var rE=Object.defineProperty;var oE=(r,l,f)=>l in r?rE(r,l,{enumerable:!0,configurable:!0,writable:!0,value:f}):r[l]=f;var dh=(r,l,f)=>(oE(r,typeof l!="symbol"?l+"":l,f),f);const sE=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))x(E);new MutationObserver(E=>{for(const I of E)if(I.type==="childList")for(const F of I.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&x(F)}).observe(document,{childList:!0,subtree:!0});function f(E){const I={};return E.integrity&&(I.integrity=E.integrity),E.referrerpolicy&&(I.referrerPolicy=E.referrerpolicy),E.crossorigin==="use-credentials"?I.credentials="include":E.crossorigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function x(E){if(E.ep)return;E.ep=!0;const I=f(E);fetch(E.href,I)}};sE();var aE=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},w1={exports:{}},gr={},Ko={exports:{}},Wt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var td=Symbol.for("react.element"),lE=Symbol.for("react.portal"),cE=Symbol.for("react.fragment"),uE=Symbol.for("react.strict_mode"),hE=Symbol.for("react.profiler"),dE=Symbol.for("react.provider"),pE=Symbol.for("react.context"),fE=Symbol.for("react.forward_ref"),mE=Symbol.for("react.suspense"),_E=Symbol.for("react.memo"),gE=Symbol.for("react.lazy"),cv=Symbol.iterator;function yE(r){return r===null||typeof r!="object"?null:(r=cv&&r[cv]||r["@@iterator"],typeof r=="function"?r:null)}var b1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T1=Object.assign,E1={};function Kc(r,l,f){this.props=r,this.context=l,this.refs=E1,this.updater=f||b1}Kc.prototype.isReactComponent={};Kc.prototype.setState=function(r,l){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,l,"setState")};Kc.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function S1(){}S1.prototype=Kc.prototype;function Zg(r,l,f){this.props=r,this.context=l,this.refs=E1,this.updater=f||b1}var qg=Zg.prototype=new S1;qg.constructor=Zg;T1(qg,Kc.prototype);qg.isPureReactComponent=!0;var uv=Array.isArray,C1=Object.prototype.hasOwnProperty,Wg={current:null},A1={key:!0,ref:!0,__self:!0,__source:!0};function I1(r,l,f){var x,E={},I=null,F=null;if(l!=null)for(x in l.ref!==void 0&&(F=l.ref),l.key!==void 0&&(I=""+l.key),l)C1.call(l,x)&&!A1.hasOwnProperty(x)&&(E[x]=l[x]);var s=arguments.length-2;if(s===1)E.children=f;else if(1<s){for(var G=Array(s),ue=0;ue<s;ue++)G[ue]=arguments[ue+2];E.children=G}if(r&&r.defaultProps)for(x in s=r.defaultProps,s)E[x]===void 0&&(E[x]=s[x]);return{$$typeof:td,type:r,key:I,ref:F,props:E,_owner:Wg.current}}function xE(r,l){return{$$typeof:td,type:r.type,key:l,ref:r.ref,props:r.props,_owner:r._owner}}function Xg(r){return typeof r=="object"&&r!==null&&r.$$typeof===td}function vE(r){var l={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(f){return l[f]})}var hv=/\/+/g;function C_(r,l){return typeof r=="object"&&r!==null&&r.key!=null?vE(""+r.key):l.toString(36)}function uf(r,l,f,x,E){var I=typeof r;(I==="undefined"||I==="boolean")&&(r=null);var F=!1;if(r===null)F=!0;else switch(I){case"string":case"number":F=!0;break;case"object":switch(r.$$typeof){case td:case lE:F=!0}}if(F)return F=r,E=E(F),r=x===""?"."+C_(F,0):x,uv(E)?(f="",r!=null&&(f=r.replace(hv,"$&/")+"/"),uf(E,l,f,"",function(ue){return ue})):E!=null&&(Xg(E)&&(E=xE(E,f+(!E.key||F&&F.key===E.key?"":(""+E.key).replace(hv,"$&/")+"/")+r)),l.push(E)),1;if(F=0,x=x===""?".":x+":",uv(r))for(var s=0;s<r.length;s++){I=r[s];var G=x+C_(I,s);F+=uf(I,l,f,G,E)}else if(G=yE(r),typeof G=="function")for(r=G.call(r),s=0;!(I=r.next()).done;)I=I.value,G=x+C_(I,s++),F+=uf(I,l,f,G,E);else if(I==="object")throw l=String(r),Error("Objects are not valid as a React child (found: "+(l==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":l)+"). If you meant to render a collection of children, use an array instead.");return F}function $p(r,l,f){if(r==null)return r;var x=[],E=0;return uf(r,x,"","",function(I){return l.call(f,I,E++)}),x}function wE(r){if(r._status===-1){var l=r._result;l=l(),l.then(function(f){(r._status===0||r._status===-1)&&(r._status=1,r._result=f)},function(f){(r._status===0||r._status===-1)&&(r._status=2,r._result=f)}),r._status===-1&&(r._status=0,r._result=l)}if(r._status===1)return r._result.default;throw r._result}var On={current:null},hf={transition:null},bE={ReactCurrentDispatcher:On,ReactCurrentBatchConfig:hf,ReactCurrentOwner:Wg};Wt.Children={map:$p,forEach:function(r,l,f){$p(r,function(){l.apply(this,arguments)},f)},count:function(r){var l=0;return $p(r,function(){l++}),l},toArray:function(r){return $p(r,function(l){return l})||[]},only:function(r){if(!Xg(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Wt.Component=Kc;Wt.Fragment=cE;Wt.Profiler=hE;Wt.PureComponent=Zg;Wt.StrictMode=uE;Wt.Suspense=mE;Wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bE;Wt.cloneElement=function(r,l,f){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var x=T1({},r.props),E=r.key,I=r.ref,F=r._owner;if(l!=null){if(l.ref!==void 0&&(I=l.ref,F=Wg.current),l.key!==void 0&&(E=""+l.key),r.type&&r.type.defaultProps)var s=r.type.defaultProps;for(G in l)C1.call(l,G)&&!A1.hasOwnProperty(G)&&(x[G]=l[G]===void 0&&s!==void 0?s[G]:l[G])}var G=arguments.length-2;if(G===1)x.children=f;else if(1<G){s=Array(G);for(var ue=0;ue<G;ue++)s[ue]=arguments[ue+2];x.children=s}return{$$typeof:td,type:r.type,key:E,ref:I,props:x,_owner:F}};Wt.createContext=function(r){return r={$$typeof:pE,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:dE,_context:r},r.Consumer=r};Wt.createElement=I1;Wt.createFactory=function(r){var l=I1.bind(null,r);return l.type=r,l};Wt.createRef=function(){return{current:null}};Wt.forwardRef=function(r){return{$$typeof:fE,render:r}};Wt.isValidElement=Xg;Wt.lazy=function(r){return{$$typeof:gE,_payload:{_status:-1,_result:r},_init:wE}};Wt.memo=function(r,l){return{$$typeof:_E,type:r,compare:l===void 0?null:l}};Wt.startTransition=function(r){var l=hf.transition;hf.transition={};try{r()}finally{hf.transition=l}};Wt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Wt.useCallback=function(r,l){return On.current.useCallback(r,l)};Wt.useContext=function(r){return On.current.useContext(r)};Wt.useDebugValue=function(){};Wt.useDeferredValue=function(r){return On.current.useDeferredValue(r)};Wt.useEffect=function(r,l){return On.current.useEffect(r,l)};Wt.useId=function(){return On.current.useId()};Wt.useImperativeHandle=function(r,l,f){return On.current.useImperativeHandle(r,l,f)};Wt.useInsertionEffect=function(r,l){return On.current.useInsertionEffect(r,l)};Wt.useLayoutEffect=function(r,l){return On.current.useLayoutEffect(r,l)};Wt.useMemo=function(r,l){return On.current.useMemo(r,l)};Wt.useReducer=function(r,l,f){return On.current.useReducer(r,l,f)};Wt.useRef=function(r){return On.current.useRef(r)};Wt.useState=function(r){return On.current.useState(r)};Wt.useSyncExternalStore=function(r,l,f){return On.current.useSyncExternalStore(r,l,f)};Wt.useTransition=function(){return On.current.useTransition()};Wt.version="18.1.0";Ko.exports=Wt;var k1={exports:{}},M1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function l(at,Et){var wt=at.length;at.push(Et);e:for(;0<wt;){var oi=wt-1>>>1,Pt=at[oi];if(0<E(Pt,Et))at[oi]=Et,at[wt]=Pt,wt=oi;else break e}}function f(at){return at.length===0?null:at[0]}function x(at){if(at.length===0)return null;var Et=at[0],wt=at.pop();if(wt!==Et){at[0]=wt;e:for(var oi=0,Pt=at.length,zi=Pt>>>1;oi<zi;){var qi=2*(oi+1)-1,Wi=at[qi],Xi=qi+1,gn=at[Xi];if(0>E(Wi,wt))Xi<Pt&&0>E(gn,Wi)?(at[oi]=gn,at[Xi]=wt,oi=Xi):(at[oi]=Wi,at[qi]=wt,oi=qi);else if(Xi<Pt&&0>E(gn,wt))at[oi]=gn,at[Xi]=wt,oi=Xi;else break e}}return Et}function E(at,Et){var wt=at.sortIndex-Et.sortIndex;return wt!==0?wt:at.id-Et.id}if(typeof performance=="object"&&typeof performance.now=="function"){var I=performance;r.unstable_now=function(){return I.now()}}else{var F=Date,s=F.now();r.unstable_now=function(){return F.now()-s}}var G=[],ue=[],ae=1,me=null,de=3,Ae=!1,je=!1,Ge=!1,Tt=typeof setTimeout=="function"?setTimeout:null,ve=typeof clearTimeout=="function"?clearTimeout:null,he=typeof setImmediate!="undefined"?setImmediate:null;typeof navigator!="undefined"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Se(at){for(var Et=f(ue);Et!==null;){if(Et.callback===null)x(ue);else if(Et.startTime<=at)x(ue),Et.sortIndex=Et.expirationTime,l(G,Et);else break;Et=f(ue)}}function Ze(at){if(Ge=!1,Se(at),!je)if(f(G)!==null)je=!0,Vn(Fe);else{var Et=f(ue);Et!==null&&xr(Ze,Et.startTime-at)}}function Fe(at,Et){je=!1,Ge&&(Ge=!1,ve(_t),_t=-1),Ae=!0;var wt=de;try{for(Se(Et),me=f(G);me!==null&&(!(me.expirationTime>Et)||at&&!un());){var oi=me.callback;if(typeof oi=="function"){me.callback=null,de=me.priorityLevel;var Pt=oi(me.expirationTime<=Et);Et=r.unstable_now(),typeof Pt=="function"?me.callback=Pt:me===f(G)&&x(G),Se(Et)}else x(G);me=f(G)}if(me!==null)var zi=!0;else{var qi=f(ue);qi!==null&&xr(Ze,qi.startTime-Et),zi=!1}return zi}finally{me=null,de=wt,Ae=!1}}var ct=!1,ut=null,_t=-1,ii=5,vt=-1;function un(){return!(r.unstable_now()-vt<ii)}function Un(){if(ut!==null){var at=r.unstable_now();vt=at;var Et=!0;try{Et=ut(!0,at)}finally{Et?jn():(ct=!1,ut=null)}}else ct=!1}var jn;if(typeof he=="function")jn=function(){he(Un)};else if(typeof MessageChannel!="undefined"){var Co=new MessageChannel,as=Co.port2;Co.port1.onmessage=Un,jn=function(){as.postMessage(null)}}else jn=function(){Tt(Un,0)};function Vn(at){ut=at,ct||(ct=!0,jn())}function xr(at,Et){_t=Tt(function(){at(r.unstable_now())},Et)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(at){at.callback=null},r.unstable_continueExecution=function(){je||Ae||(je=!0,Vn(Fe))},r.unstable_forceFrameRate=function(at){0>at||125<at?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ii=0<at?Math.floor(1e3/at):5},r.unstable_getCurrentPriorityLevel=function(){return de},r.unstable_getFirstCallbackNode=function(){return f(G)},r.unstable_next=function(at){switch(de){case 1:case 2:case 3:var Et=3;break;default:Et=de}var wt=de;de=Et;try{return at()}finally{de=wt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(at,Et){switch(at){case 1:case 2:case 3:case 4:case 5:break;default:at=3}var wt=de;de=at;try{return Et()}finally{de=wt}},r.unstable_scheduleCallback=function(at,Et,wt){var oi=r.unstable_now();switch(typeof wt=="object"&&wt!==null?(wt=wt.delay,wt=typeof wt=="number"&&0<wt?oi+wt:oi):wt=oi,at){case 1:var Pt=-1;break;case 2:Pt=250;break;case 5:Pt=1073741823;break;case 4:Pt=1e4;break;default:Pt=5e3}return Pt=wt+Pt,at={id:ae++,callback:Et,priorityLevel:at,startTime:wt,expirationTime:Pt,sortIndex:-1},wt>oi?(at.sortIndex=wt,l(ue,at),f(G)===null&&at===f(ue)&&(Ge?(ve(_t),_t=-1):Ge=!0,xr(Ze,wt-oi))):(at.sortIndex=Pt,l(G,at),je||Ae||(je=!0,Vn(Fe))),at},r.unstable_shouldYield=un,r.unstable_wrapCallback=function(at){var Et=de;return function(){var wt=de;de=Et;try{return at.apply(this,arguments)}finally{de=wt}}}})(M1);k1.exports=M1;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z1=Ko.exports,_r=k1.exports;function We(r){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+r,f=1;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+r+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var P1=new Set,Oh={};function hl(r,l){Zc(r,l),Zc(r+"Capture",l)}function Zc(r,l){for(Oh[r]=l,r=0;r<l.length;r++)P1.add(l[r])}var ns=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Q_=Object.prototype.hasOwnProperty,TE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,dv={},pv={};function EE(r){return Q_.call(pv,r)?!0:Q_.call(dv,r)?!1:TE.test(r)?pv[r]=!0:(dv[r]=!0,!1)}function SE(r,l,f,x){if(f!==null&&f.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return x?!1:f!==null?!f.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function CE(r,l,f,x){if(l===null||typeof l=="undefined"||SE(r,l,f,x))return!0;if(x)return!1;if(f!==null)switch(f.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function Nn(r,l,f,x,E,I,F){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=x,this.attributeNamespace=E,this.mustUseProperty=f,this.propertyName=r,this.type=l,this.sanitizeURL=I,this.removeEmptyString=F}var _n={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){_n[r]=new Nn(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var l=r[0];_n[l]=new Nn(l,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){_n[r]=new Nn(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){_n[r]=new Nn(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){_n[r]=new Nn(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){_n[r]=new Nn(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){_n[r]=new Nn(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){_n[r]=new Nn(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){_n[r]=new Nn(r,5,!1,r.toLowerCase(),null,!1,!1)});var Hg=/[\-:]([a-z])/g;function Yg(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var l=r.replace(Hg,Yg);_n[l]=new Nn(l,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var l=r.replace(Hg,Yg);_n[l]=new Nn(l,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var l=r.replace(Hg,Yg);_n[l]=new Nn(l,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){_n[r]=new Nn(r,1,!1,r.toLowerCase(),null,!1,!1)});_n.xlinkHref=new Nn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){_n[r]=new Nn(r,1,!1,r.toLowerCase(),null,!0,!0)});function Kg(r,l,f,x){var E=_n.hasOwnProperty(l)?_n[l]:null;(E!==null?E.type!==0:x||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(CE(l,f,E,x)&&(f=null),x||E===null?EE(l)&&(f===null?r.removeAttribute(l):r.setAttribute(l,""+f)):E.mustUseProperty?r[E.propertyName]=f===null?E.type===3?!1:"":f:(l=E.attributeName,x=E.attributeNamespace,f===null?r.removeAttribute(l):(E=E.type,f=E===3||E===4&&f===!0?"":""+f,x?r.setAttributeNS(x,l,f):r.setAttribute(l,f))))}var ss=z1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Zp=Symbol.for("react.element"),Ac=Symbol.for("react.portal"),Ic=Symbol.for("react.fragment"),Jg=Symbol.for("react.strict_mode"),eg=Symbol.for("react.profiler"),D1=Symbol.for("react.provider"),L1=Symbol.for("react.context"),Qg=Symbol.for("react.forward_ref"),tg=Symbol.for("react.suspense"),ig=Symbol.for("react.suspense_list"),ey=Symbol.for("react.memo"),$s=Symbol.for("react.lazy"),B1=Symbol.for("react.offscreen"),fv=Symbol.iterator;function ph(r){return r===null||typeof r!="object"?null:(r=fv&&r[fv]||r["@@iterator"],typeof r=="function"?r:null)}var Fi=Object.assign,A_;function Sh(r){if(A_===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);A_=l&&l[1]||""}return`
`+A_+r}var I_=!1;function k_(r,l){if(!r||I_)return"";I_=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(ue){var x=ue}Reflect.construct(r,[],l)}else{try{l.call()}catch(ue){x=ue}r.call(l.prototype)}else{try{throw Error()}catch(ue){x=ue}r()}}catch(ue){if(ue&&x&&typeof ue.stack=="string"){for(var E=ue.stack.split(`
`),I=x.stack.split(`
`),F=E.length-1,s=I.length-1;1<=F&&0<=s&&E[F]!==I[s];)s--;for(;1<=F&&0<=s;F--,s--)if(E[F]!==I[s]){if(F!==1||s!==1)do if(F--,s--,0>s||E[F]!==I[s]){var G=`
`+E[F].replace(" at new "," at ");return r.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",r.displayName)),G}while(1<=F&&0<=s);break}}}finally{I_=!1,Error.prepareStackTrace=f}return(r=r?r.displayName||r.name:"")?Sh(r):""}function AE(r){switch(r.tag){case 5:return Sh(r.type);case 16:return Sh("Lazy");case 13:return Sh("Suspense");case 19:return Sh("SuspenseList");case 0:case 2:case 15:return r=k_(r.type,!1),r;case 11:return r=k_(r.type.render,!1),r;case 1:return r=k_(r.type,!0),r;default:return""}}function ng(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Ic:return"Fragment";case Ac:return"Portal";case eg:return"Profiler";case Jg:return"StrictMode";case tg:return"Suspense";case ig:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case L1:return(r.displayName||"Context")+".Consumer";case D1:return(r._context.displayName||"Context")+".Provider";case Qg:var l=r.render;return r=r.displayName,r||(r=l.displayName||l.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case ey:return l=r.displayName||null,l!==null?l:ng(r.type)||"Memo";case $s:l=r._payload,r=r._init;try{return ng(r(l))}catch{}}return null}function IE(r){var l=r.type;switch(r.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=l.render,r=r.displayName||r.name||"",l.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ng(l);case 8:return l===Jg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function ia(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function R1(r){var l=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function kE(r){var l=R1(r)?"checked":"value",f=Object.getOwnPropertyDescriptor(r.constructor.prototype,l),x=""+r[l];if(!r.hasOwnProperty(l)&&typeof f!="undefined"&&typeof f.get=="function"&&typeof f.set=="function"){var E=f.get,I=f.set;return Object.defineProperty(r,l,{configurable:!0,get:function(){return E.call(this)},set:function(F){x=""+F,I.call(this,F)}}),Object.defineProperty(r,l,{enumerable:f.enumerable}),{getValue:function(){return x},setValue:function(F){x=""+F},stopTracking:function(){r._valueTracker=null,delete r[l]}}}}function qp(r){r._valueTracker||(r._valueTracker=kE(r))}function F1(r){if(!r)return!1;var l=r._valueTracker;if(!l)return!0;var f=l.getValue(),x="";return r&&(x=R1(r)?r.checked?"true":"false":r.value),r=x,r!==f?(l.setValue(r),!0):!1}function wf(r){if(r=r||(typeof document!="undefined"?document:void 0),typeof r=="undefined")return null;try{return r.activeElement||r.body}catch{return r.body}}function rg(r,l){var f=l.checked;return Fi({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f!=null?f:r._wrapperState.initialChecked})}function mv(r,l){var f=l.defaultValue==null?"":l.defaultValue,x=l.checked!=null?l.checked:l.defaultChecked;f=ia(l.value!=null?l.value:f),r._wrapperState={initialChecked:x,initialValue:f,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function O1(r,l){l=l.checked,l!=null&&Kg(r,"checked",l,!1)}function og(r,l){O1(r,l);var f=ia(l.value),x=l.type;if(f!=null)x==="number"?(f===0&&r.value===""||r.value!=f)&&(r.value=""+f):r.value!==""+f&&(r.value=""+f);else if(x==="submit"||x==="reset"){r.removeAttribute("value");return}l.hasOwnProperty("value")?sg(r,l.type,f):l.hasOwnProperty("defaultValue")&&sg(r,l.type,ia(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(r.defaultChecked=!!l.defaultChecked)}function _v(r,l,f){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var x=l.type;if(!(x!=="submit"&&x!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+r._wrapperState.initialValue,f||l===r.value||(r.value=l),r.defaultValue=l}f=r.name,f!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,f!==""&&(r.name=f)}function sg(r,l,f){(l!=="number"||wf(r.ownerDocument)!==r)&&(f==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+f&&(r.defaultValue=""+f))}var Ch=Array.isArray;function Nc(r,l,f,x){if(r=r.options,l){l={};for(var E=0;E<f.length;E++)l["$"+f[E]]=!0;for(f=0;f<r.length;f++)E=l.hasOwnProperty("$"+r[f].value),r[f].selected!==E&&(r[f].selected=E),E&&x&&(r[f].defaultSelected=!0)}else{for(f=""+ia(f),l=null,E=0;E<r.length;E++){if(r[E].value===f){r[E].selected=!0,x&&(r[E].defaultSelected=!0);return}l!==null||r[E].disabled||(l=r[E])}l!==null&&(l.selected=!0)}}function ag(r,l){if(l.dangerouslySetInnerHTML!=null)throw Error(We(91));return Fi({},l,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function gv(r,l){var f=l.value;if(f==null){if(f=l.children,l=l.defaultValue,f!=null){if(l!=null)throw Error(We(92));if(Ch(f)){if(1<f.length)throw Error(We(93));f=f[0]}l=f}l==null&&(l=""),f=l}r._wrapperState={initialValue:ia(f)}}function N1(r,l){var f=ia(l.value),x=ia(l.defaultValue);f!=null&&(f=""+f,f!==r.value&&(r.value=f),l.defaultValue==null&&r.defaultValue!==f&&(r.defaultValue=f)),x!=null&&(r.defaultValue=""+x)}function yv(r){var l=r.textContent;l===r._wrapperState.initialValue&&l!==""&&l!==null&&(r.value=l)}function U1(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lg(r,l){return r==null||r==="http://www.w3.org/1999/xhtml"?U1(l):r==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Wp,j1=function(r){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(l,f,x,E){MSApp.execUnsafeLocalFunction(function(){return r(l,f,x,E)})}:r}(function(r,l){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=l;else{for(Wp=Wp||document.createElement("div"),Wp.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=Wp.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;l.firstChild;)r.appendChild(l.firstChild)}});function Nh(r,l){if(l){var f=r.firstChild;if(f&&f===r.lastChild&&f.nodeType===3){f.nodeValue=l;return}}r.textContent=l}var kh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ME=["Webkit","ms","Moz","O"];Object.keys(kh).forEach(function(r){ME.forEach(function(l){l=l+r.charAt(0).toUpperCase()+r.substring(1),kh[l]=kh[r]})});function V1(r,l,f){return l==null||typeof l=="boolean"||l===""?"":f||typeof l!="number"||l===0||kh.hasOwnProperty(r)&&kh[r]?(""+l).trim():l+"px"}function G1(r,l){r=r.style;for(var f in l)if(l.hasOwnProperty(f)){var x=f.indexOf("--")===0,E=V1(f,l[f],x);f==="float"&&(f="cssFloat"),x?r.setProperty(f,E):r[f]=E}}var zE=Fi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function cg(r,l){if(l){if(zE[r]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(We(137,r));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(We(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(We(61))}if(l.style!=null&&typeof l.style!="object")throw Error(We(62))}}function ug(r,l){if(r.indexOf("-")===-1)return typeof l.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hg=null;function ty(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var dg=null,Uc=null,jc=null;function xv(r){if(r=rd(r)){if(typeof dg!="function")throw Error(We(280));var l=r.stateNode;l&&(l=Yf(l),dg(r.stateNode,r.type,l))}}function $1(r){Uc?jc?jc.push(r):jc=[r]:Uc=r}function Z1(){if(Uc){var r=Uc,l=jc;if(jc=Uc=null,xv(r),l)for(r=0;r<l.length;r++)xv(l[r])}}function q1(r,l){return r(l)}function W1(){}var M_=!1;function X1(r,l,f){if(M_)return r(l,f);M_=!0;try{return q1(r,l,f)}finally{M_=!1,(Uc!==null||jc!==null)&&(W1(),Z1())}}function Uh(r,l){var f=r.stateNode;if(f===null)return null;var x=Yf(f);if(x===null)return null;f=x[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(r=r.type,x=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!x;break e;default:r=!1}if(r)return null;if(f&&typeof f!="function")throw Error(We(231,l,typeof f));return f}var pg=!1;if(ns)try{var fh={};Object.defineProperty(fh,"passive",{get:function(){pg=!0}}),window.addEventListener("test",fh,fh),window.removeEventListener("test",fh,fh)}catch{pg=!1}function PE(r,l,f,x,E,I,F,s,G){var ue=Array.prototype.slice.call(arguments,3);try{l.apply(f,ue)}catch(ae){this.onError(ae)}}var Mh=!1,bf=null,Tf=!1,fg=null,DE={onError:function(r){Mh=!0,bf=r}};function LE(r,l,f,x,E,I,F,s,G){Mh=!1,bf=null,PE.apply(DE,arguments)}function BE(r,l,f,x,E,I,F,s,G){if(LE.apply(this,arguments),Mh){if(Mh){var ue=bf;Mh=!1,bf=null}else throw Error(We(198));Tf||(Tf=!0,fg=ue)}}function dl(r){var l=r,f=r;if(r.alternate)for(;l.return;)l=l.return;else{r=l;do l=r,(l.flags&4098)!==0&&(f=l.return),r=l.return;while(r)}return l.tag===3?f:null}function H1(r){if(r.tag===13){var l=r.memoizedState;if(l===null&&(r=r.alternate,r!==null&&(l=r.memoizedState)),l!==null)return l.dehydrated}return null}function vv(r){if(dl(r)!==r)throw Error(We(188))}function RE(r){var l=r.alternate;if(!l){if(l=dl(r),l===null)throw Error(We(188));return l!==r?null:r}for(var f=r,x=l;;){var E=f.return;if(E===null)break;var I=E.alternate;if(I===null){if(x=E.return,x!==null){f=x;continue}break}if(E.child===I.child){for(I=E.child;I;){if(I===f)return vv(E),r;if(I===x)return vv(E),l;I=I.sibling}throw Error(We(188))}if(f.return!==x.return)f=E,x=I;else{for(var F=!1,s=E.child;s;){if(s===f){F=!0,f=E,x=I;break}if(s===x){F=!0,x=E,f=I;break}s=s.sibling}if(!F){for(s=I.child;s;){if(s===f){F=!0,f=I,x=E;break}if(s===x){F=!0,x=I,f=E;break}s=s.sibling}if(!F)throw Error(We(189))}}if(f.alternate!==x)throw Error(We(190))}if(f.tag!==3)throw Error(We(188));return f.stateNode.current===f?r:l}function Y1(r){return r=RE(r),r!==null?K1(r):null}function K1(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var l=K1(r);if(l!==null)return l;r=r.sibling}return null}var J1=_r.unstable_scheduleCallback,wv=_r.unstable_cancelCallback,FE=_r.unstable_shouldYield,OE=_r.unstable_requestPaint,Vi=_r.unstable_now,NE=_r.unstable_getCurrentPriorityLevel,iy=_r.unstable_ImmediatePriority,Q1=_r.unstable_UserBlockingPriority,Ef=_r.unstable_NormalPriority,UE=_r.unstable_LowPriority,ew=_r.unstable_IdlePriority,qf=null,Eo=null;function jE(r){if(Eo&&typeof Eo.onCommitFiberRoot=="function")try{Eo.onCommitFiberRoot(qf,r,void 0,(r.current.flags&128)===128)}catch{}}var no=Math.clz32?Math.clz32:$E,VE=Math.log,GE=Math.LN2;function $E(r){return r>>>=0,r===0?32:31-(VE(r)/GE|0)|0}var Xp=64,Hp=4194304;function Ah(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Sf(r,l){var f=r.pendingLanes;if(f===0)return 0;var x=0,E=r.suspendedLanes,I=r.pingedLanes,F=f&268435455;if(F!==0){var s=F&~E;s!==0?x=Ah(s):(I&=F,I!==0&&(x=Ah(I)))}else F=f&~E,F!==0?x=Ah(F):I!==0&&(x=Ah(I));if(x===0)return 0;if(l!==0&&l!==x&&(l&E)===0&&(E=x&-x,I=l&-l,E>=I||E===16&&(I&4194240)!==0))return l;if((x&4)!==0&&(x|=f&16),l=r.entangledLanes,l!==0)for(r=r.entanglements,l&=x;0<l;)f=31-no(l),E=1<<f,x|=r[f],l&=~E;return x}function ZE(r,l){switch(r){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qE(r,l){for(var f=r.suspendedLanes,x=r.pingedLanes,E=r.expirationTimes,I=r.pendingLanes;0<I;){var F=31-no(I),s=1<<F,G=E[F];G===-1?((s&f)===0||(s&x)!==0)&&(E[F]=ZE(s,l)):G<=l&&(r.expiredLanes|=s),I&=~s}}function mg(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function tw(){var r=Xp;return Xp<<=1,(Xp&4194240)===0&&(Xp=64),r}function z_(r){for(var l=[],f=0;31>f;f++)l.push(r);return l}function id(r,l,f){r.pendingLanes|=l,l!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,l=31-no(l),r[l]=f}function WE(r,l){var f=r.pendingLanes&~l;r.pendingLanes=l,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=l,r.mutableReadLanes&=l,r.entangledLanes&=l,l=r.entanglements;var x=r.eventTimes;for(r=r.expirationTimes;0<f;){var E=31-no(f),I=1<<E;l[E]=0,x[E]=-1,r[E]=-1,f&=~I}}function ny(r,l){var f=r.entangledLanes|=l;for(r=r.entanglements;f;){var x=31-no(f),E=1<<x;E&l|r[x]&l&&(r[x]|=l),f&=~E}}var ci=0;function iw(r){return r&=-r,1<r?4<r?(r&268435455)!==0?16:536870912:4:1}var nw,ry,rw,ow,sw,_g=!1,Yp=[],Ys=null,Ks=null,Js=null,jh=new Map,Vh=new Map,qs=[],XE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bv(r,l){switch(r){case"focusin":case"focusout":Ys=null;break;case"dragenter":case"dragleave":Ks=null;break;case"mouseover":case"mouseout":Js=null;break;case"pointerover":case"pointerout":jh.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vh.delete(l.pointerId)}}function mh(r,l,f,x,E,I){return r===null||r.nativeEvent!==I?(r={blockedOn:l,domEventName:f,eventSystemFlags:x,nativeEvent:I,targetContainers:[E]},l!==null&&(l=rd(l),l!==null&&ry(l)),r):(r.eventSystemFlags|=x,l=r.targetContainers,E!==null&&l.indexOf(E)===-1&&l.push(E),r)}function HE(r,l,f,x,E){switch(l){case"focusin":return Ys=mh(Ys,r,l,f,x,E),!0;case"dragenter":return Ks=mh(Ks,r,l,f,x,E),!0;case"mouseover":return Js=mh(Js,r,l,f,x,E),!0;case"pointerover":var I=E.pointerId;return jh.set(I,mh(jh.get(I)||null,r,l,f,x,E)),!0;case"gotpointercapture":return I=E.pointerId,Vh.set(I,mh(Vh.get(I)||null,r,l,f,x,E)),!0}return!1}function aw(r){var l=il(r.target);if(l!==null){var f=dl(l);if(f!==null){if(l=f.tag,l===13){if(l=H1(f),l!==null){r.blockedOn=l,sw(r.priority,function(){rw(f)});return}}else if(l===3&&f.stateNode.current.memoizedState.isDehydrated){r.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}r.blockedOn=null}function df(r){if(r.blockedOn!==null)return!1;for(var l=r.targetContainers;0<l.length;){var f=gg(r.domEventName,r.eventSystemFlags,l[0],r.nativeEvent);if(f===null){f=r.nativeEvent;var x=new f.constructor(f.type,f);hg=x,f.target.dispatchEvent(x),hg=null}else return l=rd(f),l!==null&&ry(l),r.blockedOn=f,!1;l.shift()}return!0}function Tv(r,l,f){df(r)&&f.delete(l)}function YE(){_g=!1,Ys!==null&&df(Ys)&&(Ys=null),Ks!==null&&df(Ks)&&(Ks=null),Js!==null&&df(Js)&&(Js=null),jh.forEach(Tv),Vh.forEach(Tv)}function _h(r,l){r.blockedOn===l&&(r.blockedOn=null,_g||(_g=!0,_r.unstable_scheduleCallback(_r.unstable_NormalPriority,YE)))}function Gh(r){function l(E){return _h(E,r)}if(0<Yp.length){_h(Yp[0],r);for(var f=1;f<Yp.length;f++){var x=Yp[f];x.blockedOn===r&&(x.blockedOn=null)}}for(Ys!==null&&_h(Ys,r),Ks!==null&&_h(Ks,r),Js!==null&&_h(Js,r),jh.forEach(l),Vh.forEach(l),f=0;f<qs.length;f++)x=qs[f],x.blockedOn===r&&(x.blockedOn=null);for(;0<qs.length&&(f=qs[0],f.blockedOn===null);)aw(f),f.blockedOn===null&&qs.shift()}var Vc=ss.ReactCurrentBatchConfig,Cf=!0;function KE(r,l,f,x){var E=ci,I=Vc.transition;Vc.transition=null;try{ci=1,oy(r,l,f,x)}finally{ci=E,Vc.transition=I}}function JE(r,l,f,x){var E=ci,I=Vc.transition;Vc.transition=null;try{ci=4,oy(r,l,f,x)}finally{ci=E,Vc.transition=I}}function oy(r,l,f,x){if(Cf){var E=gg(r,l,f,x);if(E===null)j_(r,l,x,Af,f),bv(r,x);else if(HE(E,r,l,f,x))x.stopPropagation();else if(bv(r,x),l&4&&-1<XE.indexOf(r)){for(;E!==null;){var I=rd(E);if(I!==null&&nw(I),I=gg(r,l,f,x),I===null&&j_(r,l,x,Af,f),I===E)break;E=I}E!==null&&x.stopPropagation()}else j_(r,l,x,null,f)}}var Af=null;function gg(r,l,f,x){if(Af=null,r=ty(x),r=il(r),r!==null)if(l=dl(r),l===null)r=null;else if(f=l.tag,f===13){if(r=H1(l),r!==null)return r;r=null}else if(f===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;r=null}else l!==r&&(r=null);return Af=r,null}function lw(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(NE()){case iy:return 1;case Q1:return 4;case Ef:case UE:return 16;case ew:return 536870912;default:return 16}default:return 16}}var Xs=null,sy=null,pf=null;function cw(){if(pf)return pf;var r,l=sy,f=l.length,x,E="value"in Xs?Xs.value:Xs.textContent,I=E.length;for(r=0;r<f&&l[r]===E[r];r++);var F=f-r;for(x=1;x<=F&&l[f-x]===E[I-x];x++);return pf=E.slice(r,1<x?1-x:void 0)}function ff(r){var l=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&l===13&&(r=13)):r=l,r===10&&(r=13),32<=r||r===13?r:0}function Kp(){return!0}function Ev(){return!1}function yr(r){function l(f,x,E,I,F){this._reactName=f,this._targetInst=E,this.type=x,this.nativeEvent=I,this.target=F,this.currentTarget=null;for(var s in r)r.hasOwnProperty(s)&&(f=r[s],this[s]=f?f(I):I[s]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?Kp:Ev,this.isPropagationStopped=Ev,this}return Fi(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Kp)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Kp)},persist:function(){},isPersistent:Kp}),l}var Jc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ay=yr(Jc),nd=Fi({},Jc,{view:0,detail:0}),QE=yr(nd),P_,D_,gh,Wf=Fi({},nd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ly,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==gh&&(gh&&r.type==="mousemove"?(P_=r.screenX-gh.screenX,D_=r.screenY-gh.screenY):D_=P_=0,gh=r),P_)},movementY:function(r){return"movementY"in r?r.movementY:D_}}),Sv=yr(Wf),eS=Fi({},Wf,{dataTransfer:0}),tS=yr(eS),iS=Fi({},nd,{relatedTarget:0}),L_=yr(iS),nS=Fi({},Jc,{animationName:0,elapsedTime:0,pseudoElement:0}),rS=yr(nS),oS=Fi({},Jc,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),sS=yr(oS),aS=Fi({},Jc,{data:0}),Cv=yr(aS),lS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},uS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hS(r){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(r):(r=uS[r])?!!l[r]:!1}function ly(){return hS}var dS=Fi({},nd,{key:function(r){if(r.key){var l=lS[r.key]||r.key;if(l!=="Unidentified")return l}return r.type==="keypress"?(r=ff(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?cS[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ly,charCode:function(r){return r.type==="keypress"?ff(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ff(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),pS=yr(dS),fS=Fi({},Wf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Av=yr(fS),mS=Fi({},nd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ly}),_S=yr(mS),gS=Fi({},Jc,{propertyName:0,elapsedTime:0,pseudoElement:0}),yS=yr(gS),xS=Fi({},Wf,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),vS=yr(xS),wS=[9,13,27,32],cy=ns&&"CompositionEvent"in window,zh=null;ns&&"documentMode"in document&&(zh=document.documentMode);var bS=ns&&"TextEvent"in window&&!zh,uw=ns&&(!cy||zh&&8<zh&&11>=zh),Iv=String.fromCharCode(32),kv=!1;function hw(r,l){switch(r){case"keyup":return wS.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dw(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var kc=!1;function TS(r,l){switch(r){case"compositionend":return dw(l);case"keypress":return l.which!==32?null:(kv=!0,Iv);case"textInput":return r=l.data,r===Iv&&kv?null:r;default:return null}}function ES(r,l){if(kc)return r==="compositionend"||!cy&&hw(r,l)?(r=cw(),pf=sy=Xs=null,kc=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return uw&&l.locale!=="ko"?null:l.data;default:return null}}var SS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mv(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l==="input"?!!SS[r.type]:l==="textarea"}function pw(r,l,f,x){$1(x),l=If(l,"onChange"),0<l.length&&(f=new ay("onChange","change",null,f,x),r.push({event:f,listeners:l}))}var Ph=null,$h=null;function CS(r){Ew(r,0)}function Xf(r){var l=Pc(r);if(F1(l))return r}function AS(r,l){if(r==="change")return l}var fw=!1;if(ns){var B_;if(ns){var R_="oninput"in document;if(!R_){var zv=document.createElement("div");zv.setAttribute("oninput","return;"),R_=typeof zv.oninput=="function"}B_=R_}else B_=!1;fw=B_&&(!document.documentMode||9<document.documentMode)}function Pv(){Ph&&(Ph.detachEvent("onpropertychange",mw),$h=Ph=null)}function mw(r){if(r.propertyName==="value"&&Xf($h)){var l=[];pw(l,$h,r,ty(r)),X1(CS,l)}}function IS(r,l,f){r==="focusin"?(Pv(),Ph=l,$h=f,Ph.attachEvent("onpropertychange",mw)):r==="focusout"&&Pv()}function kS(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Xf($h)}function MS(r,l){if(r==="click")return Xf(l)}function zS(r,l){if(r==="input"||r==="change")return Xf(l)}function PS(r,l){return r===l&&(r!==0||1/r===1/l)||r!==r&&l!==l}var ro=typeof Object.is=="function"?Object.is:PS;function Zh(r,l){if(ro(r,l))return!0;if(typeof r!="object"||r===null||typeof l!="object"||l===null)return!1;var f=Object.keys(r),x=Object.keys(l);if(f.length!==x.length)return!1;for(x=0;x<f.length;x++){var E=f[x];if(!Q_.call(l,E)||!ro(r[E],l[E]))return!1}return!0}function Dv(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Lv(r,l){var f=Dv(r);r=0;for(var x;f;){if(f.nodeType===3){if(x=r+f.textContent.length,r<=l&&x>=l)return{node:f,offset:l-r};r=x}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=Dv(f)}}function _w(r,l){return r&&l?r===l?!0:r&&r.nodeType===3?!1:l&&l.nodeType===3?_w(r,l.parentNode):"contains"in r?r.contains(l):r.compareDocumentPosition?!!(r.compareDocumentPosition(l)&16):!1:!1}function gw(){for(var r=window,l=wf();l instanceof r.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)r=l.contentWindow;else break;l=wf(r.document)}return l}function uy(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l&&(l==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||l==="textarea"||r.contentEditable==="true")}function DS(r){var l=gw(),f=r.focusedElem,x=r.selectionRange;if(l!==f&&f&&f.ownerDocument&&_w(f.ownerDocument.documentElement,f)){if(x!==null&&uy(f)){if(l=x.start,r=x.end,r===void 0&&(r=l),"selectionStart"in f)f.selectionStart=l,f.selectionEnd=Math.min(r,f.value.length);else if(r=(l=f.ownerDocument||document)&&l.defaultView||window,r.getSelection){r=r.getSelection();var E=f.textContent.length,I=Math.min(x.start,E);x=x.end===void 0?I:Math.min(x.end,E),!r.extend&&I>x&&(E=x,x=I,I=E),E=Lv(f,I);var F=Lv(f,x);E&&F&&(r.rangeCount!==1||r.anchorNode!==E.node||r.anchorOffset!==E.offset||r.focusNode!==F.node||r.focusOffset!==F.offset)&&(l=l.createRange(),l.setStart(E.node,E.offset),r.removeAllRanges(),I>x?(r.addRange(l),r.extend(F.node,F.offset)):(l.setEnd(F.node,F.offset),r.addRange(l)))}}for(l=[],r=f;r=r.parentNode;)r.nodeType===1&&l.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<l.length;f++)r=l[f],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var LS=ns&&"documentMode"in document&&11>=document.documentMode,Mc=null,yg=null,Dh=null,xg=!1;function Bv(r,l,f){var x=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;xg||Mc==null||Mc!==wf(x)||(x=Mc,"selectionStart"in x&&uy(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),Dh&&Zh(Dh,x)||(Dh=x,x=If(yg,"onSelect"),0<x.length&&(l=new ay("onSelect","select",null,l,f),r.push({event:l,listeners:x}),l.target=Mc)))}function Jp(r,l){var f={};return f[r.toLowerCase()]=l.toLowerCase(),f["Webkit"+r]="webkit"+l,f["Moz"+r]="moz"+l,f}var zc={animationend:Jp("Animation","AnimationEnd"),animationiteration:Jp("Animation","AnimationIteration"),animationstart:Jp("Animation","AnimationStart"),transitionend:Jp("Transition","TransitionEnd")},F_={},yw={};ns&&(yw=document.createElement("div").style,"AnimationEvent"in window||(delete zc.animationend.animation,delete zc.animationiteration.animation,delete zc.animationstart.animation),"TransitionEvent"in window||delete zc.transitionend.transition);function Hf(r){if(F_[r])return F_[r];if(!zc[r])return r;var l=zc[r],f;for(f in l)if(l.hasOwnProperty(f)&&f in yw)return F_[r]=l[f];return r}var xw=Hf("animationend"),vw=Hf("animationiteration"),ww=Hf("animationstart"),bw=Hf("transitionend"),Tw=new Map,Rv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function oa(r,l){Tw.set(r,l),hl(l,[r])}for(var O_=0;O_<Rv.length;O_++){var N_=Rv[O_],BS=N_.toLowerCase(),RS=N_[0].toUpperCase()+N_.slice(1);oa(BS,"on"+RS)}oa(xw,"onAnimationEnd");oa(vw,"onAnimationIteration");oa(ww,"onAnimationStart");oa("dblclick","onDoubleClick");oa("focusin","onFocus");oa("focusout","onBlur");oa(bw,"onTransitionEnd");Zc("onMouseEnter",["mouseout","mouseover"]);Zc("onMouseLeave",["mouseout","mouseover"]);Zc("onPointerEnter",["pointerout","pointerover"]);Zc("onPointerLeave",["pointerout","pointerover"]);hl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hl("onBeforeInput",["compositionend","keypress","textInput","paste"]);hl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ih="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),FS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ih));function Fv(r,l,f){var x=r.type||"unknown-event";r.currentTarget=f,BE(x,l,void 0,r),r.currentTarget=null}function Ew(r,l){l=(l&4)!==0;for(var f=0;f<r.length;f++){var x=r[f],E=x.event;x=x.listeners;e:{var I=void 0;if(l)for(var F=x.length-1;0<=F;F--){var s=x[F],G=s.instance,ue=s.currentTarget;if(s=s.listener,G!==I&&E.isPropagationStopped())break e;Fv(E,s,ue),I=G}else for(F=0;F<x.length;F++){if(s=x[F],G=s.instance,ue=s.currentTarget,s=s.listener,G!==I&&E.isPropagationStopped())break e;Fv(E,s,ue),I=G}}}if(Tf)throw r=fg,Tf=!1,fg=null,r}function Ti(r,l){var f=l[Eg];f===void 0&&(f=l[Eg]=new Set);var x=r+"__bubble";f.has(x)||(Sw(l,r,2,!1),f.add(x))}function U_(r,l,f){var x=0;l&&(x|=4),Sw(f,r,x,l)}var Qp="_reactListening"+Math.random().toString(36).slice(2);function qh(r){if(!r[Qp]){r[Qp]=!0,P1.forEach(function(f){f!=="selectionchange"&&(FS.has(f)||U_(f,!1,r),U_(f,!0,r))});var l=r.nodeType===9?r:r.ownerDocument;l===null||l[Qp]||(l[Qp]=!0,U_("selectionchange",!1,l))}}function Sw(r,l,f,x){switch(lw(l)){case 1:var E=KE;break;case 4:E=JE;break;default:E=oy}f=E.bind(null,l,f,r),E=void 0,!pg||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(E=!0),x?E!==void 0?r.addEventListener(l,f,{capture:!0,passive:E}):r.addEventListener(l,f,!0):E!==void 0?r.addEventListener(l,f,{passive:E}):r.addEventListener(l,f,!1)}function j_(r,l,f,x,E){var I=x;if((l&1)===0&&(l&2)===0&&x!==null)e:for(;;){if(x===null)return;var F=x.tag;if(F===3||F===4){var s=x.stateNode.containerInfo;if(s===E||s.nodeType===8&&s.parentNode===E)break;if(F===4)for(F=x.return;F!==null;){var G=F.tag;if((G===3||G===4)&&(G=F.stateNode.containerInfo,G===E||G.nodeType===8&&G.parentNode===E))return;F=F.return}for(;s!==null;){if(F=il(s),F===null)return;if(G=F.tag,G===5||G===6){x=I=F;continue e}s=s.parentNode}}x=x.return}X1(function(){var ue=I,ae=ty(f),me=[];e:{var de=Tw.get(r);if(de!==void 0){var Ae=ay,je=r;switch(r){case"keypress":if(ff(f)===0)break e;case"keydown":case"keyup":Ae=pS;break;case"focusin":je="focus",Ae=L_;break;case"focusout":je="blur",Ae=L_;break;case"beforeblur":case"afterblur":Ae=L_;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ae=Sv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ae=tS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ae=_S;break;case xw:case vw:case ww:Ae=rS;break;case bw:Ae=yS;break;case"scroll":Ae=QE;break;case"wheel":Ae=vS;break;case"copy":case"cut":case"paste":Ae=sS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ae=Av}var Ge=(l&4)!==0,Tt=!Ge&&r==="scroll",ve=Ge?de!==null?de+"Capture":null:de;Ge=[];for(var he=ue,Se;he!==null;){Se=he;var Ze=Se.stateNode;if(Se.tag===5&&Ze!==null&&(Se=Ze,ve!==null&&(Ze=Uh(he,ve),Ze!=null&&Ge.push(Wh(he,Ze,Se)))),Tt)break;he=he.return}0<Ge.length&&(de=new Ae(de,je,null,f,ae),me.push({event:de,listeners:Ge}))}}if((l&7)===0){e:{if(de=r==="mouseover"||r==="pointerover",Ae=r==="mouseout"||r==="pointerout",de&&f!==hg&&(je=f.relatedTarget||f.fromElement)&&(il(je)||je[rs]))break e;if((Ae||de)&&(de=ae.window===ae?ae:(de=ae.ownerDocument)?de.defaultView||de.parentWindow:window,Ae?(je=f.relatedTarget||f.toElement,Ae=ue,je=je?il(je):null,je!==null&&(Tt=dl(je),je!==Tt||je.tag!==5&&je.tag!==6)&&(je=null)):(Ae=null,je=ue),Ae!==je)){if(Ge=Sv,Ze="onMouseLeave",ve="onMouseEnter",he="mouse",(r==="pointerout"||r==="pointerover")&&(Ge=Av,Ze="onPointerLeave",ve="onPointerEnter",he="pointer"),Tt=Ae==null?de:Pc(Ae),Se=je==null?de:Pc(je),de=new Ge(Ze,he+"leave",Ae,f,ae),de.target=Tt,de.relatedTarget=Se,Ze=null,il(ae)===ue&&(Ge=new Ge(ve,he+"enter",je,f,ae),Ge.target=Se,Ge.relatedTarget=Tt,Ze=Ge),Tt=Ze,Ae&&je)t:{for(Ge=Ae,ve=je,he=0,Se=Ge;Se;Se=Cc(Se))he++;for(Se=0,Ze=ve;Ze;Ze=Cc(Ze))Se++;for(;0<he-Se;)Ge=Cc(Ge),he--;for(;0<Se-he;)ve=Cc(ve),Se--;for(;he--;){if(Ge===ve||ve!==null&&Ge===ve.alternate)break t;Ge=Cc(Ge),ve=Cc(ve)}Ge=null}else Ge=null;Ae!==null&&Ov(me,de,Ae,Ge,!1),je!==null&&Tt!==null&&Ov(me,Tt,je,Ge,!0)}}e:{if(de=ue?Pc(ue):window,Ae=de.nodeName&&de.nodeName.toLowerCase(),Ae==="select"||Ae==="input"&&de.type==="file")var Fe=AS;else if(Mv(de))if(fw)Fe=zS;else{Fe=kS;var ct=IS}else(Ae=de.nodeName)&&Ae.toLowerCase()==="input"&&(de.type==="checkbox"||de.type==="radio")&&(Fe=MS);if(Fe&&(Fe=Fe(r,ue))){pw(me,Fe,f,ae);break e}ct&&ct(r,de,ue),r==="focusout"&&(ct=de._wrapperState)&&ct.controlled&&de.type==="number"&&sg(de,"number",de.value)}switch(ct=ue?Pc(ue):window,r){case"focusin":(Mv(ct)||ct.contentEditable==="true")&&(Mc=ct,yg=ue,Dh=null);break;case"focusout":Dh=yg=Mc=null;break;case"mousedown":xg=!0;break;case"contextmenu":case"mouseup":case"dragend":xg=!1,Bv(me,f,ae);break;case"selectionchange":if(LS)break;case"keydown":case"keyup":Bv(me,f,ae)}var ut;if(cy)e:{switch(r){case"compositionstart":var _t="onCompositionStart";break e;case"compositionend":_t="onCompositionEnd";break e;case"compositionupdate":_t="onCompositionUpdate";break e}_t=void 0}else kc?hw(r,f)&&(_t="onCompositionEnd"):r==="keydown"&&f.keyCode===229&&(_t="onCompositionStart");_t&&(uw&&f.locale!=="ko"&&(kc||_t!=="onCompositionStart"?_t==="onCompositionEnd"&&kc&&(ut=cw()):(Xs=ae,sy="value"in Xs?Xs.value:Xs.textContent,kc=!0)),ct=If(ue,_t),0<ct.length&&(_t=new Cv(_t,r,null,f,ae),me.push({event:_t,listeners:ct}),ut?_t.data=ut:(ut=dw(f),ut!==null&&(_t.data=ut)))),(ut=bS?TS(r,f):ES(r,f))&&(ue=If(ue,"onBeforeInput"),0<ue.length&&(ae=new Cv("onBeforeInput","beforeinput",null,f,ae),me.push({event:ae,listeners:ue}),ae.data=ut))}Ew(me,l)})}function Wh(r,l,f){return{instance:r,listener:l,currentTarget:f}}function If(r,l){for(var f=l+"Capture",x=[];r!==null;){var E=r,I=E.stateNode;E.tag===5&&I!==null&&(E=I,I=Uh(r,f),I!=null&&x.unshift(Wh(r,I,E)),I=Uh(r,l),I!=null&&x.push(Wh(r,I,E))),r=r.return}return x}function Cc(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function Ov(r,l,f,x,E){for(var I=l._reactName,F=[];f!==null&&f!==x;){var s=f,G=s.alternate,ue=s.stateNode;if(G!==null&&G===x)break;s.tag===5&&ue!==null&&(s=ue,E?(G=Uh(f,I),G!=null&&F.unshift(Wh(f,G,s))):E||(G=Uh(f,I),G!=null&&F.push(Wh(f,G,s)))),f=f.return}F.length!==0&&r.push({event:l,listeners:F})}var OS=/\r\n?/g,NS=/\u0000|\uFFFD/g;function Nv(r){return(typeof r=="string"?r:""+r).replace(OS,`
`).replace(NS,"")}function ef(r,l,f){if(l=Nv(l),Nv(r)!==l&&f)throw Error(We(425))}function kf(){}var vg=null,wg=null;function bg(r,l){return r==="textarea"||r==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Tg=typeof setTimeout=="function"?setTimeout:void 0,US=typeof clearTimeout=="function"?clearTimeout:void 0,Uv=typeof Promise=="function"?Promise:void 0,jS=typeof queueMicrotask=="function"?queueMicrotask:typeof Uv!="undefined"?function(r){return Uv.resolve(null).then(r).catch(VS)}:Tg;function VS(r){setTimeout(function(){throw r})}function V_(r,l){var f=l,x=0;do{var E=f.nextSibling;if(r.removeChild(f),E&&E.nodeType===8)if(f=E.data,f==="/$"){if(x===0){r.removeChild(E),Gh(l);return}x--}else f!=="$"&&f!=="$?"&&f!=="$!"||x++;f=E}while(f);Gh(l)}function Qo(r){for(;r!=null;r=r.nextSibling){var l=r.nodeType;if(l===1||l===3)break;if(l===8){if(l=r.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return r}function jv(r){r=r.previousSibling;for(var l=0;r;){if(r.nodeType===8){var f=r.data;if(f==="$"||f==="$!"||f==="$?"){if(l===0)return r;l--}else f==="/$"&&l++}r=r.previousSibling}return null}var Qc=Math.random().toString(36).slice(2),To="__reactFiber$"+Qc,Xh="__reactProps$"+Qc,rs="__reactContainer$"+Qc,Eg="__reactEvents$"+Qc,GS="__reactListeners$"+Qc,$S="__reactHandles$"+Qc;function il(r){var l=r[To];if(l)return l;for(var f=r.parentNode;f;){if(l=f[rs]||f[To]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(r=jv(r);r!==null;){if(f=r[To])return f;r=jv(r)}return l}r=f,f=r.parentNode}return null}function rd(r){return r=r[To]||r[rs],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Pc(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(We(33))}function Yf(r){return r[Xh]||null}var Sg=[],Dc=-1;function sa(r){return{current:r}}function Ei(r){0>Dc||(r.current=Sg[Dc],Sg[Dc]=null,Dc--)}function yi(r,l){Dc++,Sg[Dc]=r.current,r.current=l}var na={},kn=sa(na),sr=sa(!1),sl=na;function qc(r,l){var f=r.type.contextTypes;if(!f)return na;var x=r.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===l)return x.__reactInternalMemoizedMaskedChildContext;var E={},I;for(I in f)E[I]=l[I];return x&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=l,r.__reactInternalMemoizedMaskedChildContext=E),E}function ar(r){return r=r.childContextTypes,r!=null}function Mf(){Ei(sr),Ei(kn)}function Vv(r,l,f){if(kn.current!==na)throw Error(We(168));yi(kn,l),yi(sr,f)}function Cw(r,l,f){var x=r.stateNode;if(l=l.childContextTypes,typeof x.getChildContext!="function")return f;x=x.getChildContext();for(var E in x)if(!(E in l))throw Error(We(108,IE(r)||"Unknown",E));return Fi({},f,x)}function zf(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||na,sl=kn.current,yi(kn,r),yi(sr,sr.current),!0}function Gv(r,l,f){var x=r.stateNode;if(!x)throw Error(We(169));f?(r=Cw(r,l,sl),x.__reactInternalMemoizedMergedChildContext=r,Ei(sr),Ei(kn),yi(kn,r)):Ei(sr),yi(sr,f)}var Jo=null,Kf=!1,G_=!1;function Aw(r){Jo===null?Jo=[r]:Jo.push(r)}function ZS(r){Kf=!0,Aw(r)}function aa(){if(!G_&&Jo!==null){G_=!0;var r=0,l=ci;try{var f=Jo;for(ci=1;r<f.length;r++){var x=f[r];do x=x(!0);while(x!==null)}Jo=null,Kf=!1}catch(E){throw Jo!==null&&(Jo=Jo.slice(r+1)),J1(iy,aa),E}finally{ci=l,G_=!1}}return null}var qS=ss.ReactCurrentBatchConfig;function Qr(r,l){if(r&&r.defaultProps){l=Fi({},l),r=r.defaultProps;for(var f in r)l[f]===void 0&&(l[f]=r[f]);return l}return l}var Pf=sa(null),Df=null,Lc=null,hy=null;function dy(){hy=Lc=Df=null}function py(r){var l=Pf.current;Ei(Pf),r._currentValue=l}function Cg(r,l,f){for(;r!==null;){var x=r.alternate;if((r.childLanes&l)!==l?(r.childLanes|=l,x!==null&&(x.childLanes|=l)):x!==null&&(x.childLanes&l)!==l&&(x.childLanes|=l),r===f)break;r=r.return}}function Gc(r,l){Df=r,hy=Lc=null,r=r.dependencies,r!==null&&r.firstContext!==null&&((r.lanes&l)!==0&&(or=!0),r.firstContext=null)}function Lr(r){var l=r._currentValue;if(hy!==r)if(r={context:r,memoizedValue:l,next:null},Lc===null){if(Df===null)throw Error(We(308));Lc=r,Df.dependencies={lanes:0,firstContext:r}}else Lc=Lc.next=r;return l}var io=null,Zs=!1;function fy(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Iw(r,l){r=r.updateQueue,l.updateQueue===r&&(l.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function is(r,l){return{eventTime:r,lane:l,tag:0,payload:null,callback:null,next:null}}function Qs(r,l){var f=r.updateQueue;f!==null&&(f=f.shared,gb(r)?(r=f.interleaved,r===null?(l.next=l,io===null?io=[f]:io.push(f)):(l.next=r.next,r.next=l),f.interleaved=l):(r=f.pending,r===null?l.next=l:(l.next=r.next,r.next=l),f.pending=l))}function mf(r,l,f){if(l=l.updateQueue,l!==null&&(l=l.shared,(f&4194240)!==0)){var x=l.lanes;x&=r.pendingLanes,f|=x,l.lanes=f,ny(r,f)}}function $v(r,l){var f=r.updateQueue,x=r.alternate;if(x!==null&&(x=x.updateQueue,f===x)){var E=null,I=null;if(f=f.firstBaseUpdate,f!==null){do{var F={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};I===null?E=I=F:I=I.next=F,f=f.next}while(f!==null);I===null?E=I=l:I=I.next=l}else E=I=l;f={baseState:x.baseState,firstBaseUpdate:E,lastBaseUpdate:I,shared:x.shared,effects:x.effects},r.updateQueue=f;return}r=f.lastBaseUpdate,r===null?f.firstBaseUpdate=l:r.next=l,f.lastBaseUpdate=l}function Lf(r,l,f,x){var E=r.updateQueue;Zs=!1;var I=E.firstBaseUpdate,F=E.lastBaseUpdate,s=E.shared.pending;if(s!==null){E.shared.pending=null;var G=s,ue=G.next;G.next=null,F===null?I=ue:F.next=ue,F=G;var ae=r.alternate;ae!==null&&(ae=ae.updateQueue,s=ae.lastBaseUpdate,s!==F&&(s===null?ae.firstBaseUpdate=ue:s.next=ue,ae.lastBaseUpdate=G))}if(I!==null){var me=E.baseState;F=0,ae=ue=G=null,s=I;do{var de=s.lane,Ae=s.eventTime;if((x&de)===de){ae!==null&&(ae=ae.next={eventTime:Ae,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var je=r,Ge=s;switch(de=l,Ae=f,Ge.tag){case 1:if(je=Ge.payload,typeof je=="function"){me=je.call(Ae,me,de);break e}me=je;break e;case 3:je.flags=je.flags&-65537|128;case 0:if(je=Ge.payload,de=typeof je=="function"?je.call(Ae,me,de):je,de==null)break e;me=Fi({},me,de);break e;case 2:Zs=!0}}s.callback!==null&&s.lane!==0&&(r.flags|=64,de=E.effects,de===null?E.effects=[s]:de.push(s))}else Ae={eventTime:Ae,lane:de,tag:s.tag,payload:s.payload,callback:s.callback,next:null},ae===null?(ue=ae=Ae,G=me):ae=ae.next=Ae,F|=de;if(s=s.next,s===null){if(s=E.shared.pending,s===null)break;de=s,s=de.next,de.next=null,E.lastBaseUpdate=de,E.shared.pending=null}}while(1);if(ae===null&&(G=me),E.baseState=G,E.firstBaseUpdate=ue,E.lastBaseUpdate=ae,l=E.shared.interleaved,l!==null){E=l;do F|=E.lane,E=E.next;while(E!==l)}else I===null&&(E.shared.lanes=0);cl|=F,r.lanes=F,r.memoizedState=me}}function Zv(r,l,f){if(r=l.effects,l.effects=null,r!==null)for(l=0;l<r.length;l++){var x=r[l],E=x.callback;if(E!==null){if(x.callback=null,x=f,typeof E!="function")throw Error(We(191,E));E.call(x)}}}var kw=new z1.Component().refs;function Ag(r,l,f,x){l=r.memoizedState,f=f(x,l),f=f==null?l:Fi({},l,f),r.memoizedState=f,r.lanes===0&&(r.updateQueue.baseState=f)}var Jf={isMounted:function(r){return(r=r._reactInternals)?dl(r)===r:!1},enqueueSetState:function(r,l,f){r=r._reactInternals;var x=Fn(),E=ta(r),I=is(x,E);I.payload=l,f!=null&&(I.callback=f),Qs(r,I),l=Dr(r,E,x),l!==null&&mf(l,r,E)},enqueueReplaceState:function(r,l,f){r=r._reactInternals;var x=Fn(),E=ta(r),I=is(x,E);I.tag=1,I.payload=l,f!=null&&(I.callback=f),Qs(r,I),l=Dr(r,E,x),l!==null&&mf(l,r,E)},enqueueForceUpdate:function(r,l){r=r._reactInternals;var f=Fn(),x=ta(r),E=is(f,x);E.tag=2,l!=null&&(E.callback=l),Qs(r,E),l=Dr(r,x,f),l!==null&&mf(l,r,x)}};function qv(r,l,f,x,E,I,F){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(x,I,F):l.prototype&&l.prototype.isPureReactComponent?!Zh(f,x)||!Zh(E,I):!0}function Mw(r,l,f){var x=!1,E=na,I=l.contextType;return typeof I=="object"&&I!==null?I=Lr(I):(E=ar(l)?sl:kn.current,x=l.contextTypes,I=(x=x!=null)?qc(r,E):na),l=new l(f,I),r.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=Jf,r.stateNode=l,l._reactInternals=r,x&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=E,r.__reactInternalMemoizedMaskedChildContext=I),l}function Wv(r,l,f,x){r=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,x),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,x),l.state!==r&&Jf.enqueueReplaceState(l,l.state,null)}function Ig(r,l,f,x){var E=r.stateNode;E.props=f,E.state=r.memoizedState,E.refs=kw,fy(r);var I=l.contextType;typeof I=="object"&&I!==null?E.context=Lr(I):(I=ar(l)?sl:kn.current,E.context=qc(r,I)),E.state=r.memoizedState,I=l.getDerivedStateFromProps,typeof I=="function"&&(Ag(r,l,I,f),E.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(l=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),l!==E.state&&Jf.enqueueReplaceState(E,E.state,null),Lf(r,f,E,x),E.state=r.memoizedState),typeof E.componentDidMount=="function"&&(r.flags|=4194308)}var Bc=[],Rc=0,Bf=null,Rf=0,kr=[],Mr=0,al=null,es=1,ts="";function el(r,l){Bc[Rc++]=Rf,Bc[Rc++]=Bf,Bf=r,Rf=l}function zw(r,l,f){kr[Mr++]=es,kr[Mr++]=ts,kr[Mr++]=al,al=r;var x=es;r=ts;var E=32-no(x)-1;x&=~(1<<E),f+=1;var I=32-no(l)+E;if(30<I){var F=E-E%5;I=(x&(1<<F)-1).toString(32),x>>=F,E-=F,es=1<<32-no(l)+E|f<<E|x,ts=I+r}else es=1<<I|f<<E|x,ts=r}function my(r){r.return!==null&&(el(r,1),zw(r,1,0))}function _y(r){for(;r===Bf;)Bf=Bc[--Rc],Bc[Rc]=null,Rf=Bc[--Rc],Bc[Rc]=null;for(;r===al;)al=kr[--Mr],kr[Mr]=null,ts=kr[--Mr],kr[Mr]=null,es=kr[--Mr],kr[Mr]=null}var mr=null,rr=null,Mi=!1,to=null;function Pw(r,l){var f=zr(5,null,null,0);f.elementType="DELETED",f.stateNode=l,f.return=r,l=r.deletions,l===null?(r.deletions=[f],r.flags|=16):l.push(f)}function Xv(r,l){switch(r.tag){case 5:var f=r.type;return l=l.nodeType!==1||f.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(r.stateNode=l,mr=r,rr=Qo(l.firstChild),!0):!1;case 6:return l=r.pendingProps===""||l.nodeType!==3?null:l,l!==null?(r.stateNode=l,mr=r,rr=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(f=al!==null?{id:es,overflow:ts}:null,r.memoizedState={dehydrated:l,treeContext:f,retryLane:1073741824},f=zr(18,null,null,0),f.stateNode=l,f.return=r,r.child=f,mr=r,rr=null,!0):!1;default:return!1}}function kg(r){return(r.mode&1)!==0&&(r.flags&128)===0}function Mg(r){if(Mi){var l=rr;if(l){var f=l;if(!Xv(r,l)){if(kg(r))throw Error(We(418));l=Qo(f.nextSibling);var x=mr;l&&Xv(r,l)?Pw(x,f):(r.flags=r.flags&-4097|2,Mi=!1,mr=r)}}else{if(kg(r))throw Error(We(418));r.flags=r.flags&-4097|2,Mi=!1,mr=r}}}function Hv(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;mr=r}function yh(r){if(r!==mr)return!1;if(!Mi)return Hv(r),Mi=!0,!1;var l;if((l=r.tag!==3)&&!(l=r.tag!==5)&&(l=r.type,l=l!=="head"&&l!=="body"&&!bg(r.type,r.memoizedProps)),l&&(l=rr)){if(kg(r)){for(r=rr;r;)r=Qo(r.nextSibling);throw Error(We(418))}for(;l;)Pw(r,l),l=Qo(l.nextSibling)}if(Hv(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(We(317));e:{for(r=r.nextSibling,l=0;r;){if(r.nodeType===8){var f=r.data;if(f==="/$"){if(l===0){rr=Qo(r.nextSibling);break e}l--}else f!=="$"&&f!=="$!"&&f!=="$?"||l++}r=r.nextSibling}rr=null}}else rr=mr?Qo(r.stateNode.nextSibling):null;return!0}function Wc(){rr=mr=null,Mi=!1}function gy(r){to===null?to=[r]:to.push(r)}function xh(r,l,f){if(r=f.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(We(309));var x=f.stateNode}if(!x)throw Error(We(147,r));var E=x,I=""+r;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===I?l.ref:(l=function(F){var s=E.refs;s===kw&&(s=E.refs={}),F===null?delete s[I]:s[I]=F},l._stringRef=I,l)}if(typeof r!="string")throw Error(We(284));if(!f._owner)throw Error(We(290,r))}return r}function tf(r,l){throw r=Object.prototype.toString.call(l),Error(We(31,r==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":r))}function Yv(r){var l=r._init;return l(r._payload)}function Dw(r){function l(ve,he){if(r){var Se=ve.deletions;Se===null?(ve.deletions=[he],ve.flags|=16):Se.push(he)}}function f(ve,he){if(!r)return null;for(;he!==null;)l(ve,he),he=he.sibling;return null}function x(ve,he){for(ve=new Map;he!==null;)he.key!==null?ve.set(he.key,he):ve.set(he.index,he),he=he.sibling;return ve}function E(ve,he){return ve=ra(ve,he),ve.index=0,ve.sibling=null,ve}function I(ve,he,Se){return ve.index=Se,r?(Se=ve.alternate,Se!==null?(Se=Se.index,Se<he?(ve.flags|=2,he):Se):(ve.flags|=2,he)):(ve.flags|=1048576,he)}function F(ve){return r&&ve.alternate===null&&(ve.flags|=2),ve}function s(ve,he,Se,Ze){return he===null||he.tag!==6?(he=H_(Se,ve.mode,Ze),he.return=ve,he):(he=E(he,Se),he.return=ve,he)}function G(ve,he,Se,Ze){var Fe=Se.type;return Fe===Ic?ae(ve,he,Se.props.children,Ze,Se.key):he!==null&&(he.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===$s&&Yv(Fe)===he.type)?(Ze=E(he,Se.props),Ze.ref=xh(ve,he,Se),Ze.return=ve,Ze):(Ze=vf(Se.type,Se.key,Se.props,null,ve.mode,Ze),Ze.ref=xh(ve,he,Se),Ze.return=ve,Ze)}function ue(ve,he,Se,Ze){return he===null||he.tag!==4||he.stateNode.containerInfo!==Se.containerInfo||he.stateNode.implementation!==Se.implementation?(he=Y_(Se,ve.mode,Ze),he.return=ve,he):(he=E(he,Se.children||[]),he.return=ve,he)}function ae(ve,he,Se,Ze,Fe){return he===null||he.tag!==7?(he=ol(Se,ve.mode,Ze,Fe),he.return=ve,he):(he=E(he,Se),he.return=ve,he)}function me(ve,he,Se){if(typeof he=="string"&&he!==""||typeof he=="number")return he=H_(""+he,ve.mode,Se),he.return=ve,he;if(typeof he=="object"&&he!==null){switch(he.$$typeof){case Zp:return Se=vf(he.type,he.key,he.props,null,ve.mode,Se),Se.ref=xh(ve,null,he),Se.return=ve,Se;case Ac:return he=Y_(he,ve.mode,Se),he.return=ve,he;case $s:var Ze=he._init;return me(ve,Ze(he._payload),Se)}if(Ch(he)||ph(he))return he=ol(he,ve.mode,Se,null),he.return=ve,he;tf(ve,he)}return null}function de(ve,he,Se,Ze){var Fe=he!==null?he.key:null;if(typeof Se=="string"&&Se!==""||typeof Se=="number")return Fe!==null?null:s(ve,he,""+Se,Ze);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case Zp:return Se.key===Fe?G(ve,he,Se,Ze):null;case Ac:return Se.key===Fe?ue(ve,he,Se,Ze):null;case $s:return Fe=Se._init,de(ve,he,Fe(Se._payload),Ze)}if(Ch(Se)||ph(Se))return Fe!==null?null:ae(ve,he,Se,Ze,null);tf(ve,Se)}return null}function Ae(ve,he,Se,Ze,Fe){if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return ve=ve.get(Se)||null,s(he,ve,""+Ze,Fe);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case Zp:return ve=ve.get(Ze.key===null?Se:Ze.key)||null,G(he,ve,Ze,Fe);case Ac:return ve=ve.get(Ze.key===null?Se:Ze.key)||null,ue(he,ve,Ze,Fe);case $s:var ct=Ze._init;return Ae(ve,he,Se,ct(Ze._payload),Fe)}if(Ch(Ze)||ph(Ze))return ve=ve.get(Se)||null,ae(he,ve,Ze,Fe,null);tf(he,Ze)}return null}function je(ve,he,Se,Ze){for(var Fe=null,ct=null,ut=he,_t=he=0,ii=null;ut!==null&&_t<Se.length;_t++){ut.index>_t?(ii=ut,ut=null):ii=ut.sibling;var vt=de(ve,ut,Se[_t],Ze);if(vt===null){ut===null&&(ut=ii);break}r&&ut&&vt.alternate===null&&l(ve,ut),he=I(vt,he,_t),ct===null?Fe=vt:ct.sibling=vt,ct=vt,ut=ii}if(_t===Se.length)return f(ve,ut),Mi&&el(ve,_t),Fe;if(ut===null){for(;_t<Se.length;_t++)ut=me(ve,Se[_t],Ze),ut!==null&&(he=I(ut,he,_t),ct===null?Fe=ut:ct.sibling=ut,ct=ut);return Mi&&el(ve,_t),Fe}for(ut=x(ve,ut);_t<Se.length;_t++)ii=Ae(ut,ve,_t,Se[_t],Ze),ii!==null&&(r&&ii.alternate!==null&&ut.delete(ii.key===null?_t:ii.key),he=I(ii,he,_t),ct===null?Fe=ii:ct.sibling=ii,ct=ii);return r&&ut.forEach(function(un){return l(ve,un)}),Mi&&el(ve,_t),Fe}function Ge(ve,he,Se,Ze){var Fe=ph(Se);if(typeof Fe!="function")throw Error(We(150));if(Se=Fe.call(Se),Se==null)throw Error(We(151));for(var ct=Fe=null,ut=he,_t=he=0,ii=null,vt=Se.next();ut!==null&&!vt.done;_t++,vt=Se.next()){ut.index>_t?(ii=ut,ut=null):ii=ut.sibling;var un=de(ve,ut,vt.value,Ze);if(un===null){ut===null&&(ut=ii);break}r&&ut&&un.alternate===null&&l(ve,ut),he=I(un,he,_t),ct===null?Fe=un:ct.sibling=un,ct=un,ut=ii}if(vt.done)return f(ve,ut),Mi&&el(ve,_t),Fe;if(ut===null){for(;!vt.done;_t++,vt=Se.next())vt=me(ve,vt.value,Ze),vt!==null&&(he=I(vt,he,_t),ct===null?Fe=vt:ct.sibling=vt,ct=vt);return Mi&&el(ve,_t),Fe}for(ut=x(ve,ut);!vt.done;_t++,vt=Se.next())vt=Ae(ut,ve,_t,vt.value,Ze),vt!==null&&(r&&vt.alternate!==null&&ut.delete(vt.key===null?_t:vt.key),he=I(vt,he,_t),ct===null?Fe=vt:ct.sibling=vt,ct=vt);return r&&ut.forEach(function(Un){return l(ve,Un)}),Mi&&el(ve,_t),Fe}function Tt(ve,he,Se,Ze){if(typeof Se=="object"&&Se!==null&&Se.type===Ic&&Se.key===null&&(Se=Se.props.children),typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case Zp:e:{for(var Fe=Se.key,ct=he;ct!==null;){if(ct.key===Fe){if(Fe=Se.type,Fe===Ic){if(ct.tag===7){f(ve,ct.sibling),he=E(ct,Se.props.children),he.return=ve,ve=he;break e}}else if(ct.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===$s&&Yv(Fe)===ct.type){f(ve,ct.sibling),he=E(ct,Se.props),he.ref=xh(ve,ct,Se),he.return=ve,ve=he;break e}f(ve,ct);break}else l(ve,ct);ct=ct.sibling}Se.type===Ic?(he=ol(Se.props.children,ve.mode,Ze,Se.key),he.return=ve,ve=he):(Ze=vf(Se.type,Se.key,Se.props,null,ve.mode,Ze),Ze.ref=xh(ve,he,Se),Ze.return=ve,ve=Ze)}return F(ve);case Ac:e:{for(ct=Se.key;he!==null;){if(he.key===ct)if(he.tag===4&&he.stateNode.containerInfo===Se.containerInfo&&he.stateNode.implementation===Se.implementation){f(ve,he.sibling),he=E(he,Se.children||[]),he.return=ve,ve=he;break e}else{f(ve,he);break}else l(ve,he);he=he.sibling}he=Y_(Se,ve.mode,Ze),he.return=ve,ve=he}return F(ve);case $s:return ct=Se._init,Tt(ve,he,ct(Se._payload),Ze)}if(Ch(Se))return je(ve,he,Se,Ze);if(ph(Se))return Ge(ve,he,Se,Ze);tf(ve,Se)}return typeof Se=="string"&&Se!==""||typeof Se=="number"?(Se=""+Se,he!==null&&he.tag===6?(f(ve,he.sibling),he=E(he,Se),he.return=ve,ve=he):(f(ve,he),he=H_(Se,ve.mode,Ze),he.return=ve,ve=he),F(ve)):f(ve,he)}return Tt}var Xc=Dw(!0),Lw=Dw(!1),od={},So=sa(od),Hh=sa(od),Yh=sa(od);function nl(r){if(r===od)throw Error(We(174));return r}function yy(r,l){switch(yi(Yh,l),yi(Hh,r),yi(So,od),r=l.nodeType,r){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:lg(null,"");break;default:r=r===8?l.parentNode:l,l=r.namespaceURI||null,r=r.tagName,l=lg(l,r)}Ei(So),yi(So,l)}function Hc(){Ei(So),Ei(Hh),Ei(Yh)}function Bw(r){nl(Yh.current);var l=nl(So.current),f=lg(l,r.type);l!==f&&(yi(Hh,r),yi(So,f))}function xy(r){Hh.current===r&&(Ei(So),Ei(Hh))}var Bi=sa(0);function Ff(r){for(var l=r;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var $_=[];function vy(){for(var r=0;r<$_.length;r++)$_[r]._workInProgressVersionPrimary=null;$_.length=0}var _f=ss.ReactCurrentDispatcher,Z_=ss.ReactCurrentBatchConfig,ll=0,Ri=null,en=null,cn=null,Of=!1,Lh=!1,Kh=0,WS=0;function Cn(){throw Error(We(321))}function wy(r,l){if(l===null)return!1;for(var f=0;f<l.length&&f<r.length;f++)if(!ro(r[f],l[f]))return!1;return!0}function by(r,l,f,x,E,I){if(ll=I,Ri=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,_f.current=r===null||r.memoizedState===null?KS:JS,r=f(x,E),Lh){I=0;do{if(Lh=!1,Kh=0,25<=I)throw Error(We(301));I+=1,cn=en=null,l.updateQueue=null,_f.current=QS,r=f(x,E)}while(Lh)}if(_f.current=Nf,l=en!==null&&en.next!==null,ll=0,cn=en=Ri=null,Of=!1,l)throw Error(We(300));return r}function Ty(){var r=Kh!==0;return Kh=0,r}function bo(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cn===null?Ri.memoizedState=cn=r:cn=cn.next=r,cn}function Br(){if(en===null){var r=Ri.alternate;r=r!==null?r.memoizedState:null}else r=en.next;var l=cn===null?Ri.memoizedState:cn.next;if(l!==null)cn=l,en=r;else{if(r===null)throw Error(We(310));en=r,r={memoizedState:en.memoizedState,baseState:en.baseState,baseQueue:en.baseQueue,queue:en.queue,next:null},cn===null?Ri.memoizedState=cn=r:cn=cn.next=r}return cn}function Jh(r,l){return typeof l=="function"?l(r):l}function q_(r){var l=Br(),f=l.queue;if(f===null)throw Error(We(311));f.lastRenderedReducer=r;var x=en,E=x.baseQueue,I=f.pending;if(I!==null){if(E!==null){var F=E.next;E.next=I.next,I.next=F}x.baseQueue=E=I,f.pending=null}if(E!==null){I=E.next,x=x.baseState;var s=F=null,G=null,ue=I;do{var ae=ue.lane;if((ll&ae)===ae)G!==null&&(G=G.next={lane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),x=ue.hasEagerState?ue.eagerState:r(x,ue.action);else{var me={lane:ae,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null};G===null?(s=G=me,F=x):G=G.next=me,Ri.lanes|=ae,cl|=ae}ue=ue.next}while(ue!==null&&ue!==I);G===null?F=x:G.next=s,ro(x,l.memoizedState)||(or=!0),l.memoizedState=x,l.baseState=F,l.baseQueue=G,f.lastRenderedState=x}if(r=f.interleaved,r!==null){E=r;do I=E.lane,Ri.lanes|=I,cl|=I,E=E.next;while(E!==r)}else E===null&&(f.lanes=0);return[l.memoizedState,f.dispatch]}function W_(r){var l=Br(),f=l.queue;if(f===null)throw Error(We(311));f.lastRenderedReducer=r;var x=f.dispatch,E=f.pending,I=l.memoizedState;if(E!==null){f.pending=null;var F=E=E.next;do I=r(I,F.action),F=F.next;while(F!==E);ro(I,l.memoizedState)||(or=!0),l.memoizedState=I,l.baseQueue===null&&(l.baseState=I),f.lastRenderedState=I}return[I,x]}function Rw(){}function Fw(r,l){var f=Ri,x=Br(),E=l(),I=!ro(x.memoizedState,E);if(I&&(x.memoizedState=E,or=!0),x=x.queue,Ey(Uw.bind(null,f,x,r),[r]),x.getSnapshot!==l||I||cn!==null&&cn.memoizedState.tag&1){if(f.flags|=2048,Qh(9,Nw.bind(null,f,x,E,l),void 0,null),nn===null)throw Error(We(349));(ll&30)!==0||Ow(f,l,E)}return E}function Ow(r,l,f){r.flags|=16384,r={getSnapshot:l,value:f},l=Ri.updateQueue,l===null?(l={lastEffect:null,stores:null},Ri.updateQueue=l,l.stores=[r]):(f=l.stores,f===null?l.stores=[r]:f.push(r))}function Nw(r,l,f,x){l.value=f,l.getSnapshot=x,jw(l)&&Dr(r,1,-1)}function Uw(r,l,f){return f(function(){jw(l)&&Dr(r,1,-1)})}function jw(r){var l=r.getSnapshot;r=r.value;try{var f=l();return!ro(r,f)}catch{return!0}}function Kv(r){var l=bo();return typeof r=="function"&&(r=r()),l.memoizedState=l.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Jh,lastRenderedState:r},l.queue=r,r=r.dispatch=YS.bind(null,Ri,r),[l.memoizedState,r]}function Qh(r,l,f,x){return r={tag:r,create:l,destroy:f,deps:x,next:null},l=Ri.updateQueue,l===null?(l={lastEffect:null,stores:null},Ri.updateQueue=l,l.lastEffect=r.next=r):(f=l.lastEffect,f===null?l.lastEffect=r.next=r:(x=f.next,f.next=r,r.next=x,l.lastEffect=r)),r}function Vw(){return Br().memoizedState}function gf(r,l,f,x){var E=bo();Ri.flags|=r,E.memoizedState=Qh(1|l,f,void 0,x===void 0?null:x)}function Qf(r,l,f,x){var E=Br();x=x===void 0?null:x;var I=void 0;if(en!==null){var F=en.memoizedState;if(I=F.destroy,x!==null&&wy(x,F.deps)){E.memoizedState=Qh(l,f,I,x);return}}Ri.flags|=r,E.memoizedState=Qh(1|l,f,I,x)}function Jv(r,l){return gf(8390656,8,r,l)}function Ey(r,l){return Qf(2048,8,r,l)}function Gw(r,l){return Qf(4,2,r,l)}function $w(r,l){return Qf(4,4,r,l)}function Zw(r,l){if(typeof l=="function")return r=r(),l(r),function(){l(null)};if(l!=null)return r=r(),l.current=r,function(){l.current=null}}function qw(r,l,f){return f=f!=null?f.concat([r]):null,Qf(4,4,Zw.bind(null,l,r),f)}function Sy(){}function Ww(r,l){var f=Br();l=l===void 0?null:l;var x=f.memoizedState;return x!==null&&l!==null&&wy(l,x[1])?x[0]:(f.memoizedState=[r,l],r)}function Xw(r,l){var f=Br();l=l===void 0?null:l;var x=f.memoizedState;return x!==null&&l!==null&&wy(l,x[1])?x[0]:(r=r(),f.memoizedState=[r,l],r)}function Hw(r,l,f){return(ll&21)===0?(r.baseState&&(r.baseState=!1,or=!0),r.memoizedState=f):(ro(f,l)||(f=tw(),Ri.lanes|=f,cl|=f,r.baseState=!0),l)}function XS(r,l){var f=ci;ci=f!==0&&4>f?f:4,r(!0);var x=Z_.transition;Z_.transition={};try{r(!1),l()}finally{ci=f,Z_.transition=x}}function Yw(){return Br().memoizedState}function HS(r,l,f){var x=ta(r);f={lane:x,action:f,hasEagerState:!1,eagerState:null,next:null},Kw(r)?Jw(l,f):(Qw(r,l,f),f=Fn(),r=Dr(r,x,f),r!==null&&eb(r,l,x))}function YS(r,l,f){var x=ta(r),E={lane:x,action:f,hasEagerState:!1,eagerState:null,next:null};if(Kw(r))Jw(l,E);else{Qw(r,l,E);var I=r.alternate;if(r.lanes===0&&(I===null||I.lanes===0)&&(I=l.lastRenderedReducer,I!==null))try{var F=l.lastRenderedState,s=I(F,f);if(E.hasEagerState=!0,E.eagerState=s,ro(s,F))return}catch{}finally{}f=Fn(),r=Dr(r,x,f),r!==null&&eb(r,l,x)}}function Kw(r){var l=r.alternate;return r===Ri||l!==null&&l===Ri}function Jw(r,l){Lh=Of=!0;var f=r.pending;f===null?l.next=l:(l.next=f.next,f.next=l),r.pending=l}function Qw(r,l,f){gb(r)?(r=l.interleaved,r===null?(f.next=f,io===null?io=[l]:io.push(l)):(f.next=r.next,r.next=f),l.interleaved=f):(r=l.pending,r===null?f.next=f:(f.next=r.next,r.next=f),l.pending=f)}function eb(r,l,f){if((f&4194240)!==0){var x=l.lanes;x&=r.pendingLanes,f|=x,l.lanes=f,ny(r,f)}}var Nf={readContext:Lr,useCallback:Cn,useContext:Cn,useEffect:Cn,useImperativeHandle:Cn,useInsertionEffect:Cn,useLayoutEffect:Cn,useMemo:Cn,useReducer:Cn,useRef:Cn,useState:Cn,useDebugValue:Cn,useDeferredValue:Cn,useTransition:Cn,useMutableSource:Cn,useSyncExternalStore:Cn,useId:Cn,unstable_isNewReconciler:!1},KS={readContext:Lr,useCallback:function(r,l){return bo().memoizedState=[r,l===void 0?null:l],r},useContext:Lr,useEffect:Jv,useImperativeHandle:function(r,l,f){return f=f!=null?f.concat([r]):null,gf(4194308,4,Zw.bind(null,l,r),f)},useLayoutEffect:function(r,l){return gf(4194308,4,r,l)},useInsertionEffect:function(r,l){return gf(4,2,r,l)},useMemo:function(r,l){var f=bo();return l=l===void 0?null:l,r=r(),f.memoizedState=[r,l],r},useReducer:function(r,l,f){var x=bo();return l=f!==void 0?f(l):l,x.memoizedState=x.baseState=l,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:l},x.queue=r,r=r.dispatch=HS.bind(null,Ri,r),[x.memoizedState,r]},useRef:function(r){var l=bo();return r={current:r},l.memoizedState=r},useState:Kv,useDebugValue:Sy,useDeferredValue:function(r){return bo().memoizedState=r},useTransition:function(){var r=Kv(!1),l=r[0];return r=XS.bind(null,r[1]),bo().memoizedState=r,[l,r]},useMutableSource:function(){},useSyncExternalStore:function(r,l,f){var x=Ri,E=bo();if(Mi){if(f===void 0)throw Error(We(407));f=f()}else{if(f=l(),nn===null)throw Error(We(349));(ll&30)!==0||Ow(x,l,f)}E.memoizedState=f;var I={value:f,getSnapshot:l};return E.queue=I,Jv(Uw.bind(null,x,I,r),[r]),x.flags|=2048,Qh(9,Nw.bind(null,x,I,f,l),void 0,null),f},useId:function(){var r=bo(),l=nn.identifierPrefix;if(Mi){var f=ts,x=es;f=(x&~(1<<32-no(x)-1)).toString(32)+f,l=":"+l+"R"+f,f=Kh++,0<f&&(l+="H"+f.toString(32)),l+=":"}else f=WS++,l=":"+l+"r"+f.toString(32)+":";return r.memoizedState=l},unstable_isNewReconciler:!1},JS={readContext:Lr,useCallback:Ww,useContext:Lr,useEffect:Ey,useImperativeHandle:qw,useInsertionEffect:Gw,useLayoutEffect:$w,useMemo:Xw,useReducer:q_,useRef:Vw,useState:function(){return q_(Jh)},useDebugValue:Sy,useDeferredValue:function(r){var l=Br();return Hw(l,en.memoizedState,r)},useTransition:function(){var r=q_(Jh)[0],l=Br().memoizedState;return[r,l]},useMutableSource:Rw,useSyncExternalStore:Fw,useId:Yw,unstable_isNewReconciler:!1},QS={readContext:Lr,useCallback:Ww,useContext:Lr,useEffect:Ey,useImperativeHandle:qw,useInsertionEffect:Gw,useLayoutEffect:$w,useMemo:Xw,useReducer:W_,useRef:Vw,useState:function(){return W_(Jh)},useDebugValue:Sy,useDeferredValue:function(r){var l=Br();return en===null?l.memoizedState=r:Hw(l,en.memoizedState,r)},useTransition:function(){var r=W_(Jh)[0],l=Br().memoizedState;return[r,l]},useMutableSource:Rw,useSyncExternalStore:Fw,useId:Yw,unstable_isNewReconciler:!1};function Cy(r,l){try{var f="",x=l;do f+=AE(x),x=x.return;while(x);var E=f}catch(I){E=`
Error generating stack: `+I.message+`
`+I.stack}return{value:r,source:l,stack:E}}function zg(r,l){try{console.error(l.value)}catch(f){setTimeout(function(){throw f})}}var eC=typeof WeakMap=="function"?WeakMap:Map;function tb(r,l,f){f=is(-1,f),f.tag=3,f.payload={element:null};var x=l.value;return f.callback=function(){jf||(jf=!0,Ug=x),zg(r,l)},f}function ib(r,l,f){f=is(-1,f),f.tag=3;var x=r.type.getDerivedStateFromError;if(typeof x=="function"){var E=l.value;f.payload=function(){return x(E)},f.callback=function(){zg(r,l)}}var I=r.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(f.callback=function(){zg(r,l),typeof x!="function"&&(ea===null?ea=new Set([this]):ea.add(this));var F=l.stack;this.componentDidCatch(l.value,{componentStack:F!==null?F:""})}),f}function Qv(r,l,f){var x=r.pingCache;if(x===null){x=r.pingCache=new eC;var E=new Set;x.set(l,E)}else E=x.get(l),E===void 0&&(E=new Set,x.set(l,E));E.has(f)||(E.add(f),r=pC.bind(null,r,l,f),l.then(r,r))}function e1(r){do{var l;if((l=r.tag===13)&&(l=r.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return r;r=r.return}while(r!==null);return null}function t1(r,l,f,x,E){return(r.mode&1)===0?(r===l?r.flags|=65536:(r.flags|=128,f.flags|=131072,f.flags&=-52805,f.tag===1&&(f.alternate===null?f.tag=17:(l=is(-1,1),l.tag=2,Qs(f,l))),f.lanes|=1),r):(r.flags|=65536,r.lanes=E,r)}var nb,Pg,rb,ob;nb=function(r,l){for(var f=l.child;f!==null;){if(f.tag===5||f.tag===6)r.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return;f=f.return}f.sibling.return=f.return,f=f.sibling}};Pg=function(){};rb=function(r,l,f,x){var E=r.memoizedProps;if(E!==x){r=l.stateNode,nl(So.current);var I=null;switch(f){case"input":E=rg(r,E),x=rg(r,x),I=[];break;case"select":E=Fi({},E,{value:void 0}),x=Fi({},x,{value:void 0}),I=[];break;case"textarea":E=ag(r,E),x=ag(r,x),I=[];break;default:typeof E.onClick!="function"&&typeof x.onClick=="function"&&(r.onclick=kf)}cg(f,x);var F;f=null;for(ue in E)if(!x.hasOwnProperty(ue)&&E.hasOwnProperty(ue)&&E[ue]!=null)if(ue==="style"){var s=E[ue];for(F in s)s.hasOwnProperty(F)&&(f||(f={}),f[F]="")}else ue!=="dangerouslySetInnerHTML"&&ue!=="children"&&ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&ue!=="autoFocus"&&(Oh.hasOwnProperty(ue)?I||(I=[]):(I=I||[]).push(ue,null));for(ue in x){var G=x[ue];if(s=E!=null?E[ue]:void 0,x.hasOwnProperty(ue)&&G!==s&&(G!=null||s!=null))if(ue==="style")if(s){for(F in s)!s.hasOwnProperty(F)||G&&G.hasOwnProperty(F)||(f||(f={}),f[F]="");for(F in G)G.hasOwnProperty(F)&&s[F]!==G[F]&&(f||(f={}),f[F]=G[F])}else f||(I||(I=[]),I.push(ue,f)),f=G;else ue==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,s=s?s.__html:void 0,G!=null&&s!==G&&(I=I||[]).push(ue,G)):ue==="children"?typeof G!="string"&&typeof G!="number"||(I=I||[]).push(ue,""+G):ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&(Oh.hasOwnProperty(ue)?(G!=null&&ue==="onScroll"&&Ti("scroll",r),I||s===G||(I=[])):(I=I||[]).push(ue,G))}f&&(I=I||[]).push("style",f);var ue=I;(l.updateQueue=ue)&&(l.flags|=4)}};ob=function(r,l,f,x){f!==x&&(l.flags|=4)};function vh(r,l){if(!Mi)switch(r.tailMode){case"hidden":l=r.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?r.tail=null:f.sibling=null;break;case"collapsed":f=r.tail;for(var x=null;f!==null;)f.alternate!==null&&(x=f),f=f.sibling;x===null?l||r.tail===null?r.tail=null:r.tail.sibling=null:x.sibling=null}}function An(r){var l=r.alternate!==null&&r.alternate.child===r.child,f=0,x=0;if(l)for(var E=r.child;E!==null;)f|=E.lanes|E.childLanes,x|=E.subtreeFlags&14680064,x|=E.flags&14680064,E.return=r,E=E.sibling;else for(E=r.child;E!==null;)f|=E.lanes|E.childLanes,x|=E.subtreeFlags,x|=E.flags,E.return=r,E=E.sibling;return r.subtreeFlags|=x,r.childLanes=f,l}function tC(r,l,f){var x=l.pendingProps;switch(_y(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return An(l),null;case 1:return ar(l.type)&&Mf(),An(l),null;case 3:return x=l.stateNode,Hc(),Ei(sr),Ei(kn),vy(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(r===null||r.child===null)&&(yh(l)?l.flags|=4:r===null||r.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,to!==null&&(Gg(to),to=null))),Pg(r,l),An(l),null;case 5:xy(l);var E=nl(Yh.current);if(f=l.type,r!==null&&l.stateNode!=null)rb(r,l,f,x,E),r.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!x){if(l.stateNode===null)throw Error(We(166));return An(l),null}if(r=nl(So.current),yh(l)){x=l.stateNode,f=l.type;var I=l.memoizedProps;switch(x[To]=l,x[Xh]=I,r=(l.mode&1)!==0,f){case"dialog":Ti("cancel",x),Ti("close",x);break;case"iframe":case"object":case"embed":Ti("load",x);break;case"video":case"audio":for(E=0;E<Ih.length;E++)Ti(Ih[E],x);break;case"source":Ti("error",x);break;case"img":case"image":case"link":Ti("error",x),Ti("load",x);break;case"details":Ti("toggle",x);break;case"input":mv(x,I),Ti("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!I.multiple},Ti("invalid",x);break;case"textarea":gv(x,I),Ti("invalid",x)}cg(f,I),E=null;for(var F in I)if(I.hasOwnProperty(F)){var s=I[F];F==="children"?typeof s=="string"?x.textContent!==s&&(I.suppressHydrationWarning!==!0&&ef(x.textContent,s,r),E=["children",s]):typeof s=="number"&&x.textContent!==""+s&&(I.suppressHydrationWarning!==!0&&ef(x.textContent,s,r),E=["children",""+s]):Oh.hasOwnProperty(F)&&s!=null&&F==="onScroll"&&Ti("scroll",x)}switch(f){case"input":qp(x),_v(x,I,!0);break;case"textarea":qp(x),yv(x);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(x.onclick=kf)}x=E,l.updateQueue=x,x!==null&&(l.flags|=4)}else{F=E.nodeType===9?E:E.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=U1(f)),r==="http://www.w3.org/1999/xhtml"?f==="script"?(r=F.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof x.is=="string"?r=F.createElement(f,{is:x.is}):(r=F.createElement(f),f==="select"&&(F=r,x.multiple?F.multiple=!0:x.size&&(F.size=x.size))):r=F.createElementNS(r,f),r[To]=l,r[Xh]=x,nb(r,l,!1,!1),l.stateNode=r;e:{switch(F=ug(f,x),f){case"dialog":Ti("cancel",r),Ti("close",r),E=x;break;case"iframe":case"object":case"embed":Ti("load",r),E=x;break;case"video":case"audio":for(E=0;E<Ih.length;E++)Ti(Ih[E],r);E=x;break;case"source":Ti("error",r),E=x;break;case"img":case"image":case"link":Ti("error",r),Ti("load",r),E=x;break;case"details":Ti("toggle",r),E=x;break;case"input":mv(r,x),E=rg(r,x),Ti("invalid",r);break;case"option":E=x;break;case"select":r._wrapperState={wasMultiple:!!x.multiple},E=Fi({},x,{value:void 0}),Ti("invalid",r);break;case"textarea":gv(r,x),E=ag(r,x),Ti("invalid",r);break;default:E=x}cg(f,E),s=E;for(I in s)if(s.hasOwnProperty(I)){var G=s[I];I==="style"?G1(r,G):I==="dangerouslySetInnerHTML"?(G=G?G.__html:void 0,G!=null&&j1(r,G)):I==="children"?typeof G=="string"?(f!=="textarea"||G!=="")&&Nh(r,G):typeof G=="number"&&Nh(r,""+G):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(Oh.hasOwnProperty(I)?G!=null&&I==="onScroll"&&Ti("scroll",r):G!=null&&Kg(r,I,G,F))}switch(f){case"input":qp(r),_v(r,x,!1);break;case"textarea":qp(r),yv(r);break;case"option":x.value!=null&&r.setAttribute("value",""+ia(x.value));break;case"select":r.multiple=!!x.multiple,I=x.value,I!=null?Nc(r,!!x.multiple,I,!1):x.defaultValue!=null&&Nc(r,!!x.multiple,x.defaultValue,!0);break;default:typeof E.onClick=="function"&&(r.onclick=kf)}switch(f){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}}x&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return An(l),null;case 6:if(r&&l.stateNode!=null)ob(r,l,r.memoizedProps,x);else{if(typeof x!="string"&&l.stateNode===null)throw Error(We(166));if(f=nl(Yh.current),nl(So.current),yh(l)){if(x=l.stateNode,f=l.memoizedProps,x[To]=l,(I=x.nodeValue!==f)&&(r=mr,r!==null))switch(r.tag){case 3:ef(x.nodeValue,f,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&ef(x.nodeValue,f,(r.mode&1)!==0)}I&&(l.flags|=4)}else x=(f.nodeType===9?f:f.ownerDocument).createTextNode(x),x[To]=l,l.stateNode=x}return An(l),null;case 13:if(Ei(Bi),x=l.memoizedState,Mi&&rr!==null&&(l.mode&1)!==0&&(l.flags&128)===0){for(x=rr;x;)x=Qo(x.nextSibling);return Wc(),l.flags|=98560,l}if(x!==null&&x.dehydrated!==null){if(x=yh(l),r===null){if(!x)throw Error(We(318));if(x=l.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(We(317));x[To]=l}else Wc(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;return An(l),null}return to!==null&&(Gg(to),to=null),(l.flags&128)!==0?(l.lanes=f,l):(x=x!==null,f=!1,r===null?yh(l):f=r.memoizedState!==null,x!==f&&x&&(l.child.flags|=8192,(l.mode&1)!==0&&(r===null||(Bi.current&1)!==0?tn===0&&(tn=3):Py())),l.updateQueue!==null&&(l.flags|=4),An(l),null);case 4:return Hc(),Pg(r,l),r===null&&qh(l.stateNode.containerInfo),An(l),null;case 10:return py(l.type._context),An(l),null;case 17:return ar(l.type)&&Mf(),An(l),null;case 19:if(Ei(Bi),I=l.memoizedState,I===null)return An(l),null;if(x=(l.flags&128)!==0,F=I.rendering,F===null)if(x)vh(I,!1);else{if(tn!==0||r!==null&&(r.flags&128)!==0)for(r=l.child;r!==null;){if(F=Ff(r),F!==null){for(l.flags|=128,vh(I,!1),x=F.updateQueue,x!==null&&(l.updateQueue=x,l.flags|=4),l.subtreeFlags=0,x=f,f=l.child;f!==null;)I=f,r=x,I.flags&=14680066,F=I.alternate,F===null?(I.childLanes=0,I.lanes=r,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=F.childLanes,I.lanes=F.lanes,I.child=F.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=F.memoizedProps,I.memoizedState=F.memoizedState,I.updateQueue=F.updateQueue,I.type=F.type,r=F.dependencies,I.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),f=f.sibling;return yi(Bi,Bi.current&1|2),l.child}r=r.sibling}I.tail!==null&&Vi()>Yc&&(l.flags|=128,x=!0,vh(I,!1),l.lanes=4194304)}else{if(!x)if(r=Ff(F),r!==null){if(l.flags|=128,x=!0,f=r.updateQueue,f!==null&&(l.updateQueue=f,l.flags|=4),vh(I,!0),I.tail===null&&I.tailMode==="hidden"&&!F.alternate&&!Mi)return An(l),null}else 2*Vi()-I.renderingStartTime>Yc&&f!==1073741824&&(l.flags|=128,x=!0,vh(I,!1),l.lanes=4194304);I.isBackwards?(F.sibling=l.child,l.child=F):(f=I.last,f!==null?f.sibling=F:l.child=F,I.last=F)}return I.tail!==null?(l=I.tail,I.rendering=l,I.tail=l.sibling,I.renderingStartTime=Vi(),l.sibling=null,f=Bi.current,yi(Bi,x?f&1|2:f&1),l):(An(l),null);case 22:case 23:return zy(),x=l.memoizedState!==null,r!==null&&r.memoizedState!==null!==x&&(l.flags|=8192),x&&(l.mode&1)!==0?(fr&1073741824)!==0&&(An(l),l.subtreeFlags&6&&(l.flags|=8192)):An(l),null;case 24:return null;case 25:return null}throw Error(We(156,l.tag))}var iC=ss.ReactCurrentOwner,or=!1;function Rn(r,l,f,x){l.child=r===null?Lw(l,null,f,x):Xc(l,r.child,f,x)}function i1(r,l,f,x,E){f=f.render;var I=l.ref;return Gc(l,E),x=by(r,l,f,x,I,E),f=Ty(),r!==null&&!or?(l.updateQueue=r.updateQueue,l.flags&=-2053,r.lanes&=~E,os(r,l,E)):(Mi&&f&&my(l),l.flags|=1,Rn(r,l,x,E),l.child)}function n1(r,l,f,x,E){if(r===null){var I=f.type;return typeof I=="function"&&!Dy(I)&&I.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(l.tag=15,l.type=I,sb(r,l,I,x,E)):(r=vf(f.type,null,x,l,l.mode,E),r.ref=l.ref,r.return=l,l.child=r)}if(I=r.child,(r.lanes&E)===0){var F=I.memoizedProps;if(f=f.compare,f=f!==null?f:Zh,f(F,x)&&r.ref===l.ref)return os(r,l,E)}return l.flags|=1,r=ra(I,x),r.ref=l.ref,r.return=l,l.child=r}function sb(r,l,f,x,E){if(r!==null){var I=r.memoizedProps;if(Zh(I,x)&&r.ref===l.ref)if(or=!1,l.pendingProps=x=I,(r.lanes&E)!==0)(r.flags&131072)!==0&&(or=!0);else return l.lanes=r.lanes,os(r,l,E)}return Dg(r,l,f,x,E)}function ab(r,l,f){var x=l.pendingProps,E=x.children,I=r!==null?r.memoizedState:null;if(x.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},yi(Oc,fr),fr|=f;else if((f&1073741824)!==0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},x=I!==null?I.baseLanes:f,yi(Oc,fr),fr|=x;else return r=I!==null?I.baseLanes|f:f,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:r,cachePool:null,transitions:null},l.updateQueue=null,yi(Oc,fr),fr|=r,null;else I!==null?(x=I.baseLanes|f,l.memoizedState=null):x=f,yi(Oc,fr),fr|=x;return Rn(r,l,E,f),l.child}function lb(r,l){var f=l.ref;(r===null&&f!==null||r!==null&&r.ref!==f)&&(l.flags|=512,l.flags|=2097152)}function Dg(r,l,f,x,E){var I=ar(f)?sl:kn.current;return I=qc(l,I),Gc(l,E),f=by(r,l,f,x,I,E),x=Ty(),r!==null&&!or?(l.updateQueue=r.updateQueue,l.flags&=-2053,r.lanes&=~E,os(r,l,E)):(Mi&&x&&my(l),l.flags|=1,Rn(r,l,f,E),l.child)}function r1(r,l,f,x,E){if(ar(f)){var I=!0;zf(l)}else I=!1;if(Gc(l,E),l.stateNode===null)r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2),Mw(l,f,x),Ig(l,f,x,E),x=!0;else if(r===null){var F=l.stateNode,s=l.memoizedProps;F.props=s;var G=F.context,ue=f.contextType;typeof ue=="object"&&ue!==null?ue=Lr(ue):(ue=ar(f)?sl:kn.current,ue=qc(l,ue));var ae=f.getDerivedStateFromProps,me=typeof ae=="function"||typeof F.getSnapshotBeforeUpdate=="function";me||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(s!==x||G!==ue)&&Wv(l,F,x,ue),Zs=!1;var de=l.memoizedState;F.state=de,Lf(l,x,F,E),G=l.memoizedState,s!==x||de!==G||sr.current||Zs?(typeof ae=="function"&&(Ag(l,f,ae,x),G=l.memoizedState),(s=Zs||qv(l,f,s,x,de,G,ue))?(me||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount()),typeof F.componentDidMount=="function"&&(l.flags|=4194308)):(typeof F.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=x,l.memoizedState=G),F.props=x,F.state=G,F.context=ue,x=s):(typeof F.componentDidMount=="function"&&(l.flags|=4194308),x=!1)}else{F=l.stateNode,Iw(r,l),s=l.memoizedProps,ue=l.type===l.elementType?s:Qr(l.type,s),F.props=ue,me=l.pendingProps,de=F.context,G=f.contextType,typeof G=="object"&&G!==null?G=Lr(G):(G=ar(f)?sl:kn.current,G=qc(l,G));var Ae=f.getDerivedStateFromProps;(ae=typeof Ae=="function"||typeof F.getSnapshotBeforeUpdate=="function")||typeof F.UNSAFE_componentWillReceiveProps!="function"&&typeof F.componentWillReceiveProps!="function"||(s!==me||de!==G)&&Wv(l,F,x,G),Zs=!1,de=l.memoizedState,F.state=de,Lf(l,x,F,E);var je=l.memoizedState;s!==me||de!==je||sr.current||Zs?(typeof Ae=="function"&&(Ag(l,f,Ae,x),je=l.memoizedState),(ue=Zs||qv(l,f,ue,x,de,je,G)||!1)?(ae||typeof F.UNSAFE_componentWillUpdate!="function"&&typeof F.componentWillUpdate!="function"||(typeof F.componentWillUpdate=="function"&&F.componentWillUpdate(x,je,G),typeof F.UNSAFE_componentWillUpdate=="function"&&F.UNSAFE_componentWillUpdate(x,je,G)),typeof F.componentDidUpdate=="function"&&(l.flags|=4),typeof F.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof F.componentDidUpdate!="function"||s===r.memoizedProps&&de===r.memoizedState||(l.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||s===r.memoizedProps&&de===r.memoizedState||(l.flags|=1024),l.memoizedProps=x,l.memoizedState=je),F.props=x,F.state=je,F.context=G,x=ue):(typeof F.componentDidUpdate!="function"||s===r.memoizedProps&&de===r.memoizedState||(l.flags|=4),typeof F.getSnapshotBeforeUpdate!="function"||s===r.memoizedProps&&de===r.memoizedState||(l.flags|=1024),x=!1)}return Lg(r,l,f,x,I,E)}function Lg(r,l,f,x,E,I){lb(r,l);var F=(l.flags&128)!==0;if(!x&&!F)return E&&Gv(l,f,!1),os(r,l,I);x=l.stateNode,iC.current=l;var s=F&&typeof f.getDerivedStateFromError!="function"?null:x.render();return l.flags|=1,r!==null&&F?(l.child=Xc(l,r.child,null,I),l.child=Xc(l,null,s,I)):Rn(r,l,s,I),l.memoizedState=x.state,E&&Gv(l,f,!0),l.child}function cb(r){var l=r.stateNode;l.pendingContext?Vv(r,l.pendingContext,l.pendingContext!==l.context):l.context&&Vv(r,l.context,!1),yy(r,l.containerInfo)}function o1(r,l,f,x,E){return Wc(),gy(E),l.flags|=256,Rn(r,l,f,x),l.child}var nf={dehydrated:null,treeContext:null,retryLane:0};function rf(r){return{baseLanes:r,cachePool:null,transitions:null}}function s1(r,l){return{baseLanes:r.baseLanes|l,cachePool:null,transitions:r.transitions}}function ub(r,l,f){var x=l.pendingProps,E=Bi.current,I=!1,F=(l.flags&128)!==0,s;if((s=F)||(s=r!==null&&r.memoizedState===null?!1:(E&2)!==0),s?(I=!0,l.flags&=-129):(r===null||r.memoizedState!==null)&&(E|=1),yi(Bi,E&1),r===null)return Mg(l),r=l.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?((l.mode&1)===0?l.lanes=1:r.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(E=x.children,r=x.fallback,I?(x=l.mode,I=l.child,E={mode:"hidden",children:E},(x&1)===0&&I!==null?(I.childLanes=0,I.pendingProps=E):I=$f(E,x,0,null),r=ol(r,x,f,null),I.return=l,r.return=l,I.sibling=r,l.child=I,l.child.memoizedState=rf(f),l.memoizedState=nf,r):Bg(l,E));if(E=r.memoizedState,E!==null){if(s=E.dehydrated,s!==null){if(F)return l.flags&256?(l.flags&=-257,of(r,l,f,Error(We(422)))):l.memoizedState!==null?(l.child=r.child,l.flags|=128,null):(I=x.fallback,E=l.mode,x=$f({mode:"visible",children:x.children},E,0,null),I=ol(I,E,f,null),I.flags|=2,x.return=l,I.return=l,x.sibling=I,l.child=x,(l.mode&1)!==0&&Xc(l,r.child,null,f),l.child.memoizedState=rf(f),l.memoizedState=nf,I);if((l.mode&1)===0)l=of(r,l,f,null);else if(s.data==="$!")l=of(r,l,f,Error(We(419)));else if(x=(f&r.childLanes)!==0,or||x){if(x=nn,x!==null){switch(f&-f){case 4:I=2;break;case 16:I=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:I=32;break;case 536870912:I=268435456;break;default:I=0}x=(I&(x.suspendedLanes|f))!==0?0:I,x!==0&&x!==E.retryLane&&(E.retryLane=x,Dr(r,x,-1))}Py(),l=of(r,l,f,Error(We(421)))}else s.data==="$?"?(l.flags|=128,l.child=r.child,l=fC.bind(null,r),s._reactRetry=l,l=null):(f=E.treeContext,rr=Qo(s.nextSibling),mr=l,Mi=!0,to=null,f!==null&&(kr[Mr++]=es,kr[Mr++]=ts,kr[Mr++]=al,es=f.id,ts=f.overflow,al=l),l=Bg(l,l.pendingProps.children),l.flags|=4096);return l}return I?(x=l1(r,l,x.children,x.fallback,f),I=l.child,E=r.child.memoizedState,I.memoizedState=E===null?rf(f):s1(E,f),I.childLanes=r.childLanes&~f,l.memoizedState=nf,x):(f=a1(r,l,x.children,f),l.memoizedState=null,f)}return I?(x=l1(r,l,x.children,x.fallback,f),I=l.child,E=r.child.memoizedState,I.memoizedState=E===null?rf(f):s1(E,f),I.childLanes=r.childLanes&~f,l.memoizedState=nf,x):(f=a1(r,l,x.children,f),l.memoizedState=null,f)}function Bg(r,l){return l=$f({mode:"visible",children:l},r.mode,0,null),l.return=r,r.child=l}function a1(r,l,f,x){var E=r.child;return r=E.sibling,f=ra(E,{mode:"visible",children:f}),(l.mode&1)===0&&(f.lanes=x),f.return=l,f.sibling=null,r!==null&&(x=l.deletions,x===null?(l.deletions=[r],l.flags|=16):x.push(r)),l.child=f}function l1(r,l,f,x,E){var I=l.mode;r=r.child;var F=r.sibling,s={mode:"hidden",children:f};return(I&1)===0&&l.child!==r?(f=l.child,f.childLanes=0,f.pendingProps=s,l.deletions=null):(f=ra(r,s),f.subtreeFlags=r.subtreeFlags&14680064),F!==null?x=ra(F,x):(x=ol(x,I,E,null),x.flags|=2),x.return=l,f.return=l,f.sibling=x,l.child=f,x}function of(r,l,f,x){return x!==null&&gy(x),Xc(l,r.child,null,f),r=Bg(l,l.pendingProps.children),r.flags|=2,l.memoizedState=null,r}function c1(r,l,f){r.lanes|=l;var x=r.alternate;x!==null&&(x.lanes|=l),Cg(r.return,l,f)}function X_(r,l,f,x,E){var I=r.memoizedState;I===null?r.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:x,tail:f,tailMode:E}:(I.isBackwards=l,I.rendering=null,I.renderingStartTime=0,I.last=x,I.tail=f,I.tailMode=E)}function hb(r,l,f){var x=l.pendingProps,E=x.revealOrder,I=x.tail;if(Rn(r,l,x.children,f),x=Bi.current,(x&2)!==0)x=x&1|2,l.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=l.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&c1(r,f,l);else if(r.tag===19)c1(r,f,l);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===l)break e;for(;r.sibling===null;){if(r.return===null||r.return===l)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}x&=1}if(yi(Bi,x),(l.mode&1)===0)l.memoizedState=null;else switch(E){case"forwards":for(f=l.child,E=null;f!==null;)r=f.alternate,r!==null&&Ff(r)===null&&(E=f),f=f.sibling;f=E,f===null?(E=l.child,l.child=null):(E=f.sibling,f.sibling=null),X_(l,!1,E,f,I);break;case"backwards":for(f=null,E=l.child,l.child=null;E!==null;){if(r=E.alternate,r!==null&&Ff(r)===null){l.child=E;break}r=E.sibling,E.sibling=f,f=E,E=r}X_(l,!0,f,null,I);break;case"together":X_(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function os(r,l,f){if(r!==null&&(l.dependencies=r.dependencies),cl|=l.lanes,(f&l.childLanes)===0)return null;if(r!==null&&l.child!==r.child)throw Error(We(153));if(l.child!==null){for(r=l.child,f=ra(r,r.pendingProps),l.child=f,f.return=l;r.sibling!==null;)r=r.sibling,f=f.sibling=ra(r,r.pendingProps),f.return=l;f.sibling=null}return l.child}function nC(r,l,f){switch(l.tag){case 3:cb(l),Wc();break;case 5:Bw(l);break;case 1:ar(l.type)&&zf(l);break;case 4:yy(l,l.stateNode.containerInfo);break;case 10:var x=l.type._context,E=l.memoizedProps.value;yi(Pf,x._currentValue),x._currentValue=E;break;case 13:if(x=l.memoizedState,x!==null)return x.dehydrated!==null?(yi(Bi,Bi.current&1),l.flags|=128,null):(f&l.child.childLanes)!==0?ub(r,l,f):(yi(Bi,Bi.current&1),r=os(r,l,f),r!==null?r.sibling:null);yi(Bi,Bi.current&1);break;case 19:if(x=(f&l.childLanes)!==0,(r.flags&128)!==0){if(x)return hb(r,l,f);l.flags|=128}if(E=l.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),yi(Bi,Bi.current),x)break;return null;case 22:case 23:return l.lanes=0,ab(r,l,f)}return os(r,l,f)}function rC(r,l){switch(_y(l),l.tag){case 1:return ar(l.type)&&Mf(),r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 3:return Hc(),Ei(sr),Ei(kn),vy(),r=l.flags,(r&65536)!==0&&(r&128)===0?(l.flags=r&-65537|128,l):null;case 5:return xy(l),null;case 13:if(Ei(Bi),r=l.memoizedState,r!==null&&r.dehydrated!==null){if(l.alternate===null)throw Error(We(340));Wc()}return r=l.flags,r&65536?(l.flags=r&-65537|128,l):null;case 19:return Ei(Bi),null;case 4:return Hc(),null;case 10:return py(l.type._context),null;case 22:case 23:return zy(),null;case 24:return null;default:return null}}var sf=!1,In=!1,oC=typeof WeakSet=="function"?WeakSet:Set,dt=null;function Fc(r,l){var f=r.ref;if(f!==null)if(typeof f=="function")try{f(null)}catch(x){ji(r,l,x)}else f.current=null}function Rg(r,l,f){try{f()}catch(x){ji(r,l,x)}}var u1=!1;function sC(r,l){if(vg=Cf,r=gw(),uy(r)){if("selectionStart"in r)var f={start:r.selectionStart,end:r.selectionEnd};else e:{f=(f=r.ownerDocument)&&f.defaultView||window;var x=f.getSelection&&f.getSelection();if(x&&x.rangeCount!==0){f=x.anchorNode;var E=x.anchorOffset,I=x.focusNode;x=x.focusOffset;try{f.nodeType,I.nodeType}catch{f=null;break e}var F=0,s=-1,G=-1,ue=0,ae=0,me=r,de=null;t:for(;;){for(var Ae;me!==f||E!==0&&me.nodeType!==3||(s=F+E),me!==I||x!==0&&me.nodeType!==3||(G=F+x),me.nodeType===3&&(F+=me.nodeValue.length),(Ae=me.firstChild)!==null;)de=me,me=Ae;for(;;){if(me===r)break t;if(de===f&&++ue===E&&(s=F),de===I&&++ae===x&&(G=F),(Ae=me.nextSibling)!==null)break;me=de,de=me.parentNode}me=Ae}f=s===-1||G===-1?null:{start:s,end:G}}else f=null}f=f||{start:0,end:0}}else f=null;for(wg={focusedElem:r,selectionRange:f},Cf=!1,dt=l;dt!==null;)if(l=dt,r=l.child,(l.subtreeFlags&1028)!==0&&r!==null)r.return=l,dt=r;else for(;dt!==null;){l=dt;try{var je=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(je!==null){var Ge=je.memoizedProps,Tt=je.memoizedState,ve=l.stateNode,he=ve.getSnapshotBeforeUpdate(l.elementType===l.type?Ge:Qr(l.type,Ge),Tt);ve.__reactInternalSnapshotBeforeUpdate=he}break;case 3:var Se=l.stateNode.containerInfo;if(Se.nodeType===1)Se.textContent="";else if(Se.nodeType===9){var Ze=Se.body;Ze!=null&&(Ze.textContent="")}break;case 5:case 6:case 4:case 17:break;default:throw Error(We(163))}}catch(Fe){ji(l,l.return,Fe)}if(r=l.sibling,r!==null){r.return=l.return,dt=r;break}dt=l.return}return je=u1,u1=!1,je}function Bh(r,l,f){var x=l.updateQueue;if(x=x!==null?x.lastEffect:null,x!==null){var E=x=x.next;do{if((E.tag&r)===r){var I=E.destroy;E.destroy=void 0,I!==void 0&&Rg(l,f,I)}E=E.next}while(E!==x)}}function em(r,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var f=l=l.next;do{if((f.tag&r)===r){var x=f.create;f.destroy=x()}f=f.next}while(f!==l)}}function Fg(r){var l=r.ref;if(l!==null){var f=r.stateNode;switch(r.tag){case 5:r=f;break;default:r=f}typeof l=="function"?l(r):l.current=r}}function db(r){var l=r.alternate;l!==null&&(r.alternate=null,db(l)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(l=r.stateNode,l!==null&&(delete l[To],delete l[Xh],delete l[Eg],delete l[GS],delete l[$S])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function pb(r){return r.tag===5||r.tag===3||r.tag===4}function h1(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||pb(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Og(r,l,f){var x=r.tag;if(x===5||x===6)r=r.stateNode,l?f.nodeType===8?f.parentNode.insertBefore(r,l):f.insertBefore(r,l):(f.nodeType===8?(l=f.parentNode,l.insertBefore(r,f)):(l=f,l.appendChild(r)),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=kf));else if(x!==4&&(r=r.child,r!==null))for(Og(r,l,f),r=r.sibling;r!==null;)Og(r,l,f),r=r.sibling}function Ng(r,l,f){var x=r.tag;if(x===5||x===6)r=r.stateNode,l?f.insertBefore(r,l):f.appendChild(r);else if(x!==4&&(r=r.child,r!==null))for(Ng(r,l,f),r=r.sibling;r!==null;)Ng(r,l,f),r=r.sibling}var fn=null,eo=!1;function Vs(r,l,f){for(f=f.child;f!==null;)fb(r,l,f),f=f.sibling}function fb(r,l,f){if(Eo&&typeof Eo.onCommitFiberUnmount=="function")try{Eo.onCommitFiberUnmount(qf,f)}catch{}switch(f.tag){case 5:In||Fc(f,l);case 6:var x=fn,E=eo;fn=null,Vs(r,l,f),fn=x,eo=E,fn!==null&&(eo?(r=fn,f=f.stateNode,r.nodeType===8?r.parentNode.removeChild(f):r.removeChild(f)):fn.removeChild(f.stateNode));break;case 18:fn!==null&&(eo?(r=fn,f=f.stateNode,r.nodeType===8?V_(r.parentNode,f):r.nodeType===1&&V_(r,f),Gh(r)):V_(fn,f.stateNode));break;case 4:x=fn,E=eo,fn=f.stateNode.containerInfo,eo=!0,Vs(r,l,f),fn=x,eo=E;break;case 0:case 11:case 14:case 15:if(!In&&(x=f.updateQueue,x!==null&&(x=x.lastEffect,x!==null))){E=x=x.next;do{var I=E,F=I.destroy;I=I.tag,F!==void 0&&((I&2)!==0||(I&4)!==0)&&Rg(f,l,F),E=E.next}while(E!==x)}Vs(r,l,f);break;case 1:if(!In&&(Fc(f,l),x=f.stateNode,typeof x.componentWillUnmount=="function"))try{x.props=f.memoizedProps,x.state=f.memoizedState,x.componentWillUnmount()}catch(s){ji(f,l,s)}Vs(r,l,f);break;case 21:Vs(r,l,f);break;case 22:f.mode&1?(In=(x=In)||f.memoizedState!==null,Vs(r,l,f),In=x):Vs(r,l,f);break;default:Vs(r,l,f)}}function d1(r){var l=r.updateQueue;if(l!==null){r.updateQueue=null;var f=r.stateNode;f===null&&(f=r.stateNode=new oC),l.forEach(function(x){var E=mC.bind(null,r,x);f.has(x)||(f.add(x),x.then(E,E))})}}function Jr(r,l){var f=l.deletions;if(f!==null)for(var x=0;x<f.length;x++){var E=f[x];try{var I=r,F=l,s=F;e:for(;s!==null;){switch(s.tag){case 5:fn=s.stateNode,eo=!1;break e;case 3:fn=s.stateNode.containerInfo,eo=!0;break e;case 4:fn=s.stateNode.containerInfo,eo=!0;break e}s=s.return}if(fn===null)throw Error(We(160));fb(I,F,E),fn=null,eo=!1;var G=E.alternate;G!==null&&(G.return=null),E.return=null}catch(ue){ji(E,l,ue)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)mb(l,r),l=l.sibling}function mb(r,l){var f=r.alternate,x=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Jr(l,r),wo(r),x&4){try{Bh(3,r,r.return),em(3,r)}catch(je){ji(r,r.return,je)}try{Bh(5,r,r.return)}catch(je){ji(r,r.return,je)}}break;case 1:Jr(l,r),wo(r),x&512&&f!==null&&Fc(f,f.return);break;case 5:if(Jr(l,r),wo(r),x&512&&f!==null&&Fc(f,f.return),r.flags&32){var E=r.stateNode;try{Nh(E,"")}catch(je){ji(r,r.return,je)}}if(x&4&&(E=r.stateNode,E!=null)){var I=r.memoizedProps,F=f!==null?f.memoizedProps:I,s=r.type,G=r.updateQueue;if(r.updateQueue=null,G!==null)try{s==="input"&&I.type==="radio"&&I.name!=null&&O1(E,I),ug(s,F);var ue=ug(s,I);for(F=0;F<G.length;F+=2){var ae=G[F],me=G[F+1];ae==="style"?G1(E,me):ae==="dangerouslySetInnerHTML"?j1(E,me):ae==="children"?Nh(E,me):Kg(E,ae,me,ue)}switch(s){case"input":og(E,I);break;case"textarea":N1(E,I);break;case"select":var de=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!I.multiple;var Ae=I.value;Ae!=null?Nc(E,!!I.multiple,Ae,!1):de!==!!I.multiple&&(I.defaultValue!=null?Nc(E,!!I.multiple,I.defaultValue,!0):Nc(E,!!I.multiple,I.multiple?[]:"",!1))}E[Xh]=I}catch(je){ji(r,r.return,je)}}break;case 6:if(Jr(l,r),wo(r),x&4){if(r.stateNode===null)throw Error(We(162));ue=r.stateNode,ae=r.memoizedProps;try{ue.nodeValue=ae}catch(je){ji(r,r.return,je)}}break;case 3:if(Jr(l,r),wo(r),x&4&&f!==null&&f.memoizedState.isDehydrated)try{Gh(l.containerInfo)}catch(je){ji(r,r.return,je)}break;case 4:Jr(l,r),wo(r);break;case 13:Jr(l,r),wo(r),ue=r.child,ue.flags&8192&&ue.memoizedState!==null&&(ue.alternate===null||ue.alternate.memoizedState===null)&&(ky=Vi()),x&4&&d1(r);break;case 22:if(ue=f!==null&&f.memoizedState!==null,r.mode&1?(In=(ae=In)||ue,Jr(l,r),In=ae):Jr(l,r),wo(r),x&8192){ae=r.memoizedState!==null;e:for(me=null,de=r;;){if(de.tag===5){if(me===null){me=de;try{E=de.stateNode,ae?(I=E.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(s=de.stateNode,G=de.memoizedProps.style,F=G!=null&&G.hasOwnProperty("display")?G.display:null,s.style.display=V1("display",F))}catch(je){ji(r,r.return,je)}}}else if(de.tag===6){if(me===null)try{de.stateNode.nodeValue=ae?"":de.memoizedProps}catch(je){ji(r,r.return,je)}}else if((de.tag!==22&&de.tag!==23||de.memoizedState===null||de===r)&&de.child!==null){de.child.return=de,de=de.child;continue}if(de===r)break e;for(;de.sibling===null;){if(de.return===null||de.return===r)break e;me===de&&(me=null),de=de.return}me===de&&(me=null),de.sibling.return=de.return,de=de.sibling}if(ae&&!ue&&(r.mode&1)!==0)for(dt=r,r=r.child;r!==null;){for(ue=dt=r;dt!==null;){switch(ae=dt,me=ae.child,ae.tag){case 0:case 11:case 14:case 15:Bh(4,ae,ae.return);break;case 1:if(Fc(ae,ae.return),I=ae.stateNode,typeof I.componentWillUnmount=="function"){de=ae,Ae=ae.return;try{E=de,I.props=E.memoizedProps,I.state=E.memoizedState,I.componentWillUnmount()}catch(je){ji(de,Ae,je)}}break;case 5:Fc(ae,ae.return);break;case 22:if(ae.memoizedState!==null){f1(ue);continue}}me!==null?(me.return=ae,dt=me):f1(ue)}r=r.sibling}}break;case 19:Jr(l,r),wo(r),x&4&&d1(r);break;case 21:break;default:Jr(l,r),wo(r)}}function wo(r){var l=r.flags;if(l&2){try{e:{for(var f=r.return;f!==null;){if(pb(f)){var x=f;break e}f=f.return}throw Error(We(160))}switch(x.tag){case 5:var E=x.stateNode;x.flags&32&&(Nh(E,""),x.flags&=-33);var I=h1(r);Ng(r,I,E);break;case 3:case 4:var F=x.stateNode.containerInfo,s=h1(r);Og(r,s,F);break;default:throw Error(We(161))}}catch(G){ji(r,r.return,G)}r.flags&=-3}l&4096&&(r.flags&=-4097)}function aC(r,l,f){dt=r,_b(r)}function _b(r,l,f){for(var x=(r.mode&1)!==0;dt!==null;){var E=dt,I=E.child;if(E.tag===22&&x){var F=E.memoizedState!==null||sf;if(!F){var s=E.alternate,G=s!==null&&s.memoizedState!==null||In;s=sf;var ue=In;if(sf=F,(In=G)&&!ue)for(dt=E;dt!==null;)F=dt,G=F.child,F.tag===22&&F.memoizedState!==null?m1(E):G!==null?(G.return=F,dt=G):m1(E);for(;I!==null;)dt=I,_b(I),I=I.sibling;dt=E,sf=s,In=ue}p1(r)}else(E.subtreeFlags&8772)!==0&&I!==null?(I.return=E,dt=I):p1(r)}}function p1(r){for(;dt!==null;){var l=dt;if((l.flags&8772)!==0){var f=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:In||em(5,l);break;case 1:var x=l.stateNode;if(l.flags&4&&!In)if(f===null)x.componentDidMount();else{var E=l.elementType===l.type?f.memoizedProps:Qr(l.type,f.memoizedProps);x.componentDidUpdate(E,f.memoizedState,x.__reactInternalSnapshotBeforeUpdate)}var I=l.updateQueue;I!==null&&Zv(l,I,x);break;case 3:var F=l.updateQueue;if(F!==null){if(f=null,l.child!==null)switch(l.child.tag){case 5:f=l.child.stateNode;break;case 1:f=l.child.stateNode}Zv(l,F,f)}break;case 5:var s=l.stateNode;if(f===null&&l.flags&4){f=s;var G=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":G.autoFocus&&f.focus();break;case"img":G.src&&(f.src=G.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var ue=l.alternate;if(ue!==null){var ae=ue.memoizedState;if(ae!==null){var me=ae.dehydrated;me!==null&&Gh(me)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(We(163))}In||l.flags&512&&Fg(l)}catch(de){ji(l,l.return,de)}}if(l===r){dt=null;break}if(f=l.sibling,f!==null){f.return=l.return,dt=f;break}dt=l.return}}function f1(r){for(;dt!==null;){var l=dt;if(l===r){dt=null;break}var f=l.sibling;if(f!==null){f.return=l.return,dt=f;break}dt=l.return}}function m1(r){for(;dt!==null;){var l=dt;try{switch(l.tag){case 0:case 11:case 15:var f=l.return;try{em(4,l)}catch(G){ji(l,f,G)}break;case 1:var x=l.stateNode;if(typeof x.componentDidMount=="function"){var E=l.return;try{x.componentDidMount()}catch(G){ji(l,E,G)}}var I=l.return;try{Fg(l)}catch(G){ji(l,I,G)}break;case 5:var F=l.return;try{Fg(l)}catch(G){ji(l,F,G)}}}catch(G){ji(l,l.return,G)}if(l===r){dt=null;break}var s=l.sibling;if(s!==null){s.return=l.return,dt=s;break}dt=l.return}}var lC=Math.ceil,Uf=ss.ReactCurrentDispatcher,Ay=ss.ReactCurrentOwner,Pr=ss.ReactCurrentBatchConfig,Kt=0,nn=null,Zi=null,mn=0,fr=0,Oc=sa(0),tn=0,ed=null,cl=0,tm=0,Iy=0,Rh=null,nr=null,ky=0,Yc=1/0,Yo=null,jf=!1,Ug=null,ea=null,af=!1,Hs=null,Vf=0,Fh=0,jg=null,yf=-1,xf=0;function Fn(){return(Kt&6)!==0?Vi():yf!==-1?yf:yf=Vi()}function ta(r){return(r.mode&1)===0?1:(Kt&2)!==0&&mn!==0?mn&-mn:qS.transition!==null?(xf===0&&(xf=tw()),xf):(r=ci,r!==0||(r=window.event,r=r===void 0?16:lw(r.type)),r)}function Dr(r,l,f){if(50<Fh)throw Fh=0,jg=null,Error(We(185));var x=im(r,l);return x===null?null:(id(x,l,f),((Kt&2)===0||x!==nn)&&(x===nn&&((Kt&2)===0&&(tm|=l),tn===4&&Ws(x,mn)),lr(x,f),l===1&&Kt===0&&(r.mode&1)===0&&(Yc=Vi()+500,Kf&&aa())),x)}function im(r,l){r.lanes|=l;var f=r.alternate;for(f!==null&&(f.lanes|=l),f=r,r=r.return;r!==null;)r.childLanes|=l,f=r.alternate,f!==null&&(f.childLanes|=l),f=r,r=r.return;return f.tag===3?f.stateNode:null}function gb(r){return(nn!==null||io!==null)&&(r.mode&1)!==0&&(Kt&2)===0}function lr(r,l){var f=r.callbackNode;qE(r,l);var x=Sf(r,r===nn?mn:0);if(x===0)f!==null&&wv(f),r.callbackNode=null,r.callbackPriority=0;else if(l=x&-x,r.callbackPriority!==l){if(f!=null&&wv(f),l===1)r.tag===0?ZS(_1.bind(null,r)):Aw(_1.bind(null,r)),jS(function(){Kt===0&&aa()}),f=null;else{switch(iw(x)){case 1:f=iy;break;case 4:f=Q1;break;case 16:f=Ef;break;case 536870912:f=ew;break;default:f=Ef}f=Sb(f,yb.bind(null,r))}r.callbackPriority=l,r.callbackNode=f}}function yb(r,l){if(yf=-1,xf=0,(Kt&6)!==0)throw Error(We(327));var f=r.callbackNode;if($c()&&r.callbackNode!==f)return null;var x=Sf(r,r===nn?mn:0);if(x===0)return null;if((x&30)!==0||(x&r.expiredLanes)!==0||l)l=Gf(r,x);else{l=x;var E=Kt;Kt|=2;var I=vb();(nn!==r||mn!==l)&&(Yo=null,Yc=Vi()+500,rl(r,l));do try{hC();break}catch(s){xb(r,s)}while(1);dy(),Uf.current=I,Kt=E,Zi!==null?l=0:(nn=null,mn=0,l=tn)}if(l!==0){if(l===2&&(E=mg(r),E!==0&&(x=E,l=Vg(r,E))),l===1)throw f=ed,rl(r,0),Ws(r,x),lr(r,Vi()),f;if(l===6)Ws(r,x);else{if(E=r.current.alternate,(x&30)===0&&!cC(E)&&(l=Gf(r,x),l===2&&(I=mg(r),I!==0&&(x=I,l=Vg(r,I))),l===1))throw f=ed,rl(r,0),Ws(r,x),lr(r,Vi()),f;switch(r.finishedWork=E,r.finishedLanes=x,l){case 0:case 1:throw Error(We(345));case 2:tl(r,nr,Yo);break;case 3:if(Ws(r,x),(x&130023424)===x&&(l=ky+500-Vi(),10<l)){if(Sf(r,0)!==0)break;if(E=r.suspendedLanes,(E&x)!==x){Fn(),r.pingedLanes|=r.suspendedLanes&E;break}r.timeoutHandle=Tg(tl.bind(null,r,nr,Yo),l);break}tl(r,nr,Yo);break;case 4:if(Ws(r,x),(x&4194240)===x)break;for(l=r.eventTimes,E=-1;0<x;){var F=31-no(x);I=1<<F,F=l[F],F>E&&(E=F),x&=~I}if(x=E,x=Vi()-x,x=(120>x?120:480>x?480:1080>x?1080:1920>x?1920:3e3>x?3e3:4320>x?4320:1960*lC(x/1960))-x,10<x){r.timeoutHandle=Tg(tl.bind(null,r,nr,Yo),x);break}tl(r,nr,Yo);break;case 5:tl(r,nr,Yo);break;default:throw Error(We(329))}}}return lr(r,Vi()),r.callbackNode===f?yb.bind(null,r):null}function Vg(r,l){var f=Rh;return r.current.memoizedState.isDehydrated&&(rl(r,l).flags|=256),r=Gf(r,l),r!==2&&(l=nr,nr=f,l!==null&&Gg(l)),r}function Gg(r){nr===null?nr=r:nr.push.apply(nr,r)}function cC(r){for(var l=r;;){if(l.flags&16384){var f=l.updateQueue;if(f!==null&&(f=f.stores,f!==null))for(var x=0;x<f.length;x++){var E=f[x],I=E.getSnapshot;E=E.value;try{if(!ro(I(),E))return!1}catch{return!1}}}if(f=l.child,l.subtreeFlags&16384&&f!==null)f.return=l,l=f;else{if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Ws(r,l){for(l&=~Iy,l&=~tm,r.suspendedLanes|=l,r.pingedLanes&=~l,r=r.expirationTimes;0<l;){var f=31-no(l),x=1<<f;r[f]=-1,l&=~x}}function _1(r){if((Kt&6)!==0)throw Error(We(327));$c();var l=Sf(r,0);if((l&1)===0)return lr(r,Vi()),null;var f=Gf(r,l);if(r.tag!==0&&f===2){var x=mg(r);x!==0&&(l=x,f=Vg(r,x))}if(f===1)throw f=ed,rl(r,0),Ws(r,l),lr(r,Vi()),f;if(f===6)throw Error(We(345));return r.finishedWork=r.current.alternate,r.finishedLanes=l,tl(r,nr,Yo),lr(r,Vi()),null}function My(r,l){var f=Kt;Kt|=1;try{return r(l)}finally{Kt=f,Kt===0&&(Yc=Vi()+500,Kf&&aa())}}function ul(r){Hs!==null&&Hs.tag===0&&(Kt&6)===0&&$c();var l=Kt;Kt|=1;var f=Pr.transition,x=ci;try{if(Pr.transition=null,ci=1,r)return r()}finally{ci=x,Pr.transition=f,Kt=l,(Kt&6)===0&&aa()}}function zy(){fr=Oc.current,Ei(Oc)}function rl(r,l){r.finishedWork=null,r.finishedLanes=0;var f=r.timeoutHandle;if(f!==-1&&(r.timeoutHandle=-1,US(f)),Zi!==null)for(f=Zi.return;f!==null;){var x=f;switch(_y(x),x.tag){case 1:x=x.type.childContextTypes,x!=null&&Mf();break;case 3:Hc(),Ei(sr),Ei(kn),vy();break;case 5:xy(x);break;case 4:Hc();break;case 13:Ei(Bi);break;case 19:Ei(Bi);break;case 10:py(x.type._context);break;case 22:case 23:zy()}f=f.return}if(nn=r,Zi=r=ra(r.current,null),mn=fr=l,tn=0,ed=null,Iy=tm=cl=0,nr=Rh=null,io!==null){for(l=0;l<io.length;l++)if(f=io[l],x=f.interleaved,x!==null){f.interleaved=null;var E=x.next,I=f.pending;if(I!==null){var F=I.next;I.next=E,x.next=F}f.pending=x}io=null}return r}function xb(r,l){do{var f=Zi;try{if(dy(),_f.current=Nf,Of){for(var x=Ri.memoizedState;x!==null;){var E=x.queue;E!==null&&(E.pending=null),x=x.next}Of=!1}if(ll=0,cn=en=Ri=null,Lh=!1,Kh=0,Ay.current=null,f===null||f.return===null){tn=1,ed=l,Zi=null;break}e:{var I=r,F=f.return,s=f,G=l;if(l=mn,s.flags|=32768,G!==null&&typeof G=="object"&&typeof G.then=="function"){var ue=G,ae=s,me=ae.tag;if((ae.mode&1)===0&&(me===0||me===11||me===15)){var de=ae.alternate;de?(ae.updateQueue=de.updateQueue,ae.memoizedState=de.memoizedState,ae.lanes=de.lanes):(ae.updateQueue=null,ae.memoizedState=null)}var Ae=e1(F);if(Ae!==null){Ae.flags&=-257,t1(Ae,F,s,I,l),Ae.mode&1&&Qv(I,ue,l),l=Ae,G=ue;var je=l.updateQueue;if(je===null){var Ge=new Set;Ge.add(G),l.updateQueue=Ge}else je.add(G);break e}else{if((l&1)===0){Qv(I,ue,l),Py();break e}G=Error(We(426))}}else if(Mi&&s.mode&1){var Tt=e1(F);if(Tt!==null){(Tt.flags&65536)===0&&(Tt.flags|=256),t1(Tt,F,s,I,l),gy(G);break e}}I=G,tn!==4&&(tn=2),Rh===null?Rh=[I]:Rh.push(I),G=Cy(G,s),s=F;do{switch(s.tag){case 3:s.flags|=65536,l&=-l,s.lanes|=l;var ve=tb(s,G,l);$v(s,ve);break e;case 1:I=G;var he=s.type,Se=s.stateNode;if((s.flags&128)===0&&(typeof he.getDerivedStateFromError=="function"||Se!==null&&typeof Se.componentDidCatch=="function"&&(ea===null||!ea.has(Se)))){s.flags|=65536,l&=-l,s.lanes|=l;var Ze=ib(s,I,l);$v(s,Ze);break e}}s=s.return}while(s!==null)}bb(f)}catch(Fe){l=Fe,Zi===f&&f!==null&&(Zi=f=f.return);continue}break}while(1)}function vb(){var r=Uf.current;return Uf.current=Nf,r===null?Nf:r}function Py(){(tn===0||tn===3||tn===2)&&(tn=4),nn===null||(cl&268435455)===0&&(tm&268435455)===0||Ws(nn,mn)}function Gf(r,l){var f=Kt;Kt|=2;var x=vb();(nn!==r||mn!==l)&&(Yo=null,rl(r,l));do try{uC();break}catch(E){xb(r,E)}while(1);if(dy(),Kt=f,Uf.current=x,Zi!==null)throw Error(We(261));return nn=null,mn=0,tn}function uC(){for(;Zi!==null;)wb(Zi)}function hC(){for(;Zi!==null&&!FE();)wb(Zi)}function wb(r){var l=Eb(r.alternate,r,fr);r.memoizedProps=r.pendingProps,l===null?bb(r):Zi=l,Ay.current=null}function bb(r){var l=r;do{var f=l.alternate;if(r=l.return,(l.flags&32768)===0){if(f=tC(f,l,fr),f!==null){Zi=f;return}}else{if(f=rC(f,l),f!==null){f.flags&=32767,Zi=f;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{tn=6,Zi=null;return}}if(l=l.sibling,l!==null){Zi=l;return}Zi=l=r}while(l!==null);tn===0&&(tn=5)}function tl(r,l,f){var x=ci,E=Pr.transition;try{Pr.transition=null,ci=1,dC(r,l,f,x)}finally{Pr.transition=E,ci=x}return null}function dC(r,l,f,x){do $c();while(Hs!==null);if((Kt&6)!==0)throw Error(We(327));f=r.finishedWork;var E=r.finishedLanes;if(f===null)return null;if(r.finishedWork=null,r.finishedLanes=0,f===r.current)throw Error(We(177));r.callbackNode=null,r.callbackPriority=0;var I=f.lanes|f.childLanes;if(WE(r,I),r===nn&&(Zi=nn=null,mn=0),(f.subtreeFlags&2064)===0&&(f.flags&2064)===0||af||(af=!0,Sb(Ef,function(){return $c(),null})),I=(f.flags&15990)!==0,(f.subtreeFlags&15990)!==0||I){I=Pr.transition,Pr.transition=null;var F=ci;ci=1;var s=Kt;Kt|=4,Ay.current=null,sC(r,f),mb(f,r),DS(wg),Cf=!!vg,wg=vg=null,r.current=f,aC(f),OE(),Kt=s,ci=F,Pr.transition=I}else r.current=f;if(af&&(af=!1,Hs=r,Vf=E),I=r.pendingLanes,I===0&&(ea=null),jE(f.stateNode),lr(r,Vi()),l!==null)for(x=r.onRecoverableError,f=0;f<l.length;f++)x(l[f]);if(jf)throw jf=!1,r=Ug,Ug=null,r;return(Vf&1)!==0&&r.tag!==0&&$c(),I=r.pendingLanes,(I&1)!==0?r===jg?Fh++:(Fh=0,jg=r):Fh=0,aa(),null}function $c(){if(Hs!==null){var r=iw(Vf),l=Pr.transition,f=ci;try{if(Pr.transition=null,ci=16>r?16:r,Hs===null)var x=!1;else{if(r=Hs,Hs=null,Vf=0,(Kt&6)!==0)throw Error(We(331));var E=Kt;for(Kt|=4,dt=r.current;dt!==null;){var I=dt,F=I.child;if((dt.flags&16)!==0){var s=I.deletions;if(s!==null){for(var G=0;G<s.length;G++){var ue=s[G];for(dt=ue;dt!==null;){var ae=dt;switch(ae.tag){case 0:case 11:case 15:Bh(8,ae,I)}var me=ae.child;if(me!==null)me.return=ae,dt=me;else for(;dt!==null;){ae=dt;var de=ae.sibling,Ae=ae.return;if(db(ae),ae===ue){dt=null;break}if(de!==null){de.return=Ae,dt=de;break}dt=Ae}}}var je=I.alternate;if(je!==null){var Ge=je.child;if(Ge!==null){je.child=null;do{var Tt=Ge.sibling;Ge.sibling=null,Ge=Tt}while(Ge!==null)}}dt=I}}if((I.subtreeFlags&2064)!==0&&F!==null)F.return=I,dt=F;else e:for(;dt!==null;){if(I=dt,(I.flags&2048)!==0)switch(I.tag){case 0:case 11:case 15:Bh(9,I,I.return)}var ve=I.sibling;if(ve!==null){ve.return=I.return,dt=ve;break e}dt=I.return}}var he=r.current;for(dt=he;dt!==null;){F=dt;var Se=F.child;if((F.subtreeFlags&2064)!==0&&Se!==null)Se.return=F,dt=Se;else e:for(F=he;dt!==null;){if(s=dt,(s.flags&2048)!==0)try{switch(s.tag){case 0:case 11:case 15:em(9,s)}}catch(Fe){ji(s,s.return,Fe)}if(s===F){dt=null;break e}var Ze=s.sibling;if(Ze!==null){Ze.return=s.return,dt=Ze;break e}dt=s.return}}if(Kt=E,aa(),Eo&&typeof Eo.onPostCommitFiberRoot=="function")try{Eo.onPostCommitFiberRoot(qf,r)}catch{}x=!0}return x}finally{ci=f,Pr.transition=l}}return!1}function g1(r,l,f){l=Cy(f,l),l=tb(r,l,1),Qs(r,l),l=Fn(),r=im(r,1),r!==null&&(id(r,1,l),lr(r,l))}function ji(r,l,f){if(r.tag===3)g1(r,r,f);else for(;l!==null;){if(l.tag===3){g1(l,r,f);break}else if(l.tag===1){var x=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(ea===null||!ea.has(x))){r=Cy(f,r),r=ib(l,r,1),Qs(l,r),r=Fn(),l=im(l,1),l!==null&&(id(l,1,r),lr(l,r));break}}l=l.return}}function pC(r,l,f){var x=r.pingCache;x!==null&&x.delete(l),l=Fn(),r.pingedLanes|=r.suspendedLanes&f,nn===r&&(mn&f)===f&&(tn===4||tn===3&&(mn&130023424)===mn&&500>Vi()-ky?rl(r,0):Iy|=f),lr(r,l)}function Tb(r,l){l===0&&((r.mode&1)===0?l=1:(l=Hp,Hp<<=1,(Hp&130023424)===0&&(Hp=4194304)));var f=Fn();r=im(r,l),r!==null&&(id(r,l,f),lr(r,f))}function fC(r){var l=r.memoizedState,f=0;l!==null&&(f=l.retryLane),Tb(r,f)}function mC(r,l){var f=0;switch(r.tag){case 13:var x=r.stateNode,E=r.memoizedState;E!==null&&(f=E.retryLane);break;case 19:x=r.stateNode;break;default:throw Error(We(314))}x!==null&&x.delete(l),Tb(r,f)}var Eb;Eb=function(r,l,f){if(r!==null)if(r.memoizedProps!==l.pendingProps||sr.current)or=!0;else{if((r.lanes&f)===0&&(l.flags&128)===0)return or=!1,nC(r,l,f);or=(r.flags&131072)!==0}else or=!1,Mi&&(l.flags&1048576)!==0&&zw(l,Rf,l.index);switch(l.lanes=0,l.tag){case 2:var x=l.type;r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2),r=l.pendingProps;var E=qc(l,kn.current);Gc(l,f),E=by(null,l,x,r,E,f);var I=Ty();return l.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,ar(x)?(I=!0,zf(l)):I=!1,l.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,fy(l),E.updater=Jf,l.stateNode=E,E._reactInternals=l,Ig(l,x,r,f),l=Lg(null,l,x,!0,I,f)):(l.tag=0,Mi&&I&&my(l),Rn(null,l,E,f),l=l.child),l;case 16:x=l.elementType;e:{switch(r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2),r=l.pendingProps,E=x._init,x=E(x._payload),l.type=x,E=l.tag=gC(x),r=Qr(x,r),E){case 0:l=Dg(null,l,x,r,f);break e;case 1:l=r1(null,l,x,r,f);break e;case 11:l=i1(null,l,x,r,f);break e;case 14:l=n1(null,l,x,Qr(x.type,r),f);break e}throw Error(We(306,x,""))}return l;case 0:return x=l.type,E=l.pendingProps,E=l.elementType===x?E:Qr(x,E),Dg(r,l,x,E,f);case 1:return x=l.type,E=l.pendingProps,E=l.elementType===x?E:Qr(x,E),r1(r,l,x,E,f);case 3:e:{if(cb(l),r===null)throw Error(We(387));x=l.pendingProps,I=l.memoizedState,E=I.element,Iw(r,l),Lf(l,x,null,f);var F=l.memoizedState;if(x=F.element,I.isDehydrated)if(I={element:x,isDehydrated:!1,cache:F.cache,pendingSuspenseBoundaries:F.pendingSuspenseBoundaries,transitions:F.transitions},l.updateQueue.baseState=I,l.memoizedState=I,l.flags&256){E=Error(We(423)),l=o1(r,l,x,f,E);break e}else if(x!==E){E=Error(We(424)),l=o1(r,l,x,f,E);break e}else for(rr=Qo(l.stateNode.containerInfo.firstChild),mr=l,Mi=!0,to=null,f=Lw(l,null,x,f),l.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(Wc(),x===E){l=os(r,l,f);break e}Rn(r,l,x,f)}l=l.child}return l;case 5:return Bw(l),r===null&&Mg(l),x=l.type,E=l.pendingProps,I=r!==null?r.memoizedProps:null,F=E.children,bg(x,E)?F=null:I!==null&&bg(x,I)&&(l.flags|=32),lb(r,l),Rn(r,l,F,f),l.child;case 6:return r===null&&Mg(l),null;case 13:return ub(r,l,f);case 4:return yy(l,l.stateNode.containerInfo),x=l.pendingProps,r===null?l.child=Xc(l,null,x,f):Rn(r,l,x,f),l.child;case 11:return x=l.type,E=l.pendingProps,E=l.elementType===x?E:Qr(x,E),i1(r,l,x,E,f);case 7:return Rn(r,l,l.pendingProps,f),l.child;case 8:return Rn(r,l,l.pendingProps.children,f),l.child;case 12:return Rn(r,l,l.pendingProps.children,f),l.child;case 10:e:{if(x=l.type._context,E=l.pendingProps,I=l.memoizedProps,F=E.value,yi(Pf,x._currentValue),x._currentValue=F,I!==null)if(ro(I.value,F)){if(I.children===E.children&&!sr.current){l=os(r,l,f);break e}}else for(I=l.child,I!==null&&(I.return=l);I!==null;){var s=I.dependencies;if(s!==null){F=I.child;for(var G=s.firstContext;G!==null;){if(G.context===x){if(I.tag===1){G=is(-1,f&-f),G.tag=2;var ue=I.updateQueue;if(ue!==null){ue=ue.shared;var ae=ue.pending;ae===null?G.next=G:(G.next=ae.next,ae.next=G),ue.pending=G}}I.lanes|=f,G=I.alternate,G!==null&&(G.lanes|=f),Cg(I.return,f,l),s.lanes|=f;break}G=G.next}}else if(I.tag===10)F=I.type===l.type?null:I.child;else if(I.tag===18){if(F=I.return,F===null)throw Error(We(341));F.lanes|=f,s=F.alternate,s!==null&&(s.lanes|=f),Cg(F,f,l),F=I.sibling}else F=I.child;if(F!==null)F.return=I;else for(F=I;F!==null;){if(F===l){F=null;break}if(I=F.sibling,I!==null){I.return=F.return,F=I;break}F=F.return}I=F}Rn(r,l,E.children,f),l=l.child}return l;case 9:return E=l.type,x=l.pendingProps.children,Gc(l,f),E=Lr(E),x=x(E),l.flags|=1,Rn(r,l,x,f),l.child;case 14:return x=l.type,E=Qr(x,l.pendingProps),E=Qr(x.type,E),n1(r,l,x,E,f);case 15:return sb(r,l,l.type,l.pendingProps,f);case 17:return x=l.type,E=l.pendingProps,E=l.elementType===x?E:Qr(x,E),r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2),l.tag=1,ar(x)?(r=!0,zf(l)):r=!1,Gc(l,f),Mw(l,x,E),Ig(l,x,E,f),Lg(null,l,x,!0,r,f);case 19:return hb(r,l,f);case 22:return ab(r,l,f)}throw Error(We(156,l.tag))};function Sb(r,l){return J1(r,l)}function _C(r,l,f,x){this.tag=r,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zr(r,l,f,x){return new _C(r,l,f,x)}function Dy(r){return r=r.prototype,!(!r||!r.isReactComponent)}function gC(r){if(typeof r=="function")return Dy(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Qg)return 11;if(r===ey)return 14}return 2}function ra(r,l){var f=r.alternate;return f===null?(f=zr(r.tag,l,r.key,r.mode),f.elementType=r.elementType,f.type=r.type,f.stateNode=r.stateNode,f.alternate=r,r.alternate=f):(f.pendingProps=l,f.type=r.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=r.flags&14680064,f.childLanes=r.childLanes,f.lanes=r.lanes,f.child=r.child,f.memoizedProps=r.memoizedProps,f.memoizedState=r.memoizedState,f.updateQueue=r.updateQueue,l=r.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=r.sibling,f.index=r.index,f.ref=r.ref,f}function vf(r,l,f,x,E,I){var F=2;if(x=r,typeof r=="function")Dy(r)&&(F=1);else if(typeof r=="string")F=5;else e:switch(r){case Ic:return ol(f.children,E,I,l);case Jg:F=8,E|=8;break;case eg:return r=zr(12,f,l,E|2),r.elementType=eg,r.lanes=I,r;case tg:return r=zr(13,f,l,E),r.elementType=tg,r.lanes=I,r;case ig:return r=zr(19,f,l,E),r.elementType=ig,r.lanes=I,r;case B1:return $f(f,E,I,l);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case D1:F=10;break e;case L1:F=9;break e;case Qg:F=11;break e;case ey:F=14;break e;case $s:F=16,x=null;break e}throw Error(We(130,r==null?r:typeof r,""))}return l=zr(F,f,l,E),l.elementType=r,l.type=x,l.lanes=I,l}function ol(r,l,f,x){return r=zr(7,r,x,l),r.lanes=f,r}function $f(r,l,f,x){return r=zr(22,r,x,l),r.elementType=B1,r.lanes=f,r.stateNode={},r}function H_(r,l,f){return r=zr(6,r,null,l),r.lanes=f,r}function Y_(r,l,f){return l=zr(4,r.children!==null?r.children:[],r.key,l),l.lanes=f,l.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},l}function yC(r,l,f,x,E){this.tag=l,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=z_(0),this.expirationTimes=z_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=z_(0),this.identifierPrefix=x,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function Ly(r,l,f,x,E,I,F,s,G){return r=new yC(r,l,f,s,G),l===1?(l=1,I===!0&&(l|=8)):l=0,I=zr(3,null,null,l),r.current=I,I.stateNode=r,I.memoizedState={element:x,isDehydrated:f,cache:null,transitions:null,pendingSuspenseBoundaries:null},fy(I),r}function xC(r,l,f){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ac,key:x==null?null:""+x,children:r,containerInfo:l,implementation:f}}function Cb(r){if(!r)return na;r=r._reactInternals;e:{if(dl(r)!==r||r.tag!==1)throw Error(We(170));var l=r;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(ar(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(We(171))}if(r.tag===1){var f=r.type;if(ar(f))return Cw(r,f,l)}return l}function Ab(r,l,f,x,E,I,F,s,G){return r=Ly(f,x,!0,r,E,I,F,s,G),r.context=Cb(null),f=r.current,x=Fn(),E=ta(f),I=is(x,E),I.callback=l!=null?l:null,Qs(f,I),r.current.lanes=E,id(r,E,x),lr(r,x),r}function nm(r,l,f,x){var E=l.current,I=Fn(),F=ta(E);return f=Cb(f),l.context===null?l.context=f:l.pendingContext=f,l=is(I,F),l.payload={element:r},x=x===void 0?null:x,x!==null&&(l.callback=x),Qs(E,l),r=Dr(E,F,I),r!==null&&mf(r,E,F),F}function Zf(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function y1(r,l){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var f=r.retryLane;r.retryLane=f!==0&&f<l?f:l}}function By(r,l){y1(r,l),(r=r.alternate)&&y1(r,l)}function vC(){return null}var Ib=typeof reportError=="function"?reportError:function(r){console.error(r)};function Ry(r){this._internalRoot=r}rm.prototype.render=Ry.prototype.render=function(r){var l=this._internalRoot;if(l===null)throw Error(We(409));nm(r,l,null,null)};rm.prototype.unmount=Ry.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var l=r.containerInfo;ul(function(){nm(null,r,null,null)}),l[rs]=null}};function rm(r){this._internalRoot=r}rm.prototype.unstable_scheduleHydration=function(r){if(r){var l=ow();r={blockedOn:null,target:r,priority:l};for(var f=0;f<qs.length&&l!==0&&l<qs[f].priority;f++);qs.splice(f,0,r),f===0&&aw(r)}};function Fy(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function om(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function x1(){}function wC(r,l,f,x,E){if(E){if(typeof x=="function"){var I=x;x=function(){var ue=Zf(F);I.call(ue)}}var F=Ab(l,x,r,0,null,!1,!1,"",x1);return r._reactRootContainer=F,r[rs]=F.current,qh(r.nodeType===8?r.parentNode:r),ul(),F}for(;E=r.lastChild;)r.removeChild(E);if(typeof x=="function"){var s=x;x=function(){var ue=Zf(G);s.call(ue)}}var G=Ly(r,0,!1,null,null,!1,!1,"",x1);return r._reactRootContainer=G,r[rs]=G.current,qh(r.nodeType===8?r.parentNode:r),ul(function(){nm(l,G,f,x)}),G}function sm(r,l,f,x,E){var I=f._reactRootContainer;if(I){var F=I;if(typeof E=="function"){var s=E;E=function(){var G=Zf(F);s.call(G)}}nm(l,F,r,E)}else F=wC(f,l,r,E,x);return Zf(F)}nw=function(r){switch(r.tag){case 3:var l=r.stateNode;if(l.current.memoizedState.isDehydrated){var f=Ah(l.pendingLanes);f!==0&&(ny(l,f|1),lr(l,Vi()),(Kt&6)===0&&(Yc=Vi()+500,aa()))}break;case 13:var x=Fn();ul(function(){return Dr(r,1,x)}),By(r,1)}};ry=function(r){if(r.tag===13){var l=Fn();Dr(r,134217728,l),By(r,134217728)}};rw=function(r){if(r.tag===13){var l=Fn(),f=ta(r);Dr(r,f,l),By(r,f)}};ow=function(){return ci};sw=function(r,l){var f=ci;try{return ci=r,l()}finally{ci=f}};dg=function(r,l,f){switch(l){case"input":if(og(r,f),l=f.name,f.type==="radio"&&l!=null){for(f=r;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<f.length;l++){var x=f[l];if(x!==r&&x.form===r.form){var E=Yf(x);if(!E)throw Error(We(90));F1(x),og(x,E)}}}break;case"textarea":N1(r,f);break;case"select":l=f.value,l!=null&&Nc(r,!!f.multiple,l,!1)}};q1=My;W1=ul;var bC={usingClientEntryPoint:!1,Events:[rd,Pc,Yf,$1,Z1,My]},wh={findFiberByHostInstance:il,bundleType:0,version:"18.1.0",rendererPackageName:"react-dom"},TC={bundleType:wh.bundleType,version:wh.version,rendererPackageName:wh.rendererPackageName,rendererConfig:wh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ss.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=Y1(r),r===null?null:r.stateNode},findFiberByHostInstance:wh.findFiberByHostInstance||vC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.1.0-next-22edb9f77-20220426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var lf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lf.isDisabled&&lf.supportsFiber)try{qf=lf.inject(TC),Eo=lf}catch{}}gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bC;gr.createPortal=function(r,l){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fy(l))throw Error(We(200));return xC(r,l,null,f)};gr.createRoot=function(r,l){if(!Fy(r))throw Error(We(299));var f=!1,x="",E=Ib;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(x=l.identifierPrefix),l.onRecoverableError!==void 0&&(E=l.onRecoverableError)),l=Ly(r,1,!1,null,null,f,!1,x,E),r[rs]=l.current,qh(r.nodeType===8?r.parentNode:r),new Ry(l)};gr.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var l=r._reactInternals;if(l===void 0)throw typeof r.render=="function"?Error(We(188)):(r=Object.keys(r).join(","),Error(We(268,r)));return r=Y1(l),r=r===null?null:r.stateNode,r};gr.flushSync=function(r){return ul(r)};gr.hydrate=function(r,l,f){if(!om(l))throw Error(We(200));return sm(null,r,l,!0,f)};gr.hydrateRoot=function(r,l,f){if(!Fy(r))throw Error(We(405));var x=f!=null&&f.hydratedSources||null,E=!1,I="",F=Ib;if(f!=null&&(f.unstable_strictMode===!0&&(E=!0),f.identifierPrefix!==void 0&&(I=f.identifierPrefix),f.onRecoverableError!==void 0&&(F=f.onRecoverableError)),l=Ab(l,null,r,1,f!=null?f:null,E,!1,I,F),r[rs]=l.current,qh(r),x)for(r=0;r<x.length;r++)f=x[r],E=f._getVersion,E=E(f._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[f,E]:l.mutableSourceEagerHydrationData.push(f,E);return new rm(l)};gr.render=function(r,l,f){if(!om(l))throw Error(We(200));return sm(null,r,l,!1,f)};gr.unmountComponentAtNode=function(r){if(!om(r))throw Error(We(40));return r._reactRootContainer?(ul(function(){sm(null,null,r,!1,function(){r._reactRootContainer=null,r[rs]=null})}),!0):!1};gr.unstable_batchedUpdates=My;gr.unstable_renderSubtreeIntoContainer=function(r,l,f,x){if(!om(f))throw Error(We(200));if(r==null||r._reactInternals===void 0)throw Error(We(38));return sm(r,l,f,!1,x)};gr.version="18.1.0-next-22edb9f77-20220426";function kb(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(kb)}catch(r){console.error(r)}}kb(),w1.exports=gr;var Mb,EC=w1.exports;Mb=EC.createRoot;var $g={exports:{}};(function(r,l){(function(f,x){r.exports=x()})(aE,function(){var f,x,E;function I(s,G){if(!f)f=G;else if(!x)x=G;else{var ue="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+f+")(sharedChunk); ("+x+")(sharedChunk); self.onerror = null;",ae={};f(ae),E=G(ae),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(E.workerUrl=window.URL.createObjectURL(new Blob([ue],{type:"text/javascript"})))}}I(["exports"],function(s){var G=typeof self!="undefined"?self:{},ue=ae;function ae(i,e,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=n,this.p2y=o}ae.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},ae.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},ae.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},ae.prototype.solveCurveX=function(i,e){var n,o,c,h,p;for(e===void 0&&(e=1e-6),c=i,p=0;p<8;p++){if(h=this.sampleCurveX(c)-i,Math.abs(h)<e)return c;var _=this.sampleCurveDerivativeX(c);if(Math.abs(_)<1e-6)break;c-=h/_}if((c=i)<(n=0))return n;if(c>(o=1))return o;for(;n<o;){if(h=this.sampleCurveX(c),Math.abs(h-i)<e)return c;i>h?n=c:o=c,c=.5*(o-n)+n}return c},ae.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var me=de;function de(i,e){this.x=i,this.y=e}de.prototype={clone:function(){return new de(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,e){var n=Math.cos(i),o=Math.sin(i),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},de.convert=function(i){return i instanceof de?i:Array.isArray(i)?new de(i[0],i[1]):i};const Ae=Math.PI/180,je=180/Math.PI;function Ge(i){return i*Ae}function Tt(i){return i*je}const ve=[[0,0],[1,0],[1,1],[0,1]];function he(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Se(i,e,n,o){const c=new ue(i,e,n,o);return function(h){return c.solve(h)}}const Ze=Se(.25,.1,.25,1);function Fe(i,e,n){return Math.min(n,Math.max(e,i))}function ct(i,e,n){return(n=Fe((n-i)/(e-i),0,1))*n*(3-2*n)}function ut(i,e,n){const o=n-e,c=((i-e)%o+o)%o+e;return c===e?n:c}function _t(i,e,n){if(!i.length)return n(null,[]);let o=i.length;const c=new Array(i.length);let h=null;i.forEach((p,_)=>{e(p,(y,v)=>{y&&(h=y),c[_]=v,--o==0&&n(h,c)})})}function ii(i){const e=[];for(const n in i)e.push(i[n]);return e}function vt(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}let un=1;function Un(){return un++}function jn(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Co(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function as(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Vn(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function xr(i,e){return i.indexOf(e,i.length-e.length)!==-1}function at(i,e,n){const o={};for(const c in i)o[c]=e.call(n||this,i[c],c,i);return o}function Et(i,e,n){const o={};for(const c in i)e.call(n||this,i[c],c,i)&&(o[c]=i[c]);return o}function wt(i){return Array.isArray(i)?i.map(wt):typeof i=="object"&&i?at(i,wt):i}const oi={};function Pt(i){oi[i]||(typeof console!="undefined"&&console.warn(i),oi[i]=!0)}function zi(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function qi(i){let e=0;for(let n,o,c=0,h=i.length,p=h-1;c<h;p=c++)n=i[c],o=i[p],e+=(o.x-n.x)*(n.y+o.y);return e}function Wi(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Xi(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,h)=>{const p=c||h;return e[o]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let gn=null;function ls(i){if(gn==null){const e=i.navigator?i.navigator.userAgent:null;gn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return gn}function la(i){try{const e=G[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Rr(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const pl=G.performance;function Ao(i){const e=i?i.url.toString():void 0;return pl.getEntriesByName(e)}var Io="2.9.0-beta.2";let Nt,Fr,ko,vr;const Gn={now:()=>ko!==void 0?ko:G.performance.now(),setNow(i){ko=i},restoreNow(){ko=void 0},frame(i){const e=G.requestAnimationFrame(i);return{cancel:()=>G.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:n,height:o}=i;vr||(vr=G.document.createElement("canvas"));const c=vr.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return(n>vr.width||o>vr.height)&&(vr.width=n,vr.height=o),c.clearRect(-e,-e,n+2*e,o+2*e),c.drawImage(i,0,0,n,o),c.getImageData(-e,-e,n+2*e,o+2*e)},resolveURL:i=>(Nt||(Nt=G.document.createElement("a")),Nt.href=i,Nt.href),get devicePixelRatio(){return G.devicePixelRatio},get prefersReducedMotion(){return!!G.matchMedia&&(Fr==null&&(Fr=G.matchMedia("(prefers-reduced-motion: reduce)")),Fr.matches)}};let cs;const Ft={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(cs==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{cs={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{cs=i}}return cs},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},oo={supported:!1,testSupport:function(i){!Mo&&Nr&&(us?ca(i):Or=i)}};let Or,Nr,Mo=!1,us=!1;function ca(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Nr),i.isContextLost())return;oo.supported=!0}catch{}i.deleteTexture(e),Mo=!0}G.document&&(Nr=G.document.createElement("img"),Nr.onload=function(){Or&&ca(Or),Or=null,us=!0},Nr.onerror=function(){Mo=!0,Or=null},Nr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ua="01",Mn="NO_ACCESS_TOKEN";function wr(i){return i.indexOf("mapbox:")===0}function zo(i){return Ft.API_URL_REGEX.test(i)}const fl=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function zn(i){const e=i.match(fl);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ur(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function ml(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(G.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ha{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=ml(Ft.ACCESS_TOKEN);let o="";return o=n&&n.u?G.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,h)=>String.fromCharCode(Number("0x"+h)))):Ft.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${o}`:`mapbox.eventData:${o}`}fetchEventData(){const e=la("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const c=G.localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));const h=G.localStorage.getItem(o);h&&(this.anonId=h)}catch{Pt("Unable to read from LocalStorage")}}saveEventData(){const e=la("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{G.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&G.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Pt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,o,c){if(!Ft.EVENTS_URL)return;const h=zn(Ft.EVENTS_URL);h.params.push(`access_token=${c||Ft.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Io,skuId:ua,userId:this.anonId},_=n?vt(p,n):p,y={url:Ur(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=be(y,v=>{this.pendingRequest=null,o(v),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const da=new class extends ha{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Ft.EVENTS_URL&&Ft.ACCESS_TOKEN&&Array.isArray(i)&&i.some(n=>wr(n)||zo(n))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ml(Ft.ACCESS_TOKEN),n=e?e.u:Ft.ACCESS_TOKEN;let o=n!==this.eventData.tokenU;as(this.anonId)||(this.anonId=jn(),o=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),p=new Date(c),_=(c-this.eventData.lastSuccess)/864e5;o=o||_>=1||_<-1||h.getDate()!==p.getDate()}else o=!0;o?this.postEvent(c,{"enabled.telemetry":!1},h=>{h||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},i):this.processRequests()}},pa=da.postTurnstileEvent.bind(da),fa=new class extends ha{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,n,o){this.skuToken=e,this.errorCb=o,Ft.EVENTS_URL&&(n||Ft.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Mn)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),as(this.anonId)||(this.anonId=jn()),this.postEvent(n,{skuToken:this.skuToken},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i))}},_l=fa.postMapLoadEvent.bind(fa),gl=new class extends ha{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,n,o){if(!Ft.API_URL||!Ft.SESSION_PATH)return;const c=zn(Ft.API_URL+Ft.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${o||Ft.ACCESS_TOKEN||""}`);const h={url:Ur(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Le(h,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(o)})}getSessionAPI(i,e,n,o){this.skuToken=e,this.errorCb=o,Ft.SESSION_PATH&&Ft.API_URL&&(n||Ft.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Mn)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i)}},eu=gl.getSessionAPI.bind(gl),so=new Set;let jr,hs=500,yl=50,yn={};function ma(i){const e=D(i);let n,o;e&&e.forEach(h=>{const p=h.split("=");p[0]==="language"?n=p[1]:p[0]==="worldview"&&(o=p[1])});let c="mapbox-tiles";return n&&(c+=`-${n}`),o&&(c+=`-${o}`),c}function H(i){G.caches&&!yn[i]&&(yn[i]=G.caches.open(i))}function D(i){const e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function B(i){const e=i.indexOf("?");if(e<0)return i;const n=D(i).filter(o=>{const c=o.split("=");return c[0]==="language"||c[0]==="worldview"});return n.length?`${i.slice(0,e)}?${n.join("&")}`:i.slice(0,e)}let X=1/0;const Q={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Q);class re extends Error{constructor(e,n,o){n===401&&zo(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _e=Wi()?()=>self.worker&&self.worker.referrer:()=>(G.location.protocol==="blob:"?G.parent:G).location.href,pe=function(i,e){if(!(/^file:/.test(n=i.url)||/^file:/.test(_e())&&!/^\w+:/.test(n))){if(G.fetch&&G.Request&&G.AbortController&&G.Request.prototype.hasOwnProperty("signal"))return function(o,c){const h=new G.AbortController,p=new G.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:_e(),signal:h.signal});let _=!1,y=!1;const v=(T=p.url).indexOf("sku=")>0&&zo(T);var T;o.type==="json"&&p.headers.set("Accept","application/json");const C=(M,P,R)=>{if(y)return;if(M&&M.message!=="SecurityError"&&Pt(M),P&&R)return A(P);const V=Date.now();G.fetch(p).then(W=>{if(W.ok){const ie=v?W.clone():null;return A(W,ie,V)}return c(new re(W.statusText,W.status,o.url))}).catch(W=>{W.code!==20&&c(new Error(W.message))})},A=(M,P,R)=>{(o.type==="arrayBuffer"?M.arrayBuffer():o.type==="json"?M.json():M.text()).then(V=>{y||(P&&R&&function(W,ie,te){const ne=ma(W.url);if(H(ne),!yn[ne])return;const se={status:ie.status,statusText:ie.statusText,headers:new G.Headers};ie.headers.forEach((Ie,De)=>se.headers.set(De,Ie));const ce=Xi(ie.headers.get("Cache-Control")||"");if(ce["no-store"])return;ce["max-age"]&&se.headers.set("Expires",new Date(te+1e3*ce["max-age"]).toUTCString());const Ce=se.headers.get("Expires");Ce&&(new Date(Ce).getTime()-te<42e4||function(Ie,De){if(jr===void 0)try{new Response(new ReadableStream),jr=!0}catch{jr=!1}jr?De(Ie.body):Ie.blob().then(De)}(ie,Ie=>{const De=new G.Response(Ie,se);H(ne),yn[ne]&&yn[ne].then(Ne=>Ne.put(B(W.url),De)).catch(Ne=>Pt(Ne.message))}))}(p,P,R),_=!0,c(null,V,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(V=>{y||c(new Error(V.message))})};return v?function(M,P){const R=ma(M.url);if(H(R),!yn[R])return P(null);const V=B(M.url);yn[R].then(W=>{W.match(V).then(ie=>{const te=function(ne){if(!ne)return!1;const se=new Date(ne.headers.get("Expires")||0),ce=Xi(ne.headers.get("Cache-Control")||"");return se>Date.now()&&!ce["no-cache"]}(ie);W.delete(V),te&&W.put(V,ie.clone()),P(null,ie,te)}).catch(P)}).catch(P)}(p,C):C(null,null),{cancel:()=>{y=!0,_||h.abort()}}}(i,e);if(Wi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(o,c){const h=new G.XMLHttpRequest;h.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const p in o.headers)h.setRequestHeader(p,o.headers[p]);return o.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=o.credentials==="include",h.onerror=()=>{c(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(o.type==="json")try{p=JSON.parse(h.response)}catch(_){return c(_)}c(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else c(new re(h.statusText,h.status,o.url))},h.send(o.body),{cancel:()=>h.abort()}}(i,e)},le=function(i,e){return pe(vt(i,{type:"arrayBuffer"}),e)},be=function(i,e){return pe(vt(i,{method:"POST"}),e)},Le=function(i,e){return pe(vt(i,{method:"GET"}),e)};function et(i){const e=G.document.createElement("a");return e.href=i,e.protocol===G.document.location.protocol&&e.host===G.document.location.host}const Oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let pt,gt;pt=[],gt=0;const ft=function(i,e){if(oo.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),gt>=Ft.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return pt.push(h),h}gt++;let n=!1;const o=()=>{if(!n)for(n=!0,gt--;pt.length&&gt<Ft.MAX_PARALLEL_IMAGE_REQUESTS;){const h=pt.shift(),{requestParameters:p,callback:_,cancelled:y}=h;y||(h.cancel=ft(p,_).cancel)}},c=le(i,(h,p,_,y)=>{o(),h?e(h):p&&(G.createImageBitmap?function(v,T){const C=new G.Blob([new Uint8Array(v)],{type:"image/png"});G.createImageBitmap(C).then(A=>{T(null,A)}).catch(A=>{T(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(v,T)=>e(v,T,_,y)):function(v,T){const C=new G.Image,A=G.URL;C.onload=()=>{T(null,C),A.revokeObjectURL(C.src),C.onload=null,G.requestAnimationFrame(()=>{C.src=Oe})},C.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new G.Blob([new Uint8Array(v)],{type:"image/png"});C.src=v.byteLength?A.createObjectURL(M):Oe}(p,(v,T)=>e(v,T,_,y)))});return{cancel:()=>{c.cancel(),o()}}};function xt(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function It(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class Gt{constructor(e,n={}){vt(this,n),this.type=e}}class ni extends Gt{constructor(e,n={}){super("error",vt({error:e},n))}}class Xt{on(e,n){return this._listeners=this._listeners||{},xt(e,n,this._listeners),this}off(e,n){return It(e,n,this._listeners),It(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},xt(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new Gt(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of c)_.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of h)It(o,_,this._oneTimeListeners),_.call(this,e);const p=this._eventedParent;p&&(vt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof ni&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var fe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"transition":false,"requires":["line-gradient",{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Pn(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}function di(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function $n(i){if(Array.isArray(i))return i.map($n);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=$n(i[n]);return e}return di(i)}class lm extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Dn=lm;class xl{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(e){return new xl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var sd=xl;const _a={kind:"null"},Je={kind:"number"},Bt={kind:"string"},kt={kind:"boolean"},cr={kind:"color"},Po={kind:"object"},Ct={kind:"value"},Vr={kind:"collator"},ds={kind:"formatted"},ga={kind:"resolvedImage"};function Zn(i,e){return{kind:"array",itemType:i,N:e}}function pi(i){if(i.kind==="array"){const e=pi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ad=[_a,Je,Bt,kt,cr,ds,Po,Zn(Ct),ga];function ps(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ps(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of ad)if(!ps(n,e))return null}}return`Expected ${pi(i)} but found ${pi(e)} instead.`}function vl(i,e){return e.some(n=>n.kind===i.kind)}function fs(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function ms(i){var e={exports:{}};return i(e,e.exports),e.exports}var ld=ms(function(i,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(_){return(_=Math.round(_))<0?0:_>255?255:_}function c(_){return o(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function h(_){return(y=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:y>1?1:y;var y}function p(_,y,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?_+(y-_)*v*6:2*v<1?y:3*v<2?_+(y-_)*(2/3-v)*6:_}try{e.parseCSSColor=function(_){var y,v=_.replace(/ /g,"").toLowerCase();if(v in n)return n[v].slice();if(v[0]==="#")return v.length===4?(y=parseInt(v.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:v.length===7&&(y=parseInt(v.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var T=v.indexOf("("),C=v.indexOf(")");if(T!==-1&&C+1===v.length){var A=v.substr(0,T),M=v.substr(T+1,C-(T+1)).split(","),P=1;switch(A){case"rgba":if(M.length!==4)return null;P=h(M.pop());case"rgb":return M.length!==3?null:[c(M[0]),c(M[1]),c(M[2]),P];case"hsla":if(M.length!==4)return null;P=h(M.pop());case"hsl":if(M.length!==3)return null;var R=(parseFloat(M[0])%360+360)%360/360,V=h(M[1]),W=h(M[2]),ie=W<=.5?W*(V+1):W+V-W*V,te=2*W-ie;return[o(255*p(te,ie,R+1/3)),o(255*p(te,ie,R)),o(255*p(te,ie,R-1/3)),P];default:return null}}return null}}catch{}});class Oi{constructor(e,n,o,c=1){this.r=e,this.g=n,this.b=o,this.a=c}static parse(e){if(!e)return;if(e instanceof Oi)return e;if(typeof e!="string")return;const n=ld.parseCSSColor(e);return n?new Oi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,o,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(o)},${c})`}toArray(){const{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*o/c,c]}toArray01(){const{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[e/c,n/c,o/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:o,a:c}=this;return[e,n,o,c]}}Oi.black=new Oi(0,0,0,1),Oi.white=new Oi(1,1,1,1),Oi.transparent=new Oi(0,0,0,0),Oi.red=new Oi(1,0,0,1),Oi.blue=new Oi(0,0,1,1);var xi=Oi;class qn{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tu{constructor(e,n,o,c,h){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=h}}class hn{constructor(e){this.sections=e}static fromString(e){return new hn([new tu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof hn?e:hn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(o)}return e}}class rn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new rn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function wl(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bl(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof xi||i instanceof qn||i instanceof hn||i instanceof rn)return!0;if(Array.isArray(i)){for(const e of i)if(!bl(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!bl(i[e]))return!1;return!0}return!1}function Ni(i){if(i===null)return _a;if(typeof i=="string")return Bt;if(typeof i=="boolean")return kt;if(typeof i=="number")return Je;if(i instanceof xi)return cr;if(i instanceof qn)return Vr;if(i instanceof hn)return ds;if(i instanceof rn)return ga;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const c=Ni(o);if(n){if(n===c)continue;n=Ct;break}n=c}return Zn(n||Ct,e)}return Po}function ya(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof xi||i instanceof hn||i instanceof rn?i.toString():JSON.stringify(i)}class Tl{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!bl(e[1]))return n.error("invalid value");const o=e[1];let c=Ni(o);const h=n.expectedType;return c.kind!=="array"||c.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(c=h),new Tl(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof xi?["rgba"].concat(this.value.toArray()):this.value instanceof hn?this.value.serialize():this.value}}var Do=Tl,Hi=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const _s={string:Bt,number:Je,boolean:kt,object:Po};class iu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1;const h=e[0];if(h==="array"){let _,y;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in _s)||v==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=_s[v],c++}else _=Ct;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],c++}o=Zn(_,y)}else o=_s[h];const p=[];for(;c<e.length;c++){const _=n.parse(e[c],c,Ct);if(!_)return null;p.push(_)}return new iu(o,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!ps(this.type,Ni(o)))return o;if(n===this.args.length-1)throw new Hi(`Expected value to be of type ${pi(this.type)}, but found ${pi(Ni(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(o=>o.serialize()))}}var Gr=iu;class xa{constructor(e){this.type=ds,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let h=!1;for(let p=1;p<=e.length-1;++p){const _=e[p];if(h&&typeof _=="object"&&!Array.isArray(_)){h=!1;let y=null;if(_["font-scale"]&&(y=n.parse(_["font-scale"],1,Je),!y))return null;let v=null;if(_["text-font"]&&(v=n.parse(_["text-font"],1,Zn(Bt)),!v))return null;let T=null;if(_["text-color"]&&(T=n.parse(_["text-color"],1,cr),!T))return null;const C=c[c.length-1];C.scale=y,C.font=v,C.textColor=T}else{const y=n.parse(e[p],1,Ct);if(!y)return null;const v=y.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,c.push({content:y,scale:null,font:null,textColor:null})}}return new xa(c)}evaluate(e){return new hn(this.sections.map(n=>{const o=n.content.evaluate(e);return Ni(o)===ga?new tu("",o,null,null,null):new tu(ya(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class El{constructor(e){this.type=ga,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Bt);return o?new El(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=rn.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const cm={"to-boolean":kt,"to-color":cr,"to-number":Je,"to-string":Bt};class nu{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=cm[o],h=[];for(let p=1;p<e.length;p++){const _=n.parse(e[p],p,Ct);if(!_)return null;h.push(_)}return new nu(c,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let n,o;for(const c of this.args){if(n=c.evaluate(e),o=null,n instanceof xi)return n;if(typeof n=="string"){const h=e.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:wl(n[0],n[1],n[2],n[3]),!o))return new xi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Hi(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new Hi(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?hn.fromString(ya(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?rn.fromString(ya(this.args[0].evaluate(e))):ya(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new xa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new El(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var gs=nu;const cd=["Unknown","Point","LineString","Polygon"];var va=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-i[0])+this.featureDistanceData.bearing[1]*(o*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=xi.parse(i)),e}};class ys{constructor(e,n,o,c){this.name=e,this.type=n,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const o=e[0],c=ys.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=p.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let y=null;for(const[v,T]of _){y=new du(n.registry,n.path,null,n.scope);const C=[];let A=!1;for(let M=1;M<e.length;M++){const P=e[M],R=Array.isArray(v)?v[M-1]:v.type,V=y.parse(P,1+C.length,R);if(!V){A=!0;break}C.push(V)}if(!A)if(Array.isArray(v)&&v.length!==C.length)y.error(`Expected ${v.length} arguments, but found ${C.length} instead.`);else{for(let M=0;M<C.length;M++){const P=Array.isArray(v)?v[M]:v.type,R=C[M];y.concat(M+1).checkSubtype(P,R.type)}if(y.errors.length===0)return new ys(o,h,T,C)}}if(_.length===1)n.errors.push(...y.errors);else{const v=(_.length?_:p).map(([C])=>{return A=C,Array.isArray(A)?`(${A.map(pi).join(", ")})`:`(${pi(A.type)}...)`;var A}).join(" | "),T=[];for(let C=1;C<e.length;C++){const A=n.parse(e[C],1+T.length);if(!A)return null;T.push(pi(A.type))}n.error(`Expected arguments of type ${v}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){ys.definitions=n;for(const o in n)e[o]=ys}}var ao=ys;class Sl{constructor(e,n,o){this.type=Vr,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,kt);if(!c)return null;const h=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,kt);if(!h)return null;let p=null;return o.locale&&(p=n.parse(o.locale,1,Bt),!p)?null:new Sl(c,h,p)}evaluate(e){return new qn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const lo=8192;function ru(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Cl(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function ud(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*lo),Math.round(o*c*lo)]}function Al(i,e,n){const o=i[0]-e[0],c=i[1]-e[1],h=i[0]-n[0],p=i[1]-n[1];return o*p-h*c==0&&o*h<=0&&c*p<=0}function ou(i,e){let n=!1;for(let p=0,_=e.length;p<_;p++){const y=e[p];for(let v=0,T=y.length;v<T-1;v++){if(Al(i,y[v],y[v+1]))return!1;(c=y[v])[1]>(o=i)[1]!=(h=y[v+1])[1]>o[1]&&o[0]<(h[0]-c[0])*(o[1]-c[1])/(h[1]-c[1])+c[0]&&(n=!n)}}var o,c,h;return n}function um(i,e){for(let n=0;n<e.length;n++)if(ou(i,e[n]))return!0;return!1}function hd(i,e,n,o){const c=o[0]-n[0],h=o[1]-n[1],p=(i[0]-n[0])*h-c*(i[1]-n[1]),_=(e[0]-n[0])*h-c*(e[1]-n[1]);return p>0&&_<0||p<0&&_>0}function hm(i,e,n){for(const v of n)for(let T=0;T<v.length-1;++T)if((_=[(p=v[T+1])[0]-(h=v[T])[0],p[1]-h[1]])[0]*(y=[(c=e)[0]-(o=i)[0],c[1]-o[1]])[1]-_[1]*y[0]!=0&&hd(o,c,h,p)&&hd(h,p,o,c))return!0;var o,c,h,p,_,y;return!1}function ur(i,e){for(let n=0;n<i.length;++n)if(!ou(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(hm(i[n],i[n+1],e))return!1;return!0}function dd(i,e){for(let n=0;n<e.length;n++)if(ur(i,e[n]))return!0;return!1}function Il(i,e,n){const o=[];for(let c=0;c<i.length;c++){const h=[];for(let p=0;p<i[c].length;p++){const _=ud(i[c][p],n);ru(e,_),h.push(_)}o.push(h)}return o}function wa(i,e,n){const o=[];for(let c=0;c<i.length;c++){const h=Il(i[c],e,n);o.push(h)}return o}function xs(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const c=.5*o;let h=i[0]-n[0]>c?-o:n[0]-i[0]>c?o:0;h===0&&(h=i[0]-n[2]>c?-o:n[2]-i[0]>c?o:0),i[0]+=h}ru(e,i)}function su(i,e,n,o){const c=Math.pow(2,o.z)*lo,h=[o.x*lo,o.y*lo],p=[];if(!i)return p;for(const _ of i)for(const y of _){const v=[y.x+h[0],y.y+h[1]];xs(v,e,n,c),p.push(v)}return p}function au(i,e,n,o){const c=Math.pow(2,o.z)*lo,h=[o.x*lo,o.y*lo],p=[];if(!i)return p;for(const y of i){const v=[];for(const T of y){const C=[T.x+h[0],T.y+h[1]];ru(e,C),v.push(C)}p.push(v)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const y of p)for(const v of y)xs(v,e,n,c)}var _;return p}class Lo{constructor(e,n){this.type=kt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(bl(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const h=o.features[c].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Lo(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Lo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Lo(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(o.type==="Polygon"){const _=Il(o.coordinates,h,p),y=su(n.geometry(),c,h,p);if(!Cl(c,h))return!1;for(const v of y)if(!ou(v,_))return!1}if(o.type==="MultiPolygon"){const _=wa(o.coordinates,h,p),y=su(n.geometry(),c,h,p);if(!Cl(c,h))return!1;for(const v of y)if(!um(v,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(o.type==="Polygon"){const _=Il(o.coordinates,h,p),y=au(n.geometry(),c,h,p);if(!Cl(c,h))return!1;for(const v of y)if(!ur(v,_))return!1}if(o.type==="MultiPolygon"){const _=wa(o.coordinates,h,p),y=au(n.geometry(),c,h,p);if(!Cl(c,h))return!1;for(const v of y)if(!dd(v,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var lu=Lo;function Ut(i){if(i instanceof ao&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof lu)return!1;let e=!0;return i.eachChild(n=>{e&&!Ut(n)&&(e=!1)}),e}function kl(i){if(i instanceof ao&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!kl(n)&&(e=!1)}),e}function Ml(i,e){if(i instanceof ao&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!Ml(o,e)&&(n=!1)}),n}class cu{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new cu(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var uu=cu;class hu{constructor(e,n=[],o,c=new sd,h=[]){this.registry=e,this.path=n,this.key=n.map(p=>`[${p}]`).join(""),this.scope=c,this.errors=h,this.expectedType=o}parse(e,n,o,c,h={}){return n?this.concat(n,o,c)._parse(e,h):this._parse(e,h)}_parse(e,n){function o(c,h,p){return p==="assert"?new Gr(h,[c]):p==="coerce"?new gs(h,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[c];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const _=this.expectedType,y=p.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||y.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(_,y))return null}else p=o(p,_,n.typeAnnotation||"coerce");else p=o(p,_,n.typeAnnotation||"assert")}if(!(p instanceof Do)&&p.type.kind!=="resolvedImage"&&zl(p)){const _=new va;try{p=new Do(p.type,p.evaluate(_))}catch(y){return this.error(y.message),null}}return p}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const c=typeof e=="number"?this.path.concat(e):this.path,h=o?this.scope.concat(o):this.scope;return new hu(this.registry,c,n||null,h,this.errors)}error(e,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Dn(o,e))}checkSubtype(e,n){const o=ps(e,n);return o&&this.error(o),o}}var du=hu;function zl(i){if(i instanceof uu)return zl(i.boundExpression);if(i instanceof ao&&i.name==="error"||i instanceof Sl||i instanceof lu)return!1;const e=i instanceof gs||i instanceof Gr;let n=!0;return i.eachChild(o=>{n=e?n&&zl(o):n&&o instanceof Do}),!!n&&Ut(i)&&Ml(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ba(i,e){const n=i.length-1;let o,c,h=0,p=n,_=0;for(;h<=p;)if(_=Math.floor((h+p)/2),o=i[_],c=i[_+1],o<=e){if(_===n||e<c)return _;h=_+1}else{if(!(o>e))throw new Hi("Input is not a number.");p=_-1}return 0}class Pl{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,h]of o)this.labels.push(c),this.outputs.push(h)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,Je);if(!o)return null;const c=[];let h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let p=1;p<e.length;p+=2){const _=p===1?-1/0:e[p],y=e[p+1],v=p,T=p+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const C=n.parse(y,T,h);if(!C)return null;h=h||C.type,c.push([_,C])}return new Pl(h,o,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const h=n.length;return c>=n[h-1]?o[h-1].evaluate(e):o[ba(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var co=Pl;function Ot(i,e,n){return i*(1-n)+e*n}var Dl=Object.freeze({__proto__:null,number:Ot,color:function(i,e,n){return new xi(Ot(i.r,e.r,n),Ot(i.g,e.g,n),Ot(i.b,e.b,n),Ot(i.a,e.a,n))},array:function(i,e,n){return i.map((o,c)=>Ot(o,e[c],n))}});const Ll=.95047,pu=1.08883,pd=4/29,fu=6/29,mu=3*fu*fu,dm=Math.PI/180,fd=180/Math.PI;function Bl(i){return i>.008856451679035631?Math.pow(i,1/3):i/mu+pd}function Rl(i){return i>fu?i*i*i:mu*(i-pd)}function _u(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Fl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function md(i){const e=Fl(i.r),n=Fl(i.g),o=Fl(i.b),c=Bl((.4124564*e+.3575761*n+.1804375*o)/Ll),h=Bl((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*h-16,a:500*(c-h),b:200*(h-Bl((.0193339*e+.119192*n+.9503041*o)/pu)),alpha:i.a}}function gu(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*Rl(e),n=Ll*Rl(n),o=pu*Rl(o),new xi(_u(3.2404542*n-1.5371385*e-.4985314*o),_u(-.969266*n+1.8760108*e+.041556*o),_u(.0556434*n-.2040259*e+1.0572252*o),i.alpha)}function _d(i,e,n){const o=e-i;return i+n*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ta={forward:md,reverse:gu,interpolate:function(i,e,n){return{l:Ot(i.l,e.l,n),a:Ot(i.a,e.a,n),b:Ot(i.b,e.b,n),alpha:Ot(i.alpha,e.alpha,n)}}},Ea={forward:function(i){const{l:e,a:n,b:o}=md(i),c=Math.atan2(o,n)*fd;return{h:c<0?c+360:c,c:Math.sqrt(n*n+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*dm,n=i.c;return gu({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:_d(i.h,e.h,n),c:Ot(i.c,e.c,n),l:Ot(i.l,e.l,n),alpha:Ot(i.alpha,e.alpha,n)}}};var gd=Object.freeze({__proto__:null,lab:Ta,hcl:Ea});class Ol{constructor(e,n,o,c,h){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[p,_]of h)this.labels.push(p),this.outputs.push(_)}static interpolationFactor(e,n,o,c){let h=0;if(e.name==="exponential")h=yu(n,e.base,o,c);else if(e.name==="linear")h=yu(n,1,o,c);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new ue(p[0],p[1],p[2],p[3]).solve(yu(n,1,o,c))}return h}static parse(e,n){let[o,c,h,...p]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const v=c[1];if(typeof v!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:v}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const v=c.slice(1);if(v.length!==4||v.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,Je),!h)return null;const _=[];let y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=cr:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let v=0;v<p.length;v+=2){const T=p[v],C=p[v+1],A=v+3,M=v+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(_.length&&_[_.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const P=n.parse(C,M,y);if(!P)return null;y=y||P.type,_.push([T,P])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Ol(y,o,c,h,_):n.error(`Type ${pi(y)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const h=n.length;if(c>=n[h-1])return o[h-1].evaluate(e);const p=ba(n,c),_=Ol.interpolationFactor(this.interpolation,c,n[p],n[p+1]),y=o[p].evaluate(e),v=o[p+1].evaluate(e);return this.operator==="interpolate"?Dl[this.type.kind.toLowerCase()](y,v,_):this.operator==="interpolate-hcl"?Ea.reverse(Ea.interpolate(Ea.forward(y),Ea.forward(v),_)):Ta.reverse(Ta.interpolate(Ta.forward(y),Ta.forward(v),_))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function yu(i,e,n,o){const c=o-n,h=i-n;return c===0?0:e===1?h/c:(Math.pow(e,h)-1)/(Math.pow(e,c)-1)}var br=Ol;class Nl{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const h=[];for(const _ of e.slice(1)){const y=n.parse(_,1+h.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,h.push(y)}const p=c&&h.some(_=>ps(c,_.type));return new Nl(p?Ct:o,h)}evaluate(e){let n,o=null,c=0;for(const h of this.args){if(c++,o=h.evaluate(e),o&&o instanceof rn&&!o.available&&(n||(n=o),o=null,c===this.args.length))return n;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var yd=Nl;class xu{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);const _=n.parse(e[h+1],h+1);if(!_)return null;o.push([p,_])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new xu(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}var xd=xu;class vu{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Je),c=n.parse(e[2],2,Zn(n.expectedType||Ct));return o&&c?new vu(c.type.itemType,o,c):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new Hi(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Hi(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Hi(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var vd=vu;class Ul{constructor(e,n){this.type=kt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Ct),c=n.parse(e[2],2,Ct);return o&&c?vl(o.type,[kt,Bt,Je,_a,Ct])?new Ul(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!fs(n,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${pi(Ni(n))} instead.`);if(!fs(o,["string","array"]))throw new Hi(`Expected second argument to be of type array or string, but found ${pi(Ni(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var wd=Ul;class jl{constructor(e,n,o){this.type=Je,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Ct),c=n.parse(e[2],2,Ct);if(!o||!c)return null;if(!vl(o.type,[kt,Bt,Je,_a,Ct]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(o.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,Je);return h?new jl(o,c,h):null}return new jl(o,c)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!fs(n,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${pi(Ni(n))} instead.`);if(!fs(o,["string","array"]))throw new Hi(`Expected second argument to be of type array or string, but found ${pi(Ni(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var pm=jl;class Vl{constructor(e,n,o,c,h,p){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=h,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const h={},p=[];for(let v=2;v<e.length-1;v+=2){let T=e[v];const C=e[v+1];Array.isArray(T)||(T=[T]);const A=n.concat(v);if(T.length===0)return A.error("Expected at least one branch label.");for(const P of T){if(typeof P!="number"&&typeof P!="string")return A.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return A.error("Numeric branch labels must be integer values.");if(o){if(A.checkSubtype(o,Ni(P)))return null}else o=Ni(P);if(h[String(P)]!==void 0)return A.error("Branch labels must be unique.");h[String(P)]=p.length}const M=n.parse(C,v,c);if(!M)return null;c=c||M.type,p.push(M)}const _=n.parse(e[1],1,Ct);if(!_)return null;const y=n.parse(e[e.length-1],e.length-1,c);return y?_.type.kind!=="value"&&n.concat(1).checkSubtype(o,_.type)?null:new Vl(o,c,_,h,p,y):null}evaluate(e){const n=this.input.evaluate(e);return(Ni(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],c={};for(const p of n){const _=c[this.cases[p]];_===void 0?(c[this.cases[p]]=o.length,o.push([this.cases[p],[p]])):o[_][1].push(p)}const h=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,_]of o)e.push(_.length===1?h(_[0]):_.map(h)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var bd=Vl;class Gl{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const _=n.parse(e[p],p,kt);if(!_)return null;const y=n.parse(e[p+1],p+1,o);if(!y)return null;c.push([_,y]),o=o||y.type}const h=n.parse(e[e.length-1],e.length-1,o);return h?new Gl(o,c,h):null}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var fm=Gl;class $l{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Ct),c=n.parse(e[2],2,Je);if(!o||!c)return null;if(!vl(o.type,[Zn(Ct),Bt,Ct]))return n.error(`Expected first argument to be of type array or string, but found ${pi(o.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,Je);return h?new $l(o.type,o,c,h):null}return new $l(o.type,o,c)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!fs(n,["string","array"]))throw new Hi(`Expected first argument to be of type array or string, but found ${pi(Ni(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var mm=$l;function Td(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Sa(i,e,n,o){return o.compare(e,n)===0}function Bo(i,e,n){const o=i!=="=="&&i!=="!=";return class zb{constructor(h,p,_){this.type=kt,this.lhs=h,this.rhs=p,this.collator=_,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const _=h[0];let y=p.parse(h[1],1,Ct);if(!y)return null;if(!Td(_,y.type))return p.concat(1).error(`"${_}" comparisons are not supported for type '${pi(y.type)}'.`);let v=p.parse(h[2],2,Ct);if(!v)return null;if(!Td(_,v.type))return p.concat(2).error(`"${_}" comparisons are not supported for type '${pi(v.type)}'.`);if(y.type.kind!==v.type.kind&&y.type.kind!=="value"&&v.type.kind!=="value")return p.error(`Cannot compare types '${pi(y.type)}' and '${pi(v.type)}'.`);o&&(y.type.kind==="value"&&v.type.kind!=="value"?y=new Gr(v.type,[y]):y.type.kind!=="value"&&v.type.kind==="value"&&(v=new Gr(y.type,[v])));let T=null;if(h.length===4){if(y.type.kind!=="string"&&v.type.kind!=="string"&&y.type.kind!=="value"&&v.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(h[3],3,Vr),!T)return null}return new zb(y,v,T)}evaluate(h){const p=this.lhs.evaluate(h),_=this.rhs.evaluate(h);if(o&&this.hasUntypedArgument){const y=Ni(p),v=Ni(_);if(y.kind!==v.kind||y.kind!=="string"&&y.kind!=="number")throw new Hi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${v.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const y=Ni(p),v=Ni(_);if(y.kind!=="string"||v.kind!=="string")return e(h,p,_)}return this.collator?n(h,p,_,this.collator.evaluate(h)):e(h,p,_)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[i];return this.eachChild(p=>{h.push(p.serialize())}),h}}}const Ed=Bo("==",function(i,e,n){return e===n},Sa),_m=Bo("!=",function(i,e,n){return e!==n},function(i,e,n,o){return!Sa(0,e,n,o)}),gm=Bo("<",function(i,e,n){return e<n},function(i,e,n,o){return o.compare(e,n)<0}),ym=Bo(">",function(i,e,n){return e>n},function(i,e,n,o){return o.compare(e,n)>0}),Sd=Bo("<=",function(i,e,n){return e<=n},function(i,e,n,o){return o.compare(e,n)<=0}),Cd=Bo(">=",function(i,e,n){return e>=n},function(i,e,n,o){return o.compare(e,n)>=0});class Zl{constructor(e,n,o,c,h){this.type=Bt,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Je);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let h=null;if(c.locale&&(h=n.parse(c.locale,1,Bt),!h))return null;let p=null;if(c.currency&&(p=n.parse(c.currency,1,Bt),!p))return null;let _=null;if(c["min-fraction-digits"]&&(_=n.parse(c["min-fraction-digits"],1,Je),!_))return null;let y=null;return c["max-fraction-digits"]&&(y=n.parse(c["max-fraction-digits"],1,Je),!y)?null:new Zl(o,h,p,_,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ca{constructor(e){this.type=Je,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${pi(o.type)} instead.`):new Ca(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Hi(`Expected value to be of type string or array, but found ${pi(Ni(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Ad={"==":Ed,"!=":_m,">":ym,"<":gm,">=":Cd,"<=":Sd,array:Gr,at:vd,boolean:Gr,case:fm,coalesce:yd,collator:Sl,format:xa,image:El,in:wd,"index-of":pm,interpolate:br,"interpolate-hcl":br,"interpolate-lab":br,length:Ca,let:xd,literal:Do,match:bd,number:Gr,"number-format":Zl,object:Gr,slice:mm,step:co,string:Gr,"to-boolean":gs,"to-color":gs,"to-number":gs,"to-string":gs,var:uu,within:lu};function Id(i,[e,n,o,c]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const h=c?c.evaluate(i):1,p=wl(e,n,o,h);if(p)throw new Hi(p);return new xi(e/255*h,n/255*h,o/255*h,h)}function kd(i,e){return i in e}function wu(i,e){const n=e[i];return n===void 0?null:n}function Ro(i){return{type:i}}ao.register(Ad,{error:[{kind:"error"},[Bt],(i,[e])=>{throw new Hi(e.evaluate(i))}],typeof:[Bt,[Ct],(i,[e])=>pi(Ni(e.evaluate(i)))],"to-rgba":[Zn(Je,4),[cr],(i,[e])=>e.evaluate(i).toArray()],rgb:[cr,[Je,Je,Je],Id],rgba:[cr,[Je,Je,Je,Je],Id],has:{type:kt,overloads:[[[Bt],(i,[e])=>kd(e.evaluate(i),i.properties())],[[Bt,Po],(i,[e,n])=>kd(e.evaluate(i),n.evaluate(i))]]},get:{type:Ct,overloads:[[[Bt],(i,[e])=>wu(e.evaluate(i),i.properties())],[[Bt,Po],(i,[e,n])=>wu(e.evaluate(i),n.evaluate(i))]]},"feature-state":[Ct,[Bt],(i,[e])=>wu(e.evaluate(i),i.featureState||{})],properties:[Po,[],i=>i.properties()],"geometry-type":[Bt,[],i=>i.geometryType()],id:[Ct,[],i=>i.id()],zoom:[Je,[],i=>i.globals.zoom],pitch:[Je,[],i=>i.globals.pitch||0],"distance-from-center":[Je,[],i=>i.distanceFromCenter()],"heatmap-density":[Je,[],i=>i.globals.heatmapDensity||0],"line-progress":[Je,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Je,[],i=>i.globals.skyRadialProgress||0],accumulated:[Ct,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Je,Ro(Je),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[Je,Ro(Je),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:Je,overloads:[[[Je,Je],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Je],(i,[e])=>-e.evaluate(i)]]},"/":[Je,[Je,Je],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Je,[Je,Je],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Je,[],()=>Math.LN2],pi:[Je,[],()=>Math.PI],e:[Je,[],()=>Math.E],"^":[Je,[Je,Je],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Je,[Je],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Je,[Je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Je,[Je],(i,[e])=>Math.log(e.evaluate(i))],log2:[Je,[Je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Je,[Je],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Je,[Je],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Je,[Je],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Je,[Je],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Je,[Je],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Je,[Je],(i,[e])=>Math.atan(e.evaluate(i))],min:[Je,Ro(Je),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[Je,Ro(Je),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[Je,[Je],(i,[e])=>Math.abs(e.evaluate(i))],round:[Je,[Je],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Je,[Je],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Je,[Je],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[kt,[Bt,Ct],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[kt,[Ct],(i,[e])=>i.id()===e.value],"filter-type-==":[kt,[Bt],(i,[e])=>i.geometryType()===e.value],"filter-<":[kt,[Bt,Ct],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[kt,[Ct],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[kt,[Bt,Ct],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[kt,[Ct],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[kt,[Bt,Ct],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[kt,[Ct],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[kt,[Bt,Ct],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[kt,[Ct],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[kt,[Ct],(i,[e])=>e.value in i.properties()],"filter-has-id":[kt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[kt,[Zn(Bt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[kt,[Zn(Ct)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[kt,[Bt,Zn(Ct)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[kt,[Bt,Zn(Ct)],(i,[e,n])=>function(o,c,h,p){for(;h<=p;){const _=h+p>>1;if(c[_]===o)return!0;c[_]>o?p=_-1:h=_+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:kt,overloads:[[[kt,kt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[Ro(kt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:kt,overloads:[[[kt,kt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[Ro(kt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[kt,[kt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[kt,[Bt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Bt,[Bt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Bt,[Bt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Bt,Ro(Ct),(i,e)=>e.map(n=>ya(n.evaluate(i))).join("")],"resolved-locale":[Bt,[Vr],(i,[e])=>e.evaluate(i).resolvedLocale()]});var Aa=Ad;function bu(i){return{result:"success",value:i}}function Fo(i){return{result:"error",value:i}}function $r(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Md(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Tu(i){return!!i.expression&&i.expression.interpolated}function $t(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function hr(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function zd(i){return i}function Oo(i,e){const n=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",c=o||!(o||i.property!==void 0),h=i.type||(Tu(e)?"exponential":"interval");if(n&&((i=Pn({},i)).stops&&(i.stops=i.stops.map(v=>[v[0],xi.parse(v[1])])),i.default=xi.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!gd[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,_,y;if(h==="exponential")p=Dd;else if(h==="interval")p=Pd;else if(h==="categorical"){p=xm,_=Object.create(null);for(const v of i.stops)_[v[0]]=v[1];y=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);p=Eu}if(o){const v={},T=[];for(let M=0;M<i.stops.length;M++){const P=i.stops[M],R=P[0].zoom;v[R]===void 0&&(v[R]={zoom:R,type:i.type,property:i.property,default:i.default,stops:[]},T.push(R)),v[R].stops.push([P[0].value,P[1]])}const C=[];for(const M of T)C.push([v[M].zoom,Oo(v[M],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:br.interpolationFactor.bind(void 0,A),zoomStops:C.map(M=>M[0]),evaluate:({zoom:M},P)=>Dd({stops:C,base:i.base},e,M).evaluate(M,P)}}if(c){const v=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:br.interpolationFactor.bind(void 0,v),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(i,e,T,_,y)}}return{kind:"source",evaluate(v,T){const C=T&&T.properties?T.properties[i.property]:void 0;return C===void 0?Ia(i.default,e.default):p(i,e,C,_,y)}}}function Ia(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function xm(i,e,n,o,c){return Ia(typeof n===c?o[n]:void 0,i.default,e.default)}function Pd(i,e,n){if($t(n)!=="number")return Ia(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const c=ba(i.stops.map(h=>h[0]),n);return i.stops[c][1]}function Dd(i,e,n){const o=i.base!==void 0?i.base:1;if($t(n)!=="number")return Ia(i.default,e.default);const c=i.stops.length;if(c===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[c-1][0])return i.stops[c-1][1];const h=ba(i.stops.map(T=>T[0]),n),p=function(T,C,A,M){const P=M-A,R=T-A;return P===0?0:C===1?R/P:(Math.pow(C,R)-1)/(Math.pow(C,P)-1)}(n,o,i.stops[h][0],i.stops[h+1][0]),_=i.stops[h][1],y=i.stops[h+1][1];let v=Dl[e.type]||zd;if(i.colorSpace&&i.colorSpace!=="rgb"){const T=gd[i.colorSpace];v=(C,A)=>T.reverse(T.interpolate(T.forward(C),T.forward(A),p))}return typeof _.evaluate=="function"?{evaluate(...T){const C=_.evaluate.apply(void 0,T),A=y.evaluate.apply(void 0,T);if(C!==void 0&&A!==void 0)return v(C,A,p)}}:v(_,y,p)}function Eu(i,e,n){return e.type==="color"?n=xi.parse(n):e.type==="formatted"?n=hn.fromString(n.toString()):e.type==="resolvedImage"?n=rn.fromString(n.toString()):$t(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Ia(n,i.default,e.default)}class ql{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new va,this._defaultValue=n?function(o){return o.type==="color"&&(hr(o.default)||Array.isArray(o.default))?new xi(0,0,0,0):o.type==="color"?xi.parse(o.default)||null:o.default===void 0?null:o.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,h,p,_,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,h,p,_,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Hi(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console!="undefined"&&console.warn(v.message)),this._defaultValue}}}function vs(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Aa}function No(i,e){const n=new du(Aa,[],e?function(c){const h={color:cr,string:Bt,number:Je,enum:Bt,boolean:kt,formatted:ds,resolvedImage:ga};return c.type==="array"?Zn(h[c.value]||Ct,c.length):h[c.type]}(e):void 0),o=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?bu(new ql(o,e)):Fo(n.errors)}class Wl{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!kl(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,h,p)}evaluate(e,n,o,c,h,p){return this._styleExpression.evaluate(e,n,o,c,h,p)}}class ka{constructor(e,n,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!kl(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,h,p)}evaluate(e,n,o,c,h,p){return this._styleExpression.evaluate(e,n,o,c,h,p)}interpolationFactor(e,n,o){return this.interpolationType?br.interpolationFactor(this.interpolationType,e,n,o):0}}function Su(i,e){if((i=No(i,e)).result==="error")return i;const n=i.value.expression,o=Ut(n);if(!o&&!$r(e))return Fo([new Dn("","data expressions not supported")]);const c=Ml(n,["zoom","pitch","distance-from-center"]);if(!c&&!Md(e))return Fo([new Dn("","zoom expressions not supported")]);const h=ws(n);return h||c?h instanceof Dn?Fo([h]):h instanceof br&&!Tu(e)?Fo([new Dn("",'"interpolate" expressions cannot be used with this property')]):bu(h?new ka(o?"camera":"composite",i.value,h.labels,h instanceof br?h.interpolation:void 0):new Wl(o?"constant":"source",i.value)):Fo([new Dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ma{constructor(e,n){this._parameters=e,this._specification=n,Pn(this,Oo(this._parameters,this._specification))}static deserialize(e){return new Ma(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ws(i){let e=null;if(i instanceof xd)e=ws(i.result);else if(i instanceof yd){for(const n of i.args)if(e=ws(n),e)break}else(i instanceof co||i instanceof br)&&i.input instanceof ao&&i.input.name==="zoom"&&(e=i);return e instanceof Dn||i.eachChild(n=>{const o=ws(n);o instanceof Dn?e=o:!e&&o?e=new Dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Dn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Xe{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Wn(i){const e=i.key,n=i.value,o=i.valueSpec||{},c=i.objectElementValidators||{},h=i.style,p=i.styleSpec;let _=[];const y=$t(n);if(y!=="object")return[new Xe(e,n,`object expected, ${y} found`)];for(const v in n){const T=v.split(".")[0],C=o[T]||o["*"];let A;c[T]?A=c[T]:o[T]?A=Yi:c["*"]?A=c["*"]:o["*"]&&(A=Yi),A?_=_.concat(A({key:(e&&`${e}.`)+v,value:n[v],valueSpec:C,style:h,styleSpec:p,object:n,objectKey:v},n)):_.push(new Xe(e,n[v],`unknown property "${v}"`))}for(const v in o)c[v]||o[v].required&&o[v].default===void 0&&n[v]===void 0&&_.push(new Xe(e,n,`missing required property "${v}"`));return _}function Cu(i){const e=i.value,n=i.valueSpec,o=i.style,c=i.styleSpec,h=i.key,p=i.arrayElementValidator||Yi;if($t(e)!=="array")return[new Xe(h,e,`array expected, ${$t(e)} found`)];if(n.length&&e.length!==n.length)return[new Xe(h,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Xe(h,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let _={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};c.$version<7&&(_.function=n.function),$t(n.value)==="object"&&(_=n.value);let y=[];for(let v=0;v<e.length;v++)y=y.concat(p({array:e,arrayIndex:v,value:e[v],valueSpec:_,style:o,styleSpec:c,key:`${h}[${v}]`}));return y}function Xl(i){const e=i.key,n=i.value,o=i.valueSpec;let c=$t(n);if(c==="number"&&n!=n&&(c="NaN"),c!=="number")return[new Xe(e,n,`number expected, ${c} found`)];if("minimum"in o){let h=o.minimum;if($t(o.minimum)==="array"&&(h=o.minimum[i.arrayIndex]),n<h)return[new Xe(e,n,`${n} is less than the minimum value ${h}`)]}if("maximum"in o){let h=o.maximum;if($t(o.maximum)==="array"&&(h=o.maximum[i.arrayIndex]),n>h)return[new Xe(e,n,`${n} is greater than the maximum value ${h}`)]}return[]}function Au(i){const e=i.valueSpec,n=di(i.value.type);let o,c,h,p={};const _=n!=="categorical"&&i.value.property===void 0,y=!_,v=$t(i.value.stops)==="array"&&$t(i.value.stops[0])==="array"&&$t(i.value.stops[0][0])==="object",T=Wn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(M){if(n==="identity")return[new Xe(M.key,M.value,'identity function may not have a "stops" property')];let P=[];const R=M.value;return P=P.concat(Cu({key:M.key,value:R,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:C})),$t(R)==="array"&&R.length===0&&P.push(new Xe(M.key,R,"array must have at least one stop")),P},default:function(M){return Yi({key:M.key,value:M.value,valueSpec:e,style:M.style,styleSpec:M.styleSpec})}}});return n==="identity"&&_&&T.push(new Xe(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||T.push(new Xe(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!Tu(i.valueSpec)&&T.push(new Xe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(y&&!$r(i.valueSpec)?T.push(new Xe(i.key,i.value,"property functions not supported")):_&&!Md(i.valueSpec)&&T.push(new Xe(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!v||i.value.property!==void 0||T.push(new Xe(i.key,i.value,'"property" property is required')),T;function C(M){let P=[];const R=M.value,V=M.key;if($t(R)!=="array")return[new Xe(V,R,`array expected, ${$t(R)} found`)];if(R.length!==2)return[new Xe(V,R,`array length 2 expected, length ${R.length} found`)];if(v){if($t(R[0])!=="object")return[new Xe(V,R,`object expected, ${$t(R[0])} found`)];if(R[0].zoom===void 0)return[new Xe(V,R,"object stop key must have zoom")];if(R[0].value===void 0)return[new Xe(V,R,"object stop key must have value")];const W=di(R[0].zoom);if(typeof W!="number")return[new Xe(V,R[0].zoom,"stop zoom values must be numbers")];if(h&&h>W)return[new Xe(V,R[0].zoom,"stop zoom values must appear in ascending order")];W!==h&&(h=W,c=void 0,p={}),P=P.concat(Wn({key:`${V}[0]`,value:R[0],valueSpec:{zoom:{}},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{zoom:Xl,value:A}}))}else P=P.concat(A({key:`${V}[0]`,value:R[0],valueSpec:{},style:M.style,styleSpec:M.styleSpec},R));return vs($n(R[1]))?P.concat([new Xe(`${V}[1]`,R[1],"expressions are not allowed in function stops.")]):P.concat(Yi({key:`${V}[1]`,value:R[1],valueSpec:e,style:M.style,styleSpec:M.styleSpec}))}function A(M,P){const R=$t(M.value),V=di(M.value),W=M.value!==null?M.value:P;if(o){if(R!==o)return[new Xe(M.key,W,`${R} stop domain type must match previous stop domain type ${o}`)]}else o=R;if(R!=="number"&&R!=="string"&&R!=="boolean"&&typeof V!="number"&&typeof V!="string"&&typeof V!="boolean")return[new Xe(M.key,W,"stop domain value must be a number, string, or boolean")];if(R!=="number"&&n!=="categorical"){let ie=`number expected, ${R} found`;return $r(e)&&n===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Xe(M.key,W,ie)]}return n!=="categorical"||R!=="number"||typeof V=="number"&&isFinite(V)&&Math.floor(V)===V?n!=="categorical"&&R==="number"&&typeof V=="number"&&typeof c=="number"&&c!==void 0&&V<c?[new Xe(M.key,W,"stop domain values must appear in ascending order")]:(c=V,n==="categorical"&&V in p?[new Xe(M.key,W,"stop domain values must be unique")]:(p[V]=!0,[])):[new Xe(M.key,W,`integer expected, found ${String(V)}`)]}}function bs(i){const e=(i.expressionContext==="property"?Su:No)($n(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Xe(`${i.key}${o.key}`,i.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Xe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!kl(n))return[new Xe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return za(n,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ml(n,["zoom","feature-state"]))return[new Xe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ut(n))return[new Xe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function za(i,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)n.delete(c);if(n.size===0)return[];const o=[];return i instanceof ao&&n.has(i.name)?[new Xe(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(c=>{o.push(...za(c,e))}),o)}function Hl(i){const e=i.key,n=i.value,o=i.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(di(n))===-1&&c.push(new Xe(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(di(n))===-1&&c.push(new Xe(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Iu(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Iu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Yl(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Iu(i)||(i=Jl(i));const n=i;let o=!0;try{o=function(v){if(!Zr(v))return v;let T=$n(v);return Bd(T),T=Ld(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const c=fe[`filter_${e}`],h=No(o,c);let p=null;if(h.result==="error")throw new Error(h.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,T,C)=>h.value.evaluate(v,T,{},C);let _=null,y=null;if(o!==n){const v=No(n,c);if(v.result==="error")throw new Error(v.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,C,A,M,P)=>v.value.evaluate(T,C,{},A,void 0,void 0,M,P),y=!Ut(v.value.expression)}return p=p,{filter:p,dynamicFilter:_||void 0,needGeometry:Pa(o),needFeature:!!y}}function Ld(i){if(!Array.isArray(i))return i;const e=function(n){if(Kl.has(n[0])){for(let o=1;o<n.length;o++)if(Zr(n[o]))return!0}return n}(i);return e===!0?e:e.map(n=>Ld(n))}function Bd(i){let e=!1;const n=[];if(i[0]==="case"){for(let o=1;o<i.length-1;o+=2)e=e||Zr(i[o]),n.push(i[o+1]);n.push(i[i.length-1])}else if(i[0]==="match"){e=e||Zr(i[1]);for(let o=2;o<i.length-1;o+=2)n.push(i[o+1]);n.push(i[i.length-1])}else if(i[0]==="step"){e=e||Zr(i[1]);for(let o=1;o<i.length-1;o+=2)n.push(i[o+1])}e&&(i.length=0,i.push("any",...n));for(let o=1;o<i.length;o++)Bd(i[o])}function Zr(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<i.length;n++)if(Zr(i[n]))return!0;return!1}const Kl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ln(i,e){return i<e?-1:i>e?1:0}function Pa(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Pa(i[e]))return!0;return!1}function Jl(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ku(i[1],i[2],"=="):e==="!="?Ts(ku(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ku(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Jl))):e==="all"?["all"].concat(i.slice(1).map(Jl)):e==="none"?["all"].concat(i.slice(1).map(Jl).map(Ts)):e==="in"?Rd(i[1],i.slice(2)):e==="!in"?Ts(Rd(i[1],i.slice(2))):e==="has"?Fd(i[1]):e==="!has"?Ts(Fd(i[1])):e!=="within"||i;var n}function ku(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Rd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Ln)]]:["filter-in-small",i,["literal",e]]}}function Fd(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ts(i){return["!",i]}function Mu(i){return Iu($n(i.value))?bs(Pn({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Ql(i)}function Ql(i){const e=i.value,n=i.key;if($t(e)!=="array")return[new Xe(n,e,`array expected, ${$t(e)} found`)];const o=i.styleSpec;let c,h=[];if(e.length<1)return[new Xe(n,e,"filter array must have at least 1 element")];switch(h=h.concat(Hl({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),di(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&di(e[1])==="$type"&&h.push(new Xe(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Xe(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=$t(e[1]),c!=="string"&&h.push(new Xe(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let p=2;p<e.length;p++)c=$t(e[p]),di(e[1])==="$type"?h=h.concat(Hl({key:`${n}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&h.push(new Xe(`${n}[${p}]`,e[p],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(Ql({key:`${n}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=$t(e[1]),e.length!==2?h.push(new Xe(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&h.push(new Xe(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=$t(e[1]),e.length!==2?h.push(new Xe(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&h.push(new Xe(`${n}[1]`,e[1],`object expected, ${c} found`))}return h}function Od(i,e){const n=i.key,o=i.style,c=i.styleSpec,h=i.value,p=i.objectKey,_=c[`${e}_${i.layerType}`];if(!_)return[];const y=p.match(/^(.*)-transition$/);if(e==="paint"&&y&&_[y[1]]&&_[y[1]].transition)return Yi({key:n,value:h,valueSpec:c.transition,style:o,styleSpec:c});const v=i.valueSpec||_[p];if(!v)return[new Xe(n,h,`unknown property "${p}"`)];let T;if($t(h)==="string"&&$r(v)&&!v.tokens&&(T=/^{([^}]+)}$/.exec(h)))return[new Xe(n,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const C=[];return i.layerType==="symbol"&&(p==="text-field"&&o&&!o.glyphs&&C.push(new Xe(n,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&hr($n(h))&&di(h.type)==="identity"&&C.push(new Xe(n,h,'"text-font" does not support identity functions'))),C.concat(Yi({key:i.key,value:h,valueSpec:v,style:o,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:p}))}function Nd(i){return Od(i,"paint")}function ec(i){return Od(i,"layout")}function Ud(i){let e=[];const n=i.value,o=i.key,c=i.style,h=i.styleSpec;n.type||n.ref||e.push(new Xe(o,n,'either "type" or "ref" is required'));let p=di(n.type);const _=di(n.ref);if(n.id){const y=di(n.id);for(let v=0;v<i.arrayIndex;v++){const T=c.layers[v];di(T.id)===y&&e.push(new Xe(o,n.id,`duplicate layer id "${n.id}", previously used at line ${T.id.__line__}`))}}if("ref"in n){let y;["type","source","source-layer","filter","layout"].forEach(v=>{v in n&&e.push(new Xe(o,n[v],`"${v}" is prohibited for ref layers`))}),c.layers.forEach(v=>{di(v.id)===_&&(y=v)}),y?y.ref?e.push(new Xe(o,n.ref,"ref cannot reference another ref layer")):p=di(y.type):typeof _=="string"&&e.push(new Xe(o,n.ref,`ref layer "${_}" not found`))}else if(p!=="background"&&p!=="sky")if(n.source){const y=c.sources&&c.sources[n.source],v=y&&di(y.type);y?v==="vector"&&p==="raster"?e.push(new Xe(o,n.source,`layer "${n.id}" requires a raster source`)):v==="raster"&&p!=="raster"?e.push(new Xe(o,n.source,`layer "${n.id}" requires a vector source`)):v!=="vector"||n["source-layer"]?v==="raster-dem"&&p!=="hillshade"?e.push(new Xe(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!n.paint||!n.paint["line-gradient"]||v==="geojson"&&y.lineMetrics?p==="line"&&n.paint&&n.paint["line-trim-offset"]&&!n.paint["line-gradient"]&&e.push(new Xe(o,n,`layer "${n.id}" specifies a line-trim-offset, which requires line-gradient enabled.`)):e.push(new Xe(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Xe(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Xe(o,n.source,`source "${n.source}" not found`))}else e.push(new Xe(o,n,'missing required property "source"'));return e=e.concat(Wn({key:o,value:n,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Yi({key:`${o}.type`,value:n.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:y=>Mu(Pn({layerType:p},y)),layout:y=>Wn({layer:n,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":v=>ec(Pn({layerType:p},v))}}),paint:y=>Wn({layer:n,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":v=>Nd(Pn({layerType:p},v))}})}})),e}function Uo(i){const e=i.value,n=i.key,o=$t(e);return o!=="string"?[new Xe(n,e,`string expected, ${o} found`)]:[]}const zu={promoteId:function({key:i,value:e}){if($t(e)==="string")return Uo({key:i,value:e});{const n=[];for(const o in e)n.push(...Uo({key:`${i}.${o}`,value:e[o]}));return n}}};function jd(i){const e=i.value,n=i.key,o=i.styleSpec,c=i.style;if(!e.type)return[new Xe(n,e,'"type" is required')];const h=di(e.type);let p;switch(h){case"vector":case"raster":case"raster-dem":return p=Wn({key:n,value:e,valueSpec:o[`source_${h.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:zu}),p;case"geojson":if(p=Wn({key:n,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,objectElementValidators:zu}),e.cluster)for(const _ in e.clusterProperties){const[y,v]=e.clusterProperties[_],T=typeof y=="string"?[y,["accumulated"],["get",_]]:y;p.push(...bs({key:`${n}.${_}.map`,value:v,expressionContext:"cluster-map"})),p.push(...bs({key:`${n}.${_}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return p;case"video":return Wn({key:n,value:e,valueSpec:o.source_video,style:c,styleSpec:o});case"image":return Wn({key:n,value:e,valueSpec:o.source_image,style:c,styleSpec:o});case"canvas":return[new Xe(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hl({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:o})}}function tc(i){const e=i.value,n=i.styleSpec,o=n.light,c=i.style;let h=[];const p=$t(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Xe("light",e,`object expected, ${p} found`)]),h;for(const _ in e){const y=_.match(/^(.*)-transition$/);h=h.concat(y&&o[y[1]]&&o[y[1]].transition?Yi({key:_,value:e[_],valueSpec:n.transition,style:c,styleSpec:n}):o[_]?Yi({key:_,value:e[_],valueSpec:o[_],style:c,styleSpec:n}):[new Xe(_,e[_],`unknown property "${_}"`)])}return h}function Da(i){const e=i.value,n=i.key,o=i.style,c=i.styleSpec,h=c.terrain;let p=[];const _=$t(e);if(e===void 0)return p;if(_!=="object")return p=p.concat([new Xe("terrain",e,`object expected, ${_} found`)]),p;for(const y in e){const v=y.match(/^(.*)-transition$/);p=p.concat(v&&h[v[1]]&&h[v[1]].transition?Yi({key:y,value:e[y],valueSpec:c.transition,style:o,styleSpec:c}):h[y]?Yi({key:y,value:e[y],valueSpec:h[y],style:o,styleSpec:c}):[new Xe(y,e[y],`unknown property "${y}"`)])}if(e.source){const y=o.sources&&o.sources[e.source],v=y&&di(y.type);y?v!=="raster-dem"&&p.push(new Xe(n,e.source,`terrain cannot be used with a source of type ${String(v)}, it only be used with a "raster-dem" source type`)):p.push(new Xe(n,e.source,`source "${e.source}" not found`))}else p.push(new Xe(n,e,'terrain is missing required property "source"'));return p}function Pu(i){const e=i.value,n=i.style,o=i.styleSpec,c=o.fog;let h=[];const p=$t(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new Xe("fog",e,`object expected, ${p} found`)]),h;for(const _ in e){const y=_.match(/^(.*)-transition$/);h=h.concat(y&&c[y[1]]&&c[y[1]].transition?Yi({key:_,value:e[_],valueSpec:o.transition,style:n,styleSpec:o}):c[_]?Yi({key:_,value:e[_],valueSpec:c[_],style:n,styleSpec:o}):[new Xe(_,e[_],`unknown property "${_}"`)])}return h}const Vd={"*":()=>[],array:Cu,boolean:function(i){const e=i.value,n=i.key,o=$t(e);return o!=="boolean"?[new Xe(n,e,`boolean expected, ${o} found`)]:[]},number:Xl,color:function(i){const e=i.key,n=i.value,o=$t(n);return o!=="string"?[new Xe(e,n,`color expected, ${o} found`)]:ld.parseCSSColor(n)===null?[new Xe(e,n,`color expected, "${n}" found`)]:[]},enum:Hl,filter:Mu,function:Au,layer:Ud,object:Wn,source:jd,light:tc,terrain:Da,fog:Pu,string:Uo,formatted:function(i){return Uo(i).length===0?[]:bs(i)},resolvedImage:function(i){return Uo(i).length===0?[]:bs(i)},projection:function(i){const e=i.value,n=i.styleSpec,o=n.projection,c=i.style;let h=[];const p=$t(e);if(p==="object")for(const _ in e)h=h.concat(Yi({key:_,value:e[_],valueSpec:o[_],style:c,styleSpec:n}));else p!=="string"&&(h=h.concat([new Xe("projection",e,`object or string expected, ${p} found`)]));return h}};function Yi(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return n.expression&&hr(di(e))?Au(i):n.expression&&vs($n(e))?bs(i):n.type&&Vd[n.type]?Vd[n.type](i):Wn(Pn({},i,{valueSpec:n.type?o[n.type]:n}))}function vm(i){const e=i.value,n=i.key,o=Uo(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Xe(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Xe(n,e,'"glyphs" url must include a "{range}" token'))),o}function ic(i,e=fe){return qr(Yi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:vm,"*":()=>[]}}))}const wm=i=>qr(Nd(i)),bm=i=>qr(ec(i));function qr(i){return i.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Gd(i,e){let n=!1;if(e&&e.length)for(const o of e)i.fire(new ni(new Error(o.message))),n=!0;return n}var jo=Tr;function Tr(i,e,n){var o=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var c=new Int32Array(this.arrayBuffer);i=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var h=0;h<this.d*this.d;h++){var p=c[3+h],_=c[3+h+1];o.push(p===_?null:c.subarray(p,_))}var y=c[3+o.length+1];this.keys=c.subarray(c[3+o.length],y),this.bboxes=c.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var v=0;v<this.d*this.d;v++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=n,this.scale=e/i,this.uid=0;var T=n/e*i;this.min=-T,this.max=i+T}Tr.prototype.insert=function(i,e,n,o,c){this._forEachCell(e,n,o,c,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c)},Tr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Tr.prototype._insertCell=function(i,e,n,o,c,h){this.cells[c].push(h)},Tr.prototype.query=function(i,e,n,o,c){var h=this.min,p=this.max;if(i<=h&&e<=h&&p<=n&&p<=o&&!c)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(i,e,n,o,this._queryCell,_,{},c),_},Tr.prototype._queryCell=function(i,e,n,o,c,h,p,_){var y=this.cells[c];if(y!==null)for(var v=this.keys,T=this.bboxes,C=0;C<y.length;C++){var A=y[C];if(p[A]===void 0){var M=4*A;(_?_(T[M+0],T[M+1],T[M+2],T[M+3]):i<=T[M+2]&&e<=T[M+3]&&n>=T[M+0]&&o>=T[M+1])?(p[A]=!0,h.push(v[A])):p[A]=!1}}},Tr.prototype._forEachCell=function(i,e,n,o,c,h,p,_){for(var y=this._convertToCellCoord(i),v=this._convertToCellCoord(e),T=this._convertToCellCoord(n),C=this._convertToCellCoord(o),A=y;A<=T;A++)for(var M=v;M<=C;M++){var P=this.d*M+A;if((!_||_(this._convertFromCellCoord(A),this._convertFromCellCoord(M),this._convertFromCellCoord(A+1),this._convertFromCellCoord(M+1)))&&c.call(this,i,e,n,o,P,h,p,_))return}},Tr.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Tr.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Tr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var h=e,p=0;p<i.length;p++){var _=i[p];c[3+p]=h,c.set(_,h),h+=_.length}return c[3+i.length]=h,c.set(this.keys,h),c[3+i.length+1]=h+=this.keys.length,c.set(this.bboxes,h),h+=this.bboxes.length,c.buffer};const nc={};function it(i,e,n={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),nc[e]={klass:i,omit:n.omit||[]}}it(Object,"Object"),jo.serialize=function(i,e){const n=i.toArrayBuffer();return e&&e.push(n),{buffer:n}},jo.deserialize=function(i){return new jo(i.buffer)},Object.defineProperty(jo,"name",{value:"Grid"}),it(jo,"Grid"),it(xi,"Color"),it(Error,"Error"),it(re,"AJAXError"),it(rn,"ResolvedImage"),it(Ma,"StylePropertyFunction"),it(ql,"StyleExpression",{omit:["_evaluator"]}),it(ka,"ZoomDependentExpression"),it(Wl,"ZoomConstantExpression"),it(ao,"CompoundExpression",{omit:["_evaluate"]});for(const i in Aa)nc[Aa[i]._classRegistryKey]||it(Aa[i],`Expression${i}`);function $d(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Zd(i){return G.ImageBitmap&&i instanceof G.ImageBitmap}function La(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if($d(i)||Zd(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof G.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const o of i)n.push(La(o,e));return n}if(typeof i=="object"){const n=i.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const c=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(const h in i)i.hasOwnProperty(h)&&(nc[o].omit.indexOf(h)>=0||(c[h]=La(i[h],e)));i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof i)}function Ba(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||$d(i)||Zd(i)||ArrayBuffer.isView(i)||i instanceof G.ImageData)return i;if(Array.isArray(i))return i.map(Ba);if(typeof i=="object"){const e=i.$name||"Object",{klass:n}=nc[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const c of Object.keys(i))c!=="$name"&&(o[c]=Ba(i[c]));return o}throw new Error("can't deserialize object of type "+typeof i)}class Ra{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const qd=i=>i>=1536&&i<=1791,Wd=i=>i>=1872&&i<=1919,Fa=i=>i>=2208&&i<=2303,Xd=i=>i>=11904&&i<=12031,Du=i=>i>=12032&&i<=12255,Hd=i=>i>=12272&&i<=12287,Oa=i=>i>=12288&&i<=12351,rc=i=>i>=12352&&i<=12447,Na=i=>i>=12448&&i<=12543,Lu=i=>i>=12544&&i<=12591,oc=i=>i>=12704&&i<=12735,sc=i=>i>=12736&&i<=12783,Yd=i=>i>=12784&&i<=12799,Kd=i=>i>=12800&&i<=13055,Jd=i=>i>=13056&&i<=13311,ac=i=>i>=13312&&i<=19903,Bu=i=>i>=19968&&i<=40959,Qd=i=>i>=40960&&i<=42127,ep=i=>i>=42128&&i<=42191,tp=i=>i>=44032&&i<=55215,Es=i=>i>=63744&&i<=64255,Ru=i=>i>=64336&&i<=65023,ip=i=>i>=65040&&i<=65055,lc=i=>i>=65072&&i<=65103,Ua=i=>i>=65104&&i<=65135,u=i=>i>=65136&&i<=65279,t=i=>i>=65280&&i<=65519;function a(i){for(const e of i)if(g(e.charCodeAt(0)))return!0;return!1}function d(i){for(const e of i)if(!m(e.charCodeAt(0)))return!1;return!0}function m(i){return!(qd(i)||Wd(i)||Fa(i)||Ru(i)||u(i))}function g(i){return!(i!==746&&i!==747&&(i<4352||!(oc(i)||Lu(i)||lc(i)&&!(i>=65097&&i<=65103)||Es(i)||Jd(i)||Xd(i)||sc(i)||!(!Oa(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ac(i)||Bu(i)||Kd(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||tp(i)||rc(i)||Hd(i)||(e=>e>=12688&&e<=12703)(i)||Du(i)||Yd(i)||Na(i)&&i!==12540||!(!t(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ua(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||ip(i)||(e=>e>=19904&&e<=19967)(i)||Qd(i)||ep(i))))}function w(i){return!(g(i)||function(e){return!!((n=>n>=128&&n<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(n=>n>=8192&&n<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&e!==9251||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Oa(e)||Na(e)||(n=>n>=57344&&n<=63743)(e)||lc(e)||Ua(e)||t(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function b(i){return i>=1424&&i<=2303||Ru(i)||u(i)}function S(i,e){return!(!e&&b(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(n=>n>=6016&&n<=6143)(i))}function k(i){for(const e of i)if(b(e.charCodeAt(0)))return!0;return!1}const z="deferred",L="loading",O="loaded";let j=null,U="unavailable",N=null;const J=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(U="error"),j&&j(i)};function $(){K.fire(new Gt("pluginStateChange",{pluginStatus:U,pluginURL:N}))}const K=new Xt,q=function(){return U},ee=function(){if(U!==z||!N)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");U=L,$(),N&&le({url:N},i=>{i?J(i):(U=O,$())})},Z={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>U===O||Z.applyArabicShaping!=null,isLoading:()=>U===L,setState(i){U=i.pluginStatus,N=i.pluginURL},isParsed:()=>Z.applyArabicShaping!=null&&Z.processBidirectionalText!=null&&Z.processStyledBidirectionalText!=null,getPluginURL:()=>N};class Y{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ra,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,o){for(const c of n)if(!S(c.charCodeAt(0),o))return!1;return!0}(e,Z.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class oe{constructor(e,n){this.property=e,this.value=n,this.expression=function(o,c){if(hr(o))return new Ma(o,c);if(vs(o)){const h=Su(o,c);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=o;return typeof o=="string"&&c.type==="color"&&(h=xi.parse(o)),{kind:"constant",evaluate:()=>h}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class Ee{constructor(e){this.property=e,this.value=new oe(e,void 0)}transitioned(e,n){return new ke(this.property,this.value,n,vt({},e.transition,this.transition),e.now)}untransitioned(){return new ke(this.property,this.value,null,{},0)}}class Me{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return wt(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ee(this._values[e].property)),this._values[e].value=new oe(this._values[e].property,n===null?void 0:wt(n))}getTransition(e){return wt(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ee(this._values[e].property)),this._values[e].transition=wt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const o=new $e(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){const e=new $e(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class ke{constructor(e,n,o,c,h){const p=c.delay||0,_=c.duration||0;h=h||0,this.property=e,this.value=n,this.begin=h+p,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const c=e.now||0,h=this.value.possiblyEvaluate(e,n,o),p=this.prior;if(p){if(c>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(c<this.begin)return p.possiblyEvaluate(e,n,o);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,o),h,he(_))}}return h}}class $e{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const c=new Pe(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ye{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return wt(this._values[e].value)}setValue(e,n){this._values[e]=new oe(this._values[e].property,n===null?void 0:wt(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const c=new Pe(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,o);return c}}class Be{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class Pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class xe{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){const c=Dl[this.specification.type];return c?c(e,n,o):e}}class ge{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new Be(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Be(this,{kind:"constant",value:void 0},e.parameters);const c=Dl[this.specification.type];return c?new Be(this,{kind:"constant",value:c(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,c,h,p){return e.kind==="constant"?e.value:e.evaluate(n,o,c,h,p)}}class tt extends ge{possiblyEvaluate(e,n,o,c){if(e.value===void 0)return new Be(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},o,c),p=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,_=this._calculate(p,p,p,n);return new Be(this,{kind:"constant",value:_},n)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Be(this,{kind:"constant",value:h},n)}return new Be(this,e.expression,n)}evaluate(e,n,o,c,h,p){if(e.kind==="source"){const _=e.evaluate(n,o,c,h,p);return this._calculate(_,_,_,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,c),e.evaluate({zoom:Math.floor(n.zoom)},o,c),e.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):e.value}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n,other:o}:{from:o,to:n,other:e}}interpolate(e){return e}}class st{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},o,c);return this._calculate(h,h,h,n)}return this._calculate(e.expression.evaluate(new Y(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Y(Math.floor(n.zoom),n)),e.expression.evaluate(new Y(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class qe{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class rt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Y(0,{});for(const o in e){const c=e[o];c.specification.overridable&&this.overridableProperties.push(o);const h=this.defaultPropertyValues[o]=new oe(c,void 0),p=this.defaultTransitionablePropertyValues[o]=new Ee(c);this.defaultTransitioningPropertyValues[o]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate(n)}}}function ot(i,e){return 256*(i=Fe(Math.floor(i),0,255))+Fe(Math.floor(e),0,255)}it(ge,"DataDrivenProperty"),it(xe,"DataConstantProperty"),it(tt,"CrossFadedDataDrivenProperty"),it(st,"CrossFadedProperty"),it(qe,"ColorRampProperty");const bt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class mt{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ye{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ke(i,e=1){let n=0,o=0;return{members:i.map(c=>{const h=bt[c.type].BYTES_PER_ELEMENT,p=n=zt(n,Math.max(e,h)),_=c.components||1;return o=Math.max(o,h),n+=h*_,{name:c.name,type:c.type,components:_,offset:p}}),size:zt(n,Math.max(o,e)),alignment:e}}function zt(i,e){return Math.ceil(i/e)*e}class Zt extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}Zt.prototype.bytesPerElement=4,it(Zt,"StructArrayLayout2i4");class ri extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const h=3*e;return this.int16[h+0]=n,this.int16[h+1]=o,this.int16[h+2]=c,e}}ri.prototype.bytesPerElement=6,it(ri,"StructArrayLayout3i6");class Jt extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,c)}emplace(e,n,o,c,h){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=c,this.int16[p+3]=h,e}}Jt.prototype.bytesPerElement=8,it(Jt,"StructArrayLayout4i8");class dn extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,h,p,_)}emplace(e,n,o,c,h,p,_,y){const v=6*e,T=12*e,C=3*e;return this.int16[v+0]=n,this.int16[v+1]=o,this.uint8[T+4]=c,this.uint8[T+5]=h,this.uint8[T+6]=p,this.uint8[T+7]=_,this.float32[C+2]=y,e}}dn.prototype.bytesPerElement=12,it(dn,"StructArrayLayout2i4ub1f12");class Xn extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,c)}emplace(e,n,o,c,h){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=c,this.float32[p+3]=h,e}}Xn.prototype.bytesPerElement=16,it(Xn,"StructArrayLayout4f16");class xn extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_,y,v,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,o,c,h,p,_,y,v,T)}emplace(e,n,o,c,h,p,_,y,v,T,C){const A=10*e;return this.uint16[A+0]=n,this.uint16[A+1]=o,this.uint16[A+2]=c,this.uint16[A+3]=h,this.uint16[A+4]=p,this.uint16[A+5]=_,this.uint16[A+6]=y,this.uint16[A+7]=v,this.uint16[A+8]=T,this.uint16[A+9]=C,e}}xn.prototype.bytesPerElement=20,it(xn,"StructArrayLayout10ui20");class Er extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,n,o,c,h,p,_,y)}emplace(e,n,o,c,h,p,_,y,v){const T=8*e;return this.uint16[T+0]=n,this.uint16[T+1]=o,this.uint16[T+2]=c,this.uint16[T+3]=h,this.uint16[T+4]=p,this.uint16[T+5]=_,this.uint16[T+6]=y,this.uint16[T+7]=v,e}}Er.prototype.bytesPerElement=16,it(Er,"StructArrayLayout8ui16");class si extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,h,p)}emplace(e,n,o,c,h,p,_){const y=6*e;return this.int16[y+0]=n,this.int16[y+1]=o,this.int16[y+2]=c,this.int16[y+3]=h,this.int16[y+4]=p,this.int16[y+5]=_,e}}si.prototype.bytesPerElement=12,it(si,"StructArrayLayout6i12");class gi extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_,y,v,T,C,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,o,c,h,p,_,y,v,T,C,A)}emplace(e,n,o,c,h,p,_,y,v,T,C,A,M){const P=12*e;return this.int16[P+0]=n,this.int16[P+1]=o,this.int16[P+2]=c,this.int16[P+3]=h,this.uint16[P+4]=p,this.uint16[P+5]=_,this.uint16[P+6]=y,this.uint16[P+7]=v,this.int16[P+8]=T,this.int16[P+9]=C,this.int16[P+10]=A,this.int16[P+11]=M,e}}gi.prototype.bytesPerElement=24,it(gi,"StructArrayLayout4i4ui4i24");class Vt extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,h,p)}emplace(e,n,o,c,h,p,_){const y=10*e,v=5*e;return this.int16[y+0]=n,this.int16[y+1]=o,this.int16[y+2]=c,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=_,e}}Vt.prototype.bytesPerElement=20,it(Vt,"StructArrayLayout3i3f20");class Si extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Si.prototype.bytesPerElement=4,it(Si,"StructArrayLayout1ul4");class on extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_,y,v,T,C,A,M){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,c,h,p,_,y,v,T,C,A,M)}emplace(e,n,o,c,h,p,_,y,v,T,C,A,M,P){const R=20*e,V=10*e;return this.int16[R+0]=n,this.int16[R+1]=o,this.int16[R+2]=c,this.int16[R+3]=h,this.int16[R+4]=p,this.float32[V+3]=_,this.float32[V+4]=y,this.float32[V+5]=v,this.float32[V+6]=T,this.int16[R+14]=C,this.uint32[V+8]=A,this.uint16[R+18]=M,this.uint16[R+19]=P,e}}on.prototype.bytesPerElement=40,it(on,"StructArrayLayout5i4f1i1ul2ui40");class ai extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,h,p,_)}emplace(e,n,o,c,h,p,_,y){const v=8*e;return this.int16[v+0]=n,this.int16[v+1]=o,this.int16[v+2]=c,this.int16[v+4]=h,this.int16[v+5]=p,this.int16[v+6]=_,this.int16[v+7]=y,e}}ai.prototype.bytesPerElement=16,it(ai,"StructArrayLayout3i2i2i16");class Hn extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,c,h)}emplace(e,n,o,c,h,p){const _=4*e,y=8*e;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.int16[y+6]=h,this.int16[y+7]=p,e}}Hn.prototype.bytesPerElement=16,it(Hn,"StructArrayLayout2f1f2i16");class Ss extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,c)}emplace(e,n,o,c,h){const p=12*e,_=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=o,this.float32[_+1]=c,this.float32[_+2]=h,e}}Ss.prototype.bytesPerElement=12,it(Ss,"StructArrayLayout2ub2f12");class Wr extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const h=3*e;return this.float32[h+0]=n,this.float32[h+1]=o,this.float32[h+2]=c,e}}Wr.prototype.bytesPerElement=12,it(Wr,"StructArrayLayout3f12");class Ci extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const h=3*e;return this.uint16[h+0]=n,this.uint16[h+1]=o,this.uint16[h+2]=c,e}}Ci.prototype.bytesPerElement=6,it(Ci,"StructArrayLayout3ui6");class uo extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_,y,v,T,C,A,M,P,R,V,W,ie,te,ne,se){const ce=this.length;return this.resize(ce+1),this.emplace(ce,e,n,o,c,h,p,_,y,v,T,C,A,M,P,R,V,W,ie,te,ne,se)}emplace(e,n,o,c,h,p,_,y,v,T,C,A,M,P,R,V,W,ie,te,ne,se,ce){const Ce=30*e,Ie=15*e,De=60*e;return this.int16[Ce+0]=n,this.int16[Ce+1]=o,this.int16[Ce+2]=c,this.float32[Ie+2]=h,this.float32[Ie+3]=p,this.uint16[Ce+8]=_,this.uint16[Ce+9]=y,this.uint32[Ie+5]=v,this.uint32[Ie+6]=T,this.uint32[Ie+7]=C,this.uint16[Ce+16]=A,this.uint16[Ce+17]=M,this.uint16[Ce+18]=P,this.float32[Ie+10]=R,this.float32[Ie+11]=V,this.uint8[De+48]=W,this.uint8[De+49]=ie,this.uint8[De+50]=te,this.uint32[Ie+13]=ne,this.int16[Ce+28]=se,this.uint8[De+58]=ce,e}}uo.prototype.bytesPerElement=60,it(uo,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Vo extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_,y,v,T,C,A,M,P,R,V,W,ie,te,ne,se,ce,Ce,Ie,De,Ne,Te,ze,Ue,Ve){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,e,n,o,c,h,p,_,y,v,T,C,A,M,P,R,V,W,ie,te,ne,se,ce,Ce,Ie,De,Ne,Te,ze,Ue,Ve)}emplace(e,n,o,c,h,p,_,y,v,T,C,A,M,P,R,V,W,ie,te,ne,se,ce,Ce,Ie,De,Ne,Te,ze,Ue,Ve,Qe){const Re=38*e,He=19*e;return this.int16[Re+0]=n,this.int16[Re+1]=o,this.int16[Re+2]=c,this.float32[He+2]=h,this.float32[He+3]=p,this.int16[Re+8]=_,this.int16[Re+9]=y,this.int16[Re+10]=v,this.int16[Re+11]=T,this.int16[Re+12]=C,this.int16[Re+13]=A,this.uint16[Re+14]=M,this.uint16[Re+15]=P,this.uint16[Re+16]=R,this.uint16[Re+17]=V,this.uint16[Re+18]=W,this.uint16[Re+19]=ie,this.uint16[Re+20]=te,this.uint16[Re+21]=ne,this.uint16[Re+22]=se,this.uint16[Re+23]=ce,this.uint16[Re+24]=Ce,this.uint16[Re+25]=Ie,this.uint16[Re+26]=De,this.uint16[Re+27]=Ne,this.uint16[Re+28]=Te,this.uint32[He+15]=ze,this.float32[He+16]=Ue,this.float32[He+17]=Ve,this.float32[He+18]=Qe,e}}Vo.prototype.bytesPerElement=76,it(Vo,"StructArrayLayout3i2f6i15ui1ul3f76");class Xr extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Xr.prototype.bytesPerElement=4,it(Xr,"StructArrayLayout1f4");class cc extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,h,p,_)}emplace(e,n,o,c,h,p,_,y){const v=7*e;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=c,this.float32[v+3]=h,this.float32[v+4]=p,this.float32[v+5]=_,this.float32[v+6]=y,e}}cc.prototype.bytesPerElement=28,it(cc,"StructArrayLayout7f28");class Cs extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,c,h)}emplace(e,n,o,c,h,p){const _=5*e;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.float32[_+3]=h,this.float32[_+4]=p,e}}Cs.prototype.bytesPerElement=20,it(Cs,"StructArrayLayout5f20");class ja extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,o,c)}emplace(e,n,o,c,h){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=c,this.uint16[p+4]=h,e}}ja.prototype.bytesPerElement=12,it(ja,"StructArrayLayout1ul3ui12");class As extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}As.prototype.bytesPerElement=4,it(As,"StructArrayLayout2ui4");class Fu extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Fu.prototype.bytesPerElement=2,it(Fu,"StructArrayLayout1ui2");class np extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}np.prototype.bytesPerElement=8,it(np,"StructArrayLayout2f8");class Tm extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,h,p,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,h,p,_)}emplace(e,n,o,c,h,p,_,y){const v=8*e,T=4*e;return this.int16[v+0]=n,this.int16[v+1]=o,this.int16[v+2]=c,this.int16[v+3]=h,this.int16[v+4]=p,this.int16[v+5]=_,this.float32[T+3]=y,e}}Tm.prototype.bytesPerElement=16,it(Tm,"StructArrayLayout6i1f16");class Ny extends mt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Ny.prototype.size=12;class Uy extends si{get(e){return new Ny(this,e)}}it(Uy,"FillExtrusionExtArray");class jy extends mt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}jy.prototype.size=40;class Em extends on{get(e){return new jy(this,e)}}it(Em,"CollisionBoxArray");class Vy extends mt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Vy.prototype.size=60;class Gy extends uo{get(e){return new Vy(this,e)}}it(Gy,"PlacedSymbolArray");class $y extends mt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}$y.prototype.size=76;class Zy extends Vo{get(e){return new $y(this,e)}}it(Zy,"SymbolInstanceArray");class qy extends Xr{getoffsetX(e){return this.float32[1*e+0]}}it(qy,"GlyphOffsetArray");class Wy extends ri{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}it(Wy,"SymbolLineVertexArray");class Xy extends mt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Xy.prototype.size=12;class Hy extends ja{get(e){return new Xy(this,e)}}it(Hy,"FeatureIndexArray");class Yy extends mt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Yy.prototype.size=4;class Ky extends As{get(e){return new Yy(this,e)}}it(Ky,"FillExtrusionCentroidArray");class Jy extends mt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}Jy.prototype.size=16;class Qy extends Tm{get(e){return new Jy(this,e)}}it(Qy,"CircleGlobeExtArray");const Db=Ke([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Lb=Ke([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var e0=ms(function(i){i.exports=function(e,n){var o,c,h,p,_,y,v,T;for(c=e.length-(o=3&e.length),h=n,_=3432918353,y=461845907,T=0;T<c;)v=255&e.charCodeAt(T)|(255&e.charCodeAt(++T))<<8|(255&e.charCodeAt(++T))<<16|(255&e.charCodeAt(++T))<<24,++T,h=27492+(65535&(p=5*(65535&(h=(h^=v=(65535&(v=(v=(65535&v)*_+(((v>>>16)*_&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(v=0,o){case 3:v^=(255&e.charCodeAt(T+2))<<16;case 2:v^=(255&e.charCodeAt(T+1))<<8;case 1:h^=v=(65535&(v=(v=(65535&(v^=255&e.charCodeAt(T)))*_+(((v>>>16)*_&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295}return h^=e.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}}),Bb=ms(function(i){i.exports=function(e,n){for(var o,c=e.length,h=n^c,p=0;c>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:h^=(255&e.charCodeAt(p+2))<<16;case 2:h^=(255&e.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&e.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}}),Ou=e0,Rb=Bb;Ou.murmur3=e0,Ou.murmur2=Rb;class rp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(t0(e)),this.positions.push(n,o,c)}getPositions(e){const n=t0(e);let o=0,c=this.ids.length-1;for(;o<c;){const p=o+c>>1;this.ids[p]>=n?c=p:o=p+1}const h=[];for(;this.ids[o]===n;)h.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return h}static serialize(e,n){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Sm(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const n=new rp;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function t0(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ou(String(i))}function Sm(i,e,n,o){for(;n<o;){const c=i[n+o>>1];let h=n-1,p=o+1;for(;;){do h++;while(i[h]<c);do p--;while(i[p]>c);if(h>=p)break;op(i,h,p),op(e,3*h,3*p),op(e,3*h+1,3*p+1),op(e,3*h+2,3*p+2)}p-n<o-p?(Sm(i,e,n,p),n=p+1):(Sm(i,e,p+1,o),o=p)}}function op(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}it(rp,"FeaturePositionMap");class Go{constructor(e,n){this.gl=e.gl,this.location=n}}class sp extends Go{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class i0 extends Go{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class n0 extends Go{constructor(e,n){super(e,n),this.current=xi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Fb=new Float32Array(16),Ob=new Float32Array(9),Nb=new Float32Array(4);function Cm(i){return[ot(255*i.r,255*i.g),ot(255*i.b,255*i.a)]}class Nu{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new n0(e,n):new sp(e,n)}}class uc{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=n.tl.concat(n.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,n,o,c){const h=c==="u_pattern_to"||c==="u_dash_to"?this.patternTo:c==="u_pattern_from"||c==="u_dash_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,n,o){return o==="u_pattern_from"||o==="u_pattern_to"||o==="u_dash_from"||o==="u_dash_to"?new i0(e,n):new sp(e,n)}}class $o{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,h,p){const _=this.paintVertexArray.length,y=this.expression.evaluate(new Y(0),n,{},h,c,p);this.paintVertexArray.resize(e),this._setPaintValue(_,e,y)}updatePaintArray(e,n,o,c,h){const p=this.expression.evaluate({zoom:0},o,c,void 0,h);this._setPaintValue(e,n,p)}_setPaintValue(e,n,o){if(this.type==="color"){const c=Cm(o);for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hr{constructor(e,n,o,c,h,p){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,o,c,h,p){const _=this.expression.evaluate(new Y(this.zoom),n,{},h,c,p),y=this.expression.evaluate(new Y(this.zoom+1),n,{},h,c,p),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,_,y)}updatePaintArray(e,n,o,c,h){const p=this.expression.evaluate({zoom:this.zoom},o,c,void 0,h),_=this.expression.evaluate({zoom:this.zoom+1},o,c,void 0,h);this._setPaintValue(e,n,p,_)}_setPaintValue(e,n,o,c){if(this.type==="color"){const h=Cm(o),p=Cm(c);for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,h[0],h[1],p[0],p[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Fe(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,o){return new sp(e,n)}}class Is{constructor(e,n,o,c,h,p,_){this.expression=e,this.type=o,this.useIntegerZoom=c,this.zoom=h,this.layerId=_,this.paintVertexAttributes=(o==="array"?Lb:Db).members;for(let y=0;y<n.length;++y);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,h,p){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(e,n,o,c){if(!c||!o)return;const{min:h,mid:p,max:_}=o,y=c[h],v=c[p],T=c[_];if(y&&v&&T)for(let C=e;C<n;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,v,y),this._setPaintValue(this.zoomOutPaintVertexArray,C,v,T)}_setPaintValue(e,n,o,c){e.emplace(n,o.tl[0],o.tl[1],o.br[0],o.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],o.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ks{constructor(e,n,o=()=>!0){this.binders={},this._buffers=[];const c=[];for(const h in e.paint._values){if(!o(h))continue;const p=e.paint.get(h);if(!(p instanceof Be&&$r(p.property.specification)))continue;const _=jb(h,e.type),y=p.value,v=p.property.specification.type,T=p.property.useIntegerZoom,C=p.property.specification["property-type"],A=C==="cross-faded"||C==="cross-faded-data-driven",M=String(h)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||M)if(y.kind==="source"||M||A){const P=r0(h,v,"source");this.binders[h]=A?new Is(y,_,v,T,n,P,e.id):new $o(y,_,v,P),c.push(`/a_${h}`)}else{const P=r0(h,v,"composite");this.binders[h]=new Hr(y,_,v,T,n,P),c.push(`/z_${h}`)}else this.binders[h]=A?new uc(y.value,_):new Nu(y.value,_,v),c.push(`/u_${h}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof $o||n instanceof Hr?n.maxValue:0}populatePaintArrays(e,n,o,c,h,p){for(const _ in this.binders){const y=this.binders[_];(y instanceof $o||y instanceof Hr||y instanceof Is)&&y.populatePaintArray(e,n,o,c,h,p)}}setConstantPatternPositions(e,n){for(const o in this.binders){const c=this.binders[o];c instanceof uc&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,c,h,p){let _=!1;for(const y in e){const v=n.getPositions(y);for(const T of v){const C=o.feature(T.index);for(const A in this.binders){const M=this.binders[A];if((M instanceof $o||M instanceof Hr||M instanceof Is)&&M.expression.isStateDependent===!0){const P=c.paint.get(A);M.expression=P.value,M.updatePaintArray(T.start,T.end,C,e[y],h,p),_=!0}}}}return _}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Nu||o instanceof uc)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof $o||o instanceof Hr||o instanceof Is)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Nu||o instanceof uc||o instanceof Hr)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof Nu||h instanceof uc||h instanceof Hr){for(const p of h.uniformNames)if(n[p]){const _=h.getBinding(e,n[p],p);o.push({name:p,property:c,binding:_})}}}return o}setUniforms(e,n,o,c){for(const{name:h,property:p,binding:_}of n)this.binders[p].setUniform(_,c,o.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof Is){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof $o||o instanceof Hr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof $o||o instanceof Hr||o instanceof Is)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof $o||n instanceof Hr||n instanceof Is)&&n.destroy()}}}class Va{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new ks(c,n,o);this.needsUpload=!1,this._featureMap=new rp,this._bufferOffset=0}populatePaintArrays(e,n,o,c,h,p,_){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,n,c,h,p,_);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c,h){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,n,p,c,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ub={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function jb(i,e){return Ub[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const Vb={"line-pattern":{source:xn,composite:xn},"fill-pattern":{source:xn,composite:xn},"fill-extrusion-pattern":{source:xn,composite:xn},"line-dasharray":{source:Er,composite:Er}},Gb={color:{source:np,composite:Xn},number:{source:Xr,composite:np}};function r0(i,e,n){const o=Vb[i];return o&&o[n]||Gb[e][n]}it(Nu,"ConstantBinder"),it(uc,"CrossFadedConstantBinder"),it($o,"SourceExpressionBinder"),it(Is,"CrossFadedCompositeBinder"),it(Hr,"CompositeExpressionBinder"),it(ks,"ProgramConfiguration",{omit:["_buffers"]}),it(Va,"ProgramConfigurationSet");const ap="-transition";class Yr extends Xt{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new ye(n.layout)),n.paint)){this._transitionablePaint=new Me(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pe(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(bm,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return xr(e,ap)?this._transitionablePaint.getTransition(e.slice(0,-ap.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(wm,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(xr(e,ap))return this._transitionablePaint.setTransition(e.slice(0,-ap.length),n||void 0),!1;{const c=this._transitionablePaint._values[e],h=c.property.specification["property-type"]==="cross-faded-data-driven",p=c.value.isDataDriven(),_=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value;return y.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(e,_,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Et(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,c,h={}){return(!h||h.validate!==!1)&&Gd(this,e.call(ic,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Be&&$r(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Yl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const $b=Ke([{name:"a_pos",components:2,type:"Int16"}],4),Zb=Ke([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class Ai{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,c){let h=this.segments[this.segments.length-1];return e>Ai.MAX_VERTEX_ARRAY_LENGTH&&Pt(`Max vertices per segment is ${Ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>Ai.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==c)&&(h={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(h.sortKey=c),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new Ai([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}Ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,it(Ai,"SegmentVector");var yt=8192;class Ms{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ht?new Ht(e.lng,e.lat):Ht.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ht?new Ht(e.lng,e.lat):Ht.convert(e),this}extend(e){const n=this._sw,o=this._ne;let c,h;if(e instanceof Ht)c=e,h=e;else{if(!(e instanceof Ms))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ms.convert(e)):this.extend(Ht.convert(e)):this;if(c=e._sw,h=e._ne,!c||!h)return this}return n||o?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),o.lng=Math.max(h.lng,o.lng),o.lat=Math.max(h.lat,o.lat)):(this._sw=new Ht(c.lng,c.lat),this._ne=new Ht(h.lng,h.lat)),this}getCenter(){return new Ht((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ht(this.getWest(),this.getNorth())}getSouthEast(){return new Ht(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:o}=Ht.convert(e);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(e){return!e||e instanceof Ms?e:new Ms(e)}}const Am=63710088e-1;class Ht{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ht(ut(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,c=e.lat*n,h=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Am*Math.acos(Math.min(h,1))}toBounds(e=0){const n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new Ms(new Ht(this.lng-o,this.lat-n),new Ht(this.lng+o,this.lat+n))}static convert(e){if(e instanceof Ht)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ht(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ht(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const o0=2*Math.PI*Am;function Im(i){return o0*Math.cos(i*Math.PI/180)}function Ga(i){return(180+i)/360}function $a(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Sr(i,e){return i/Im(e)}function vn(i){return 360*i-180}function Pi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function s0(i,e){return i*Im(Pi(e))}const ho=85.051129;class hc{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=Ht.convert(e);return new hc(Ga(o.lng),$a(o.lat),Sr(n,o.lat))}toLngLat(){return new Ht(vn(this.x),Pi(this.y))}toAltitude(){return s0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/o0*(e=Pi(this.y),1/Math.cos(e*Math.PI/180));var e}}function km(i,e,n,o,c,h,p,_,y){const v=(e+o)/2,T=(n+c)/2,C=new me(v,T);_(C),function(A,M,P,R,V,W){const ie=P-V,te=R-W;return Math.abs((R-M)*ie-(P-A)*te)/Math.hypot(ie,te)}(C.x,C.y,h.x,h.y,p.x,p.y)>=y?(km(i,e,n,v,T,h,C,_,y),km(i,v,T,o,c,C,p,_,y)):i.push(p)}function a0(i,e,n){let o=i[0],c=o.x,h=o.y;e(o);const p=[o];for(let _=1;_<i.length;_++){const y=i[_],{x:v,y:T}=y;e(y),km(p,c,h,v,T,o,y,e,n),c=v,h=T,o=y}return p}function Mm(i,e,n,o,c){if(c(e,n)){const h=e.add(n).mult(.5);o(h),Mm(i,e,h,o,c),Mm(i,h,n,o,c)}else i.push(n)}function qb(i,e,n){let o=i[0];e(o);const c=[o];for(let h=1;h<i.length;h++){const p=i[h];e(p),Mm(c,o,p,e,n),o=p}return c}const zm=Math.pow(2,14)-1,l0=-zm-1;function Wb(i,e){const n=Math.round(i.x*e),o=Math.round(i.y*e);return i.x=Fe(n,l0,zm),i.y=Fe(o,l0,zm),(n<i.x||n>i.x+1||o<i.y||o>i.y+1)&&Pt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Zo(i,e,n){const o=i.loadGeometry(),c=i.extent,h=yt/c;if(e&&n&&n.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:_,x:y,y:v,projection:T}=n,C=A=>{const M=vn((e.x+A.x/c)/p),P=Pi((e.y+A.y/c)/p),R=T.project(M,P);A.x=(R.x*_-y)*c,A.y=(R.y*_-v)*c};for(let A=0;A<o.length;A++)if(i.type!==1)o[A]=a0(o[A],C,1);else{const M=[];for(const P of o[A])P.x<0||P.x>=c||P.y<0||P.y>=c||(C(P),M.push(P));o[A]=M}}for(const p of o)for(const _ of p)Wb(_,h);return o}function Za(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Zo(i):[]}}function lp(i,e,n,o,c){i.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}function cp(i,e,n,o){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384,o)}class Pm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Zt,this.indexArray=new Ci,this.segments=new Ai,this.programConfigurations=new Va(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,c){const h=this.layers[0],p=[];let _=null;h.type==="circle"&&(_=h.layout.get("circle-sort-key"));for(const{feature:v,id:T,index:C,sourceLayerIndex:A}of e){const M=this.layers[0]._featureFilter.needGeometry,P=Za(v,M);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),P,o))continue;const R=_?_.evaluate(P,{},o):void 0,V={id:T,properties:v.properties,type:v.type,sourceLayerIndex:A,index:C,geometry:M?P.geometry:Zo(v,o,c),patterns:{},sortKey:R};p.push(V)}_&&p.sort((v,T)=>v.sortKey-T.sortKey);let y=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Qy,y=c.projection);for(const v of p){const{geometry:T,index:C,sourceLayerIndex:A}=v,M=e[C].feature;this.addFeature(v,T,C,n.availableImages,o,y),n.featureIndex.insert(M,T,C,A,this.index)}}update(e,n,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$b.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Zb.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,o,c,h,p){for(const _ of n)for(const y of _){const v=y.x,T=y.y;if(v<0||v>=yt||T<0||T>=yt)continue;if(p){const M=p.projectTilePoint(v,T,h),P=p.upVector(h,v,T),R=Pi((T/yt+h.y)/(1<<h.z)),V=p.pixelsPerMeter(R,1)/Sr(1,R),W=this.globeExtVertexArray;cp(W,M,P,V),cp(W,M,P,V),cp(W,M,P,V),cp(W,M,P,V)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=C.vertexLength;lp(this.layoutVertexArray,v,T,-1,-1),lp(this.layoutVertexArray,v,T,1,-1),lp(this.layoutVertexArray,v,T,1,1),lp(this.layoutVertexArray,v,T,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c,h)}}function c0(i,e){for(let n=0;n<i.length;n++)if(qa(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(qa(i,e[n]))return!0;return!!Dm(i,e)}function Xb(i,e,n){return!!qa(i,e)||!!Lm(e,i,n)}function u0(i,e){if(i.length===1)return d0(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let c=0;c<o.length;c++)if(qa(i,o[c]))return!0}for(let n=0;n<i.length;n++)if(d0(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Dm(i,e[n]))return!0;return!1}function Hb(i,e,n){if(i.length>1){if(Dm(i,e))return!0;for(let o=0;o<e.length;o++)if(Lm(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(Lm(i[o],e,n))return!0;return!1}function Dm(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],c=i[n+1];for(let h=0;h<e.length-1;h++)if(Yb(o,c,e[h],e[h+1]))return!0}return!1}function Yb(i,e,n,o){return zi(i,n,o)!==zi(e,n,o)&&zi(i,e,n)!==zi(i,e,o)}function Lm(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(h0(i,e[c-1],e[c])<o)return!0;return!1}function h0(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const c=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function d0(i,e){let n,o,c,h=!1;for(let p=0;p<i.length;p++){n=i[p];for(let _=0,y=n.length-1;_<n.length;y=_++)o=n[_],c=n[y],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(h=!h)}return h}function qa(i,e){let n=!1;for(let o=0,c=i.length-1;o<i.length;c=o++){const h=i[o],p=i[c];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(n=!n)}return n}function p0(i,e,n,o,c){for(const p of i)if(e<=p.x&&n<=p.y&&o>=p.x&&c>=p.y)return!0;const h=[new me(e,n),new me(e,c),new me(o,c),new me(o,n)];if(i.length>2){for(const p of h)if(qa(i,p))return!0}for(let p=0;p<i.length-1;p++)if(Kb(i[p],i[p+1],h))return!0;return!1}function Kb(i,e,n){const o=n[0],c=n[2];if(i.x<o.x&&e.x<o.x||i.x>c.x&&e.x>c.x||i.y<o.y&&e.y<o.y||i.y>c.y&&e.y>c.y)return!1;const h=zi(i,e,n[0]);return h!==zi(i,e,n[1])||h!==zi(i,e,n[2])||h!==zi(i,e,n[3])}function dc(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function up(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function f0(i,e,n,o,c){if(!e[0]&&!e[1])return i;const h=me.convert(e)._mult(c);n==="viewport"&&h._rotate(-o);const p=[];for(let _=0;_<i.length;_++)p.push(i[_].sub(h));return p}function m0(i,e,n,o){const c=me.convert(i)._mult(o);return e==="viewport"&&c._rotate(-n),c}it(Pm,"CircleBucket",{omit:["layers"]});const Jb=new rt({"circle-sort-key":new ge(fe.layout_circle["circle-sort-key"])});var Qb={paint:new rt({"circle-radius":new ge(fe.paint_circle["circle-radius"]),"circle-color":new ge(fe.paint_circle["circle-color"]),"circle-blur":new ge(fe.paint_circle["circle-blur"]),"circle-opacity":new ge(fe.paint_circle["circle-opacity"]),"circle-translate":new xe(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new xe(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xe(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xe(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ge(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ge(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ge(fe.paint_circle["circle-stroke-opacity"])}),layout:Jb},hp=1e-6,Yn=typeof Float32Array!="undefined"?Float32Array:Array;function _0(){var i=new Yn(9);return Yn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Kn(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function zs(i,e,n){var o=e[0],c=e[1],h=e[2],p=e[3],_=e[4],y=e[5],v=e[6],T=e[7],C=e[8],A=e[9],M=e[10],P=e[11],R=e[12],V=e[13],W=e[14],ie=e[15],te=n[0],ne=n[1],se=n[2],ce=n[3];return i[0]=te*o+ne*_+se*C+ce*R,i[1]=te*c+ne*y+se*A+ce*V,i[2]=te*h+ne*v+se*M+ce*W,i[3]=te*p+ne*T+se*P+ce*ie,i[4]=(te=n[4])*o+(ne=n[5])*_+(se=n[6])*C+(ce=n[7])*R,i[5]=te*c+ne*y+se*A+ce*V,i[6]=te*h+ne*v+se*M+ce*W,i[7]=te*p+ne*T+se*P+ce*ie,i[8]=(te=n[8])*o+(ne=n[9])*_+(se=n[10])*C+(ce=n[11])*R,i[9]=te*c+ne*y+se*A+ce*V,i[10]=te*h+ne*v+se*M+ce*W,i[11]=te*p+ne*T+se*P+ce*ie,i[12]=(te=n[12])*o+(ne=n[13])*_+(se=n[14])*C+(ce=n[15])*R,i[13]=te*c+ne*y+se*A+ce*V,i[14]=te*h+ne*v+se*M+ce*W,i[15]=te*p+ne*T+se*P+ce*ie,i}function Wa(i,e,n){var o,c,h,p,_,y,v,T,C,A,M,P,R=n[0],V=n[1],W=n[2];return e===i?(i[12]=e[0]*R+e[4]*V+e[8]*W+e[12],i[13]=e[1]*R+e[5]*V+e[9]*W+e[13],i[14]=e[2]*R+e[6]*V+e[10]*W+e[14],i[15]=e[3]*R+e[7]*V+e[11]*W+e[15]):(c=e[1],h=e[2],p=e[3],_=e[4],y=e[5],v=e[6],T=e[7],C=e[8],A=e[9],M=e[10],P=e[11],i[0]=o=e[0],i[1]=c,i[2]=h,i[3]=p,i[4]=_,i[5]=y,i[6]=v,i[7]=T,i[8]=C,i[9]=A,i[10]=M,i[11]=P,i[12]=o*R+_*V+C*W+e[12],i[13]=c*R+y*V+A*W+e[13],i[14]=h*R+v*V+M*W+e[14],i[15]=p*R+T*V+P*W+e[15]),i}function po(i,e,n){var o=n[0],c=n[1],h=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function dp(i,e,n){var o=Math.sin(n),c=Math.cos(n),h=e[4],p=e[5],_=e[6],y=e[7],v=e[8],T=e[9],C=e[10],A=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*c+v*o,i[5]=p*c+T*o,i[6]=_*c+C*o,i[7]=y*c+A*o,i[8]=v*c-h*o,i[9]=T*c-p*o,i[10]=C*c-_*o,i[11]=A*c-y*o,i}function pp(i,e,n){var o=Math.sin(n),c=Math.cos(n),h=e[0],p=e[1],_=e[2],y=e[3],v=e[8],T=e[9],C=e[10],A=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*c-v*o,i[1]=p*c-T*o,i[2]=_*c-C*o,i[3]=y*c-A*o,i[8]=h*o+v*c,i[9]=p*o+T*c,i[10]=_*o+C*c,i[11]=y*o+A*c,i}function g0(i,e,n){var o,c,h,p=n[0],_=n[1],y=n[2],v=Math.hypot(p,_,y);return v<hp?null:(p*=v=1/v,_*=v,y*=v,o=Math.sin(e),c=Math.cos(e),i[0]=p*p*(h=1-c)+c,i[1]=_*p*h+y*o,i[2]=y*p*h-_*o,i[3]=0,i[4]=p*_*h-y*o,i[5]=_*_*h+c,i[6]=y*_*h+p*o,i[7]=0,i[8]=p*y*h+_*o,i[9]=_*y*h-p*o,i[10]=y*y*h+c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var e2=zs;function Bm(){var i=new Yn(3);return Yn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function y0(i){var e=new Yn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Uu(i){return Math.hypot(i[0],i[1],i[2])}function pc(i,e,n){var o=new Yn(3);return o[0]=i,o[1]=e,o[2]=n,o}function Ps(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function Rm(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function x0(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function fp(i,e,n){return i[0]=Math.min(e[0],n[0]),i[1]=Math.min(e[1],n[1]),i[2]=Math.min(e[2],n[2]),i}function mp(i,e,n){return i[0]=Math.max(e[0],n[0]),i[1]=Math.max(e[1],n[1]),i[2]=Math.max(e[2],n[2]),i}function fo(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function _p(i,e,n,o){return i[0]=e[0]+n[0]*o,i[1]=e[1]+n[1]*o,i[2]=e[2]+n[2]*o,i}function wn(i,e){var n=e[0],o=e[1],c=e[2],h=n*n+o*o+c*c;return h>0&&(h=1/Math.sqrt(h)),i[0]=e[0]*h,i[1]=e[1]*h,i[2]=e[2]*h,i}function Cr(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function Fm(i,e,n){var o=e[0],c=e[1],h=e[2],p=n[0],_=n[1],y=n[2];return i[0]=c*y-h*_,i[1]=h*p-o*y,i[2]=o*_-c*p,i}function sn(i,e,n){var o=e[0],c=e[1],h=e[2],p=n[3]*o+n[7]*c+n[11]*h+n[15];return i[0]=(n[0]*o+n[4]*c+n[8]*h+n[12])/(p=p||1),i[1]=(n[1]*o+n[5]*c+n[9]*h+n[13])/p,i[2]=(n[2]*o+n[6]*c+n[10]*h+n[14])/p,i}function v0(i,e,n){var o=n[0],c=n[1],h=n[2],p=e[0],_=e[1],y=e[2],v=c*y-h*_,T=h*p-o*y,C=o*_-c*p,A=c*C-h*T,M=h*v-o*C,P=o*T-c*v,R=2*n[3];return T*=R,C*=R,M*=2,P*=2,i[0]=p+(v*=R)+(A*=2),i[1]=_+T+M,i[2]=y+C+P,i}var ju,Ar=Rm,t2=x0,i2=Uu;function w0(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i}function Xa(i,e,n){var o=e[0],c=e[1],h=e[2],p=e[3];return i[0]=n[0]*o+n[4]*c+n[8]*h+n[12]*p,i[1]=n[1]*o+n[5]*c+n[9]*h+n[13]*p,i[2]=n[2]*o+n[6]*c+n[10]*h+n[14]*p,i[3]=n[3]*o+n[7]*c+n[11]*h+n[15]*p,i}function b0(){var i=new Yn(4);return Yn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function T0(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function E0(i,e,n){n*=.5;var o=e[0],c=e[1],h=e[2],p=e[3],_=Math.sin(n),y=Math.cos(n);return i[0]=o*y+p*_,i[1]=c*y+h*_,i[2]=h*y-c*_,i[3]=p*y-o*_,i}function S0(i,e,n){n*=.5;var o=e[0],c=e[1],h=e[2],p=e[3],_=Math.sin(n),y=Math.cos(n);return i[0]=o*y-h*_,i[1]=c*y+p*_,i[2]=h*y+o*_,i[3]=p*y-c*_,i}Bm(),ju=new Yn(4),Yn!=Float32Array&&(ju[0]=0,ju[1]=0,ju[2]=0,ju[3]=0),Bm(),pc(1,0,0),pc(0,1,0),b0(),b0(),_0();class Om{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,o){const c=Cr(n,this.dir);if(Math.abs(c)<1e-6)return!1;const h=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return o[0]=this.pos[0]+this.dir[0]*h,o[1]=this.pos[1]+this.dir[1]*h,o[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,n,o){if(function(M,P){var R=M[0],V=M[1],W=M[2],ie=P[0],te=P[1],ne=P[2];return Math.abs(R-ie)<=hp*Math.max(1,Math.abs(R),Math.abs(ie))&&Math.abs(V-te)<=hp*Math.max(1,Math.abs(V),Math.abs(te))&&Math.abs(W-ne)<=hp*Math.max(1,Math.abs(W),Math.abs(ne))}(this.pos,e)||n===0)return o[0]=o[1]=o[2]=0,!1;const[c,h,p]=this.dir,_=this.pos[0]-e[0],y=this.pos[1]-e[1],v=this.pos[2]-e[2],T=c*c+h*h+p*p,C=2*(_*c+y*h+v*p),A=C*C-4*T*(_*_+y*y+v*v-n*n);if(A<0){const M=Math.max(-C/2,0),P=_+c*M,R=y+h*M,V=v+p*M,W=Math.hypot(P,R,V);return o[0]=P*n/W,o[1]=R*n/W,o[2]=V*n/W,!1}{const M=(-C-Math.sqrt(A))/(2*T);if(M<0){const P=Math.hypot(_,y,v);return o[0]=_*n/P,o[1]=y*n/P,o[2]=v*n/P,!1}return o[0]=_+c*M,o[1]=y+h*M,o[2]=v+p*M,!0}}}class Nm{constructor(e,n,o,c,h){this.TL=e,this.TR=n,this.BR=o,this.BL=c,this.horizon=h}static fromInvProjectionMatrix(e,n,o){const c=[-1,1,1],h=[1,1,1],p=[1,-1,1],_=[-1,-1,1],y=sn(c,c,e),v=sn(h,h,e),T=sn(p,p,e),C=sn(_,_,e);return new Nm(y,v,T,C,n/o)}}class Um{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,o,c){const h=Math.pow(2,o),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const v=Xa([],y,e),T=1/v[3]/n*h;return function(C,A,M){return C[0]=A[0]*M[0],C[1]=A[1]*M[1],C[2]=A[2]*M[2],C[3]=A[3]*M[3],C}(v,v,[T,T,c?1/v[3]:T,T])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const v=wn([],Fm([],Ar([],p[y[0]],p[y[1]]),Ar([],p[y[2]],p[y[1]]))),T=-Cr(v,p[y[1]]);return v.concat(T)});return new Um(p,_)}}class dr{constructor(e,n){this.min=e,this.max=n,this.center=fo([],Ps([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],o=y0(this.min),c=y0(this.max);for(let h=0;h<n.length;h++)o[h]=n[h]?this.min[h]:this.center[h],c[h]=n[h]?this.center[h]:this.max[h];return c[2]=this.max[2],new dr(o,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let o=!0;for(let c=0;c<e.planes.length;c++){const h=e.planes[c];let p=0;for(let _=0;_<n.length;_++)p+=Cr(h,n[_])+h[3]>=0;if(p===0)return 0;p!==n.length&&(o=!1)}if(o)return 2;for(let c=0;c<3;c++){let h=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let _=0;_<e.points.length;_++){const y=e.points[_][c]-this.min[c];h=Math.min(h,y),p=Math.max(p,y)}if(p<0||h>this.max[c]-this.min[c])return 0}return 1}}function C0(i,e,n,o,c,h,p,_,y){if(h&&i.queryGeometry.isAboveHorizon)return!1;h&&(y*=i.pixelToTileUnitsFactor);const v=i.tileID.canonical,T=n.projection.upVectorScale(v,n.center.lat,n.worldSize).metersToTile;for(const C of e)for(const A of C){const M=A.add(_),P=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(M.x,M.y,!0):0,R=n.projection.projectTilePoint(M.x,M.y,v);if(P>0){const te=n.projection.upVector(v,M.x,M.y);R.x+=te[0]*T*P,R.y+=te[1]*T*P,R.z+=te[2]*T*P}const V=h?M:n2(R.x,R.y,R.z,o),W=h?i.tilespaceRays.map(te=>o2(te,P)):i.queryGeometry.screenGeometry,ie=Xa([],[R.x,R.y,R.z,1],o);if(!p&&h?y*=ie[3]/n.cameraToCenterDistance:p&&!h&&(y*=n.cameraToCenterDistance/ie[3]),!p&&h){const te=Pi((A.y/yt+v.y)/(1<<v.z));y/=n.projection.pixelsPerMeter(te,1)/Sr(1,te)}if(Xb(W,V,y))return!0}return!1}function n2(i,e,n,o){const c=Xa([],[i,e,n,1],o);return new me(c[0]/c[3],c[1]/c[3])}const A0=pc(0,0,0),r2=pc(0,0,1);function o2(i,e){const n=Bm();return A0[2]=e,i.intersectsPlane(A0,r2,n),new me(n[0],n[1])}class I0 extends Pm{}function k0(i,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=c,i}function M0(i,e,n){const{width:o,height:c}=e;o===i.width&&c===i.height||(jm(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,o),height:Math.min(i.height,c)},n),i.width=o,i.height=c,i.data=e.data)}function jm(i,e,n,o,c,h){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||n.x>i.width-c.width||n.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,_=e.data;for(let y=0;y<c.height;y++){const v=((n.y+y)*i.width+n.x)*h,T=((o.y+y)*e.width+o.x)*h;for(let C=0;C<c.width*h;C++)_[T+C]=p[v+C]}return e}it(I0,"HeatmapBucket",{omit:["layers"]});class qo{constructor(e,n){k0(this,e,1,n)}resize(e){M0(this,new qo(e),1)}clone(){return new qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,h){jm(e,n,o,c,h,1)}}class Jn{constructor(e,n){k0(this,e,4,n)}resize(e){M0(this,new Jn(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Jn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,h){jm(e,n,o,c,h,4)}}it(qo,"AlphaImage"),it(Jn,"RGBAImage");var s2={paint:new rt({"heatmap-radius":new ge(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ge(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xe(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qe(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xe(fe.paint_heatmap["heatmap-opacity"])})};function Vm(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,c=i.image||new Jn({width:n,height:o}),h=(p,_,y)=>{e[i.evaluationKey]=y;const v=i.expression.evaluate(e);c.data[p+_+0]=Math.floor(255*v.r/v.a),c.data[p+_+1]=Math.floor(255*v.g/v.a),c.data[p+_+2]=Math.floor(255*v.b/v.a),c.data[p+_+3]=Math.floor(255*v.a)};if(i.clips)for(let p=0,_=0;p<o;++p,_+=4*n)for(let y=0,v=0;y<n;y++,v+=4){const T=y/(n-1),{start:C,end:A}=i.clips[p];h(_,v,C*(1-T)+A*T)}else for(let p=0,_=0;p<n;p++,_+=4)h(0,_,p/(n-1));return c}var a2={paint:new rt({"hillshade-illumination-direction":new xe(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xe(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xe(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xe(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xe(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xe(fe.paint_hillshade["hillshade-accent-color"])})};const l2=Ke([{name:"a_pos",components:2,type:"Int16"}],4),{members:c2}=l2;var gp=yp,u2=yp;function yp(i,e,n){n=n||2;var o,c,h,p,_,y,v,T=e&&e.length,C=T?e[0]*n:i.length,A=z0(i,0,C,n,!0),M=[];if(!A||A.next===A.prev)return M;if(T&&(A=function(R,V,W,ie){var te,ne,se,ce=[];for(te=0,ne=V.length;te<ne;te++)(se=z0(R,V[te]*ie,te<ne-1?V[te+1]*ie:R.length,ie,!1))===se.next&&(se.steiner=!0),ce.push(y2(se));for(ce.sort(m2),te=0;te<ce.length;te++)W=Ds(W=_2(ce[te],W),W.next);return W}(i,e,A,n)),i.length>80*n){o=h=i[0],c=p=i[1];for(var P=n;P<C;P+=n)(_=i[P])<o&&(o=_),(y=i[P+1])<c&&(c=y),_>h&&(h=_),y>p&&(p=y);v=(v=Math.max(h-o,p-c))!==0?1/v:0}return Vu(A,M,n,o,c,v),M}function z0(i,e,n,o,c){var h,p;if(c===Zm(i,e,n,o)>0)for(h=e;h<n;h+=o)p=L0(h,i[h],i[h+1],p);else for(h=n-o;h>=e;h-=o)p=L0(h,i[h],i[h+1],p);return p&&xp(p,p.next)&&($u(p),p=p.next),p}function Ds(i,e){if(!i)return i;e||(e=i);var n,o=i;do if(n=!1,o.steiner||!xp(o,o.next)&&Di(o.prev,o,o.next)!==0)o=o.next;else{if($u(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function Vu(i,e,n,o,c,h,p){if(i){!p&&h&&function(T,C,A,M){var P=T;do P.z===null&&(P.z=Gm(P.x,P.y,C,A,M)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==T);P.prevZ.nextZ=null,P.prevZ=null,function(R){var V,W,ie,te,ne,se,ce,Ce,Ie=1;do{for(W=R,R=null,ne=null,se=0;W;){for(se++,ie=W,ce=0,V=0;V<Ie&&(ce++,ie=ie.nextZ);V++);for(Ce=Ie;ce>0||Ce>0&&ie;)ce!==0&&(Ce===0||!ie||W.z<=ie.z)?(te=W,W=W.nextZ,ce--):(te=ie,ie=ie.nextZ,Ce--),ne?ne.nextZ=te:R=te,te.prevZ=ne,ne=te;W=ie}ne.nextZ=null,Ie*=2}while(se>1)}(P)}(i,o,c,h);for(var _,y,v=i;i.prev!==i.next;)if(_=i.prev,y=i.next,h?d2(i,o,c,h):h2(i))e.push(_.i/n),e.push(i.i/n),e.push(y.i/n),$u(i),i=y.next,v=y.next;else if((i=y)===v){p?p===1?Vu(i=p2(Ds(i),e,n),e,n,o,c,h,2):p===2&&f2(i,e,n,o,c,h):Vu(Ds(i),e,n,o,c,h,1);break}}}function h2(i){var e=i.prev,n=i,o=i.next;if(Di(e,n,o)>=0)return!1;for(var c=i.next.next;c!==i.prev;){if(fc(e.x,e.y,n.x,n.y,o.x,o.y,c.x,c.y)&&Di(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function d2(i,e,n,o){var c=i.prev,h=i,p=i.next;if(Di(c,h,p)>=0)return!1;for(var _=c.x>h.x?c.x>p.x?c.x:p.x:h.x>p.x?h.x:p.x,y=c.y>h.y?c.y>p.y?c.y:p.y:h.y>p.y?h.y:p.y,v=Gm(c.x<h.x?c.x<p.x?c.x:p.x:h.x<p.x?h.x:p.x,c.y<h.y?c.y<p.y?c.y:p.y:h.y<p.y?h.y:p.y,e,n,o),T=Gm(_,y,e,n,o),C=i.prevZ,A=i.nextZ;C&&C.z>=v&&A&&A.z<=T;){if(C!==i.prev&&C!==i.next&&fc(c.x,c.y,h.x,h.y,p.x,p.y,C.x,C.y)&&Di(C.prev,C,C.next)>=0||(C=C.prevZ,A!==i.prev&&A!==i.next&&fc(c.x,c.y,h.x,h.y,p.x,p.y,A.x,A.y)&&Di(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;C&&C.z>=v;){if(C!==i.prev&&C!==i.next&&fc(c.x,c.y,h.x,h.y,p.x,p.y,C.x,C.y)&&Di(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;A&&A.z<=T;){if(A!==i.prev&&A!==i.next&&fc(c.x,c.y,h.x,h.y,p.x,p.y,A.x,A.y)&&Di(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function p2(i,e,n){var o=i;do{var c=o.prev,h=o.next.next;!xp(c,h)&&P0(c,o,o.next,h)&&Gu(c,h)&&Gu(h,c)&&(e.push(c.i/n),e.push(o.i/n),e.push(h.i/n),$u(o),$u(o.next),o=i=h),o=o.next}while(o!==i);return Ds(o)}function f2(i,e,n,o,c,h){var p=i;do{for(var _=p.next.next;_!==p.prev;){if(p.i!==_.i&&x2(p,_)){var y=D0(p,_);return p=Ds(p,p.next),y=Ds(y,y.next),Vu(p,e,n,o,c,h),void Vu(y,e,n,o,c,h)}_=_.next}p=p.next}while(p!==i)}function m2(i,e){return i.x-e.x}function _2(i,e){var n=function(h,p){var _,y=p,v=h.x,T=h.y,C=-1/0;do{if(T<=y.y&&T>=y.next.y&&y.next.y!==y.y){var A=y.x+(T-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(A<=v&&A>C){if(C=A,A===v){if(T===y.y)return y;if(T===y.next.y)return y.next}_=y.x<y.next.x?y:y.next}}y=y.next}while(y!==p);if(!_)return null;if(v===C)return _;var M,P=_,R=_.x,V=_.y,W=1/0;y=_;do v>=y.x&&y.x>=R&&v!==y.x&&fc(T<V?v:C,T,R,V,T<V?C:v,T,y.x,y.y)&&(M=Math.abs(T-y.y)/(v-y.x),Gu(y,h)&&(M<W||M===W&&(y.x>_.x||y.x===_.x&&g2(_,y)))&&(_=y,W=M)),y=y.next;while(y!==P);return _}(i,e);if(!n)return e;var o=D0(n,i),c=Ds(n,n.next);return Ds(o,o.next),e===n?c:e}function g2(i,e){return Di(i.prev,i,e.prev)<0&&Di(e.next,i,i.next)<0}function Gm(i,e,n,o,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-n)*c)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-o)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function y2(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function fc(i,e,n,o,c,h,p,_){return(c-p)*(e-_)-(i-p)*(h-_)>=0&&(i-p)*(o-_)-(n-p)*(e-_)>=0&&(n-p)*(h-_)-(c-p)*(o-_)>=0}function x2(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&P0(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(i,e)&&(Gu(i,e)&&Gu(e,i)&&function(n,o){var c=n,h=!1,p=(n.x+o.x)/2,_=(n.y+o.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&p<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(h=!h),c=c.next;while(c!==n);return h}(i,e)&&(Di(i.prev,i,e.prev)||Di(i,e.prev,e))||xp(i,e)&&Di(i.prev,i,i.next)>0&&Di(e.prev,e,e.next)>0)}function Di(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function xp(i,e){return i.x===e.x&&i.y===e.y}function P0(i,e,n,o){var c=wp(Di(i,e,n)),h=wp(Di(i,e,o)),p=wp(Di(n,o,i)),_=wp(Di(n,o,e));return c!==h&&p!==_||!(c!==0||!vp(i,n,e))||!(h!==0||!vp(i,o,e))||!(p!==0||!vp(n,i,o))||!(_!==0||!vp(n,e,o))}function vp(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function wp(i){return i>0?1:i<0?-1:0}function Gu(i,e){return Di(i.prev,i,i.next)<0?Di(i,e,i.next)>=0&&Di(i,i.prev,e)>=0:Di(i,e,i.prev)<0||Di(i,i.next,e)<0}function D0(i,e){var n=new $m(i.i,i.x,i.y),o=new $m(e.i,e.x,e.y),c=i.next,h=e.prev;return i.next=e,e.prev=i,n.next=c,c.prev=n,o.next=n,n.prev=o,h.next=o,o.prev=h,o}function L0(i,e,n,o){var c=new $m(i,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function $u(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function $m(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zm(i,e,n,o){for(var c=0,h=e,p=n-o;h<n;h+=o)c+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return c}function v2(i,e,n,o,c){B0(i,e,n||0,o||i.length-1,c||w2)}function B0(i,e,n,o,c){for(;o>n;){if(o-n>600){var h=o-n+1,p=e-n+1,_=Math.log(h),y=.5*Math.exp(2*_/3),v=.5*Math.sqrt(_*y*(h-y)/h)*(p-h/2<0?-1:1);B0(i,e,Math.max(n,Math.floor(e-p*y/h+v)),Math.min(o,Math.floor(e+(h-p)*y/h+v)),c)}var T=i[e],C=n,A=o;for(Zu(i,n,e),c(i[o],T)>0&&Zu(i,n,o);C<A;){for(Zu(i,C,A),C++,A--;c(i[C],T)<0;)C++;for(;c(i[A],T)>0;)A--}c(i[n],T)===0?Zu(i,n,A):Zu(i,++A,o),A<=e&&(n=A+1),e<=A&&(o=A-1)}}function Zu(i,e,n){var o=i[e];i[e]=i[n],i[n]=o}function w2(i,e){return i<e?-1:i>e?1:0}function qm(i,e){const n=i.length;if(n<=1)return[i];const o=[];let c,h;for(let p=0;p<n;p++){const _=qi(i[p]);_!==0&&(i[p].area=Math.abs(_),h===void 0&&(h=_<0),h===_<0?(c&&o.push(c),c=[i[p]]):c.push(i[p]))}if(c&&o.push(c),e>1)for(let p=0;p<o.length;p++)o[p].length<=e||(v2(o[p],e,1,o[p].length-1,b2),o[p]=o[p].slice(0,e));return o}function b2(i,e){return e.area-i.area}function Wm(i,e,n){const o=n.patternDependencies;let c=!1;for(const h of e){const p=h.paint.get(`${i}-pattern`);p.isConstant()||(c=!0);const _=p.constantOr(null);_&&(c=!0,o[_.to]=!0,o[_.from]=!0)}return c}function Xm(i,e,n,o,c){const h=c.patternDependencies;for(const p of e){const _=p.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let y=_.evaluate({zoom:o-1},n,{},c.availableImages),v=_.evaluate({zoom:o},n,{},c.availableImages),T=_.evaluate({zoom:o+1},n,{},c.availableImages);y=y&&y.name?y.name:y,v=v&&v.name?v.name:v,T=T&&T.name?T.name:T,h[y]=!0,h[v]=!0,h[T]=!0,n.patterns[p.id]={min:y,mid:v,max:T}}}return n}yp.deviation=function(i,e,n,o){var c=e&&e.length,h=Math.abs(Zm(i,0,c?e[0]*n:i.length,n));if(c)for(var p=0,_=e.length;p<_;p++)h-=Math.abs(Zm(i,e[p]*n,p<_-1?e[p+1]*n:i.length,n));var y=0;for(p=0;p<o.length;p+=3){var v=o[p]*n,T=o[p+1]*n,C=o[p+2]*n;y+=Math.abs((i[v]-i[C])*(i[T+1]-i[v+1])-(i[v]-i[T])*(i[C+1]-i[v+1]))}return h===0&&y===0?0:Math.abs((y-h)/h)},yp.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<i.length;c++){for(var h=0;h<i[c].length;h++)for(var p=0;p<e;p++)n.vertices.push(i[c][h][p]);c>0&&n.holes.push(o+=i[c-1].length)}return n},gp.default=u2;class bp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Zt,this.indexArray=new Ci,this.indexArray2=new As,this.programConfigurations=new Va(e.layers,e.zoom),this.segments=new Ai,this.segments2=new Ai,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,o,c){this.hasPattern=Wm("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:_,id:y,index:v,sourceLayerIndex:T}of e){const C=this.layers[0]._featureFilter.needGeometry,A=Za(_,C);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),A,o))continue;const M=h?h.evaluate(A,{},o,n.availableImages):void 0,P={id:y,properties:_.properties,type:_.type,sourceLayerIndex:T,index:v,geometry:C?A.geometry:Zo(_,o,c),patterns:{},sortKey:M};p.push(P)}h&&p.sort((_,y)=>_.sortKey-y.sortKey);for(const _ of p){const{geometry:y,index:v,sourceLayerIndex:T}=_;if(this.hasPattern){const C=Xm("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(_,y,v,o,{},n.availableImages);n.featureIndex.insert(e[v].feature,y,v,T,this.index)}}update(e,n,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,c)}addFeatures(e,n,o,c,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,c2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,h,p=[]){for(const _ of qm(n,500)){let y=0;for(const P of _)y+=P.length;const v=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),T=v.vertexLength,C=[],A=[];for(const P of _){if(P.length===0)continue;P!==_[0]&&A.push(C.length/2);const R=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),V=R.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(V+P.length-1,V),C.push(P[0].x),C.push(P[0].y);for(let W=1;W<P.length;W++)this.layoutVertexArray.emplaceBack(P[W].x,P[W].y),this.indexArray2.emplaceBack(V+W-1,V+W),C.push(P[W].x),C.push(P[W].y);R.vertexLength+=P.length,R.primitiveLength+=P.length}const M=gp(C,A);for(let P=0;P<M.length;P+=3)this.indexArray.emplaceBack(T+M[P],T+M[P+1],T+M[P+2]);v.vertexLength+=y,v.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,p,c)}}it(bp,"FillBucket",{omit:["layers","patternFeatures"]});const T2=new rt({"fill-sort-key":new ge(fe.layout_fill["fill-sort-key"])});var E2={paint:new rt({"fill-antialias":new xe(fe.paint_fill["fill-antialias"]),"fill-opacity":new ge(fe.paint_fill["fill-opacity"]),"fill-color":new ge(fe.paint_fill["fill-color"]),"fill-outline-color":new ge(fe.paint_fill["fill-outline-color"]),"fill-translate":new xe(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new xe(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new tt(fe.paint_fill["fill-pattern"])}),layout:T2};const S2=Ke([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),C2=Ke([{name:"a_centroid_pos",components:2,type:"Uint16"}]),A2=Ke([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:I2}=S2;var R0=mc;function mc(i,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=c,i.readFields(k2,this,e)}function k2(i,e,n){i==1?e.id=n.readVarint():i==2?function(o,c){for(var h=o.readVarint()+o.pos;o.pos<h;){var p=c._keys[o.readVarint()],_=c._values[o.readVarint()];c.properties[p]=_}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function M2(i){for(var e,n,o=0,c=0,h=i.length,p=h-1;c<h;p=c++)o+=((n=i[p]).x-(e=i[c]).x)*(e.y+n.y);return o}mc.types=["Unknown","Point","LineString","Polygon"],mc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,o=1,c=0,h=0,p=0,_=[];i.pos<n;){if(c<=0){var y=i.readVarint();o=7&y,c=y>>3}if(c--,o===1||o===2)h+=i.readSVarint(),p+=i.readSVarint(),o===1&&(e&&_.push(e),e=[]),e.push(new me(h,p));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&_.push(e),_},mc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,o=0,c=0,h=0,p=1/0,_=-1/0,y=1/0,v=-1/0;i.pos<e;){if(o<=0){var T=i.readVarint();n=7&T,o=T>>3}if(o--,n===1||n===2)(c+=i.readSVarint())<p&&(p=c),c>_&&(_=c),(h+=i.readSVarint())<y&&(y=h),h>v&&(v=h);else if(n!==7)throw new Error("unknown command "+n)}return[p,y,_,v]},mc.prototype.toGeoJSON=function(i,e,n){var o,c,h=this.extent*Math.pow(2,n),p=this.extent*i,_=this.extent*e,y=this.loadGeometry(),v=mc.types[this.type];function T(M){for(var P=0;P<M.length;P++){var R=M[P];M[P]=[360*(R.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(R.y+_)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(o=0;o<y.length;o++)C[o]=y[o][0];T(y=C);break;case 2:for(o=0;o<y.length;o++)T(y[o]);break;case 3:for(y=function(M){var P=M.length;if(P<=1)return[M];for(var R,V,W=[],ie=0;ie<P;ie++){var te=M2(M[ie]);te!==0&&(V===void 0&&(V=te<0),V===te<0?(R&&W.push(R),R=[M[ie]]):R.push(M[ie]))}return R&&W.push(R),W}(y),o=0;o<y.length;o++)for(c=0;c<y[o].length;c++)T(y[o][c])}y.length===1?y=y[0]:v="Multi"+v;var A={type:"Feature",geometry:{type:v,coordinates:y},properties:this.properties};return"id"in this&&(A.id=this.id),A};var F0=O0;function O0(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(z2,this,e),this.length=this._features.length}function z2(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(o){for(var c=null,h=o.readVarint()+o.pos;o.pos<h;){var p=o.readVarint()>>3;c=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}return c}(n))}function P2(i,e,n){if(i===3){var o=new F0(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}O0.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new R0(this._pbf,e,this.extent,this._keys,this._values)};var Ha={VectorTile:function(i,e){this.layers=i.readFields(P2,{},e)},VectorTileFeature:R0,VectorTileLayer:F0};function Tp(i,e,n,o){const c=[],h=o===0?(p,_,y,v,T,C)=>{p.push(new me(C,y+(C-_)/(v-_)*(T-y)))}:(p,_,y,v,T,C)=>{p.push(new me(_+(C-y)/(T-y)*(v-_),C))};for(const p of i){const _=[];for(const y of p){if(y.length<=2)continue;const v=[];for(let A=0;A<y.length-1;A++){const M=y[A].x,P=y[A].y,R=y[A+1].x,V=y[A+1].y,W=o===0?M:P,ie=o===0?R:V;W<e?ie>e&&h(v,M,P,R,V,e):W>n?ie<n&&h(v,M,P,R,V,n):v.push(y[A]),ie<e&&W>=e&&h(v,M,P,R,V,e),ie>n&&W<=n&&h(v,M,P,R,V,n)}let T=y[y.length-1];const C=o===0?T.x:T.y;C>=e&&C<=n&&v.push(T),v.length&&(T=v[v.length-1],v[0].x===T.x&&v[0].y===T.y||v.push(v[0]),_.push(v))}_.length&&c.push(_)}return c}const D2=Ha.VectorTileFeature.types,L2=Math.pow(2,13);function qu(i,e,n,o,c,h,p,_){i.emplaceBack((e<<1)+p,(n<<1)+h,(Math.floor(o*L2)<<1)+c,Math.round(_))}function Wu(i,e,n){i.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class N0{constructor(){this.acc=new me(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new me(e.x,e.y),this.max=new me(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const o=this.min,c=this.max;e.x<o.x?o.x=e.x:e.x>c.x&&(c.x=e.x),e.y<o.y?o.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===yt)&&e.x===n.x)!=((e.y===0||e.y===yt)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,Ot(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>yt!=e.x>yt&&this.addBorderIntersection(1,Ot(n.y,e.y,(yt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Ot(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>yt!=e.y>yt&&this.addBorderIntersection(3,Ot(n.x,e.x,(yt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((n,o)=>n+o.edges,0);return e!==0?this.acc.div(e)._round():new me(0,0)}span(){return new me(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Xu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Jt,this.centroidVertexArray=new Ky,this.indexArray=new Ci,this.programConfigurations=new Va(e.layers,e.zoom),this.segments=new Ai,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,o,c){this.features=[],this.hasPattern=Wm("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(h){const p=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*p/(p*p+1)/yt/(1<<h.z)}(o);for(const{feature:h,id:p,index:_,sourceLayerIndex:y}of e){const v=this.layers[0]._featureFilter.needGeometry,T=Za(h,v);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),T,o))continue;const C={id:p,sourceLayerIndex:y,index:_,geometry:v?T.geometry:Zo(h,o,c),properties:h.properties,type:h.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(Xm("fill-extrusion",this.layers,C,this.zoom,n)):this.addFeature(C,C.geometry,_,o,{},n.availableImages,c),n.featureIndex.insert(h,C.geometry,_,y,this.index,A)}this.sortBorders()}addFeatures(e,n,o,c,h){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,n,o,c,h)}this.sortBorders()}update(e,n,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,I2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,A2.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,C2.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c,h,p,_){const y=[new me(0,0),new me(yt,yt)],v=_.projection,T=v.name==="globe",C=this.enableTerrain&&!T?new N0:null;T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Uy);const A=qm(n,500);for(let R=A.length-1;R>=0;R--){const V=A[R];(V.length===0||(M=V[0]).every(W=>W.x<=0)||M.every(W=>W.x>=yt)||M.every(W=>W.y<=0)||M.every(W=>W.y>=yt))&&A.splice(R,1)}var M;let P;if(T)P=j0(A,y,c);else{P=[];for(const R of A)P.push({polygon:R,bounds:y})}for(const R of P){const V=R.polygon;let W=0,ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Ce=0;Ce<V.length;Ce++){const Ie=V[Ce];if(Ie.length===0)continue;W+=Ie.length;let De=0;C&&C.startRing(Ie[0]);for(let Ne=0;Ne<Ie.length;Ne++){const Te=Ie[Ne];if(Ne>=1){const ze=Ie[Ne-1];if(!B2(Te,ze,R.bounds)){C&&C.append(Te,ze),ie.vertexLength+4>Ai.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ue=Te.sub(ze)._perp(),Ve=Ue.x/(Math.abs(Ue.x)+Math.abs(Ue.y)),Qe=Ue.y>0?1:0,Re=ze.dist(Te);De+Re>32768&&(De=0),qu(this.layoutVertexArray,Te.x,Te.y,Ve,Qe,0,0,De),qu(this.layoutVertexArray,Te.x,Te.y,Ve,Qe,0,1,De),De+=Re,qu(this.layoutVertexArray,ze.x,ze.y,Ve,Qe,0,0,De),qu(this.layoutVertexArray,ze.x,ze.y,Ve,Qe,0,1,De);const He=ie.vertexLength;if(this.indexArray.emplaceBack(He,He+2,He+1),this.indexArray.emplaceBack(He+1,He+2,He+3),ie.vertexLength+=4,ie.primitiveLength+=2,T){const St=this.layoutVertexExtArray,Mt=v.projectTilePoint(Te.x,Te.y,c),ht=v.projectTilePoint(ze.x,ze.y,c),nt=v.upVector(c,Te.x,Te.y),Dt=v.upVector(c,ze.x,ze.y);Wu(St,Mt,nt),Wu(St,Mt,nt),Wu(St,ht,Dt),Wu(St,ht,Dt)}}}}}if(ie.vertexLength+W>Ai.MAX_VERTEX_ARRAY_LENGTH&&(ie=this.segments.prepareSegment(W,this.layoutVertexArray,this.indexArray)),D2[e.type]!=="Polygon")continue;const te=[],ne=[],se=ie.vertexLength;for(let Ce=0;Ce<V.length;Ce++){const Ie=V[Ce];if(Ie.length!==0){Ie!==V[0]&&ne.push(te.length/2);for(let De=0;De<Ie.length;De++){const Ne=Ie[De];qu(this.layoutVertexArray,Ne.x,Ne.y,0,0,1,1,0),te.push(Ne.x),te.push(Ne.y),C&&C.currentPolyCount.top++,T&&Wu(this.layoutVertexExtArray,v.projectTilePoint(Ne.x,Ne.y,c),v.upVector(c,Ne.x,Ne.y))}}}const ce=gp(te,ne);for(let Ce=0;Ce<ce.length;Ce+=3)this.indexArray.emplaceBack(se+ce[Ce],se+ce[Ce+2],se+ce[Ce+1]);ie.primitiveLength+=ce.length/3,ie.vertexLength+=W}if(C&&C.polyCount.length>0){if(C.borders){C.vertexArrayOffset=this.centroidVertexArray.length;const R=C.borders,V=this.featuresOnBorder.push(C)-1;for(let W=0;W<4;W++)R[W][0]!==Number.MAX_VALUE&&this.borders[W].push(V)}this.encodeCentroid(C.borders?void 0:C.centroid(),C)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,p,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,n,o=!0){let c,h;if(e)if(e.y!==0){const _=n.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(_.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(_.y/10))}else c=Math.ceil(7*(e.x+450)),h=0;else c=0,h=+o;let p=o?this.centroidVertexArray.length:n.vertexArrayOffset;for(const _ of n.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*_.edges+_.top);for(let y=0;y<2*_.edges;y++)this.centroidVertexArray.emplace(p++,0,h),this.centroidVertexArray.emplace(p++,c,h);for(let y=0;y<_.top;y++)this.centroidVertexArray.emplace(p++,c,h)}}}function B2(i,e,n){return i.x===e.x&&(i.x<n[0].x||i.x>n[1].x)||i.y===e.y&&(i.y<n[0].y||i.y>n[1].y)}function U0(){const i=Math.PI/32,e=Math.tan(i),n=Am;return n*Math.sqrt(1+2*e*e)-n}function j0(i,e,n){const o=1<<n.z,c=vn(n.x/o),h=vn((n.x+1)/o),p=Pi(n.y/o),_=Pi((n.y+1)/o);return function(y,v,T,C,A=0,M){const P=[];if(!y.length||!T||!C)return P;const R=(ce,Ce)=>{for(const Ie of ce)P.push({polygon:Ie,bounds:Ce})},V=Math.ceil(Math.log2(T)),W=Math.ceil(Math.log2(C)),ie=V-W,te=[];for(let ce=0;ce<Math.abs(ie);ce++)te.push(ie>0?0:1);for(let ce=0;ce<Math.min(V,W);ce++)te.push(0),te.push(1);let ne=y;if(ne=Tp(ne,v[0].y-A,v[1].y+A,1),ne=Tp(ne,v[0].x-A,v[1].x+A,0),!ne.length)return P;const se=[];for(te.length?se.push({polygons:ne,bounds:v,depth:0}):R(ne,v);se.length;){const ce=se.pop(),Ce=ce.depth,Ie=te[Ce],De=ce.bounds[0],Ne=ce.bounds[1],Te=Ie===0?De.x:De.y,ze=Ie===0?Ne.x:Ne.y,Ue=M?M(Ie,Te,ze):.5*(Te+ze),Ve=Tp(ce.polygons,Te-A,Ue+A,Ie),Qe=Tp(ce.polygons,Ue-A,ze+A,Ie);if(Ve.length){const Re=[De,new me(Ie===0?Ue:Ne.x,Ie===1?Ue:Ne.y)];te.length>Ce+1?se.push({polygons:Ve,bounds:Re,depth:Ce+1}):R(Ve,Re)}if(Qe.length){const Re=[new me(Ie===0?Ue:De.x,Ie===1?Ue:De.y),Ne];te.length>Ce+1?se.push({polygons:Qe,bounds:Re,depth:Ce+1}):R(Qe,Re)}}return P}(i,e,Math.ceil((h-c)/11.25),Math.ceil((p-_)/11.25),1,(y,v,T)=>{if(y===0)return .5*(v+T);{const C=Pi((n.y+v/yt)/o);return($a(.5*(Pi((n.y+T/yt)/o)+C))*o-n.y)*yt}})}it(Xu,"FillExtrusionBucket",{omit:["layers","features"]}),it(N0,"PartMetadata");var R2={paint:new rt({"fill-extrusion-opacity":new xe(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ge(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xe(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xe(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new tt(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ge(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ge(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xe(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function V0(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Ep{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=Hu(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const o=function(h,p,_){var y=V0(256*h,256*(p=Math.pow(2,_)-p-1),_),v=V0(256*(h+1),256*(p+1),_);return y[0]+","+y[1]+","+v[0]+","+v[1]}(this.x,this.y,this.z),c=function(h,p,_){let y,v="";for(let T=h;T>0;T--)y=1<<T-1,v+=(p&y?1:0)+(_&y?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class G0{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Hu(e,n.z,n.z,n.x,n.y)}}class bn{constructor(e,n,o,c,h){this.overscaledZ=e,this.wrap=n,this.canonical=new Ep(o,+c,+h),this.key=n===0&&e===o?this.canonical.key:Hu(n,e,o,c,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new bn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Hu(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Hu(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new bn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new bn(n,this.wrap,n,o,c),new bn(n,this.wrap,n,o+1,c),new bn(n,this.wrap,n,o,c+1),new bn(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new bn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new bn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new G0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Hu(i,e,n,o,c){const h=1<<Math.min(n,22);let p=h*(c%h)+o%h;return i&&n<22&&(p+=h*h*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}function Yu(i,e){return i.x*e.x+i.y*e.y}function $0(i,e){if(i.length===1){let n=0;const o=e[n++];let c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const h=e[n],p=i[0],_=c.sub(o),y=h.sub(o),v=p.sub(o),T=Yu(_,_),C=Yu(_,y),A=Yu(y,y),M=Yu(v,_),P=Yu(v,y),R=T*A-C*C,V=(A*M-C*P)/R,W=(T*P-C*M)/R,ie=o.z*(1-V-W)+c.z*V+h.z*W;if(isFinite(ie))return ie}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}function Sp(i){const e=new me(i[0],i[1]);return e.z=i[2],e}function Z0(i,e,n,o,c,h,p,_){const y=p*c.getElevationAt(i,e,!0,!0),v=h[0]!==0,T=v?h[1]===0?p*(h[0]/7-450):p*function(C,A,M){const P=Math.floor(A[0]/8),R=Math.floor(A[1]/8),V=10*(A[0]-8*P),W=10*(A[1]-8*R),ie=C.getElevationAt(P,R,!0,!0),te=C.getMeterToDEM(M),ne=Math.floor(.5*(V*te-1)),se=Math.floor(.5*(W*te-1)),ce=C.tileCoordToPixel(P,R),Ce=2*ne+1,Ie=2*se+1,De=function(Qe,Re,He,St,Mt){return[Qe.getElevationAtPixel(Re,He,!0),Qe.getElevationAtPixel(Re+Mt,He,!0),Qe.getElevationAtPixel(Re,He+Mt,!0),Qe.getElevationAtPixel(Re+St,He+Mt,!0)]}(C,ce.x-ne,ce.y-se,Ce,Ie),Ne=Math.abs(De[0]-De[1]),Te=Math.abs(De[2]-De[3]),ze=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),Ue=Math.min(.25,.5*te*(Ne+Te)/Ce),Ve=Math.min(.25,.5*te*ze/Ie);return ie+Math.max(Ue*V,Ve*W)}(c,h,_):y;return{base:y+(n===0)?-1:n,top:v?Math.max(T+o,y+n+2):y+o}}it(Ep,"CanonicalTileID"),it(bn,"OverscaledTileID",{omit:["projMatrix"]});const F2=Ke([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:O2}=F2,N2=Ke([{name:"a_packed",components:4,type:"Float32"}]),{members:U2}=N2,j2=Ha.VectorTileFeature.types,V2=Math.cos(Math.PI/180*37.5);class Cp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new dn,this.layoutVertexArray2=new Xn,this.indexArray=new Ci,this.programConfigurations=new Va(e.layers,e.zoom),this.segments=new Ai,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o,c){this.hasPattern=Wm("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:T,id:C,index:A,sourceLayerIndex:M}of e){const P=this.layers[0]._featureFilter.needGeometry,R=Za(T,P);if(!this.layers[0]._featureFilter.filter(new Y(this.zoom),R,o))continue;const V=h?h.evaluate(R,{},o):void 0,W={id:C,properties:T.properties,type:T.type,sourceLayerIndex:M,index:A,geometry:P?R.geometry:Zo(T,o,c),patterns:{},sortKey:V};p.push(W)}h&&p.sort((T,C)=>T.sortKey-C.sortKey);const{lineAtlas:_,featureIndex:y}=n,v=this.addConstantDashes(_);for(const T of p){const{geometry:C,index:A,sourceLayerIndex:M}=T;if(v&&this.addFeatureDashes(T,_),this.hasPattern){const P=Xm("line",this.layers,T,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(T,C,A,o,_.positions,n.availableImages);y.insert(e[A].feature,C,A,M,this.index)}}addConstantDashes(e){let n=!1;for(const o of this.layers){const c=o.paint.get("line-dasharray").value,h=o.layout.get("line-cap").value;if(c.kind!=="constant"||h.kind!=="constant")n=!0;else{const p=h.value,_=c.value;if(!_)continue;e.addDash(_.from,p),e.addDash(_.to,p),_.other&&e.addDash(_.other,p)}}return n}addFeatureDashes(e,n){const o=this.zoom;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(h.kind==="constant"&&p.kind==="constant")continue;let _,y,v,T,C,A;if(h.kind==="constant"){const V=h.value;if(!V)continue;_=V.other||V.to,y=V.to,v=V.from}else _=h.evaluate({zoom:o-1},e),y=h.evaluate({zoom:o},e),v=h.evaluate({zoom:o+1},e);p.kind==="constant"?T=C=A=p.value:(T=p.evaluate({zoom:o-1},e),C=p.evaluate({zoom:o},e),A=p.evaluate({zoom:o+1},e)),n.addDash(_,T),n.addDash(y,C),n.addDash(v,A);const M=n.getKey(_,T),P=n.getKey(y,C),R=n.getKey(v,A);e.patterns[c.id]={min:M,mid:P,max:R}}}update(e,n,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o,c)}addFeatures(e,n,o,c,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,U2)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,O2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,h,p){const _=this.layers[0].layout,y=_.get("line-join").evaluate(e,{}),v=_.get("line-cap").evaluate(e,{}),T=_.get("line-miter-limit"),C=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of n)this.addLine(A,e,y,v,T,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,p,c)}addLine(e,n,o,c,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let W=0;W<e.length-1;W++)this.totalDistance+=e[W].dist(e[W+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=j2[n.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let v=0;for(;v<y-1&&e[v].equals(e[v+1]);)v++;if(y<(_?3:2))return;o==="bevel"&&(h=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let A,M,P,R,V;this.e1=this.e2=-1,_&&(A=e[y-2],V=e[v].sub(A)._unit()._perp());for(let W=v;W<y;W++){if(P=W===y-1?_?e[v+1]:void 0:e[W+1],P&&e[W].equals(P))continue;V&&(R=V),A&&(M=A),A=e[W],V=P?P.sub(A)._unit()._perp():R,R=R||V;let ie=R.add(V);ie.x===0&&ie.y===0||ie._unit();const te=R.x*V.x+R.y*V.y,ne=ie.x*V.x+ie.y*V.y,se=ne!==0?1/ne:1/0,ce=2*Math.sqrt(2-2*ne),Ce=ne<V2&&M&&P,Ie=R.x*V.y-R.y*V.x>0;if(Ce&&W>v){const Te=A.dist(M);if(Te>2*T){const ze=A.sub(A.sub(M)._mult(T/Te)._round());this.updateDistance(M,ze),this.addCurrentVertex(ze,R,0,0,C),M=ze}}const De=M&&P;let Ne=De?o:_?"butt":c;if(De&&Ne==="round"&&(se<p?Ne="miter":se<=2&&(Ne="fakeround")),Ne==="miter"&&se>h&&(Ne="bevel"),Ne==="bevel"&&(se>2&&(Ne="flipbevel"),se<h&&(Ne="miter")),M&&this.updateDistance(M,A),Ne==="miter")ie._mult(se),this.addCurrentVertex(A,ie,0,0,C);else if(Ne==="flipbevel"){if(se>100)ie=V.mult(-1);else{const Te=se*R.add(V).mag()/R.sub(V).mag();ie._perp()._mult(Te*(Ie?-1:1))}this.addCurrentVertex(A,ie,0,0,C),this.addCurrentVertex(A,ie.mult(-1),0,0,C)}else if(Ne==="bevel"||Ne==="fakeround"){const Te=-Math.sqrt(se*se-1),ze=Ie?Te:0,Ue=Ie?0:Te;if(M&&this.addCurrentVertex(A,R,ze,Ue,C),Ne==="fakeround"){const Ve=Math.round(180*ce/Math.PI/20);for(let Qe=1;Qe<Ve;Qe++){let Re=Qe/Ve;if(Re!==.5){const St=Re-.5;Re+=Re*St*(Re-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*St*St+(.848013+te*(.215638*te-1.06021)))}const He=V.sub(R)._mult(Re)._add(R)._unit()._mult(Ie?-1:1);this.addHalfVertex(A,He.x,He.y,!1,Ie,0,C)}}P&&this.addCurrentVertex(A,V,-ze,-Ue,C)}else if(Ne==="butt")this.addCurrentVertex(A,ie,0,0,C);else if(Ne==="square"){const Te=M?1:-1;M||this.addCurrentVertex(A,ie,Te,Te,C),this.addCurrentVertex(A,ie,0,0,C),M&&this.addCurrentVertex(A,ie,Te,Te,C)}else Ne==="round"&&(M&&(this.addCurrentVertex(A,R,0,0,C),this.addCurrentVertex(A,R,1,1,C,!0)),P&&(this.addCurrentVertex(A,V,-1,-1,C,!0),this.addCurrentVertex(A,V,0,0,C)));if(Ce&&W<y-1){const Te=A.dist(P);if(Te>2*T){const ze=A.add(P.sub(A)._mult(T/Te)._round());this.updateDistance(A,ze),this.addCurrentVertex(ze,V,0,0,C),A=ze}}}}addCurrentVertex(e,n,o,c,h,p=!1){const _=n.y*c-n.x,y=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,p,!1,o,h),this.addHalfVertex(e,_,y,p,!0,-c,h)}addHalfVertex({x:e,y:n},o,c,h,p,_,y){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(n<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),y.primitiveLength++),p?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}it(Cp,"LineBucket",{omit:["layers","patternFeatures"]});const G2=new rt({"line-cap":new ge(fe.layout_line["line-cap"]),"line-join":new ge(fe.layout_line["line-join"]),"line-miter-limit":new xe(fe.layout_line["line-miter-limit"]),"line-round-limit":new xe(fe.layout_line["line-round-limit"]),"line-sort-key":new ge(fe.layout_line["line-sort-key"])});var q0={paint:new rt({"line-opacity":new ge(fe.paint_line["line-opacity"]),"line-color":new ge(fe.paint_line["line-color"]),"line-translate":new xe(fe.paint_line["line-translate"]),"line-translate-anchor":new xe(fe.paint_line["line-translate-anchor"]),"line-width":new ge(fe.paint_line["line-width"]),"line-gap-width":new ge(fe.paint_line["line-gap-width"]),"line-offset":new ge(fe.paint_line["line-offset"]),"line-blur":new ge(fe.paint_line["line-blur"]),"line-dasharray":new tt(fe.paint_line["line-dasharray"]),"line-pattern":new tt(fe.paint_line["line-pattern"]),"line-gradient":new qe(fe.paint_line["line-gradient"]),"line-trim-offset":new xe(fe.paint_line["line-trim-offset"])}),layout:G2};const W0=new class extends ge{possiblyEvaluate(i,e){return e=new Y(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,n,o){return e=vt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,n,o)}}(q0.paint.properties["line-width"].specification);function X0(i,e){return e>0?e+2*i:i}W0.useIntegerZoom=!0;const $2=Ke([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Z2=Ke([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),q2=Ke([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ke([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const W2=Ke([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),X2=Ke([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ke([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const H0=Ke([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),H2=Ke([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ke([{name:"triangle",components:3,type:"Uint16"}]),Ke([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ke([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ke([{type:"Float32",name:"offsetX"}]),Ke([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var an=24;const mo=128;function Hm(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Y(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let h=0;for(;h<o.length&&o[h]<=i;)h++;h=Math.max(0,h-1);let p=h;for(;p<o.length&&o[p]<i+1;)p++;p=Math.min(o.length-1,p);const _=o[h],y=o[p];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:y,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:y,minSize:n.evaluate(new Y(_)),maxSize:n.evaluate(new Y(y)),interpolationType:c}}}function Ap(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return i.kind==="source"?o/mo:i.kind==="composite"?Ot(o/mo,c/mo,n):e}function _c(i,e){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:h,maxZoom:p}=i,_=c?Fe(br.interpolationFactor(c,e,h,p),0,1):0;i.kind==="camera"?o=Ot(i.minSize,i.maxSize,_):n=_}return{uSizeT:n,uSize:o}}var Y2=Object.freeze({__proto__:null,getSizeData:Hm,evaluateSizeForFeature:Ap,evaluateSizeForZoom:_c,SIZE_PACK_FACTOR:mo});function K2(i,e,n){return i.sections.forEach(o=>{o.text=function(c,h,p){const _=h.layout.get("text-transform").evaluate(p,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),Z.applyArabicShaping&&(c=Z.applyArabicShaping(c)),c}(o.text,e,n)}),i}const Ku={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function J2(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function Q2(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var Y0=function(i,e,n,o,c){var h,p,_=8*c-o-1,y=(1<<_)-1,v=y>>1,T=-7,C=n?c-1:0,A=n?-1:1,M=i[e+C];for(C+=A,h=M&(1<<-T)-1,M>>=-T,T+=_;T>0;h=256*h+i[e+C],C+=A,T-=8);for(p=h&(1<<-T)-1,h>>=-T,T+=o;T>0;p=256*p+i[e+C],C+=A,T-=8);if(h===0)h=1-v;else{if(h===y)return p?NaN:1/0*(M?-1:1);p+=Math.pow(2,o),h-=v}return(M?-1:1)*p*Math.pow(2,h-o)},K0=function(i,e,n,o,c,h){var p,_,y,v=8*h-c-1,T=(1<<v)-1,C=T>>1,A=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=o?0:h-1,P=o?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+C>=1?A/y:A*Math.pow(2,1-C))*y>=2&&(p++,y/=2),p+C>=T?(_=0,p=T):p+C>=1?(_=(e*y-1)*Math.pow(2,c),p+=C):(_=e*Math.pow(2,C-1)*Math.pow(2,c),p=0));c>=8;i[n+M]=255&_,M+=P,_/=256,c-=8);for(p=p<<c|_,v+=c;v>0;i[n+M]=255&p,M+=P,p/=256,v-=8);i[n+M-P]|=128*R},Ju=ei;function ei(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ei.Varint=0,ei.Fixed64=1,ei.Bytes=2,ei.Fixed32=5;var Ym=4294967296,J0=1/Ym,Q0=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Wo(i){return i.type===ei.Bytes?i.readVarint()+i.pos:i.pos+1}function gc(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function ex(i,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=i;c--)n.buf[c+o]=n.buf[c]}function eT(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function tT(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function iT(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function nT(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function rT(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function oT(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function sT(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function aT(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function lT(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function Ip(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function yc(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function tx(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function cT(i,e,n){e.glyphs=[],i===1&&n.readMessage(uT,e)}function uT(i,e,n){if(i===3){const{id:o,bitmap:c,width:h,height:p,left:_,top:y,advance:v}=n.readMessage(hT,{});e.glyphs.push({id:o,bitmap:new qo({width:h+6,height:p+6},c),metrics:{width:h,height:p,left:_,top:y,advance:v}})}else i===4?e.ascender=n.readSVarint():i===5&&(e.descender=n.readSVarint())}function hT(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function Km(i){let e=0,n=0;for(const p of i)e+=p.w*p.h,n=Math.max(n,p.w);i.sort((p,_)=>_.h-p.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,h=0;for(const p of i)for(let _=o.length-1;_>=0;_--){const y=o[_];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,h=Math.max(h,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===y.w&&p.h===y.h){const v=o.pop();_<o.length&&(o[_]=v)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(o.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:c,h,fill:e/(c*h)||0}}ei.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,h=this.pos;this.type=7&o,i(c,e,this),this.pos===h&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Ip(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=tx(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Ip(this.buf,this.pos)+Ip(this.buf,this.pos+4)*Ym;return this.pos+=8,i},readSFixed64:function(){var i=Ip(this.buf,this.pos)+tx(this.buf,this.pos+4)*Ym;return this.pos+=8,i},readFloat:function(){var i=Y0(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Y0(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,h,p){var _,y,v=p.buf;if(_=(112&(y=v[p.pos++]))>>4,y<128||(_|=(127&(y=v[p.pos++]))<<3,y<128)||(_|=(127&(y=v[p.pos++]))<<10,y<128)||(_|=(127&(y=v[p.pos++]))<<17,y<128)||(_|=(127&(y=v[p.pos++]))<<24,y<128)||(_|=(1&(y=v[p.pos++]))<<31,y<128))return gc(c,_,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Q0?function(n,o,c){return Q0.decode(n.subarray(o,c))}(this.buf,e,i):function(n,o,c){for(var h="",p=o;p<c;){var _,y,v,T=n[p],C=null,A=T>239?4:T>223?3:T>191?2:1;if(p+A>c)break;A===1?T<128&&(C=T):A===2?(192&(_=n[p+1]))==128&&(C=(31&T)<<6|63&_)<=127&&(C=null):A===3?(y=n[p+2],(192&(_=n[p+1]))==128&&(192&y)==128&&((C=(15&T)<<12|(63&_)<<6|63&y)<=2047||C>=55296&&C<=57343)&&(C=null)):A===4&&(y=n[p+2],v=n[p+3],(192&(_=n[p+1]))==128&&(192&y)==128&&(192&v)==128&&((C=(15&T)<<18|(63&_)<<12|(63&y)<<6|63&v)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,A=1):C>65535&&(C-=65536,h+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),h+=String.fromCharCode(C),p+=A}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==ei.Bytes)return i.push(this.readVarint(e));var n=Wo(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==ei.Bytes)return i.push(this.readSVarint());var e=Wo(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ei.Bytes)return i.push(this.readBoolean());var e=Wo(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ei.Bytes)return i.push(this.readFloat());var e=Wo(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ei.Bytes)return i.push(this.readDouble());var e=Wo(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ei.Bytes)return i.push(this.readFixed32());var e=Wo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ei.Bytes)return i.push(this.readSFixed32());var e=Wo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ei.Bytes)return i.push(this.readFixed64());var e=Wo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ei.Bytes)return i.push(this.readSFixed64());var e=Wo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===ei.Varint)for(;this.buf[this.pos++]>127;);else if(e===ei.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ei.Fixed32)this.pos+=4;else{if(e!==ei.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),yc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),yc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),yc(this.buf,-1&i,this.pos),yc(this.buf,Math.floor(i*J0),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),yc(this.buf,-1&i,this.pos),yc(this.buf,Math.floor(i*J0),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(h,p,_){_.buf[_.pos++]=127&h|128,h>>>=7,_.buf[_.pos++]=127&h|128,h>>>=7,_.buf[_.pos++]=127&h|128,h>>>=7,_.buf[_.pos++]=127&h|128,_.buf[_.pos]=127&(h>>>=7)}(o,0,n),function(h,p){var _=(7&h)<<4;p.buf[p.pos++]|=_|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(c,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,c,h){for(var p,_,y=0;y<c.length;y++){if((p=c.charCodeAt(y))>55295&&p<57344){if(!_){p>56319||y+1===c.length?(o[h++]=239,o[h++]=191,o[h++]=189):_=p;continue}if(p<56320){o[h++]=239,o[h++]=191,o[h++]=189,_=p;continue}p=_-55296<<10|p-56320|65536,_=null}else _&&(o[h++]=239,o[h++]=191,o[h++]=189,_=null);p<128?o[h++]=p:(p<2048?o[h++]=p>>6|192:(p<65536?o[h++]=p>>12|224:(o[h++]=p>>18|240,o[h++]=p>>12&63|128),o[h++]=p>>6&63|128),o[h++]=63&p|128)}return h}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&ex(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),K0(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),K0(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var o=this.pos-n;o>=128&&ex(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,n){this.writeTag(i,ei.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,eT,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,tT,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,rT,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,iT,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,nT,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,oT,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,sT,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,aT,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,lT,e)},writeBytesField:function(i,e){this.writeTag(i,ei.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,ei.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,ei.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,ei.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,ei.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,ei.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,ei.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,ei.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,ei.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,ei.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Jm{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=h,this.content=p,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ix{constructor(e,n){const o={},c={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,o,h),this.addImages(n,c,h);const{w:p,h:_}=Km(h),y=new Jn({width:p||1,height:_||1});for(const v in e){const T=e[v],C=o[v].paddedRect;Jn.copy(T.data,y,{x:0,y:0},{x:C.x+1,y:C.y+1},T.data)}for(const v in n){const T=n[v],C=c[v].paddedRect,A=C.x+1,M=C.y+1,P=T.data.width,R=T.data.height;Jn.copy(T.data,y,{x:0,y:0},{x:A,y:M},T.data),Jn.copy(T.data,y,{x:0,y:R-1},{x:A,y:M-1},{width:P,height:1}),Jn.copy(T.data,y,{x:0,y:0},{x:A,y:M+R},{width:P,height:1}),Jn.copy(T.data,y,{x:P-1,y:0},{x:A-1,y:M},{width:1,height:R}),Jn.copy(T.data,y,{x:0,y:0},{x:A+P,y:M},{width:1,height:R})}this.image=y,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(const c in e){const h=e[c],p={x:0,y:0,w:h.data.width+2,h:h.data.height+2};o.push(p),n[c]=new Jm(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>e.hasImage(o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,h]=e.tl;o.update(n.data,void 0,{x:c,y:h})}}it(Jm,"ImagePosition"),it(ix,"ImageAtlas");const pr={horizontal:1,vertical:2,horizontalOnly:3};class Qu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new Qu;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new Qu;return n.imageName=e,n}}class xc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new xc;for(let c=0;c<e.sections.length;c++){const h=e.sections[c];h.image?o.addImageSection(h):o.addTextSection(h,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,o){let c="";for(let h=0;h<n.length;h++){const p=n.charCodeAt(h+1)||null,_=n.charCodeAt(h-1)||null;c+=!o&&(p&&w(p)&&!Ku[n[h+1]]||_&&w(_)&&!Ku[n[h-1]])||!Ku[n[h]]?n[h]:Ku[n[h]]}return c}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&kp[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&kp[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new xc;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Qu.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Pt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Qu.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Pt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Qm(i,e,n,o,c,h,p,_,y,v,T,C,A,M,P,R){const V=xc.fromFeature(i,c);let W;C===pr.vertical&&V.verticalizePunctuation(A);const{processBidirectionalText:ie,processStyledBidirectionalText:te}=Z;if(ie&&V.sections.length===1){W=[];const ce=ie(V.toString(),e_(V,v,h,e,o,M,P));for(const Ce of ce){const Ie=new xc;Ie.text=Ce,Ie.sections=V.sections;for(let De=0;De<Ce.length;De++)Ie.sectionIndex.push(0);W.push(Ie)}}else if(te){W=[];const ce=te(V.text,V.sectionIndex,e_(V,v,h,e,o,M,P));for(const Ce of ce){const Ie=new xc;Ie.text=Ce[0],Ie.sectionIndex=Ce[1],Ie.sections=V.sections,W.push(Ie)}}else W=function(ce,Ce){const Ie=[],De=ce.text;let Ne=0;for(const Te of Ce)Ie.push(ce.substring(Ne,Te)),Ne=Te;return Ne<De.length&&Ie.push(ce.substring(Ne,De.length)),Ie}(V,e_(V,v,h,e,o,M,P));const ne=[],se={positionedLines:ne,text:V.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ce,Ce,Ie,De,Ne,Te,ze,Ue,Ve,Qe,Re,He){let St=0,Mt=0,ht=0;const nt=Ue==="right"?1:Ue==="left"?0:.5;let Dt=!1;for(const Lt of Ne){const jt=Lt.getSections();for(const ti of jt){if(ti.imageName)continue;const Qt=Ce[ti.fontStack];if(Qt&&(Dt=Qt.ascender!==void 0&&Qt.descender!==void 0,!Dt))break}if(!Dt)break}let At=0;for(const Lt of Ne){Lt.trim();const jt=Lt.getMaxScale(),ti=(jt-1)*an,Qt={positionedGlyphs:[],lineOffset:0};ce.positionedLines[At]=Qt;const Yt=Qt.positionedGlyphs;let li=0;if(!Lt.length()){Mt+=Te,++At;continue}let fi=0,Ki=0;for(let Rt=0;Rt<Lt.length();Rt++){const wi=Lt.getSection(Rt),pn=Lt.getSectionIndex(Rt),qt=Lt.getCharCode(Rt);let mi=wi.scale,En=null,ui=null,ki=null,Ji=an,Gi=0;const ln=!(Ve===pr.horizontal||!Re&&!g(qt)||Re&&(kp[qt]||(lt=qt,qd(lt)||Wd(lt)||Fa(lt)||Ru(lt)||u(lt))));if(wi.imageName){const Sn=De[wi.imageName];if(!Sn)continue;ki=wi.imageName,ce.iconsInText=ce.iconsInText||!0,ui=Sn.paddedRect;const Qi=Sn.displaySize;mi=mi*an/He,En={width:Qi[0],height:Qi[1],left:1,top:-3,advance:ln?Qi[1]:Qi[0],localGlyph:!1},Gi=Dt?-En.height*mi:jt*an-17-Qi[1]*mi,Ji=En.advance;const Ho=(ln?Qi[0]:Qi[1])*mi-an*jt;Ho>0&&Ho>li&&(li=Ho)}else{const Sn=Ie[wi.fontStack];if(!Sn)continue;Sn[qt]&&(ui=Sn[qt]);const Qi=Ce[wi.fontStack];if(!Qi)continue;const Ho=Qi.glyphs[qt];if(!Ho)continue;if(En=Ho.metrics,Ji=qt!==8203?an:0,Dt){const Sc=Qi.ascender!==void 0?Math.abs(Qi.ascender):0,ch=Qi.descender!==void 0?Math.abs(Qi.descender):0,uh=(Sc+ch)*mi;fi<uh&&(fi=uh,Ki=(Sc-ch)/2*mi),Gi=-Sc*mi}else Gi=(jt-mi)*an-17}ln?(ce.verticalizable=!0,Yt.push({glyph:qt,imageName:ki,x:St,y:Mt+Gi,vertical:ln,scale:mi,localGlyph:En.localGlyph,fontStack:wi.fontStack,sectionIndex:pn,metrics:En,rect:ui}),St+=Ji*mi+Qe):(Yt.push({glyph:qt,imageName:ki,x:St,y:Mt+Gi,vertical:ln,scale:mi,localGlyph:En.localGlyph,fontStack:wi.fontStack,sectionIndex:pn,metrics:En,rect:ui}),St+=En.advance*mi+Qe)}Yt.length!==0&&(ht=Math.max(St-Qe,ht),Dt?ax(Yt,nt,li,Ki,Te*jt/2):ax(Yt,nt,li,0,Te/2)),St=0;const Bn=Te*jt+li;Qt.lineOffset=Math.max(li,ti),Mt+=Bn,++At}var lt;const Ui=Mt,{horizontalAlign:Ii,verticalAlign:vi}=t_(ze);(function(Lt,jt,ti,Qt,Yt,li){const fi=(jt-ti)*Yt,Ki=-li*Qt;for(const Bn of Lt)for(const Rt of Bn.positionedGlyphs)Rt.x+=fi,Rt.y+=Ki})(ce.positionedLines,nt,Ii,vi,ht,Ui),ce.top+=-vi*Ui,ce.bottom=ce.top+Ui,ce.left+=-Ii*ht,ce.right=ce.left+ht,ce.hasBaseline=Dt}(se,e,n,o,W,p,_,y,C,v,A,R),!function(ce){for(const Ce of ce)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(ne)&&se}const kp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function nx(i,e,n,o,c,h){if(e.imageName){const p=o[e.imageName];return p?p.displaySize[0]*e.scale*an/h+c:0}{const p=n[e.fontStack],_=p&&p.glyphs[i];return _?_.metrics.advance*e.scale+c:0}}function rx(i,e,n,o){const c=Math.pow(i-e,2);return o?i<e?c/2:2*c:c+Math.abs(n)*n}function pT(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function ox(i,e,n,o,c,h){let p=null,_=rx(e,n,c,h);for(const y of o){const v=rx(e-y.x,n,c,h)+y.badness;v<=_&&(p=y,_=v)}return{index:i,x:e,priorBreak:p,badness:_}}function sx(i){return i?sx(i.priorBreak).concat(i.index):[]}function e_(i,e,n,o,c,h,p){if(h!=="point")return[];if(!i)return[];const _=[],y=function(A,M,P,R,V,W){let ie=0;for(let te=0;te<A.length();te++){const ne=A.getSection(te);ie+=nx(A.getCharCode(te),ne,R,V,M,W)}return ie/Math.max(1,Math.ceil(ie/P))}(i,e,n,o,c,p),v=i.text.indexOf("\u200B")>=0;let T=0;for(let A=0;A<i.length();A++){const M=i.getSection(A),P=i.getCharCode(A);if(kp[P]||(T+=nx(P,M,o,c,e,p)),A<i.length()-1){const R=!((C=P)<11904||!(oc(C)||Lu(C)||lc(C)||Es(C)||Jd(C)||Xd(C)||sc(C)||Oa(C)||ac(C)||Bu(C)||Kd(C)||t(C)||rc(C)||Hd(C)||Du(C)||Yd(C)||Na(C)||ip(C)||ep(C)||Qd(C)));(dT[P]||R||M.imageName)&&_.push(ox(A+1,T,y,_,pT(P,i.getCharCode(A+1),R&&v),!1))}}var C;return sx(ox(i.length(),T,y,_,0,!0))}function t_(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function ax(i,e,n,o,c){if(!(e||n||o||c))return;const h=i.length-1,p=i[h],_=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=h;y++)i[y].x-=_,i[y].y+=n+o+c}function fT(i,e,n){const{horizontalAlign:o,verticalAlign:c}=t_(n),h=e[0]-i.displaySize[0]*o,p=e[1]-i.displaySize[1]*c;return{image:i,top:p,bottom:p+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function lx(i,e,n,o,c,h){const p=i.image;let _;if(p.content){const V=p.content,W=p.pixelRatio||1;_=[V[0]/W,V[1]/W,p.displaySize[0]-V[2]/W,p.displaySize[1]-V[3]/W]}const y=e.left*h,v=e.right*h;let T,C,A,M;n==="width"||n==="both"?(M=c[0]+y-o[3],C=c[0]+v+o[1]):(M=c[0]+(y+v-p.displaySize[0])/2,C=M+p.displaySize[0]);const P=e.top*h,R=e.bottom*h;return n==="height"||n==="both"?(T=c[1]+P-o[0],A=c[1]+R+o[2]):(T=c[1]+(P+R-p.displaySize[1])/2,A=T+p.displaySize[1]),{image:p,top:T,right:C,bottom:A,left:M,collisionPadding:_}}class Xo extends me{constructor(e,n,o,c,h){super(e,n),this.angle=c,this.z=o,h!==void 0&&(this.segment=h)}clone(){return new Xo(this.x,this.y,this.z,this.angle,this.segment)}}function cx(i,e,n,o,c){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,_=0;for(;_>-n/2;){if(p--,p<0)return!1;_-=i[p].dist(h),h=i[p]}_+=i[p].dist(i[p+1]),p++;const y=[];let v=0;for(;_<n/2;){const T=i[p],C=i[p+1];if(!C)return!1;let A=i[p-1].angleTo(T)-T.angleTo(C);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:_,angleDelta:A}),v+=A;_-y[0].distance>o;)v-=y.shift().angleDelta;if(v>c)return!1;p++,_+=T.dist(C)}return!0}function ux(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function hx(i,e,n){return i?.6*e*n:0}function dx(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function mT(i,e,n,o,c,h){const p=hx(n,c,h),_=dx(n,o)*h;let y=0;const v=ux(i)/2;for(let T=0;T<i.length-1;T++){const C=i[T],A=i[T+1],M=C.dist(A);if(y+M>v){const P=(v-y)/M,R=Ot(C.x,A.x,P),V=Ot(C.y,A.y,P),W=new Xo(R,V,0,A.angleTo(C),T);return!p||cx(i,W,_,p,e)?W:void 0}y+=M}}function _T(i,e,n,o,c,h,p,_,y){const v=hx(o,h,p),T=dx(o,c),C=T*p,A=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-C<e/4&&(e=C+e/4),px(i,A?e/2*_%e:(T/2+2*h)*p*_%e,e,v,n,C,A,!1,y)}function px(i,e,n,o,c,h,p,_,y){const v=h/2,T=ux(i);let C=0,A=e-n,M=[];for(let P=0;P<i.length-1;P++){const R=i[P],V=i[P+1],W=R.dist(V),ie=V.angleTo(R);for(;A+n<C+W;){A+=n;const te=(A-C)/W,ne=Ot(R.x,V.x,te),se=Ot(R.y,V.y,te);if(ne>=0&&ne<y&&se>=0&&se<y&&A-v>=0&&A+v<=T){const ce=new Xo(ne,se,0,ie,P);ce._round(),o&&!cx(i,ce,h,o,c)||M.push(ce)}}C+=W}return _||M.length||p||(M=px(i,C/2,n,o,c,h,p,!0,y)),M}function fx(i,e,n,o,c){const h=[];for(let p=0;p<i.length;p++){const _=i[p];let y;for(let v=0;v<_.length-1;v++){let T=_[v],C=_[v+1];T.x<e&&C.x<e||(T.x<e?T=new me(e,T.y+(e-T.x)/(C.x-T.x)*(C.y-T.y))._round():C.x<e&&(C=new me(e,T.y+(e-T.x)/(C.x-T.x)*(C.y-T.y))._round()),T.y<n&&C.y<n||(T.y<n?T=new me(T.x+(n-T.y)/(C.y-T.y)*(C.x-T.x),n)._round():C.y<n&&(C=new me(T.x+(n-T.y)/(C.y-T.y)*(C.x-T.x),n)._round()),T.x>=o&&C.x>=o||(T.x>=o?T=new me(o,T.y+(o-T.x)/(C.x-T.x)*(C.y-T.y))._round():C.x>=o&&(C=new me(o,T.y+(o-T.x)/(C.x-T.x)*(C.y-T.y))._round()),T.y>=c&&C.y>=c||(T.y>=c?T=new me(T.x+(c-T.y)/(C.y-T.y)*(C.x-T.x),c)._round():C.y>=c&&(C=new me(T.x+(c-T.y)/(C.y-T.y)*(C.x-T.x),c)._round()),y&&T.equals(y[y.length-1])||(y=[T],h.push(y)),y.push(C)))))}}return h}it(Xo,"Anchor");const eh=1e20;function mx(i,e,n,o,c,h,p,_,y){for(let v=e;v<e+o;v++)_x(i,n*h+v,h,c,p,_,y);for(let v=n;v<n+c;v++)_x(i,v*h+e,1,o,p,_,y)}function _x(i,e,n,o,c,h,p){h[0]=0,p[0]=-eh,p[1]=eh,c[0]=i[e];for(let _=1,y=0,v=0;_<o;_++){c[_]=i[e+_*n];const T=_*_;do{const C=h[y];v=(c[_]-c[C]+T-C*C)/(_-C)/2}while(v<=p[y]&&--y>-1);y++,h[y]=_,p[y]=v,p[y+1]=eh}for(let _=0,y=0;_<o;_++){for(;p[y+1]<_;)y++;const v=h[y],T=_-v;i[e+_*n]=c[v]+T*T}}const i_={none:0,ideographs:1,all:2};class vc{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const o=[];for(const c in e)for(const h of e[c])o.push({stack:c,id:h});_t(o,({stack:c,id:h},p)=>{let _=this.entries[c];_||(_=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=_.glyphs[h];if(y!==void 0)return void p(null,{stack:c,id:h,glyph:y});if(y=this._tinySDF(_,c,h),y)return _.glyphs[h]=y,void p(null,{stack:c,id:h,glyph:y});const v=Math.floor(h/256);if(256*v>65535)return void p(new Error("glyphs > 65535 not supported"));if(_.ranges[v])return void p(null,{stack:c,id:h,glyph:y});let T=_.requests[v];T||(T=_.requests[v]=[],vc.loadGlyphRange(c,v,this.url,this.requestManager,(C,A)=>{if(A){_.ascender=A.ascender,_.descender=A.descender;for(const M in A.glyphs)this._doesCharSupportLocalGlyph(+M)||(_.glyphs[+M]=A.glyphs[+M]);_.ranges[v]=!0}for(const M of T)M(C,A);delete _.requests[v]})),T.push((C,A)=>{C?p(C):A&&p(null,{stack:c,id:h,glyph:A.glyphs[h]||null})})},(c,h)=>{if(c)n(c);else if(h){const p={};for(const{stack:_,id:y,glyph:v}of h)p[_]===void 0&&(p[_]={}),p[_].glyphs===void 0&&(p[_].glyphs={}),p[_].glyphs[y]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics},p[_].ascender=this.entries[_].ascender,p[_].descender=this.entries[_].descender;n(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==i_.none&&(this.localGlyphMode===i_.all?!!this.localFontFamily:!!this.localFontFamily&&(Bu(e)||tp(e)||rc(e)||Na(e)||Oa(e)))}_tinySDF(e,n,o){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let h=e.tinySDF;if(!h){let R="400";/bold/i.test(n)?R="900":/medium/i.test(n)?R="500":/light/i.test(n)&&(R="200"),h=e.tinySDF=new vc.TinySDF({fontFamily:c,fontWeight:R,fontSize:48,buffer:6,radius:16}),h.fontWeight=R}if(this.localGlyphs[h.fontWeight][o])return this.localGlyphs[h.fontWeight][o];const p=String.fromCharCode(o),{data:_,width:y,height:v,glyphWidth:T,glyphHeight:C,glyphLeft:A,glyphTop:M,glyphAdvance:P}=h.draw(p);return this.localGlyphs[h.fontWeight][o]={id:o,bitmap:new qo({width:y,height:v},_),metrics:{width:T/2,height:C/2,left:A/2,top:M/2-27,advance:P/2,localGlyph:!0}}}}function gx(i,e,n,o){const c=[],h=i.image,p=h.pixelRatio,_=h.paddedRect.w-2,y=h.paddedRect.h-2,v=i.right-i.left,T=i.bottom-i.top,C=h.stretchX||[[0,_]],A=h.stretchY||[[0,y]],M=(Te,ze)=>Te+ze[1]-ze[0],P=C.reduce(M,0),R=A.reduce(M,0),V=_-P,W=y-R;let ie=0,te=P,ne=0,se=R,ce=0,Ce=V,Ie=0,De=W;if(h.content&&o){const Te=h.content;ie=Mp(C,0,Te[0]),ne=Mp(A,0,Te[1]),te=Mp(C,Te[0],Te[2]),se=Mp(A,Te[1],Te[3]),ce=Te[0]-ie,Ie=Te[1]-ne,Ce=Te[2]-Te[0]-te,De=Te[3]-Te[1]-se}const Ne=(Te,ze,Ue,Ve)=>{const Qe=zp(Te.stretch-ie,te,v,i.left),Re=Pp(Te.fixed-ce,Ce,Te.stretch,P),He=zp(ze.stretch-ne,se,T,i.top),St=Pp(ze.fixed-Ie,De,ze.stretch,R),Mt=zp(Ue.stretch-ie,te,v,i.left),ht=Pp(Ue.fixed-ce,Ce,Ue.stretch,P),nt=zp(Ve.stretch-ne,se,T,i.top),Dt=Pp(Ve.fixed-Ie,De,Ve.stretch,R),At=new me(Qe,He),lt=new me(Mt,He),Ui=new me(Mt,nt),Ii=new me(Qe,nt),vi=new me(Re/p,St/p),Lt=new me(ht/p,Dt/p),jt=e*Math.PI/180;if(jt){const Yt=Math.sin(jt),li=Math.cos(jt),fi=[li,-Yt,Yt,li];At._matMult(fi),lt._matMult(fi),Ii._matMult(fi),Ui._matMult(fi)}const ti=Te.stretch+Te.fixed,Qt=ze.stretch+ze.fixed;return{tl:At,tr:lt,bl:Ii,br:Ui,tex:{x:h.paddedRect.x+1+ti,y:h.paddedRect.y+1+Qt,w:Ue.stretch+Ue.fixed-ti,h:Ve.stretch+Ve.fixed-Qt},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vi,pixelOffsetBR:Lt,minFontScaleX:Ce/p/v,minFontScaleY:De/p/T,isSDF:n}};if(o&&(h.stretchX||h.stretchY)){const Te=yx(C,V,P),ze=yx(A,W,R);for(let Ue=0;Ue<Te.length-1;Ue++){const Ve=Te[Ue],Qe=Te[Ue+1];for(let Re=0;Re<ze.length-1;Re++)c.push(Ne(Ve,ze[Re],Qe,ze[Re+1]))}}else c.push(Ne({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:y+1}));return c}function Mp(i,e,n){let o=0;for(const c of i)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function yx(i,e,n){const o=[{fixed:-1,stretch:0}];for(const[c,h]of i){const p=o[o.length-1];o.push({fixed:c-p.stretch,stretch:p.stretch}),o.push({fixed:c-p.stretch,stretch:p.stretch+(h-c)})}return o.push({fixed:e+1,stretch:n}),o}function zp(i,e,n,o){return i/e*n+o}function Pp(i,e,n,o){return i-e*n/o}function gT(i,e,n,o){const c=e+i.positionedLines[o].lineOffset;return o===0?n+c/2:n+(c+(e+i.positionedLines[o-1].lineOffset))/2}vc.loadGlyphRange=function(i,e,n,o,c){const h=256*e,p=h+255,_=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${h}-${p}`),Q.Glyphs);le(_,(y,v)=>{if(y)c(y);else if(v){const T={},C=function(A){return new Ju(A).readFields(cT,{})}(v);for(const A of C.glyphs)T[A.id]=A;c(null,{glyphs:T,ascender:C.ascender,descender:C.descender})}})},vc.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:h="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=n;const _=this.size=i+4*e,y=this._createCanvas(_),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${p} ${h} ${i}px ${c}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:h}=this.ctx.measureText(i),p=Math.ceil(n),_=Math.min(this.size-this.buffer,Math.ceil(h-c)),y=Math.min(this.size-this.buffer,p+Math.ceil(o)),v=_+2*this.buffer,T=y+2*this.buffer,C=Math.max(v*T,0),A=new Uint8ClampedArray(C),M={data:A,width:v,height:T,glyphWidth:_,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return M;const{ctx:P,buffer:R,gridInner:V,gridOuter:W}=this;P.clearRect(R,R,_,y),P.fillText(i,R,R+p);const ie=P.getImageData(R,R,_,y);W.fill(eh,0,C),V.fill(0,0,C);for(let te=0;te<y;te++)for(let ne=0;ne<_;ne++){const se=ie.data[4*(te*_+ne)+3]/255;if(se===0)continue;const ce=(te+R)*v+ne+R;if(se===1)W[ce]=0,V[ce]=eh;else{const Ce=.5-se;W[ce]=Ce>0?Ce*Ce:0,V[ce]=Ce<0?Ce*Ce:0}}mx(W,0,0,v,T,v,this.f,this.v,this.z),mx(V,R,R,_,y,v,this.f,this.v,this.z);for(let te=0;te<C;te++){const ne=Math.sqrt(W[te])-Math.sqrt(V[te]);A[te]=Math.round(255-255*(ne/this.radius+this.cutoff))}return M}};class yT{constructor(e=[],n=xT){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,c=n[e];for(;e>0;){const h=e-1>>1,p=n[h];if(o(c,p)>=0)break;n[e]=p,e=h}n[e]=c}_down(e){const{data:n,compare:o}=this,c=this.length>>1,h=n[e];for(;e<c;){let p=1+(e<<1),_=n[p];const y=p+1;if(y<this.length&&o(n[y],_)<0&&(p=y,_=n[y]),o(_,h)>=0)break;n[e]=_,e=p}n[e]=h}}function xT(i,e){return i<e?-1:i>e?1:0}function vT(i,e=1,n=!1){let o=1/0,c=1/0,h=-1/0,p=-1/0;const _=i[0];for(let M=0;M<_.length;M++){const P=_[M];(!M||P.x<o)&&(o=P.x),(!M||P.y<c)&&(c=P.y),(!M||P.x>h)&&(h=P.x),(!M||P.y>p)&&(p=P.y)}const y=Math.min(h-o,p-c);let v=y/2;const T=new yT([],wT);if(y===0)return new me(o,c);for(let M=o;M<h;M+=y)for(let P=c;P<p;P+=y)T.push(new wc(M+v,P+v,v,i));let C=function(M){let P=0,R=0,V=0;const W=M[0];for(let ie=0,te=W.length,ne=te-1;ie<te;ne=ie++){const se=W[ie],ce=W[ne],Ce=se.x*ce.y-ce.x*se.y;R+=(se.x+ce.x)*Ce,V+=(se.y+ce.y)*Ce,P+=3*Ce}return new wc(R/P,V/P,0,M)}(i),A=T.length;for(;T.length;){const M=T.pop();(M.d>C.d||!C.d)&&(C=M,n&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,A)),M.max-C.d<=e||(v=M.h/2,T.push(new wc(M.p.x-v,M.p.y-v,v,i)),T.push(new wc(M.p.x+v,M.p.y-v,v,i)),T.push(new wc(M.p.x-v,M.p.y+v,v,i)),T.push(new wc(M.p.x+v,M.p.y+v,v,i)),A+=4)}return n&&(console.log(`num probes: ${A}`),console.log(`best distance: ${C.d}`)),C.p}function wT(i,e){return e.max-i.max}function wc(i,e,n,o){this.p=new me(i,e),this.h=n,this.d=function(c,h){let p=!1,_=1/0;for(let y=0;y<h.length;y++){const v=h[y];for(let T=0,C=v.length,A=C-1;T<C;A=T++){const M=v[T],P=v[A];M.y>c.y!=P.y>c.y&&c.x<(P.x-M.x)*(c.y-M.y)/(P.y-M.y)+M.x&&(p=!p),_=Math.min(_,h0(c,M,P))}}return(p?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const n_=Number.POSITIVE_INFINITY,bT=Math.sqrt(2);function xx(i,e){return e[1]!==n_?function(n,o,c){let h=0,p=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(n){case"top-right":case"bottom-right":case"right":h=-o;break;case"top-left":case"bottom-left":case"left":h=o}return[h,p]}(i,e[0],e[1]):function(n,o){let c=0,h=0;o<0&&(o=0);const p=o/bT;switch(n){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-o;break;case"top":h=o-7}switch(n){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=o;break;case"right":c=-o}return[c,h]}(i,e[0])}function TT(i,e,n,o,c,h,p,_,y,v){i.createArrays(),i.tilePixelRatio=yt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const T=i.layers[0].layout,C=i.layers[0]._unevaluatedLayout._values,A={};if(i.textSizeData.kind==="composite"){const{minZoom:R,maxZoom:V}=i.textSizeData;A.compositeTextSizes=[C["text-size"].possiblyEvaluate(new Y(R),_),C["text-size"].possiblyEvaluate(new Y(V),_)]}if(i.iconSizeData.kind==="composite"){const{minZoom:R,maxZoom:V}=i.iconSizeData;A.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new Y(R),_),C["icon-size"].possiblyEvaluate(new Y(V),_)]}A.layoutTextSize=C["text-size"].possiblyEvaluate(new Y(y+1),_),A.layoutIconSize=C["icon-size"].possiblyEvaluate(new Y(y+1),_),A.textMaxSize=C["text-size"].possiblyEvaluate(new Y(18),_);const M=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",P=T.get("text-size");for(const R of i.features){const V=T.get("text-font").evaluate(R,{},_).join(","),W=P.evaluate(R,{},_),ie=A.layoutTextSize.evaluate(R,{},_),te=(A.layoutIconSize.evaluate(R,{},_),{horizontal:{},vertical:void 0}),ne=R.text;let se,ce=[0,0];if(ne){const De=ne.toString(),Ne=T.get("text-letter-spacing").evaluate(R,{},_)*an,Te=T.get("text-line-height").evaluate(R,{},_)*an,ze=d(De)?Ne:0,Ue=T.get("text-anchor").evaluate(R,{},_),Ve=T.get("text-variable-anchor");if(!Ve){const ht=T.get("text-radial-offset").evaluate(R,{},_);ce=ht?xx(Ue,[ht*an,n_]):T.get("text-offset").evaluate(R,{},_).map(nt=>nt*an)}let Qe=M?"center":T.get("text-justify").evaluate(R,{},_);const Re=T.get("symbol-placement"),He=Re==="point",St=Re==="point"?T.get("text-max-width").evaluate(R,{},_)*an:0,Mt=ht=>{i.allowVerticalPlacement&&a(De)&&(te.vertical=Qm(ne,e,n,c,V,St,Te,Ue,ht,ze,ce,pr.vertical,!0,Re,ie,W))};if(!M&&Ve){const ht=Qe==="auto"?Ve.map(Dt=>r_(Dt)):[Qe];let nt=!1;for(let Dt=0;Dt<ht.length;Dt++){const At=ht[Dt];if(!te.horizontal[At])if(nt)te.horizontal[At]=te.horizontal[0];else{const lt=Qm(ne,e,n,c,V,St,Te,"center",At,ze,ce,pr.horizontal,!1,Re,ie,W);lt&&(te.horizontal[At]=lt,nt=lt.positionedLines.length===1)}}Mt("left")}else{if(Qe==="auto"&&(Qe=r_(Ue)),He||T.get("text-writing-mode").indexOf("horizontal")>=0||!a(De)){const ht=Qm(ne,e,n,c,V,St,Te,Ue,Qe,ze,ce,pr.horizontal,!1,Re,ie,W);ht&&(te.horizontal[Qe]=ht)}Mt(Re==="point"?"left":Qe)}}let Ce=!1;if(R.icon&&R.icon.name){const De=o[R.icon.name];De&&(se=fT(c[R.icon.name],T.get("icon-offset").evaluate(R,{},_),T.get("icon-anchor").evaluate(R,{},_)),Ce=De.sdf,i.sdfIcons===void 0?i.sdfIcons=De.sdf:i.sdfIcons!==De.sdf&&Pt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==i.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Ie=wx(te.horizontal)||te.vertical;i.iconsInText||(i.iconsInText=!!Ie&&Ie.iconsInText),(Ie||se)&&ET(i,R,te,se,o,A,ie,0,ce,Ce,p,_,v)}h&&i.generateCollisionDebugBuffers(y,i.collisionBoxArray)}function r_(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ET(i,e,n,o,c,h,p,_,y,v,T,C,A){let M=h.textMaxSize.evaluate(e,{},C);M===void 0&&(M=p);const P=i.layers[0].layout,R=P.get("icon-offset").evaluate(e,{},C),V=wx(n.horizontal)||n.vertical,W=A.name==="globe",ie=p/24,te=i.tilePixelRatio*M/24,ne=(ze=i.overscaling,i.zoom>18&&ze>2&&(ze>>=1),Math.max(yt/(512*ze),1)*P.get("symbol-spacing")),se=P.get("text-padding")*i.tilePixelRatio,ce=P.get("icon-padding")*i.tilePixelRatio,Ce=Ge(P.get("text-max-angle")),Ie=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",De=P.get("icon-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",Ne=P.get("symbol-placement"),Te=ne/2;var ze;const Ue=P.get("icon-text-fit");let Ve;o&&Ue!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Ve=lx(o,n.vertical,Ue,P.get("icon-text-fit-padding"),R,ie)),V&&(o=lx(o,V,Ue,P.get("icon-text-fit-padding"),R,ie)));const Qe=(Re,He,St)=>{if(He.x<0||He.x>=yt||He.y<0||He.y>=yt)return;let Mt=null;if(W){const{x:ht,y:nt,z:Dt}=A.projectTilePoint(He.x,He.y,St);Mt={anchor:new Xo(ht,nt,Dt,0,void 0),up:A.upVector(St,He.x,He.y)}}(function(ht,nt,Dt,At,lt,Ui,Ii,vi,Lt,jt,ti,Qt,Yt,li,fi,Ki,Bn,Rt,wi,pn,qt,mi,En,ui,ki){const Ji=ht.addToLineVertexArray(nt,At);let Gi,ln,Sn,Qi,Ho,Sc,ch,uh=0,rv=0,ov=0,sv=0,v_=-1,w_=-1;const vo={};let av=Ou("");const Ja=Dt?Dt.anchor:nt;let b_=0,T_=0;if(Lt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[b_,T_]=Lt.layout.get("text-offset").evaluate(qt,{},ki).map(tr=>tr*an):(b_=Lt.layout.get("text-radial-offset").evaluate(qt,{},ki)*an,T_=n_),ht.allowVerticalPlacement&&lt.vertical){const tr=lt.vertical;if(fi)Sc=o_(tr),vi&&(ch=o_(vi));else{const ir=Lt.layout.get("text-rotate").evaluate(qt,{},ki)+90;Sn=Dp(jt,Ja,nt,ti,Qt,Yt,tr,li,ir,Ki),vi&&(Qi=Dp(jt,Ja,nt,ti,Qt,Yt,vi,Rt,ir))}}if(Ui){const tr=Lt.layout.get("icon-rotate").evaluate(qt,{},ki),ir=Lt.layout.get("icon-text-fit")!=="none",hh=gx(Ui,tr,En,ir),S_=vi?gx(vi,tr,En,ir):void 0;ln=Dp(jt,Ja,nt,ti,Qt,Yt,Ui,Rt,tr),uh=4*hh.length;const lv=ht.iconSizeData;let Qa=null;lv.kind==="source"?(Qa=[mo*Lt.layout.get("icon-size").evaluate(qt,{},ki)],Qa[0]>Ls&&Pt(`${ht.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):lv.kind==="composite"&&(Qa=[mo*mi.compositeIconSizes[0].evaluate(qt,{},ki),mo*mi.compositeIconSizes[1].evaluate(qt,{},ki)],(Qa[0]>Ls||Qa[1]>Ls)&&Pt(`${ht.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ht.addSymbols(ht.icon,hh,Qa,pn,wi,qt,!1,Dt,nt,Ji.lineStartIndex,Ji.lineLength,-1,ui,ki),v_=ht.icon.placedSymbolArray.length-1,S_&&(rv=4*S_.length,ht.addSymbols(ht.icon,S_,Qa,pn,wi,qt,pr.vertical,Dt,nt,Ji.lineStartIndex,Ji.lineLength,-1,ui,ki),w_=ht.icon.placedSymbolArray.length-1)}for(const tr in lt.horizontal){const ir=lt.horizontal[tr];Gi||(av=Ou(ir.text),fi?Ho=o_(ir):Gi=Dp(jt,Ja,nt,ti,Qt,Yt,ir,li,Lt.layout.get("text-rotate").evaluate(qt,{},ki),Ki));const hh=ir.positionedLines.length===1;if(ov+=vx(ht,Dt,nt,ir,Ii,Lt,fi,qt,Ki,Ji,lt.vertical?pr.horizontal:pr.horizontalOnly,hh?Object.keys(lt.horizontal):[tr],vo,v_,mi,ui,ki),hh)break}lt.vertical&&(sv+=vx(ht,Dt,nt,lt.vertical,Ii,Lt,fi,qt,Ki,Ji,pr.vertical,["vertical"],vo,w_,mi,ui,ki));let js=-1;const E_=(tr,ir)=>tr?Math.max(tr,ir):ir;js=E_(Ho,js),js=E_(Sc,js),js=E_(ch,js);const nE=js>-1?1:0;ht.glyphOffsetArray.length>=Rs.MAX_GLYPHS&&Pt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qt.sortKey!==void 0&&ht.addToSortKeyRanges(ht.symbolInstances.length,qt.sortKey),ht.symbolInstances.emplaceBack(Ja.x,Ja.y,Ja.z,nt.x,nt.y,vo.right>=0?vo.right:-1,vo.center>=0?vo.center:-1,vo.left>=0?vo.left:-1,vo.vertical>=0?vo.vertical:-1,v_,w_,av,Gi!==void 0?Gi:ht.collisionBoxArray.length,Gi!==void 0?Gi+1:ht.collisionBoxArray.length,Sn!==void 0?Sn:ht.collisionBoxArray.length,Sn!==void 0?Sn+1:ht.collisionBoxArray.length,ln!==void 0?ln:ht.collisionBoxArray.length,ln!==void 0?ln+1:ht.collisionBoxArray.length,Qi||ht.collisionBoxArray.length,Qi?Qi+1:ht.collisionBoxArray.length,ti,ov,sv,uh,rv,nE,0,b_,T_,js)})(i,He,Mt,Re,n,o,c,Ve,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,se,Ie,y,0,ce,De,R,e,h,v,T,C)};if(Ne==="line")for(const Re of fx(e.geometry,0,0,yt,yt)){const He=_T(Re,ne,Ce,n.vertical||V,o,24,te,i.overscaling,yt);for(const St of He){const Mt=V;Mt&&ST(i,Mt.text,Te,St)||Qe(Re,St,C)}}else if(Ne==="line-center"){for(const Re of e.geometry)if(Re.length>1){const He=mT(Re,Ce,n.vertical||V,o,24,te);He&&Qe(Re,He,C)}}else if(e.type==="Polygon")for(const Re of qm(e.geometry,0)){const He=vT(Re,16);Qe(Re[0],new Xo(He.x,He.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Re of e.geometry)Qe(Re,new Xo(Re[0].x,Re[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Re of e.geometry)for(const He of Re)Qe([He],new Xo(He.x,He.y,0,0,void 0),C)}const Ls=32640;function vx(i,e,n,o,c,h,p,_,y,v,T,C,A,M,P,R,V){const W=function(ne,se,ce,Ce,Ie,De,Ne,Te){const ze=[];if(se.positionedLines.length===0)return ze;const Ue=Ce.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,Ve=function(Mt){const ht=Mt[0],nt=Mt[1],Dt=ht*nt;return Dt>0?[ht,-nt]:Dt<0?[-ht,nt]:ht===0?[nt,ht]:[nt,-ht]}(ce);let Qe=Math.abs(se.top-se.bottom);for(const Mt of se.positionedLines)Qe-=Mt.lineOffset;const Re=se.positionedLines.length,He=Qe/Re;let St=se.top-ce[1];for(let Mt=0;Mt<Re;++Mt){const ht=se.positionedLines[Mt];St=gT(se,He,St,Mt);for(const nt of ht.positionedGlyphs){if(!nt.rect)continue;const Dt=nt.rect||{};let At=4,lt=!0,Ui=1,Ii=0;if(nt.imageName){const ui=Ne[nt.imageName];if(!ui)continue;if(ui.sdf){Pt("SDF images are not supported in formatted text and will be ignored.");continue}lt=!1,Ui=ui.pixelRatio,At=1/Ui}const vi=(Ie||Te)&&nt.vertical,Lt=nt.metrics.advance*nt.scale/2,jt=nt.metrics,ti=nt.rect;if(ti===null)continue;Te&&se.verticalizable&&(Ii=nt.imageName?Lt-nt.metrics.width*nt.scale/2:0);const Qt=Ie?[nt.x+Lt,nt.y]:[0,0];let Yt=[0,0],li=[0,0],fi=!1;Ie||(vi?(li=[nt.x+Lt+Ve[0],nt.y+Ve[1]-Ii],fi=!0):Yt=[nt.x+Lt+ce[0],nt.y+ce[1]-Ii]);const Ki=ti.w*nt.scale/(Ui*(nt.localGlyph?2:1)),Bn=ti.h*nt.scale/(Ui*(nt.localGlyph?2:1));let Rt,wi,pn,qt;if(vi){const ui=nt.y-St,ki=new me(-Lt,Lt-ui),Ji=-Math.PI/2,Gi=new me(...li);Rt=new me(-Lt+Yt[0],Yt[1]),Rt._rotateAround(Ji,ki)._add(Gi),Rt.x+=-ui+Lt,Rt.y-=(jt.left-At)*nt.scale;const ln=nt.imageName?jt.advance*nt.scale:an*nt.scale,Sn=String.fromCharCode(nt.glyph);J2(Sn)?Rt.x+=(1-At)*nt.scale:Q2(Sn)?Rt.x+=ln-jt.height*nt.scale+(-At-1)*nt.scale:Rt.x+=nt.imageName||jt.width+2*At===ti.w&&jt.height+2*At===ti.h?(ln-Bn)/2:(ln-(jt.height+2*At)*nt.scale)/2,wi=new me(Rt.x,Rt.y-Ki),pn=new me(Rt.x+Bn,Rt.y),qt=new me(Rt.x+Bn,Rt.y-Ki)}else{const ui=(jt.left-At)*nt.scale-Lt+Yt[0],ki=(-jt.top-At)*nt.scale+Yt[1],Ji=ui+Ki,Gi=ki+Bn;Rt=new me(ui,ki),wi=new me(Ji,ki),pn=new me(ui,Gi),qt=new me(Ji,Gi)}if(Ue){let ui;ui=Ie?new me(0,0):fi?new me(Ve[0],Ve[1]):new me(ce[0],ce[1]),Rt._rotateAround(Ue,ui),wi._rotateAround(Ue,ui),pn._rotateAround(Ue,ui),qt._rotateAround(Ue,ui)}const mi=new me(0,0),En=new me(0,0);ze.push({tl:Rt,tr:wi,bl:pn,br:qt,tex:Dt,writingMode:se.writingMode,glyphOffset:Qt,sectionIndex:nt.sectionIndex,isSDF:lt,pixelOffsetTL:mi,pixelOffsetBR:En,minFontScaleX:0,minFontScaleY:0})}}return ze}(0,o,y,h,p,_,c,i.allowVerticalPlacement),ie=i.textSizeData;let te=null;ie.kind==="source"?(te=[mo*h.layout.get("text-size").evaluate(_,{},V)],te[0]>Ls&&Pt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ie.kind==="composite"&&(te=[mo*P.compositeTextSizes[0].evaluate(_,{},V),mo*P.compositeTextSizes[1].evaluate(_,{},V)],(te[0]>Ls||te[1]>Ls)&&Pt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,W,te,y,p,_,T,e,n,v.lineStartIndex,v.lineLength,M,R,V);for(const ne of C)A[ne]=i.text.placedSymbolArray.length-1;return 4*W.length}function wx(i){for(const e in i)return i[e];return null}function Dp(i,e,n,o,c,h,p,_,y,v){let T=p.top,C=p.bottom,A=p.left,M=p.right;const P=p.collisionPadding;if(P&&(A-=P[0],T-=P[1],M+=P[2],C+=P[3]),y){const R=new me(A,T),V=new me(M,T),W=new me(A,C),ie=new me(M,C),te=Ge(y);let ne=new me(0,0);v&&(ne=new me(v[0],v[1])),R._rotateAround(te,ne),V._rotateAround(te,ne),W._rotateAround(te,ne),ie._rotateAround(te,ne),A=Math.min(R.x,V.x,W.x,ie.x),M=Math.max(R.x,V.x,W.x,ie.x),T=Math.min(R.y,V.y,W.y,ie.y),C=Math.max(R.y,V.y,W.y,ie.y)}return i.emplaceBack(e.x,e.y,e.z,n.x,n.y,A,T,M,C,_,o,c,h),i.length-1}function o_(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function ST(i,e,n,o){const c=i.compareText;if(e in c){const h=c[e];for(let p=h.length-1;p>=0;p--)if(o.dist(h[p])<n)return!0}else c[e]=[];return c[e].push(o),!1}const CT=Ke([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:bx}=CT,Tx=Ke([{name:"a_pos_3",components:3,type:"Int16"}]);var th=Ke([{name:"a_pos",type:"Int16",components:2}]);const Bs=yt/Math.PI/2,AT=2*Sr(1,0)*Bs*Math.PI,bc=[64,32,16],Qn=-Bs,er=Bs,IT=[new dr([Qn,Qn,Qn],[er,er,er]),new dr([Qn,Qn,Qn],[0,0,er]),new dr([0,Qn,Qn],[er,0,er]),new dr([Qn,0,Qn],[0,er,er]),new dr([0,0,Qn],[er,er,er])];function Ex(i,e,n,o=!0){const c=fo([],i._camera.position,i.worldSize),h=[e,n,1,1];Xa(h,h,i.pixelMatrixInverse),w0(h,h,1/h[3]);const p=wn([],Ar([],h,c)),_=i.globeMatrix,y=[_[12],_[13],_[14]],v=Ar([],y,c),T=Uu(v),C=wn([],v),A=i.worldSize/(2*Math.PI),M=Cr(C,p),P=Math.asin(A/T);if(P<Math.acos(M)){if(!o)return null;const Ne=[],Te=[];fo(Ne,p,T/M),wn(Te,Ar(Te,Ne,v)),wn(p,Ps(p,v,fo(p,Te,Math.tan(P)*T)))}const R=[];new Om(c,p).closestPointOnSphere(y,A,R);const V=wn([],Rr(_,0)),W=wn([],Rr(_,1)),ie=wn([],Rr(_,2)),te=Cr(V,R),ne=Cr(W,R),se=Cr(ie,R),ce=Tt(Math.asin(-ne/A));let Ce=Tt(Math.atan2(te,se));Ce=i.center.lng+function(Ne,Te){const ze=(Te-Ne+180)%360-180;return ze<-180?ze+360:ze}(i.center.lng,Ce);const Ie=Ga(Ce),De=Fe($a(ce),0,1);return new hc(Ie,De)}class kT{constructor(e,n,o){this.a=Ar([],e,o),this.b=Ar([],n,o),this.center=o;const c=wn([],this.a),h=wn([],this.b);this.angle=Math.acos(Cr(c,h))}}function s_(i,e){if(i.angle===0)return null;let n;return n=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),n<0||n>1?null:function(o,c,h,p){const _=Math.sin(h);return o*(Math.sin((1-p)*h)/_)+c*(Math.sin(p*h)/_)}(i.a[e],i.b[e],i.angle,Fe(n,0,1))+i.center[e]}function _o(i){if(i.z<=1)return IT[i.z+2*i.y+i.x];const[e,n]=a_(i),o=[Tn(e[0],e[1]),Tn(e[0],n[1]),Tn(n[0],e[1]),Tn(n[0],n[1])],c=[er,er,er],h=[Qn,Qn,Qn];for(const p of o)c[0]=Math.min(c[0],p[0]),c[1]=Math.min(c[1],p[1]),c[2]=Math.min(c[2],p[2]),h[0]=Math.max(h[0],p[0]),h[1]=Math.max(h[1],p[1]),h[2]=Math.max(h[2],p[2]);return new dr(c,h)}function MT(i,e,n){const o=e/i.worldSize,c=Number.MAX_VALUE,h=[-c,-c,-c],p=[c,c,c],_=Kn(new Float64Array(16));if(po(_,_,[o,o,o]),zs(_,_,i.globeMatrix),n.z<=1){const Te=_o(n).getCorners();for(let ze=0;ze<Te.length;ze++)sn(Te[ze],Te[ze],_),fp(p,p,Te[ze]),mp(h,h,Te[ze]);return new dr(p,h)}const[y,v]=a_(n),T=new Ms;T.setSouthWest([y[1],v[0]]),T.setNorthEast([v[1],y[0]]);const C=[Tn(T.getSouth(),T.getWest()),Tn(T.getSouth(),T.getEast()),Tn(T.getNorth(),T.getEast()),Tn(T.getNorth(),T.getWest())];for(let Te=0;Te<C.length;Te++)sn(C[Te],C[Te],_),fp(p,p,C[Te]),mp(h,h,C[Te]);if(T.contains(i.center)){h[2]=0;const Te=i.point,ze=[Te.x*o,Te.y*o,0];return fp(p,p,ze),mp(h,h,ze),new dr(p,h)}const A=[_[12],_[13],_[14]],M=i.center.lng,P=Fe(i.center.lat,-85.051129,ho),R=[Ga(M),$a(P)],V=T.getCenter().lng,W=Fe(T.getCenter().lat,-85.051129,ho),ie=[Ga(V),$a(W)];let te=new Array(3),ne=0,se=R[0]-ie[0];const ce=R[1]-ie[1];if(se>.5?se-=1:se<-.5&&(se+=1),Math.abs(se)>Math.abs(ce))ne=se>=0?1:3,te=A;else{ne=ce>=0?0:2;const Te=[_[4],_[5],_[6]];let ze;ze=ce>=0?-Math.sin(Ge(T.getSouth()))*Bs:-Math.sin(Ge(T.getNorth()))*Bs,te=_p(te,A,Te,ze)}const Ce=C[ne],Ie=C[(ne+1)%4],De=new kT(Ce,Ie,te),Ne=[s_(De,0)||Ce[0],s_(De,1)||Ce[1],s_(De,2)||Ce[2]];return p[2]=Math.min(Ce[2],Ie[2]),fp(p,p,Ne),mp(h,h,Ne),new dr(p,h)}function a_(i){const e=1<<i.z,n=i.x/e,o=(i.x+1)/e,c=(i.y+1)/e;return[[Pi(i.y/e),vn(n)],[Pi(c),vn(o)]]}function Sx(i,e,n,o=Bs){return n=Ge(n),[i*Math.sin(n)*o,-e*o,i*Math.cos(n)*o]}function Tn(i,e,n){return Sx(Math.cos(Ge(i)),Math.sin(Ge(i)),e,n)}function Cx(i,e,n){const o=Math.pow(2,n.z),c=(i/yt+n.x)/o;return Tn(Pi((e/yt+n.y)/o),vn(c))}function Lp(i){return 16383/Math.max(...Ar([],i.max,i.min))}function ih(i){const e=Kn(new Float64Array(16)),n=Lp(i);var o,c;return po(e,e,[n,n,n]),Wa(e,e,((o=[])[0]=-(c=i.min)[0],o[1]=-c[1],o[2]=-c[2],o)),e}function Ax(i){const e=Kn(new Float64Array(16)),n=1/Lp(i);return Wa(e,e,i.min),po(e,e,[n,n,n]),e}function Ix(i,e,n,o,c){const h=function(y){const v=yt/(2*Math.PI);return y/(2*Math.PI)/v}(n),p=[i,e,-n/(2*Math.PI)],_=Kn(new Float64Array(16));return Wa(_,_,p),po(_,_,[h,h,h]),dp(_,_,Ge(-c)),pp(_,_,Ge(-o)),_}function l_(i){return ct(5,6,i)}function kx(i,e){const n=Tn(e.lat,e.lng);return h=(o=Rm([],function(M){const P=Tn(M._center.lat,M._center.lng);let R=Fm([],pc(0,1,0),P);const V=g0([],-M.angle,P);R=sn(R,R,V),g0(V,-M._pitch,R);const W=wn([],P);return fo(W,W,M.cameraToCenterDistance/M.pixelsPerMeter*AT),sn(W,W,V),Ps([],P,W)}(i),n))[0],p=o[1],_=o[2],y=(c=n)[0],v=c[1],T=c[2],A=(C=Math.sqrt(h*h+p*p+_*_)*Math.sqrt(y*y+v*v+T*T))&&Cr(o,c)/C,Math.acos(Math.min(Math.max(A,-1),1));var o,c,h,p,_,y,v,T,C,A}const Mx=Ge(85),zT=Math.cos(Mx),PT=Math.sin(Mx),DT=Ha.VectorTileFeature.types,LT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bp(i,e,n,o,c,h,p,_,y,v,T,C,A){const M=_?Math.min(Ls,Math.round(_[0])):0,P=_?Math.min(Ls,Math.round(_[1])):0;i.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),h,p,(M<<1)+(y?1:0),P,16*v,16*T,256*C,256*A)}function Rp(i,e,n,o,c,h,p){i.emplaceBack(e,n,o,c,h,p)}function Fp(i,e,n,o,c){i.emplaceBack(e,n,o,c),i.emplaceBack(e,n,o,c),i.emplaceBack(e,n,o,c),i.emplaceBack(e,n,o,c)}function BT(i){for(const e of i.sections)if(k(e.text))return!0;return!1}class c_{constructor(e){this.layoutVertexArray=new gi,this.indexArray=new Ci,this.programConfigurations=e,this.segments=new Ai,this.dynamicLayoutVertexArray=new Xn,this.opacityVertexArray=new Si,this.placedSymbolArray=new Gy,this.globeExtVertexArray=new Vt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,q2.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,LT,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Z2.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}it(c_,"SymbolBuffers");class u_{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Ai,this.collisionVertexArray=new Ss,this.collisionVertexArrayExt=new Wr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,W2.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,X2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}it(u_,"CollisionBuffers");class Rs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Kn([]),this.placementViewportMatrix=Kn([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hm(this.zoom,n["text-size"]),this.iconSizeData=Hm(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),h=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(p=>pr[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new c_(new Va(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new c_(new Va(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new qy,this.lineVertexArray=new Wy,this.symbolInstances=new Zy}calculateGlyphDependencies(e,n,o,c,h){for(let p=0;p<e.length;p++)if(n[e.charCodeAt(p)]=!0,c&&h){const _=Ku[e.charAt(p)];_&&(n[_.charCodeAt(0)]=!0)}}populate(e,n,o,c){const h=this.layers[0],p=h.layout,_=this.projection==="globe",y=p.get("text-font"),v=p.get("text-field"),T=p.get("icon-image"),C=(v.value.kind!=="constant"||v.value.value instanceof hn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),A=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,M=p.get("symbol-sort-key");if(this.features=[],!C&&!A)return;const P=n.iconDependencies,R=n.glyphDependencies,V=n.availableImages,W=new Y(this.zoom);for(const{feature:ie,id:te,index:ne,sourceLayerIndex:se}of e){const ce=h._featureFilter.needGeometry,Ce=Za(ie,ce);if(!h._featureFilter.filter(W,Ce,o))continue;if(ce||(Ce.geometry=Zo(ie,o,c)),_&&ie.type!==1&&o.z<=5){const Te=Ce.geometry,ze=1<<o.z,Ue=o.x,Ve=o.y,Qe=.98078528056;for(let Re=0;Re<Te.length;Re++)Te[Re]=qb(Te[Re],He=>He,(He,St)=>Cr(Tn(Pi((He.y/yt+Ve)/ze),vn((He.x/yt+Ue)/ze),1),Tn(Pi((St.y/yt+Ve)/ze),vn((St.x/yt+Ue)/ze),1))<Qe)}let Ie,De;if(C){const Te=h.getValueAndResolveTokens("text-field",Ce,o,V),ze=hn.factory(Te);BT(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||q()==="unavailable"||this.hasRTLText&&Z.isParsed())&&(Ie=K2(ze,h,Ce))}if(A){const Te=h.getValueAndResolveTokens("icon-image",Ce,o,V);De=Te instanceof rn?Te:rn.fromString(Te)}if(!Ie&&!De)continue;const Ne=this.sortFeaturesByKey?M.evaluate(Ce,{},o):void 0;if(this.features.push({id:te,text:Ie,icon:De,index:ne,sourceLayerIndex:se,geometry:Ce.geometry,properties:ie.properties,type:DT[ie.type],sortKey:Ne}),De&&(P[De.name]=!0),Ie){const Te=y.evaluate(Ce,{},o).join(","),ze=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(pr.vertical)>=0;for(const Ue of Ie.sections)if(Ue.image)P[Ue.image.name]=!0;else{const Ve=a(Ie.toString()),Qe=Ue.fontStack||Te,Re=R[Qe]=R[Qe]||{};this.calculateGlyphDependencies(Ue.text,Re,ze,this.allowVerticalPlacement,Ve)}}}p.get("symbol-placement")==="line"&&(this.features=function(ie){const te={},ne={},se=[];let ce=0;function Ce(Te){se.push(ie[Te]),ce++}function Ie(Te,ze,Ue){const Ve=ne[Te];return delete ne[Te],ne[ze]=Ve,se[Ve].geometry[0].pop(),se[Ve].geometry[0]=se[Ve].geometry[0].concat(Ue[0]),Ve}function De(Te,ze,Ue){const Ve=te[ze];return delete te[ze],te[Te]=Ve,se[Ve].geometry[0].shift(),se[Ve].geometry[0]=Ue[0].concat(se[Ve].geometry[0]),Ve}function Ne(Te,ze,Ue){const Ve=Ue?ze[0][ze[0].length-1]:ze[0][0];return`${Te}:${Ve.x}:${Ve.y}`}for(let Te=0;Te<ie.length;Te++){const ze=ie[Te],Ue=ze.geometry,Ve=ze.text?ze.text.toString():null;if(!Ve){Ce(Te);continue}const Qe=Ne(Ve,Ue),Re=Ne(Ve,Ue,!0);if(Qe in ne&&Re in te&&ne[Qe]!==te[Re]){const He=De(Qe,Re,Ue),St=Ie(Qe,Re,se[He].geometry);delete te[Qe],delete ne[Re],ne[Ne(Ve,se[St].geometry,!0)]=St,se[He].geometry=null}else Qe in ne?Ie(Qe,Re,Ue):Re in te?De(Qe,Re,Ue):(Ce(Te),te[Qe]=ce-1,ne[Re]=ce-1)}return se.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,te)=>ie.sortKey-te.sortKey)}update(e,n,o,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o,c),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length,c=e.segment;if(c!==void 0){let h=e.dist(n[c+1]),p=e.dist(n[c]);const _={};for(let y=c+1;y<n.length;y++)_[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:h},y<n.length-1&&(h+=n[y+1].dist(n[y]));for(let y=c||0;y>=0;y--)_[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:p},y>0&&(p+=n[y-1].dist(n[y]));for(let y=0;y<n.length;y++){const v=_[y];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,h,p,_,y,v,T,C,A,M,P){const R=e.indexArray,V=e.layoutVertexArray,W=e.globeExtVertexArray,ie=e.segments.prepareSegment(4*n.length,V,R,this.canOverlap?p.sortKey:void 0),te=this.glyphOffsetArray.length,ne=ie.vertexLength,se=this.allowVerticalPlacement&&_===pr.vertical?Math.PI/2:0,ce=p.text&&p.text.sections;for(let Ie=0;Ie<n.length;Ie++){const{tl:De,tr:Ne,bl:Te,br:ze,tex:Ue,pixelOffsetTL:Ve,pixelOffsetBR:Qe,minFontScaleX:Re,minFontScaleY:He,glyphOffset:St,isSDF:Mt,sectionIndex:ht}=n[Ie],nt=ie.vertexLength,Dt=St[1];if(Bp(V,v.x,v.y,De.x,Dt+De.y,Ue.x,Ue.y,o,Mt,Ve.x,Ve.y,Re,He),Bp(V,v.x,v.y,Ne.x,Dt+Ne.y,Ue.x+Ue.w,Ue.y,o,Mt,Qe.x,Ve.y,Re,He),Bp(V,v.x,v.y,Te.x,Dt+Te.y,Ue.x,Ue.y+Ue.h,o,Mt,Ve.x,Qe.y,Re,He),Bp(V,v.x,v.y,ze.x,Dt+ze.y,Ue.x+Ue.w,Ue.y+Ue.h,o,Mt,Qe.x,Qe.y,Re,He),y){const At=y.anchor,lt=y.up;Rp(W,At.x,At.y,At.z,lt[0],lt[1],lt[2]),Rp(W,At.x,At.y,At.z,lt[0],lt[1],lt[2]),Rp(W,At.x,At.y,At.z,lt[0],lt[1],lt[2]),Rp(W,At.x,At.y,At.z,lt[0],lt[1],lt[2]),Fp(e.dynamicLayoutVertexArray,At.x,At.y,At.z,se)}else Fp(e.dynamicLayoutVertexArray,v.x,v.y,v.z,se);R.emplaceBack(nt,nt+1,nt+2),R.emplaceBack(nt+1,nt+2,nt+3),ie.vertexLength+=4,ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Ie!==n.length-1&&ht===n[Ie+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,p,p.index,{},M,P,ce&&ce[ht])}const Ce=y?y.anchor:v;e.placedSymbolArray.emplaceBack(Ce.x,Ce.y,Ce.z,v.x,v.y,te,this.glyphOffsetArray.length-te,ne,T,C,v.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],_,0,!1,0,A,0)}_commitLayoutVertex(e,n,o,c,h,p,_){e.emplaceBack(n,o,c,h,p,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,n,o,c,h,p,_){const y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),v=y.vertexLength,T=_.tileAnchorX,C=_.tileAnchorY;for(let M=0;M<4;M++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,c,h,p,T,C,new me(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,h,p,T,C,new me(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,h,p,T,C,new me(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,h,p,T,C,new me(e.x1,e.y2)),y.vertexLength+=4;const A=o.indexArray;A.emplaceBack(v,v+1),A.emplaceBack(v+1,v+2),A.emplaceBack(v+2,v+3),A.emplaceBack(v+3,v),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,c,h,p){for(let _=c;_<h;_++){const y=o.get(_),v=this.getSymbolInstanceTextSize(e,p,n,_);this._addCollisionDebugVertices(y,v,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,o,c,h,p){for(let _=c;_<h;_++){const y=o.get(_),v=this.getSymbolInstanceIconSize(e,n,_);this._addCollisionDebugVertices(y,v,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new u_(ai,H0.members,As),this.iconCollisionBox=new u_(ai,H0.members,As);const o=_c(this.iconSizeData,e),c=_c(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,o,c){const h=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),p=Ap(this.textSizeData,e,h)/an;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,o){const c=this.icon.placedSymbolArray.get(o),h=Ap(this.iconSizeData,e,c);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,n,o){e.emplaceBack(n,-o,-o),e.emplaceBack(n,o,-o),e.emplaceBack(n,o,o),e.emplaceBack(n,-o,o)}_updateTextDebugCollisionBoxes(e,n,o,c,h,p){for(let _=c;_<h;_++){const y=o.get(_),v=this.getSymbolInstanceTextSize(e,p,n,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,y.padding)}}_updateIconDebugCollisionBoxes(e,n,o,c,h){for(let p=c;p<h;p++){const _=o.get(p),y=this.getSymbolInstanceIconSize(e,n,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,_.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=_c(this.iconSizeData,e),c=_c(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(o,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(o,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,c,h,p,_,y,v){const T={};for(let C=n;C<o;C++){const A=e.get(C);T.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},T.textFeatureIndex=A.featureIndex;break}for(let C=c;C<h;C++){const A=e.get(C);T.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},T.verticalTextFeatureIndex=A.featureIndex;break}for(let C=p;C<_;C++){const A=e.get(C);T.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},T.iconFeatureIndex=A.featureIndex;break}for(let C=y;C<v;C++){const A=e.get(C);T.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},T.verticalIconFeatureIndex=A.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let h=o.vertexStartIndex;h<c;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),c=[],h=[],p=[];for(let _=0;_<this.symbolInstances.length;++_){p.push(_);const y=this.symbolInstances.get(_);c.push(0|Math.round(n*y.tileAnchorX+o*y.tileAnchorY)),h.push(y.featureIndex)}return p.sort((_,y)=>c[_]-c[y]||h[y]-h[_]),p}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,h,p)=>{c>=0&&p.indexOf(c)===h&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}it(Rs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Rs.MAX_GLYPHS=65535,Rs.addDynamicAttributes=Fp;const RT=new rt({"symbol-placement":new xe(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new xe(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xe(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ge(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xe(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xe(fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xe(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new xe(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xe(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new ge(fe.layout_symbol["icon-size"]),"icon-text-fit":new xe(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xe(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new ge(fe.layout_symbol["icon-image"]),"icon-rotate":new ge(fe.layout_symbol["icon-rotate"]),"icon-padding":new xe(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new xe(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new ge(fe.layout_symbol["icon-offset"]),"icon-anchor":new ge(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xe(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xe(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xe(fe.layout_symbol["text-rotation-alignment"]),"text-field":new ge(fe.layout_symbol["text-field"]),"text-font":new ge(fe.layout_symbol["text-font"]),"text-size":new ge(fe.layout_symbol["text-size"]),"text-max-width":new ge(fe.layout_symbol["text-max-width"]),"text-line-height":new ge(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new ge(fe.layout_symbol["text-letter-spacing"]),"text-justify":new ge(fe.layout_symbol["text-justify"]),"text-radial-offset":new ge(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xe(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new ge(fe.layout_symbol["text-anchor"]),"text-max-angle":new xe(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new xe(fe.layout_symbol["text-writing-mode"]),"text-rotate":new ge(fe.layout_symbol["text-rotate"]),"text-padding":new xe(fe.layout_symbol["text-padding"]),"text-keep-upright":new xe(fe.layout_symbol["text-keep-upright"]),"text-transform":new ge(fe.layout_symbol["text-transform"]),"text-offset":new ge(fe.layout_symbol["text-offset"]),"text-allow-overlap":new xe(fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xe(fe.layout_symbol["text-ignore-placement"]),"text-optional":new xe(fe.layout_symbol["text-optional"])});var h_={paint:new rt({"icon-opacity":new ge(fe.paint_symbol["icon-opacity"]),"icon-color":new ge(fe.paint_symbol["icon-color"]),"icon-halo-color":new ge(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new ge(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ge(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new xe(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new xe(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new ge(fe.paint_symbol["text-opacity"]),"text-color":new ge(fe.paint_symbol["text-color"],{runtimeType:cr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ge(fe.paint_symbol["text-halo-color"]),"text-halo-width":new ge(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new ge(fe.paint_symbol["text-halo-blur"]),"text-translate":new xe(fe.paint_symbol["text-translate"]),"text-translate-anchor":new xe(fe.paint_symbol["text-translate-anchor"])}),layout:RT};class zx{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:_a,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}it(zx,"FormatSectionOverride",{omit:["defaultValue"]});class Op extends Yr{constructor(e){super(e,h_)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const h of o)c.indexOf(h)<0&&c.push(h);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){const h=this.layout.get(e).evaluate(n,{},o,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||vs(p.value)||!h?h:function(_,y){return y.replace(/{([^{}]+)}/g,(v,T)=>T in _?String(_[T]):"")}(n.properties,h)}createBucket(e){return new Rs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of h_.paint.overridableProperties){if(!Op.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new zx(n),c=new ql(o,n.property.specification);let h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new Wl("source",c):new ka("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Be(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Op.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),c=h_.paint.properties[n];let h=!1;const p=_=>{for(const y of _)if(c.overrides&&c.overrides.hasOverride(y))return void(h=!0)};if(o.value.kind==="constant"&&o.value.value instanceof hn)p(o.value.value.sections);else if(o.value.kind==="source"){const _=v=>{h||(v instanceof Do&&Ni(v.value)===ds?p(v.value.sections):v instanceof xa?p(v.sections):v.eachChild(_))},y=o.value;y._styleExpression&&_(y._styleExpression.expression)}return h}getProgramConfiguration(e){return new ks(this,e)}}var FT={paint:new rt({"background-color":new xe(fe.paint_background["background-color"]),"background-pattern":new st(fe.paint_background["background-pattern"]),"background-opacity":new xe(fe.paint_background["background-opacity"])})},OT={paint:new rt({"raster-opacity":new xe(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new xe(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xe(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xe(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new xe(fe.paint_raster["raster-saturation"]),"raster-contrast":new xe(fe.paint_raster["raster-contrast"]),"raster-resampling":new xe(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new xe(fe.paint_raster["raster-fade-duration"])})};class NT extends Yr{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var UT={paint:new rt({"sky-type":new xe(fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new xe(fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new xe(fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new xe(fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new xe(fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new qe(fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new xe(fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new xe(fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new xe(fe.paint_sky["sky-opacity"])})};function d_(i,e,n){const o=[0,0,1],c=T0([]);return S0(c,c,n?-Ge(i)+Math.PI:Ge(i)),E0(c,c,-Ge(e)),v0(o,o,c),wn(o,o)}const jT={circle:class extends Yr{constructor(i){super(i,Qb)}createBucket(i){return new Pm(i)}queryRadius(i){const e=i;return dc("circle-radius",this,e)+dc("circle-stroke-width",this,e)+up(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,o,c,h,p,_){const y=m0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return C0(i,o,h,p,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,v)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new ks(this,i)}},heatmap:class extends Yr{createBucket(i){return new I0(i)}constructor(i){super(i,s2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return dc("heatmap-radius",this,i)}queryIntersectsFeature(i,e,n,o,c,h,p,_){const y=this.paint.get("heatmap-radius").evaluate(e,n);return C0(i,o,h,p,_,!0,!0,new me(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new ks(this,i)}},hillshade:class extends Yr{constructor(i){super(i,a2)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Yr{constructor(i){super(i,E2)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(i){return new ks(this,i)}recalculate(i,e){super.recalculate(i,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new bp(i)}queryRadius(){return up(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,o,c,h){return!i.queryGeometry.isAboveHorizon&&u0(f0(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Yr{constructor(i){super(i,R2)}createBucket(i){return new Xu(i)}queryRadius(){return up(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new ks(this,i)}queryIntersectsFeature(i,e,n,o,c,h,p,_,y){const v=m0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),C=this.paint.get("fill-extrusion-base").evaluate(e,n),A=[0,0],M=_&&h.elevation,P=h.elevation?h.elevation.exaggeration():1,R=i.tile.getBucket(this);if(M&&R instanceof Xu){const ie=R.centroidVertexArray,te=y+1;if(te<ie.length){const ne=ie.get(te);A[0]=ne.a_centroid_pos0,A[1]=ne.a_centroid_pos1}}if(A[0]===0&&A[1]===1)return!1;h.projection.name==="globe"&&(o=j0([o],[new me(0,0),new me(yt,yt)],i.tileID.canonical).map(ie=>ie.polygon).flat());const V=function(ie,te,ne,se,ce,Ce,Ie,De,Ne,Te,ze){return ie.projection.name==="globe"?function(Ue,Ve,Qe,Re,He,St,Mt,ht,nt,Dt,At){const lt=[],Ui=[],Ii=Ue.projection.upVectorScale(At,Ue.center.lat,Ue.worldSize).metersToTile,vi=[0,0,0,1],Lt=[0,0,0,1],jt=(Qt,Yt,li,fi)=>{Qt[0]=Yt,Qt[1]=li,Qt[2]=fi,Qt[3]=1},ti=U0();Qe>0&&(Qe+=ti),Re+=ti;for(const Qt of Ve){const Yt=[],li=[];for(const fi of Qt){const Ki=fi.x+He.x,Bn=fi.y+He.y,Rt=Ue.projection.projectTilePoint(Ki,Bn,At),wi=Ue.projection.upVector(At,fi.x,fi.y);let pn=Qe,qt=Re;if(Mt){const mi=Z0(Ki,Bn,Qe,Re,Mt,ht,nt,Dt);pn+=mi.base,qt+=mi.top}Qe!==0?jt(vi,Rt.x+wi[0]*Ii*pn,Rt.y+wi[1]*Ii*pn,Rt.z+wi[2]*Ii*pn):jt(vi,Rt.x,Rt.y,Rt.z),jt(Lt,Rt.x+wi[0]*Ii*qt,Rt.y+wi[1]*Ii*qt,Rt.z+wi[2]*Ii*qt),sn(vi,vi,St),sn(Lt,Lt,St),Yt.push(Sp(vi)),li.push(Sp(Lt))}lt.push(Yt),Ui.push(li)}return[lt,Ui]}(ie,te,ne,se,ce,Ce,Ie,De,Ne,Te,ze):Ie?function(Ue,Ve,Qe,Re,He,St,Mt,ht,nt){const Dt=[],At=[],lt=[0,0,0,1];for(const Ui of Ue){const Ii=[],vi=[];for(const Lt of Ui){const jt=Lt.x+Re.x,ti=Lt.y+Re.y,Qt=Z0(jt,ti,Ve,Qe,St,Mt,ht,nt);lt[0]=jt,lt[1]=ti,lt[2]=Qt.base,lt[3]=1,Xa(lt,lt,He),lt[3]=Math.max(lt[3],1e-5);const Yt=Sp([lt[0]/lt[3],lt[1]/lt[3],lt[2]/lt[3]]);lt[0]=jt,lt[1]=ti,lt[2]=Qt.top,lt[3]=1,Xa(lt,lt,He),lt[3]=Math.max(lt[3],1e-5);const li=Sp([lt[0]/lt[3],lt[1]/lt[3],lt[2]/lt[3]]);Ii.push(Yt),vi.push(li)}Dt.push(Ii),At.push(vi)}return[Dt,At]}(te,ne,se,ce,Ce,Ie,De,Ne,Te):function(Ue,Ve,Qe,Re,He){const St=[],Mt=[],ht=He[8]*Ve,nt=He[9]*Ve,Dt=He[10]*Ve,At=He[11]*Ve,lt=He[8]*Qe,Ui=He[9]*Qe,Ii=He[10]*Qe,vi=He[11]*Qe;for(const Lt of Ue){const jt=[],ti=[];for(const Qt of Lt){const Yt=Qt.x+Re.x,li=Qt.y+Re.y,fi=He[0]*Yt+He[4]*li+He[12],Ki=He[1]*Yt+He[5]*li+He[13],Bn=He[2]*Yt+He[6]*li+He[14],Rt=He[3]*Yt+He[7]*li+He[15],wi=fi+ht,pn=Ki+nt,qt=Bn+Dt,mi=Math.max(Rt+At,1e-5),En=fi+lt,ui=Ki+Ui,ki=Bn+Ii,Ji=Math.max(Rt+vi,1e-5),Gi=new me(wi/mi,pn/mi);Gi.z=qt/mi,jt.push(Gi);const ln=new me(En/Ji,ui/Ji);ln.z=ki/Ji,ti.push(ln)}St.push(jt),Mt.push(ti)}return[St,Mt]}(te,ne,se,ce,Ce)}(h,o,C,T,v,p,M?_:null,A,P,h.center.lat,i.tileID.canonical),W=i.queryGeometry;return function(ie,te,ne){let se=1/0;u0(ne,te)&&(se=$0(ne,te[0]));for(let ce=0;ce<te.length;ce++){const Ce=te[ce],Ie=ie[ce];for(let De=0;De<Ce.length-1;De++){const Ne=Ce[De],Te=[Ne,Ce[De+1],Ie[De+1],Ie[De],Ne];c0(ne,Te)&&(se=Math.min(se,$0(ne,Te)))}}return se!==1/0&&se}(V[0],V[1],W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends Yr{constructor(i){super(i,q0),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof co,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=W0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Cp(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new ks(this,i)}queryRadius(i){const e=i,n=X0(dc("line-width",this,e),dc("line-gap-width",this,e)),o=dc("line-offset",this,e);return n/2+Math.abs(o)+up(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,o,c,h){if(i.queryGeometry.isAboveHorizon)return!1;const p=f0(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),_=i.pixelToTileUnitsFactor/2*X0(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(o=function(v,T){const C=[],A=new me(0,0);for(let M=0;M<v.length;M++){const P=v[M],R=[];for(let V=0;V<P.length;V++){const W=P[V-1],ie=P[V],te=P[V+1],ne=V===0?A:ie.sub(W)._unit()._perp(),se=V===P.length-1?A:te.sub(ie)._unit()._perp(),ce=ne._add(se)._unit();ce._mult(1/(ce.x*se.x+ce.y*se.y)),R.push(ce._mult(T)._add(ie))}C.push(R)}return C}(o,y*i.pixelToTileUnitsFactor)),function(v,T,C){for(let A=0;A<T.length;A++){const M=T[A];if(v.length>=3){for(let P=0;P<M.length;P++)if(qa(v,M[P]))return!0}if(Hb(v,M,C))return!0}return!1}(p,o,_)}isTileClipped(){return!0}},symbol:Op,background:class extends Yr{constructor(i){super(i,FT)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Yr{constructor(i){super(i,OT)}getProgramIds(){return["raster"]}},sky:class extends Yr{constructor(i){super(i,UT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Vm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),c=!o,h=i.style.light,p=h.properties.get("position");return c&&h.properties.get("anchor")==="viewport"&&Pt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?d_(p.azimuthal,90-p.polar,e):d_(o[0],90-o[1],e)}const n=this.paint.get("sky-gradient-center");return d_(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class nh{constructor(e,n,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,o){const{width:c,height:h}=e,{context:p}=this,{gl:_}=p,{HTMLImageElement:y,HTMLCanvasElement:v,HTMLVideoElement:T,ImageData:C,ImageBitmap:A}=G;if(_.bindTexture(_.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!n||n.premultiply!==!1)),o||this.size&&this.size[0]===c&&this.size[1]===h){const{x:M,y:P}=o||{x:0,y:0};e instanceof y||e instanceof v||e instanceof T||e instanceof C||A&&e instanceof A?_.texSubImage2D(_.TEXTURE_2D,0,M,P,_.RGBA,_.UNSIGNED_BYTE,e):_.texSubImage2D(_.TEXTURE_2D,0,M,P,c,h,_.RGBA,_.UNSIGNED_BYTE,e.data)}else this.size=[c,h],e instanceof y||e instanceof v||e instanceof T||e instanceof C||A&&e instanceof A?_.texImage2D(_.TEXTURE_2D,0,this.format,this.format,_.UNSIGNED_BYTE,e):_.texImage2D(_.TEXTURE_2D,0,this.format,c,h,0,this.format,_.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,n){const{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class p_{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new qo({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const o=this.getKey(e,n);return this.positions[o]}trim(){const e=this.width,n=this.height=Co(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){const c=[];let h=e.length%2==1?-e[e.length-1]*o:0,p=e[0]*o,_=!0;c.push({left:h,right:p,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let v=1;v<e.length;v++){_=!_;const T=e[v];h=y*o,y+=T,p=y*o,c.push({left:h,right:p,isDash:_,zeroLength:T===0})}return c}addRoundDash(e,n,o){const c=n/2;for(let h=-o;h<=o;h++){const p=this.width*(this.nextRow+o+h);let _=0,y=e[_];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++_]);const T=Math.abs(v-y.left),C=Math.abs(v-y.right),A=Math.min(T,C);let M;const P=h/o*(c+1);if(y.isDash){const R=c-Math.abs(P);M=Math.sqrt(A*A+R*R)}else M=c-Math.sqrt(A*A+P*P);this.image.data[p+v]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){const v=e[y],T=e[y+1];v.zeroLength?e.splice(y,1):T&&T.isDash===v.isDash&&(T.left=v.left,e.splice(y,1))}const o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);const h=this.width*this.nextRow;let p=0,_=e[p];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++p]);const v=Math.abs(y-_.left),T=Math.abs(y-_.right),C=Math.min(v,T);this.image.data[h+y]=Math.max(0,Math.min(255,(_.isDash?C:-C)+n+128))}}addDash(e,n){const o=this.getKey(e,n);if(this.positions[o])return this.positions[o];const c=n==="round",h=c?7:0,p=2*h+1;if(this.nextRow+p>this.height)return Pt("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let T=0;T<e.length;T++)e[T]<0&&(Pt("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),_+=e[T];if(_!==0){const T=this.width/_,C=this.getDashRanges(e,this.width,T);c?this.addRoundDash(C,T,h):this.addRegularDash(C,n==="square"?.5*T:0)}const y=this.nextRow+h;this.nextRow+=p;const v={tl:[y,h],br:[_,0]};return this.positions[o]=v,v}}it(p_,"LineAtlas");class VT{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class GT{constructor(){this.tasks={},this.taskQueue=[],Vn(["process"],this),this.invoker=new VT(this.process),this.nextId=0}add(e,n){const o=this.nextId++,c=function({type:h,isSymbolTile:p,zoom:_}){return _=_||0,h==="message"?0:h!=="maybePrepare"||p?h!=="parseTile"||p?h==="parseTile"&&p?300-_:h==="maybePrepare"&&p?400-_:500:200-_:100-_}(n);if(c===0){Wi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:n,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){Wi();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){const h=this.tasks[this.taskQueue[c]];h.priority<n&&(n=h.priority,e=c)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}function Ya(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const n=Math.pow(2,-i.z),o=i.x*n,c=(i.x+1)*n,h=i.y*n,p=(i.y+1)*n,_=vn(o),y=vn(c),v=Pi(h),T=Pi(p),C=e.project(_,v),A=e.project(y,v),M=e.project(y,T),P=e.project(_,T);let R=Math.min(C.x,A.x,M.x,P.x),V=Math.min(C.y,A.y,M.y,P.y),W=Math.max(C.x,A.x,M.x,P.x),ie=Math.max(C.y,A.y,M.y,P.y);const te=n/16;function ne(ce,Ce,Ie,De,Ne,Te){const ze=(Ie+Ne)/2,Ue=(De+Te)/2,Ve=e.project(vn(ze),Pi(Ue)),Qe=Math.max(0,R-Ve.x,V-Ve.y,Ve.x-W,Ve.y-ie);R=Math.min(R,Ve.x),W=Math.max(W,Ve.x),V=Math.min(V,Ve.y),ie=Math.max(ie,Ve.y),Qe>te&&(ne(ce,Ve,Ie,De,ze,Ue),ne(Ve,Ce,ze,Ue,Ne,Te))}ne(C,A,o,h,c,h),ne(A,M,c,h,c,p),ne(M,P,c,p,o,p),ne(P,C,o,p,o,h),R-=te,V-=te,W+=te,ie+=te;const se=1/Math.max(W-R,ie-V);return{scale:se,x:R*se,y:V*se,x2:W*se,y2:ie*se,projection:e}}class Px{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const $T=["tile","layer","source","sourceLayer","state"];class Dx{constructor(e,n,o,c,h){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=o,this._y=c,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const n of $T)this[n]!==void 0&&(e[n]=this[n]);return e}}const Ir=32,go=33,Fs=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,n=0,o=0,c=0,h=0,p=0,_=0;for(1&e?c=h=p=Ir:n=o=_=Ir;(e>>=1)>1;){const v=n+c>>1,T=o+h>>1;1&e?(c=n,h=o,n=p,o=_):(n=c,o=h,c=p,h=_),p=v,_=T}const y=4*i;Fs[y+0]=n,Fs[y+1]=o,Fs[y+2]=c,Fs[y+3]=h}const yo=new Uint16Array(2178),Os=new Uint8Array(1089),Np=new Uint16Array(1089);function Lx(i){return i===0?-.03125:i===32?.03125:0}var Bx=Ke([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Rx={type:2,extent:yt,loadGeometry:()=>[[new me(0,0),new me(8193,0),new me(8193,8193),new me(0,8193),new me(0,0)]]};class f_{constructor(e,n,o,c,h){this.tileID=e,this.uid=Un(),this.uses=0,this.tileSize=n,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<Gn.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ya(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,h){const p={};if(!h)return p;for(const _ of c){const y=_.layerIds.map(v=>h.getLayer(v)).filter(Boolean);if(y.length!==0){_.layers=y,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(v=>y.filter(T=>T.id===v)[0]));for(const v of y)p[v.id]=_}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const h=this.buckets[c];if(h instanceof Rs){if(this.hasSymbolBuckets=!0,!o)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const h=this.buckets[c];if(h instanceof Rs&&h.hasRTLText){this.hasRTLText=!0,Z.isLoading()||Z.isLoaded()||q()!=="deferred"||ee();break}}this.queryPadding=0;for(const c in this.buckets){const h=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Em}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new nh(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new nh(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new nh(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,o,c,h,p,_,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:_,transform:p,params:h,tileTransform:this.tileTransform},e,n,o):{}}querySourceFeatures(e,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),h=n?n.sourceLayer:"",p=c._geojsonTileLayer||c[h];if(!p)return;const _=Yl(n&&n.filter),{z:y,x:v,y:T}=this.tileID.canonical,C={z:y,x:v,y:T};for(let A=0;A<p.length;A++){const M=p.feature(A);if(_.needGeometry){const V=Za(M,!0);if(!_.filter(new Y(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!_.filter(new Y(this.tileID.overscaledZ),M))continue;const P=o.getId(M,h),R=new Dx(M,y,v,T,P);R.tile=C,e.push(R)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const o=Xi(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const h=this.expirationTime-n;h?this.expirationTime=o+Math.max(h,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;const o=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const p=this.buckets[h],_=p.layers[0].sourceLayer||"_geojsonTileLayer",y=o[_],v=e[_];if(!y||!v||Object.keys(v).length===0)continue;if(p.update(v,y,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof Cp||p instanceof bp){const C=n.style._getSourceCache(p.layers[0].source);n._terrain&&n._terrain.enabled&&C&&p.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(C.id,this.tileID)}const T=n&&n.style&&n.style.getLayer(h);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Gn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Gn.now()+e}setTexture(e,n){const o=n.context,c=o.gl;this.texture=n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new nh(o,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax))}setDependencies(e,n){const o={};for(const c of n)o[c]=!0;this.dependencies[e]=o}hasDependency(e,n){for(const o of e){const c=this.dependencies[o];if(c){for(const h of n)if(c[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const o=Zo(Rx,this.tileID.canonical,this.tileTransform)[0],c=new Zt,h=new Fu;for(let p=0;p<o.length;p++){const{x:_,y}=o[p];c.emplaceBack(_,y),h.emplaceBack(p)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(c,th.members),this._tileDebugSegments=Ai.simpleSegment(0,0,c.length,h.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const o=Zo(Rx,this.tileID.canonical,this.tileTransform)[0];let c,h;if(this.isRaster){const p=function(_,y){const v=Ya(_,y),T=Math.pow(2,_.z);for(let V=0;V<go;V++)for(let W=0;W<go;W++){const ie=vn((_.x+(W+Lx(W))/Ir)/T),te=Pi((_.y+(V+Lx(V))/Ir)/T),ne=y.project(ie,te),se=V*go+W;yo[2*se+0]=Math.round((ne.x*v.scale-v.x)*yt),yo[2*se+1]=Math.round((ne.y*v.scale-v.y)*yt)}Os.fill(0),Np.fill(0);for(let V=2045;V>=0;V--){const W=4*V,ie=Fs[W+0],te=Fs[W+1],ne=Fs[W+2],se=Fs[W+3],ce=ie+ne>>1,Ce=te+se>>1,Ie=ce+Ce-te,De=Ce+ie-ce,Ne=te*go+ie,Te=se*go+ne,ze=Ce*go+ce,Ue=Math.hypot((yo[2*Ne+0]+yo[2*Te+0])/2-yo[2*ze+0],(yo[2*Ne+1]+yo[2*Te+1])/2-yo[2*ze+1])>=16;if(Os[ze]=Os[ze]||(Ue?1:0),V<1022){const Ve=(te+De>>1)*go+(ie+Ie>>1),Qe=(se+De>>1)*go+(ne+Ie>>1);Os[ze]=Os[ze]||Os[Ve]||Os[Qe]}}const C=new Jt,A=new Ci;let M=0;function P(V,W){const ie=W*go+V;return Np[ie]===0&&(C.emplaceBack(yo[2*ie+0],yo[2*ie+1],V*yt/Ir,W*yt/Ir),Np[ie]=++M),Np[ie]-1}function R(V,W,ie,te,ne,se){const ce=V+ie>>1,Ce=W+te>>1;if(Math.abs(V-ne)+Math.abs(W-se)>1&&Os[Ce*go+ce])R(ne,se,V,W,ce,Ce),R(ie,te,ne,se,ce,Ce);else{const Ie=P(V,W),De=P(ie,te),Ne=P(ne,se);A.emplaceBack(Ie,De,Ne)}}return R(0,0,Ir,Ir,Ir,0),R(Ir,Ir,0,0,0,Ir),{vertices:C,indices:A}}(this.tileID.canonical,n);c=p.vertices,h=p.indices}else{c=new Jt,h=new Ci;for(const{x:_,y}of o)c.emplaceBack(_,y,0,0);const p=gp(c.int16,void 0,4);for(let _=0;_<p.length;_+=3)h.emplaceBack(p[_],p[_+1],p[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,Bx.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=Ai.simpleSegment(0,0,c.length,h.length)}_makeGlobeTileDebugBuffers(e,n){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!n||n.name!=="globe")return;const o=this.tileID.canonical,c=ih(_o(o));this._makeGlobeTileDebugBorderBuffer(e,o,c),this._makeGlobeTileDebugTextBuffer(e,o,c)}_makeGlobeTileDebugBorderBuffer(e,n,o){const c=new Zt,h=new Fu,p=new ri,_=(v,T,C,A,M)=>{const P=(C-v)/(M-1),R=(A-T)/(M-1),V=c.length;for(let W=0;W<M;W++){const ie=v+W*P,te=T+W*R;c.emplaceBack(ie,te);const ne=Cx(ie,te,n),se=sn(ne,ne,o);p.emplaceBack(se[0],se[1],se[2]),h.emplaceBack(V+W)}},y=yt;_(0,0,y,0,16),_(y,0,y,y,16),_(y,y,0,y,16),_(0,y,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(c,th.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(p,Tx.members),this._tileDebugSegments=Ai.simpleSegment(0,0,c.length,h.length)}_makeGlobeTileDebugTextBuffer(e,n,o){const c=new Zt,h=new Ci,p=new ri,_=25;h.reserve(32),c.reserve(_),p.reserve(_);const y=(v,T)=>_*v+T;for(let v=0;v<_;v++){const T=2048*v;for(let C=0;C<_;C++){const A=2048*C;c.emplaceBack(A,T);const M=Cx(A,T,n),P=sn(M,M,o);p.emplaceBack(P[0],P[1],P[2])}}for(let v=0;v<4;v++)for(let T=0;T<4;T++){const C=y(v,T),A=y(v,T+1),M=y(v+1,T),P=y(v+1,T+1);h.emplaceBack(C,A,M),h.emplaceBack(M,A,P)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(h),this._tileDebugTextBuffer=e.createVertexBuffer(c,th.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(p,Tx.members),this._tileDebugTextSegments=Ai.simpleSegment(0,0,_,32)}}class ZT{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){const c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},vt(this.stateChanges[e][c],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==c&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const h in this.state[e][c])o[h]||(this.deletedStates[e][c][h]=null)}else for(const h in o)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][h]===null&&delete this.deletedStates[e][c][h]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;const c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(o in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][o]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){const o=String(n),c=vt({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][n];if(h===null)return{};for(const p in h)delete c[p]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const h={};for(const p in this.stateChanges[c])this.state[c][p]||(this.state[c][p]={}),vt(this.state[c][p],this.stateChanges[c][p]),h[p]=this.state[c][p];o[c]=h}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const h={};if(this.deletedStates[c]===null)for(const p in this.state[c])h[p]={},this.state[c][p]={};else for(const p in this.deletedStates[c]){if(this.deletedStates[c][p]===null)this.state[c][p]={};else for(const _ of Object.keys(this.deletedStates[c][p]))delete this.state[c][p][_];h[p]=this.state[c][p]}o[c]=o[c]||{},vt(o[c],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in e)e[c].setFeatureState(o,n)}}class Fx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Ox(i,e,n,o){let c=0,h=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(o[p])<1e-15){if(n[p]<i[p]||n[p]>e[p])return null}else{const _=1/o[p];let y=(i[p]-n[p])*_,v=(e[p]-n[p])*_;if(y>v){const T=y;y=v,v=T}if(y>c&&(c=y),v<h&&(h=v),c>h)return null}return c}function Nx(i,e,n,o,c,h,p,_,y,v,T){const C=o-i,A=c-e,M=h-n,P=p-i,R=_-e,V=y-n,W=T[1]*V-T[2]*R,ie=T[2]*P-T[0]*V,te=T[0]*R-T[1]*P,ne=C*W+A*ie+M*te;if(Math.abs(ne)<1e-15)return null;const se=1/ne,ce=v[0]-i,Ce=v[1]-e,Ie=v[2]-n,De=(ce*W+Ce*ie+Ie*te)*se;if(De<0||De>1)return null;const Ne=Ce*M-Ie*A,Te=Ie*C-ce*M,ze=ce*A-Ce*C,Ue=(T[0]*Ne+T[1]*Te+T[2]*ze)*se;return Ue<0||De+Ue>1?null:(P*Ne+R*Te+V*ze)*se}function Ux(i,e,n){return(i-e)/(n-e)}function jx(i,e,n,o,c,h,p,_,y){const v=1<<n,T=h-o,C=p-c,A=(i+1)/v*T+o,M=(e+0)/v*C+c,P=(e+1)/v*C+c;_[0]=(i+0)/v*T+o,_[1]=M,y[0]=A,y[1]=P}class Vx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(h){const p=Math.ceil(Math.log2(h.dim/8)),_=[];let y=Math.ceil(Math.pow(2,p));const v=1/y,T=(M,P,R,V,W)=>{const ie=V?1:0,te=(M+1)*R-ie,ne=P*R,se=(P+1)*R-ie;W[0]=M*R,W[1]=ne,W[2]=te,W[3]=se};let C=new Fx(y);const A=[];for(let M=0;M<y*y;M++){T(M%y,Math.floor(M/y),v,!1,A);const P=Ns(A[0],A[1],h),R=Ns(A[2],A[1],h),V=Ns(A[2],A[3],h),W=Ns(A[0],A[3],h);C.minimums.push(Math.min(P,R,V,W)),C.maximums.push(Math.max(P,R,V,W)),C.leaves.push(1)}for(_.push(C),y/=2;y>=1;y/=2){const M=_[_.length-1];C=new Fx(y);for(let P=0;P<y*y;P++){T(P%y,Math.floor(P/y),2,!0,A);const R=M.getElevation(A[0],A[1]),V=M.getElevation(A[2],A[1]),W=M.getElevation(A[2],A[3]),ie=M.getElevation(A[0],A[3]),te=M.isLeaf(A[0],A[1]),ne=M.isLeaf(A[2],A[1]),se=M.isLeaf(A[2],A[3]),ce=M.isLeaf(A[0],A[3]),Ce=Math.min(R.min,V.min,W.min,ie.min),Ie=Math.max(R.max,V.max,W.max,ie.max),De=te&&ne&&se&&ce;C.maximums.push(Ie),C.minimums.push(Ce),C.leaves.push(Ie-Ce<=5&&De?1:0)}_.push(C)}return _}(this.dem),o=n.length-1,c=n[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,c,h,p,_=1){return Ox([e,n,-100],[o,c,this.maximums[0]*_],h,p)}raycast(e,n,o,c,h,p,_=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,n,o,c,h,p,_);if(y==null)return null;const v=[],T=[],C=[],A=[],M=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;M.length>0;){const{idx:P,t:R,nodex:V,nodey:W,depth:ie}=M.pop();if(this.leaves[P]){jx(V,W,ie,e,n,o,c,C,A);const ne=1<<ie,se=(V+0)/ne,ce=(V+1)/ne,Ce=(W+0)/ne,Ie=(W+1)/ne,De=Ns(se,Ce,this.dem)*_,Ne=Ns(ce,Ce,this.dem)*_,Te=Ns(ce,Ie,this.dem)*_,ze=Ns(se,Ie,this.dem)*_,Ue=Nx(C[0],C[1],De,A[0],C[1],Ne,A[0],A[1],Te,h,p),Ve=Nx(A[0],A[1],Te,C[0],A[1],ze,C[0],C[1],De,h,p),Qe=Math.min(Ue!==null?Ue:Number.MAX_VALUE,Ve!==null?Ve:Number.MAX_VALUE);if(Qe!==Number.MAX_VALUE)return Qe;{const Re=_p([],h,p,R);if(Gx(De,Ne,ze,Te,Ux(Re[0],C[0],A[0]),Ux(Re[1],C[1],A[1]))>=Re[2])return R}continue}let te=0;for(let ne=0;ne<this._siblingOffset.length;ne++){jx((V<<1)+this._siblingOffset[ne][0],(W<<1)+this._siblingOffset[ne][1],ie+1,e,n,o,c,C,A),C[2]=-100,A[2]=this.maximums[this.childOffsets[P]+ne]*_;const se=Ox(C,A,h,p);if(se!=null){const ce=se;v[ne]=ce;let Ce=!1;for(let Ie=0;Ie<te&&!Ce;Ie++)ce>=v[T[Ie]]&&(T.splice(Ie,0,ne),Ce=!0);Ce||(T[te]=ne),te++}}for(let ne=0;ne<te;ne++){const se=T[ne];M.push({idx:this.childOffsets[P]+se,t:v[se],nodex:(V<<1)+this._siblingOffset[se][0],nodey:(W<<1)+this._siblingOffset[se][1],depth:ie+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,c,h){if(e[c].isLeaf(n,o)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const p=c-1,_=e[p];let y=0,v=0;for(let T=0;T<this._siblingOffset.length;T++){const C=2*n+this._siblingOffset[T][0],A=2*o+this._siblingOffset[T][1],M=_.getElevation(C,A),P=_.isLeaf(C,A),R=this._addNode(M.min,M.max,P);P&&(y|=1<<T),v||(v=R)}for(let T=0;T<this._siblingOffset.length;T++)y&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*o+this._siblingOffset[T][1],p,v+T)}}function Gx(i,e,n,o,c,h){return Ot(Ot(i,n,h),Ot(e,o,h),c)}function Ns(i,e,n){const o=n.dim,c=Fe(i*o-.5,0,o-1),h=Fe(e*o-.5,0,o-1),p=Math.floor(c),_=Math.floor(h),y=Math.min(p+1,o-1),v=Math.min(_+1,o-1);return Gx(n.get(p,_),n.get(y,_),n.get(p,v),n.get(y,v),c-p,h-_)}const $x={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Up{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,c=!1,h=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return Pt(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const p=this.dim=n.height-2,_=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=o||"mapbox",this.borderReady=c,!c){for(let y=0;y<p;y++)_[this._idx(-1,y)]=_[this._idx(0,y)],_[this._idx(p,y)]=_[this._idx(p-1,y)],_[this._idx(y,-1)]=_[this._idx(y,0)],_[this._idx(y,p)]=_[this._idx(y,p-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(p,-1)]=_[this._idx(p-1,0)],_[this._idx(-1,p)]=_[this._idx(0,p-1)],_[this._idx(p,p)]=_[this._idx(p-1,p-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Vx(this)}get(e,n,o=!1){o&&(e=Fe(e,-1,this.dim),n=Fe(n,-1,this.dim));const c=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return $x[e]}get unpackVector(){return $x[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,o){return(256*e*256+256*n+o)/10-1e4}_unpackTerrarium(e,n,o){return 256*e+n+o/256-32768}static pack(e,n){const o=[0,0,0,0],c=Up.getUnpackVector(n);let h=Math.floor((e+c[3])/c[2]);return o[2]=h%256,h=Math.floor(h/256),o[1]=h%256,h=Math.floor(h/256),o[0]=h,o}getPixels(){return new Jn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,h=n*this.dim+this.dim,p=o*this.dim,_=o*this.dim+this.dim;switch(n){case-1:c=h-1;break;case 1:h=c+1}switch(o){case-1:p=_-1;break;case 1:_=p+1}const y=-n*this.dim,v=-o*this.dim;for(let T=p;T<_;T++)for(let C=c;C<h;C++){const A=4*this._idx(C,T),M=4*this._idx(C+y,T+v);this.pixels[A+0]=e.pixels[M+0],this.pixels[A+1]=e.pixels[M+1],this.pixels[A+2]=e.pixels[M+2],this.pixels[A+3]=e.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}it(Up,"DEMData"),it(Vx,"DemMinMaxQuadTree",{omit:["dem"]});class qT{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const h={value:n,timeout:void 0};if(o!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},o)),this.data[c].push(h),this.order.push(c),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const o=e.wrapped().key,c=n===void 0?0:this.data[o].indexOf(n),h=this.data[o][c];return this.data[o].splice(c,1),h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(h.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const o in this.data)for(const c of this.data[o])e(c.value)||n.push(c);for(const o of n)this.remove(o.value.tileID,o)}}class Tc{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}Tc.ReadOnly=!1,Tc.ReadWrite=!0,Tc.disabled=new Tc(519,Tc.ReadOnly,[0,1]);const m_=7680;class __{constructor(e,n,o,c,h,p){this.test=e,this.ref=n,this.mask=o,this.fail=c,this.depthFail=h,this.pass=p}}__.disabled=new __({func:519,mask:0},0,0,m_,m_,m_);class xo{constructor(e,n,o){this.blendFunction=e,this.blendColor=n,this.mask=o}}xo.Replace=[1,0],xo.disabled=new xo(xo.Replace,xi.transparent,[!1,!1,!1,!1]),xo.unblended=new xo(xo.Replace,xi.transparent,[!0,!0,!0,!0]),xo.alphaBlended=new xo([1,771],xi.transparent,[!0,!0,!0,!0]);const g_=1029,y_=2305;class Kr{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}Kr.disabled=new Kr(!1,g_,y_),Kr.backCCW=new Kr(!0,g_,y_),Kr.backCW=new Kr(!0,g_,2304),Kr.frontCW=new Kr(!0,1028,2304),Kr.frontCCW=new Kr(!0,1028,y_);class Ka extends Xt{constructor(e,n,o){super(),this.id=e,this._onlySymbols=o,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new qT(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new ZT,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const n in this._tiles){const o=this._tiles[n];this._source.prepareTile(o)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,o.tileID),o.upload(e),o.prepare(this.map.style.imageManager)}else for(const n in this._tiles){const o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return ii(this._tiles).map(e=>e.tileID).sort(Zx).map(e=>e.key)}getRenderableIds(e){const n=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&n.push(this._tiles[o]);return e?n.sort((o,c)=>{const h=o.tileID,p=c.tileID,_=new me(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),y=new me(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-p.overscaledZ||y.y-_.y||y.x-_.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(Zx).map(o=>o.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,e,n)))}_tileLoaded(e,n,o,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new ni(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Gn.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Gt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const h=n[c];if(e.neighboringTiles&&e.neighboringTiles[h]){const p=this.getTileByID(h);o(e,p),o(p,e)}}function o(c,h){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let p=h.tileID.canonical.x-c.tileID.canonical.x;const _=h.tileID.canonical.y-c.tileID.canonical.y,y=Math.pow(2,c.tileID.canonical.z),v=h.tileID.key;p===0&&_===0||Math.abs(_)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),h.dem&&c.dem&&(c.dem.backfillBorder(h.dem,p,_),c.neighboringTiles&&c.neighboringTiles[v]&&(c.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,c){for(const h in this._tiles){let p=this._tiles[h];if(c[h]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>o)continue;let _=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){const v=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[v.key],p&&p.hasData()&&(_=v)}let y=_;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){c[_.key]=_;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){const c=e.scaledTo(o),h=this._getLoadedTile(c);if(h)return h}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const o=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,h=Math.floor(o*c*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(_)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const o={};for(const c in this._tiles){const h=this._tiles[c];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),o[h.tileID.key]=h}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let c;this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(_=>new bn(_.canonical.z,_.wrap,_.canonical.z,_.canonical.x,_.canonical.y)):(c=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(_=>this._source.hasTile(_)))):c=[];const h=this._updateRetainedTiles(c);if(qx(this._source.type)&&c.length!==0){const _={},y={},v=Object.keys(h);for(const C of v){const A=h[C],M=this._tiles[C];if(!M||M.fadeEndTime&&M.fadeEndTime<=Gn.now())continue;const P=this.findLoadedParent(A,Math.max(A.overscaledZ-Ka.maxOverzooming,this._source.minzoom));P&&(this._addTile(P.tileID),_[P.tileID.key]=P.tileID),y[C]=A}const T=c[c.length-1].overscaledZ;for(const C in this._tiles){const A=this._tiles[C];if(h[C]||!A.hasData())continue;let M=A.tileID;for(;M.overscaledZ>T;){M=M.scaledTo(M.overscaledZ-1);const P=this._tiles[M.key];if(P&&P.hasData()&&y[M.key]){h[C]=A.tileID;break}}}for(const C in _)h[C]||(this._coveredTiles[C]=!0,h[C]=_[C])}for(const _ in h)this._tiles[_].clearFadeHold();const p=function(_,y){const v=[];for(const T in _)T in y||v.push(T);return v}(this._tiles,h);for(const _ of p){const y=this._tiles[_];y.hasSymbolBuckets&&!y.holdingForFade()?y.setHoldDuration(this.map._fadeDuration):y.hasSymbolBuckets&&!y.symbolFadeFinished()||this._removeTile(+_)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const o={},c=e.reduce((v,T)=>Math.min(v,T.overscaledZ),1/0),h=e[0].overscaledZ,p=Math.max(h-Ka.maxOverzooming,this._source.minzoom),_=Math.max(h+Ka.maxUnderzooming,this._source.minzoom),y={};for(const v of e){const T=this._addTile(v);n[v.key]=v,T.hasData()||c<this._source.maxzoom&&(y[v.key]=v)}this._retainLoadedChildren(y,c,_,n);for(const v of e){let T=this._tiles[v.key];if(T.hasData())continue;if(v.canonical.z>=this._source.maxzoom){const A=v.children(this._source.maxzoom)[0],M=this.getTile(A);if(M&&M.hasData()){n[A.key]=A;continue}}else{const A=v.children(this._source.maxzoom);if(n[A[0].key]&&n[A[1].key]&&n[A[2].key]&&n[A[3].key])continue}let C=T.wasRequested();for(let A=v.overscaledZ-1;A>=p;--A){const M=v.scaledTo(A);if(o[M.key]||(o[M.key]=!0,T=this.getTile(M),!T&&C&&(T=this._addTile(M)),T&&(n[M.key]=M,C=T.wasRequested(),T.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let o,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}n.push(c.key);const h=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(h),o)break;c=h}for(const h of n)this._loadedParentTiles[h]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return this._source.prepareTile&&this._source.prepareTile(n),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const o=Boolean(n);if(!o){const c=this.map?this.map.painter:null;n=new f_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._source.prepareTile&&this._source.prepareTile(n)||this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,o||this._source.fire(new Gt("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,o){const c=[],h=this.transform;if(!h)return c;const p=h.projection.name==="globe",_=Ga(h.center.lng);for(const y in this._tiles){const v=this._tiles[y];if(o&&v.clearQueryDebugViz(),v.holdingForFade())continue;let T;if(p){const C=v.tileID.canonical;if(C.z===0){const A=[Math.abs(Fe(_,...rh(C,-1))-_),Math.abs(Fe(_,...rh(C,1))-_)];T=[0,2*A.indexOf(Math.min(...A))-1]}else{const A=[Math.abs(Fe(_,...rh(C,-1))-_),Math.abs(Fe(_,...rh(C,0))-_),Math.abs(Fe(_,...rh(C,1))-_)];T=[A.indexOf(Math.min(...A))-1]}}else T=[0];for(const C of T){const A=e.containsTile(v,h,n,C);A&&c.push(A)}}return c}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of n)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(qx(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Gn.now())return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){const c=this._tiles[e];c&&c.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(const o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}_preloadTiles(e,n){const o=new Map,c=Array.isArray(e)?e:[e],h=this.map.painter.terrain,p=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(const _ of c){const y=_.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const v of y)o.set(v.key,v);this.usedForTerrain&&_.updateElevation(!1)}_t(Array.from(o.values()),(_,y)=>{const v=new f_(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(v,T=>{this._source.type==="raster-dem"&&v.dem&&this._backfillDEM(v),y(T,v)})},n)}}function Zx(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function qx(i){return i==="raster"||i==="image"||i==="video"}function rh(i,e){const n=1<<i.z;return[i.x/n+e,(i.x+1)/n+e]}Ka.maxOverzooming=10,Ka.maxUnderzooming=3;class jp{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){const c=o||e.findDEMTileFor(n);if(!c||!c.dem)return;const h=c.dem,p=c.tileID,_=1<<n.canonical.z-p.canonical.z;return new jp(c,c.tileSize/yt/_,[(n.canonical.x/_-p.canonical.x)*h.dim,(n.canonical.y/_-p.canonical.y)*h.dim])}tileCoordToPixel(e,n){const o=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(o);return new me(c,h)}getElevationAt(e,n,o,c){const h=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],_=Math.floor(h),y=Math.floor(p),v=this._dem;return c=!!c,o?Ot(Ot(v.get(_,y,c),v.get(_,y+1,c),p-y),Ot(v.get(_+1,y,c),v.get(_+1,y+1,c),p-y),h-_):v.get(_,y,c)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Sr(1,e)*this._dem.stride}}class Wx{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new jo(yt,16,0),this.featureIndexArray=new Hy,this.promoteId=n}insert(e,n,o,c,h,p=0){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,h,p);const y=this.grid;for(let v=0;v<n.length;v++){const T=n[v],C=[1/0,1/0,-1/0,-1/0];for(let A=0;A<T.length;A++){const M=T[A];C[0]=Math.min(C[0],M.x),C[1]=Math.min(C[1],M.y),C[2]=Math.max(C[2],M.x),C[3]=Math.max(C[3],M.y)}C[0]<yt&&C[1]<yt&&C[2]>=0&&C[3]>=0&&y.insert(_,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ha.VectorTile(new Ju(this.rawTileData)).layers,this.sourceLayerCoder=new Px(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,o,c){this.loadVTLayers();const h=e.params||{},p=Yl(h.filter),_=e.tileResult,y=e.transform,v=_.bufferedTilespaceBounds,T=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(P,R,V,W)=>p0(_.bufferedTilespaceGeometry,P,R,V,W));T.sort(WT);let C=null;y.elevation&&T.length>0&&(C=jp.create(y.elevation,this.tileID));const A={};let M;for(let P=0;P<T.length;P++){const R=T[P];if(R===M)continue;M=R;const V=this.featureIndexArray.get(R);let W=null;this.loadMatchingFeature(A,V,p,h.layers,h.availableImages,n,o,c,(ie,te,ne,se=0)=>(W||(W=Zo(ie,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(_,ie,ne,W,this.z,e.transform,e.pixelPosMatrix,C,se)))}return A}loadMatchingFeature(e,n,o,c,h,p,_,y,v){const{featureIndex:T,bucketIndex:C,sourceLayerIndex:A,layoutVertexArrayOffset:M}=n,P=this.bucketLayerIDs[C];if(c&&!function(ie,te){for(let ne=0;ne<ie.length;ne++)if(te.indexOf(ie[ne])>=0)return!0;return!1}(c,P))return;const R=this.sourceLayerCoder.decode(A),V=this.vtLayers[R].feature(T);if(o.needGeometry){const ie=Za(V,!0);if(!o.filter(new Y(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!o.filter(new Y(this.tileID.overscaledZ),V))return;const W=this.getId(V,R);for(let ie=0;ie<P.length;ie++){const te=P[ie];if(c&&c.indexOf(te)<0)continue;const ne=p[te];if(!ne)continue;let se={};W!==void 0&&y&&(se=y.getState(ne.sourceLayer||"_geojsonTileLayer",W));const ce=vt({},_[te]);ce.paint=Xx(ce.paint,ne.paint,V,se,h),ce.layout=Xx(ce.layout,ne.layout,V,se,h);const Ce=!v||v(V,ne,se,M);if(!Ce)continue;const Ie=new Dx(V,this.z,this.x,this.y,W);Ie.layer=ce;let De=e[te];De===void 0&&(De=e[te]=[]),De.push({featureIndex:T,feature:Ie,intersectionZ:Ce})}}lookupSymbolFeatures(e,n,o,c,h,p,_,y){const v={};this.loadVTLayers();const T=Yl(h);for(const C of e)this.loadMatchingFeature(v,{bucketIndex:o,sourceLayerIndex:c,featureIndex:C,layoutVertexArrayOffset:0},T,p,_,y,n);return v}loadFeature(e){const{featureIndex:n,sourceLayerIndex:o}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(o),h=this.vtFeatures[c];if(h[n])return h[n];const p=this.vtLayers[c].feature(n);return h[n]=p,p}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function Xx(i,e,n,o,c){return at(i,(h,p)=>{const _=e instanceof Pe?e.get(p):null;return _&&_.evaluate?_.evaluate(n,o,c):_})}function WT(i,e){return e-i}it(Wx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Hx{constructor(e){const n={},o=[];for(const _ in e){const y=e[_],v=n[_]={};for(const T in y.glyphs){const C=y.glyphs[+T];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const A=C.metrics.localGlyph?2:1,M={x:0,y:0,w:C.bitmap.width+2*A,h:C.bitmap.height+2*A};o.push(M),v[T]=M}}const{w:c,h}=Km(o),p=new qo({width:c||1,height:h||1});for(const _ in e){const y=e[_];for(const v in y.glyphs){const T=y.glyphs[+v];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const C=n[_][v],A=T.metrics.localGlyph?2:1;qo.copy(T.bitmap,p,{x:0,y:0},{x:C.x+A,y:C.y+A},T.bitmap)}}this.image=p,this.positions=n}}it(Hx,"GlyphAtlas");class XT{constructor(e){this.tileID=new bn(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ya(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,o,c,h){this.status="parsing",this.data=e,this.collisionBoxArray=new Em;const p=new Px(Object.keys(e.layers).sort()),_=new Wx(this.tileID,this.promoteId);_.bucketLayerIDs=[];const y={},v=new p_(256,256),T={featureIndex:_,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:v,availableImages:o},C=n.familiesBySource[this.source];for(const se in C){const ce=e.layers[se];if(!ce)continue;let Ce=!1,Ie=!1;for(const Te of C[se])Te[0].type==="symbol"?Ce=!0:Ie=!0;if(this.isSymbolTile===!0&&!Ce||this.isSymbolTile===!1&&!Ie)continue;ce.version===1&&Pt(`Vector tile source "${this.source}" layer "${se}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const De=p.encode(se),Ne=[];for(let Te=0;Te<ce.length;Te++){const ze=ce.feature(Te),Ue=_.getId(ze,se);Ne.push({feature:ze,id:Ue,index:Te,sourceLayerIndex:De})}for(const Te of C[se]){const ze=Te[0];this.isSymbolTile!==void 0&&ze.type==="symbol"!==this.isSymbolTile||ze.minzoom&&this.zoom<Math.floor(ze.minzoom)||ze.maxzoom&&this.zoom>=ze.maxzoom||ze.visibility!=="none"&&(x_(Te,this.zoom,o),(y[ze.id]=ze.createBucket({index:_.bucketLayerIDs.length,layers:Te,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:De,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:o})).populate(Ne,T,this.tileID.canonical,this.tileTransform),_.bucketLayerIDs.push(Te.map(Ue=>Ue.id)))}}let A,M,P,R;v.trim();const V={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},W=at(T.glyphDependencies,se=>Object.keys(se).map(Number));Object.keys(W).length?c.send("getGlyphs",{uid:this.uid,stacks:W},(se,ce)=>{A||(A=se,M=ce,ne.call(this))},void 0,!1,V):M={};const ie=Object.keys(T.iconDependencies);ie.length?c.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(se,ce)=>{A||(A=se,P=ce,ne.call(this))},void 0,!1,V):P={};const te=Object.keys(T.patternDependencies);function ne(){if(A)return h(A);if(M&&P&&R){const se=new Hx(M),ce=new ix(P,R);for(const Ce in y){const Ie=y[Ce];Ie instanceof Rs?(x_(Ie.layers,this.zoom,o),TT(Ie,M,se.positions,P,ce.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection)):Ie.hasPattern&&(Ie instanceof Cp||Ie instanceof bp||Ie instanceof Xu)&&(x_(Ie.layers,this.zoom,o),Ie.addFeatures(T,this.tileID.canonical,ce.patternPositions,o,this.tileTransform))}this.status="done",h(null,{buckets:ii(y).filter(Ce=>!Ce.isEmpty()),featureIndex:_,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:se.image,lineAtlas:v,imageAtlas:ce,glyphMap:this.returnDependencies?M:null,iconMap:this.returnDependencies?P:null,glyphPositions:this.returnDependencies?se.positions:null})}}te.length?c.send("getImages",{icons:te,source:this.source,tileID:this.tileID,type:"patterns"},(se,ce)=>{A||(A=se,R=ce,ne.call(this))},void 0,!1,V):R={},ne.call(this)}}function x_(i,e,n){const o=new Y(e);for(const c of i)c.recalculate(o,n)}class Yx{constructor(e){this.entries={},this.scheduler=e}request(e,n,o,c){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[p,_]=h.result;return this.scheduler?this.scheduler.add(()=>{c(p,_)},n):c(p,_),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=o((p,_)=>{h.result=[p,_];for(const y of h.callbacks)this.scheduler?this.scheduler.add(()=>{y(p,_)},n):y(p,_);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==c),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function Kx(i,e,n){const o=JSON.stringify(i.request);return i.data&&(this.deduped.entries[o]={result:[null,i.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},c=>{const h=le(i.request,(p,_,y,v)=>{p?c(p):_&&c(null,{vectorTile:n?void 0:new Ha.VectorTile(new Ju(_)),rawData:_,cacheControl:y,expires:v})});return()=>{h.cancel(),c()}},e)}function Jx(i,e){const n=i.fovAboveCenter,o=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,c=(i._camera.position[2]*i.worldSize-o)/Math.cos(i._pitch),h=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-i._pitch-n,.01)),p=Math.sin(i._pitch)*h+c;return Math.min(1.01*p,c*(1/i._horizonShift))}const HT=Kn(new Float32Array(16));class Us{constructor(e){this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Ht(0,0)}projectTilePoint(e,n,o){return{x:e,y:n,z:0}}locationPoint(e,n,o=!0){return e._coordinatePoint(e.locationCoordinate(n),o)}pixelsPerMeter(e,n){return Sr(1,e)*n}farthestPixelDistance(e){return Jx(e,e.pixelsPerMeter)}pointCoordinate(e,n,o,c){const h=e.horizonLineFromTop(!1),p=new me(n,Math.max(h,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,n,o){const c=new me(n,o);if(e.elevation)return e.elevation.pointCoordinate(c);{const h=this.pointCoordinate(e,c.x,c.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const o=e.horizonLineFromTop();return n.y<o}createInversionMatrix(e,n){return HT}createTileMatrix(e,n,o){let c,h,p;const _=o.canonical,y=Kn(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=Ya(_,this);c=1,h=v.x+o.wrap*v.scale,p=v.y,po(y,y,[c/v.scale,c/v.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(_.z),h=(_.x+Math.pow(2,_.z)*o.wrap)*c,p=_.y*c;return Wa(y,y,[h,p,0]),po(y,y,[c/yt,c/yt,1]),y}upVector(e,n,o){return[0,0,1]}upVectorScale(e,n,o){return{metersToTile:1}}}class Qx extends Us{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ga(e),y:$a(n),z:0}}unproject(e,n){const o=vn(e),c=Pi(n);return new Ht(o,c)}}const ev=2*Sr(1,0)*Bs*Math.PI;class YT extends Qx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,n,o){const c=Math.pow(2,o.z),h=(e/yt+o.x)/c,p=Tn(Pi((n/yt+o.y)/c),vn(h));return sn(p,p,ih(_o(o))),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,n){const o=Tn(n.lat,n.lng),c=wn([],o),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;_p(o,o,c,Sr(1,0)*yt*h);const p=Kn(new Float64Array(16));return zs(p,e.pixelMatrix,e.globeMatrix),sn(o,o,p),new me(o[0],o[1])}pixelsPerMeter(e,n){return Sr(1,0)*n}createTileMatrix(e,n,o){const c=Ax(_o(o.canonical));return zs(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){const{center:o}=e,c=Kn(new Float64Array(16));return zs(c,c,ih(_o(n))),pp(c,c,Ge(o.lng)),dp(c,c,Ge(o.lat)),po(c,c,[e._projectionScaler,e._projectionScaler,1]),Float32Array.from(c)}pointCoordinate(e,n,o,c){return Ex(e,n,o,!0)||new hc(0,0)}pointCoordinate3D(e,n,o){const c=this.pointCoordinate(e,n,o,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!Ex(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(c,h){const p=c.cameraToCenterDistance,_=c._centerAltitude*h,y=c._camera,v=c._camera.forward(),T=Ps([],fo([],v,-p),[0,0,_]),C=c.worldSize/(2*Math.PI),A=[0,0,-C],M=c.width/c.height,P=Math.tan(c.fovAboveCenter),R=fo([],y.up(),P),V=fo([],y.right(),P*M),W=wn([],Ps([],Ps([],v,R),V)),ie=[];let te;if(new Om(T,W).closestPointOnSphere(A,C,ie)){const ne=Ps([],ie,A),se=Ar([],ne,T);te=Math.cos(c.fovAboveCenter)*Uu(se)}else{const ne=Ar([],T,A),se=Ar([],A,T);wn(se,se);const ce=Uu(ne)-C;te=Math.sqrt(ce*(ce+2*C));const Ce=Math.acos(te/(C+ce))-Math.acos(Cr(v,se));te*=Math.cos(Ce)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=l_(e.zoom);if(o>0){const c=Jx(e,Sr(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ot(n,c+h*(1-Math.cos(p)),Math.pow(o,10))}return n}upVector(e,n,o){const c=1<<e.z,h=(n/yt+e.x)/c;return Tn(Pi((o/yt+e.y)/c),vn(h),1)}upVectorScale(e){return{metersToTile:ev*Lp(_o(e))}}}class KT extends Us{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,o]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Ge(n));this.n=(c+Math.sin(Ge(o)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:o,c,r0:h}=this,p=Ge(e-this.center[0]),_=Ge(n),y=Math.sqrt(c-2*o*Math.sin(_))/o;return{x:y*Math.sin(p*o),y:y*Math.cos(p*o)-h,z:0}}unproject(e,n){const{n:o,c,r0:h}=this,p=h+n;let _=Math.atan2(e,Math.abs(p))*Math.sign(p);p*o<0&&(_-=Math.PI*Math.sign(e)*Math.sign(p));const y=Ge(this.center[0])*o;_=ut(_,-Math.PI-y,Math.PI-y);const v=Tt(_/o)+this.center[0],T=Math.asin(Fe((c-(e*e+p*p)*o*o)/(2*o),-1,1)),C=Fe(Tt(T),-85.051129,ho);return new Ht(v,C)}}const oh=1.340264,sh=-.081106,ah=893e-6,lh=.003796,Vp=Math.sqrt(3)/2;class JT extends Us{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Vp*Math.sin(n)),c=o*o,h=c*c*c;return{x:.5*(e*Math.cos(o)/(Vp*(oh+3*sh*c+h*(7*ah+9*lh*c)))/Math.PI+.5),y:1-.5*(o*(oh+sh*c+h*(ah+lh*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,c=o*o,h=c*c*c;for(let T,C,A,M=0;M<12&&(C=o*(oh+sh*c+h*(ah+lh*c))-n,A=oh+3*sh*c+h*(7*ah+9*lh*c),T=C/A,o=Fe(o-T,-Math.PI/3,Math.PI/3),c=o*o,h=c*c*c,!(Math.abs(T)<1e-12));++M);const p=Vp*e*(oh+3*sh*c+h*(7*ah+9*lh*c))/Math.cos(o),_=Math.asin(Math.sin(o)/Vp),y=Fe(180*p/Math.PI,-180,180),v=Fe(180*_/Math.PI,-85.051129,ho);return new Ht(y,v)}}class QT extends Us{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const o=360*(e-.5),c=Fe(360*(.5-n),-85.051129,ho);return new Ht(o,c)}}const Ec=Math.PI/2;function Gp(i){return Math.tan((Ec+i)/2)}class eE extends Us{constructor(e){super(e),this.center=e.center||[0,30];const[n,o]=this.parallels=e.parallels||[30,30],c=Ge(n),h=Ge(o),p=Math.cos(c);this.n=c===h?Math.sin(c):Math.log(p/Math.cos(h))/Math.log(Gp(h)/Gp(c)),this.f=p*Math.pow(Gp(c),this.n)/this.n}project(e,n){n=Ge(n),e=Ge(e-this.center[0]);const o=1e-6,{n:c,f:h}=this;h>0?n<-Ec+o&&(n=-Ec+o):n>Ec-o&&(n=Ec-o);const p=h/Math.pow(Gp(n),c),_=p*Math.sin(c*e),y=h-p*Math.cos(c*e);return{x:.5*(_/Math.PI+.5),y:1-.5*(y/Math.PI+.5),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,n=(2*(1-n)-.5)*Math.PI;const{n:o,f:c}=this,h=c-n,p=Math.sign(h),_=Math.sign(o)*Math.sqrt(e*e+h*h);let y=Math.atan2(e,Math.abs(h))*p;h*o<0&&(y-=Math.PI*Math.sign(e)*p);const v=Fe(Tt(y/o)+this.center[0],-180,180),T=Fe(Tt(2*Math.atan(Math.pow(c/_,1/o))-Ec),-85.051129,ho);return new Ht(v,T)}}const tv=Ge(ho);class tE extends Us{project(e,n){const o=(n=Ge(n))*n,c=o*o;return{x:.5*((e=Ge(e))*(.8707-.131979*o+c*(c*(.003971*o-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+o*(.015085+c*(.028874*o-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let o=n=(2*(1-n)-1)*Math.PI,c=25,h=0,p=o*o;do{p=o*o;const v=p*p;h=(o*(1.007226+p*(.015085+v*(.028874*p-.044475-.005916*v)))-n)/(1.007226+p*(.045255+v*(.259866*p-.311325-.005916*11*v))),o=Fe(o-h,-tv,tv)}while(Math.abs(h)>1e-6&&--c>0);p=o*o;const _=Fe(Tt(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=Tt(o);return new Ht(_,y)}}const iv=Ge(ho);class iE extends Us{project(e,n){n=Ge(n),e=Ge(e);const o=Math.cos(n),c=2/Math.PI,h=Math.acos(o*Math.cos(e/2)),p=Math.sin(h)/h,_=.5*(e*c+2*o*Math.sin(e/2)/p)||0,y=.5*(n+Math.sin(n)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let o=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,h=25;const p=1e-6;let _=0,y=0;do{const v=Math.cos(c),T=Math.sin(c),C=2*T*v,A=T*T,M=v*v,P=Math.cos(o/2),R=Math.sin(o/2),V=2*P*R,W=R*R,ie=1-M*P*P,te=ie?1/ie:0,ne=ie?Math.acos(v*P)*Math.sqrt(1/ie):0,se=.5*(2*ne*v*R+2*o/Math.PI)-e,ce=.5*(ne*T+c)-n,Ce=.5*te*(M*W+ne*v*P*A)+1/Math.PI,Ie=te*(V*C/4-ne*T*R),De=.125*te*(C*R-ne*T*M*V),Ne=.5*te*(A*P+ne*W*v)+.5,Te=Ie*De-Ne*Ce;_=(ce*Ie-se*Ne)/Te,y=(se*De-ce*Ce)/Te,o=Fe(o-_,-Math.PI,Math.PI),c=Fe(c-y,-iv,iv)}while((Math.abs(_)>p||Math.abs(y)>p)&&--h>0);return new Ht(Tt(o),Tt(c))}}class nv extends Us{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ge(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:o,cosPhi:c}=this;return{x:Ge(e)*c*o+.5,y:-Math.sin(Ge(n))/c*o+.5,z:0}}unproject(e,n){const{scale:o,cosPhi:c}=this,h=-(n-.5)/o,p=Fe(Tt((e-.5)/o)/c,-180,180),_=Math.asin(Fe(h*c,-1,1)),y=Fe(Tt(_),-85.051129,ho);return new Ht(p,y)}}s.ARRAY_TYPE=Yn,s.AUTH_ERR_MSG=Mn,s.Aabb=dr,s.Actor=class{constructor(i,e,n){this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Vn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Wi()?i:G,this.scheduler=new GT}send(i,e,n,o,c=!1,h){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=h,this.callbacks[p]=n);const _=ls(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!n,targetMapId:o,mustQueue:c,sourceMapId:this.mapId,data:La(e,_)},_),{cancel:()=>{n&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const e=i.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const o=this.cancelCallbacks[n];delete this.cancelCallbacks[n],o&&o.cancel()}else if(e.mustQueue||Wi()){const o=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),o&&o.metadata||{type:"message"})}else this.processTask(n,e)}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(Ba(e.error)):n(null,Ba(e.data)))}else{const n=ls(this.globalScope)?void 0:[],o=e.hasCallback?(h,p)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:h?La(h):null,data:La(p,n)},n)}:h=>{},c=Ba(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,o);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],c.source)[h[1]](c,o)}else o(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Ep,s.Color=xi,s.ColorMode=xo,s.CullFaceMode=Kr,s.DEMData=Up,s.DataConstantProperty=xe,s.DedupedRequest=Yx,s.DepthMode=Tc,s.EXTENT=yt,s.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const n=e.getSource().maxzoom,o=1<<n,c=Math.floor(i.x),h=Math.floor((i.x-c)*o),p=Math.floor(i.y*o),_=this.findDEMTileFor(new bn(n,c,n,h,p));return!(!_||!_.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,n=!0){e==null&&(e=null);const o=this._source();if(!o||i.y<0||i.y>1)return e;const c=o.getSource().maxzoom,h=1<<c,p=Math.floor(i.x),_=i.x-p,y=new bn(c,p,c,Math.floor(_*h),Math.floor(i.y*h)),v=this.findDEMTileFor(y);if(!v||!v.dem)return e;const T=v.dem,C=1<<v.tileID.canonical.z,A=(_*C-v.tileID.canonical.x)*T.dim,M=(i.y*C-v.tileID.canonical.y)*T.dim,P=Math.floor(A),R=Math.floor(M);return(n?this.exaggeration():1)*Ot(Ot(T.get(P,R),T.get(P,R+1),M-R),Ot(T.get(P+1,R),T.get(P+1,R+1),M-R),A-P)}getAtTileOffset(i,e,n){const o=1<<i.canonical.z;return this.getAtPointOrZero(new hc(i.wrap+(i.canonical.x+e/yt)/o,(i.canonical.y+n/yt)/o))}getAtTileOffsetFunc(i,e,n,o){return c=>{const h=this.getAtTileOffset(i,c.x,c.y),p=o.upVector(i.canonical,c.x,c.y);return fo(p,p,h*o.upVectorScale(i.canonical,e,n).metersToTile),p}}getForTilePoints(i,e,n,o){const c=jp.create(this,i,o);return!!c&&(e.forEach(h=>{h[2]=this.exaggeration()*c.getElevationAt(h[0],h[1],n)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const n=e.dem.tree,o=e.tileID,c=1<<i.canonical.z-o.canonical.z;let h=i.canonical.x/c-o.canonical.x,p=i.canonical.y/c-o.canonical.y,_=0;for(let y=0;y<i.canonical.z-o.canonical.z&&!n.leaves[_];y++){h*=2,p*=2;const v=2*Math.floor(p)+Math.floor(h);_=n.childOffsets[_]+v,h%=1,p%=1}return{min:this.exaggeration()*n.minimums[_],max:this.exaggeration()*n.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=ni,s.EvaluationParameters=Y,s.Event=Gt,s.Evented=Xt,s.FillExtrusionBucket=Xu,s.Frustum=Um,s.FrustumCorners=Nm,s.GLOBE_METERS_TO_ECEF=ev,s.GLOBE_RADIUS=Bs,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const e=new Zt,n=new Ci,o=65;for(let c=0;c<o;c++)for(let h=0;h<o;h++)e.emplaceBack(h,c);this._gridSegments=[];for(let c=0,h=0;c<bc.length;c++){const p=bc[c];for(let y=0;y<p;y++)for(let v=0;v<64;v++){const T=y*o+v;n.emplaceBack(T+1,T,T+o),n.emplaceBack(T+o,T+o+1,T+1)}const _=64*p*2;this._gridSegments.push(Ai.simpleSegment(0,h,(p+1)*o,_)),h+=_}this._gridBuffer=i.createVertexBuffer(e,th.members),this._gridIndexBuffer=i.createIndexBuffer(n,!0)}_createPoles(i){const e=new Ci;for(let c=0;c<=64;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const n=new cc,o=new cc;this._poleSegments=[];for(let c=0,h=0;c<5;c++){const p=1<<c,_=512*p/Math.PI/2,y=360/p;n.emplaceBack(0,-_,0,0,0,.5,0),o.emplaceBack(0,-_,0,0,0,.5,1);for(let v=0;v<=64;v++){const T=v/64,C=Ot(0,y,T),[A,M,P]=Sx(zT,PT,C,_);n.emplaceBack(A,M,P,0,0,T,0),o.emplaceBack(A,M,P,0,0,T,1)}this._poleSegments.push(Ai.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(n,bx,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(o,bx,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const n=new As,o=64,c=o+1;this._wireframeSegments=[];for(let h=0,p=0;h<bc.length;h++){const _=bc[h];for(let v=0;v<_;v++)for(let T=0;T<o;T++){const C=v*c+T;n.emplaceBack(C,C+1),n.emplaceBack(C,C+c),n.emplaceBack(C,C+c+1)}const y=_*o*3;this._wireframeSegments.push(Ai.simpleSegment(0,p,(_+1)*c,y)),p+=y}this._wireframeIndexBuffer=i.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=vc,s.ImagePosition=Jm,s.LineAtlas=p_,s.LngLat=Ht,s.LngLatBounds=Ms,s.LocalGlyphMode=i_,s.MAX_MERCATOR_LATITUDE=ho,s.MercatorCoordinate=hc,s.ONE_EM=an,s.OverscaledTileID=bn,s.Properties=rt,s.RGBAImage=Jn,s.Ray=Om,s.RequestManager=class{constructor(i,e,n){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ua,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!wr(i))return i;const n=zn(i);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!wr(i))return i;const n=zn(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(i,e,n,o){if(!wr(i))return i;const c=zn(i);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),n&&c.params.push(`language=${n}`),o&&c.params.push(`worldview=${o}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(i,e,n,o){const c=zn(i);return wr(i)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||o)):(c.path+=`${e}${n}`,Ur(c))}normalizeTileURL(i,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!wr(i))return i;const o=zn(i);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&o.authority!=="raster"&&n===512?"@2x":""}${oo.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${Ft.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${Ft.TILE_URL_VERSION}${o.path}`);const c=this._customAccessToken||function(h){for(const p of h){const _=p.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(o.params)||Ft.ACCESS_TOKEN;return Ft.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,c)}canonicalizeTileURL(i,e){const n=zn(i);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${Ft.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${Ft.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(h=>!h.match(/^access_token=/))),c.length&&(o+=`?${c.join("&")}`),o}canonicalizeTileset(i,e){const n=!!e&&wr(e),o=[];for(const c of i.tiles||[])zo(c)?o.push(this.canonicalizeTileURL(c,n)):o.push(c);return o}_makeAPIURL(i,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=zn(Ft.API_URL);if(i.protocol=o.protocol,i.authority=o.authority,i.protocol==="http"){const c=i.params.indexOf("secure");c>=0&&i.params.splice(c,1)}if(o.path!=="/"&&(i.path=`${o.path}${i.path}`),!Ft.REQUIRE_ACCESS_TOKEN)return Ur(i);if(e=e||Ft.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(c=>c.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Ur(i)}},s.ResourceType=Q,s.SegmentVector=Ai,s.SourceCache=Ka,s.StencilMode=__,s.StructArrayLayout1ui2=Fu,s.StructArrayLayout2f1f2i16=Hn,s.StructArrayLayout2i4=Zt,s.StructArrayLayout2ui4=As,s.StructArrayLayout3f12=Wr,s.StructArrayLayout3ui6=Ci,s.StructArrayLayout4i8=Jt,s.StructArrayLayout5f20=Cs,s.Texture=nh,s.Tile=f_,s.Transitionable=Me,s.Uniform1f=sp,s.Uniform1i=class extends Go{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.Uniform2f=class extends Go{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},s.Uniform3f=class extends Go{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},s.Uniform4f=i0,s.UniformColor=n0,s.UniformMatrix2f=class extends Go{constructor(i,e){super(i,e),this.current=Nb}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},s.UniformMatrix3f=class extends Go{constructor(i,e){super(i,e),this.current=Ob}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},s.UniformMatrix4f=class extends Go{constructor(i,e){super(i,e),this.current=Fb}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},s.UnwrappedTileID=G0,s.ValidationError=Xe,s.VectorTileWorkerSource=class extends Xt{constructor(i,e,n,o,c){super(),this.actor=i,this.layerIndex=e,this.availableImages=n,this.loadVectorData=c||Kx,this.loading={},this.loaded={},this.deduped=new Yx(i.scheduler),this.isSpriteLoaded=o,this.scheduler=i.scheduler}loadTile(i,e){const n=i.uid,o=i&&i.request,c=o&&o.collectResourceTiming,h=this.loading[n]=new XT(i);h.abort=this.loadVectorData(i,(p,_)=>{const y=!this.loading[n];if(delete this.loading[n],y||p||!_)return h.status="done",y||(this.loaded[n]=h),e(p);const v=_.rawData,T={};_.expires&&(T.expires=_.expires),_.cacheControl&&(T.cacheControl=_.cacheControl),h.vectorTile=_.vectorTile||new Ha.VectorTile(new Ju(v));const C=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(A,M)=>{if(A||!M)return e(A);const P={};if(c){const R=Ao(o);R.length>0&&(P.resourceTiming=JSON.parse(JSON.stringify(R)))}e(null,vt({rawTileData:v.slice(0)},M,T,P))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[n]=h})}reloadTile(i,e){const n=this.loaded,o=i.uid,c=this;if(n&&n[o]){const h=n[o];h.showCollisionBoxes=i.showCollisionBoxes,h.enableTerrain=!!i.enableTerrain,h.projection=i.projection,h.tileTransform=Ya(i.tileID.canonical,i.projection);const p=(_,y)=>{const v=h.reloadCallback;v&&(delete h.reloadCallback,h.parse(h.vectorTile,c.layerIndex,this.availableImages,c.actor,v)),e(_,y)};h.status==="parsing"?h.reloadCallback=p:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(i,e){const n=i.uid,o=this.loading[n];o&&(o.abort&&o.abort(),delete this.loading[n]),e()}removeTile(i,e){const n=this.loaded,o=i.uid;n&&n[o]&&delete n[o],e()}},s.WritingMode=pr,s.ZoomHistory=Ra,s.add=Ps,s.addDynamicAttributes=Fp,s.adjoint=function(i,e){var n=e[0],o=e[1],c=e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=e[8];return i[0]=p*T-_*v,i[1]=c*v-o*T,i[2]=o*_-c*p,i[3]=_*y-h*T,i[4]=n*T-c*y,i[5]=c*h-n*_,i[6]=h*v-p*y,i[7]=o*y-n*v,i[8]=n*p-o*h,i},s.asyncAll=_t,s.bezier=Se,s.bindAll=Vn,s.boundsAttributes=Bx,s.bufferConvexPolygon=function(i,e){const n=[];for(let o=0;o<i.length;o++){const c=ut(o-1,-1,i.length-1),h=ut(o+1,-1,i.length-1),p=i[o],_=i[h],y=i[c].sub(p).unit(),v=_.sub(p).unit(),T=v.angleWithSep(y.x,y.y),C=y.add(v).unit().mult(-1*e/Math.sin(T/2));n.push(p.add(C))}return n},s.cacheEntryPossiblyAdded=function(i){X++,X>yl&&(i.getActor().send("enforceCacheSizeLimit",hs),X=0)},s.calculateGlobeLabelMatrix=function(i,e){const{x:n,y:o}=i.point,c=Ix(n,o,i.worldSize/i._projectionScaler,0,0);return zs(c,c,Ax(_o(e)))},s.calculateGlobeMatrix=function(i){const{x:e,y:n}=i.point,{lng:o,lat:c}=i._center;return Ix(e,n,i.worldSize,o,c)},s.calculateGlobeMercatorMatrix=function(i){const e=i.worldSize,n=i.point,o=Sr(1,i.center.lat)*e,c=i.pixelsPerMeter,h=e/(o/i.pixelsPerMeter),p=Kn(new Float64Array(16));return Wa(p,p,[n.x,n.y,0]),po(p,p,[h,h,c]),Float32Array.from(p)},s.circumferenceAtLatitude=Im,s.clamp=Fe,s.clearTileCache=function(i){const e=[];for(const n in yn)e.push(G.caches.delete(n)),delete yn[n];i&&Promise.all(e).catch(i).then(()=>i())},s.clipLine=fx,s.clone=function(i){var e=new Yn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.clone$1=wt,s.collisionCircleLayout=H2,s.config=Ft,s.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},s.create=function(){var i=new Yn(16);return Yn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$1=_0,s.createExpression=No,s.createLayout=Ke,s.createStyleLayer=function(i){return i.type==="custom"?new NT(i):new jT[i.type](i)},s.cross=Fm,s.degToRad=Ge,s.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},s.div=function(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i},s.dot=Cr,s.ease=Ze,s.easeCubicInOut=he,s.emitValidationErrors=Gd,s.endsWith=xr,s.enforceCacheSizeLimit=function(i){for(const e in yn)H(e),yn[e].then(n=>{n.keys().then(o=>{for(let c=0;c<o.length-i;c++)n.delete(o[c])})})},s.evaluateSizeForFeature=Ap,s.evaluateSizeForZoom=_c,s.evaluateVariableOffset=xx,s.evented=K,s.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},s.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},s.exported=Gn,s.exported$1=oo,s.extend=vt,s.extend$1=Pn,s.fillExtrusionHeightLift=U0,s.filterObject=Et,s.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},s.fromQuat=function(i,e){var n=e[0],o=e[1],c=e[2],h=e[3],p=n+n,_=o+o,y=c+c,v=n*p,T=o*p,C=o*_,A=c*p,M=c*_,P=c*y,R=h*p,V=h*_,W=h*y;return i[0]=1-C-P,i[1]=T+W,i[2]=A-V,i[3]=0,i[4]=T-W,i[5]=1-v-P,i[6]=M+R,i[7]=0,i[8]=A+V,i[9]=M-R,i[10]=1-v-C,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.fromRotation=function(i,e){var n=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return ve[e]},s.getAABBPointSquareDist=function(i,e,n){let o=0;for(let c=0;c<2;++c){const h=n?n[c]:0;i[c]>h&&(o+=(i[c]-h)*(i[c]-h)),e[c]<h&&(o+=(h-e[c])*(h-e[c]))}return o},s.getAnchorAlignment=t_,s.getAnchorJustification=r_,s.getBounds=function(i){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const h of i)e=Math.min(e,h.x),n=Math.min(n,h.y),o=Math.max(o,h.x),c=Math.max(c,h.y);return{min:new me(e,n),max:new me(o,c)}},s.getColumn=Rr,s.getGridMatrix=function(i,e,n){const[o,c]=e,h=.015625;return[0,(c[1]-o[1])*h,1<<i.z,(c[0]-o[0])/bc[n],0,i.y,o[0],o[1],h]},s.getImage=ft,s.getJSON=function(i,e){return pe(vt(i,{type:"json"}),e)},s.getLatitudinalLod=function(i){const e=80.051129;i=Fe(i,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Ge(i))),3);return Math.round(n*(bc.length-1))},s.getMapSessionAPI=eu,s.getPerformanceMeasurement=Ao,s.getProjection=function(i){const e=i.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Qx(i);case"equirectangular":return new QT(i);case"naturalEarth":return new tE(i);case"equalEarth":return new JT(i);case"winkelTripel":return new iE(i);case"albers":return n?new nv(i):new KT(i);case"lambertConformalConic":return n?new nv(i):new eE(i);case"globe":return new YT(i)}throw new Error(`Invalid projection name: ${i.name}`)},s.getRTLTextPluginStatus=q,s.getReferrer=_e,s.getTilePoint=function(i,{x:e,y:n},o=0){return new me(((e-o)*i.scale-i.x)*yt,(n*i.scale-i.y)*yt)},s.getTileVec3=function(i,e,n=0){return pc(((e.x-n)*i.scale-i.x)*yt,(e.y*i.scale-i.y)*yt,s0(e.z,e.y))},s.getVideo=function(i,e){const n=G.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<i.length;o++){const c=G.document.createElement("source");et(i[o])||(n.crossOrigin="Anonymous"),c.src=i[o],n.appendChild(c)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(i){const e=[0,0,0],n=Kn(new Float64Array(16));return zs(n,i.pixelMatrix,i.globeMatrix),sn(e,e,n),new me(e[0],e[1])},s.globeECEFOrigin=function(i,e){const n=[0,0,0];return sn(n,n,ih(_o(e.canonical))),sn(n,n,i),n},s.globeNormalizeECEF=ih,s.globePixelsToTileUnits=function(i,e){return yt/(512*Math.pow(2,i))*Lp(_o(e))},s.globePoleMatrixForTile=function(i,e,n){const o=Kn(new Float64Array(16)),c=1<<i,h=360*(e/c-.5),p=n.point,_=n.worldSize/(n.tileSize*c);return Wa(o,o,[p.x,p.y,-n.worldSize/Math.PI/2]),po(o,o,[_,_,_]),dp(o,o,Ge(-n._center.lat)),pp(o,o,Ge(-n._center.lng+h)),Float32Array.from(o)},s.globeTileBounds=_o,s.globeTileLatLngCorners=a_,s.globeTiltAtLngLat=kx,s.globeToMercatorTransition=l_,s.globeUseCustomAntiAliasing=function(i,e,n){return l_(n.zoom)===0&&!i.style.map._antialias&&!e.extStandardDerivativesForceOff&&!!e.extStandardDerivatives},s.identity=Kn,s.identity$1=T0,s.invert=function(i,e){var n=e[0],o=e[1],c=e[2],h=e[3],p=e[4],_=e[5],y=e[6],v=e[7],T=e[8],C=e[9],A=e[10],M=e[11],P=e[12],R=e[13],V=e[14],W=e[15],ie=n*_-o*p,te=n*y-c*p,ne=n*v-h*p,se=o*y-c*_,ce=o*v-h*_,Ce=c*v-h*y,Ie=T*R-C*P,De=T*V-A*P,Ne=T*W-M*P,Te=C*V-A*R,ze=C*W-M*R,Ue=A*W-M*V,Ve=ie*Ue-te*ze+ne*Te+se*Ne-ce*De+Ce*Ie;return Ve?(i[0]=(_*Ue-y*ze+v*Te)*(Ve=1/Ve),i[1]=(c*ze-o*Ue-h*Te)*Ve,i[2]=(R*Ce-V*ce+W*se)*Ve,i[3]=(A*ce-C*Ce-M*se)*Ve,i[4]=(y*Ne-p*Ue-v*De)*Ve,i[5]=(n*Ue-c*Ne+h*De)*Ve,i[6]=(V*ne-P*Ce-W*te)*Ve,i[7]=(T*Ce-A*ne+M*te)*Ve,i[8]=(p*ze-_*Ne+v*Ie)*Ve,i[9]=(o*Ne-n*ze-h*Ie)*Ve,i[10]=(P*ce-R*ne+W*ie)*Ve,i[11]=(C*ne-T*ce-M*ie)*Ve,i[12]=(_*De-p*Te-y*Ie)*Ve,i[13]=(n*Te-o*De+c*Ie)*Ve,i[14]=(R*te-P*se-V*ie)*Ve,i[15]=(T*se-C*te+A*ie)*Ve,i):null},s.isLngLatBehindGlobe=function(i,e){return kx(i,e)>Math.PI/2*1.01},s.isMapAuthenticated=function(i){return so.has(i)},s.isMapboxURL=wr,s.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!ls(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Pi,s.len=i2,s.length=Uu,s.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},s.loadVectorTile=Kx,s.makeRequest=pe,s.mapValue=function(i,e,n,o,c){return Fe((i-e)/(n-e)*(c-o)+o,o,c)},s.mercatorXfromLng=Ga,s.mercatorYfromLat=$a,s.mercatorZfromAltitude=Sr,s.mul=e2,s.mul$1=t2,s.multiply=zs,s.multiply$1=function(i,e,n){var o=e[0],c=e[1],h=e[2],p=e[3],_=e[4],y=e[5],v=e[6],T=e[7],C=e[8],A=n[0],M=n[1],P=n[2],R=n[3],V=n[4],W=n[5],ie=n[6],te=n[7],ne=n[8];return i[0]=A*o+M*p+P*v,i[1]=A*c+M*_+P*T,i[2]=A*h+M*y+P*C,i[3]=R*o+V*p+W*v,i[4]=R*c+V*_+W*T,i[5]=R*h+V*y+W*C,i[6]=ie*o+te*p+ne*v,i[7]=ie*c+te*_+ne*T,i[8]=ie*h+te*y+ne*C,i},s.multiply$2=x0,s.nextPowerOfTwo=Co,s.normalize=wn,s.normalize$1=function(i,e){var n=e[0],o=e[1],c=e[2],h=e[3],p=n*n+o*o+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=n*p,i[1]=o*p,i[2]=c*p,i[3]=h*p,i},s.number=Ot,s.ortho=function(i,e,n,o,c,h,p){var _=1/(e-n),y=1/(o-c),v=1/(h-p);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*v,i[11]=0,i[12]=(e+n)*_,i[13]=(c+o)*y,i[14]=(p+h)*v,i[15]=1,i},s.pbf=Ju,s.perspective=function(i,e,n,o,c){var h,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+o)*(h=1/(o-c)),i[14]=2*c*o*h):(i[10]=-1,i[14]=-2*o),i},s.pick=function(i,e){const n={};for(let o=0;o<e.length;o++){const c=e[o];c in i&&(n[c]=i[c])}return n},s.plugin=Z,s.pointGeometry=me,s.polygonContainsPoint=qa,s.polygonIntersectsBox=p0,s.polygonIntersectsPolygon=c0,s.polygonizeBounds=function(i,e,n=0,o=!0){const c=new me(n,n),h=i.sub(c),p=e.add(c),_=[h,new me(p.x,h.y),p,new me(h.x,p.y)];return o&&_.push(h.clone()),_},s.posAttributes=th,s.postMapLoadEvent=_l,s.postTurnstileEvent=pa,s.potpack=Km,s.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},s.radToDeg=Tt,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(i){return i({pluginStatus:U,pluginURL:N}),K.on("pluginStateChange",i),i},s.removeAuthState=function(i){so.delete(i)},s.renderColorRamp=Vm,s.resample=a0,s.rotateX=dp,s.rotateX$1=E0,s.rotateY=pp,s.rotateY$1=S0,s.rotateZ=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),h=e[0],p=e[1],_=e[2],y=e[3],v=e[4],T=e[5],C=e[6],A=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*c+v*o,i[1]=p*c+T*o,i[2]=_*c+C*o,i[3]=y*c+A*o,i[4]=v*c-h*o,i[5]=T*c-p*o,i[6]=C*c-_*o,i[7]=A*c-y*o,i},s.rotateZ$1=function(i,e,n){n*=.5;var o=e[0],c=e[1],h=e[2],p=e[3],_=Math.sin(n),y=Math.cos(n);return i[0]=o*y+c*_,i[1]=c*y-o*_,i[2]=h*y+p*_,i[3]=p*y-h*_,i},s.scale=po,s.scale$1=w0,s.scale$2=fo,s.scaleAndAdd=_p,s.setCacheLimits=function(i,e){hs=i,yl=e},s.setColumn=function(i,e,n){i[4*e+0]=n[0],i[4*e+1]=n[1],i[4*e+2]=n[2],i[4*e+3]=n[3]},s.setRTLTextPlugin=function(i,e,n=!1){if(U===z||U===L||U===O)throw new Error("setRTLTextPlugin cannot be called multiple times.");N=Gn.resolveURL(i),U=z,j=e,$(),n||ee()},s.smoothstep=ct,s.spec=fe,s.storeAuthState=function(i,e){e?so.add(i):so.delete(i)},s.sub=Ar,s.subtract=Rm,s.symbolSize=Y2,s.tileAABB=function(i,e,n,o,c,h,p,_,y){if(y.name==="globe")return MT(i,e,new Ep(n,o,c));const v=Ya({z:n,x:o,y:c},y);return new dr([(h+v.x/v.scale)*e,e*(v.y/v.scale),p],[(h+v.x2/v.scale)*e,e*(v.y2/v.scale),_])},s.tileTransform=Ya,s.transformMat3=function(i,e,n){var o=e[0],c=e[1],h=e[2];return i[0]=o*n[0]+c*n[3]+h*n[6],i[1]=o*n[1]+c*n[4]+h*n[7],i[2]=o*n[2]+c*n[5]+h*n[8],i},s.transformMat4=sn,s.transformMat4$1=Xa,s.transformQuat=v0,s.translate=Wa,s.transpose=function(i,e){if(i===e){var n=e[1],o=e[2],c=e[5];i[1]=e[3],i[2]=e[6],i[3]=n,i[5]=e[7],i[6]=o,i[7]=c}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},s.triggerPluginCompletionEvent=J,s.uniqueId=Un,s.updateGlobeVertexNormal=function(i,e,n,o,c){const h=5*e+2;i.float32[h+0]=n,i.float32[h+1]=o,i.float32[h+2]=c},s.validateCustomStyleLayer=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=i=>qr(Mu(i)),s.validateFog=i=>qr(Pu(i)),s.validateLayer=i=>qr(Ud(i)),s.validateLight=i=>qr(tc(i)),s.validateSource=i=>qr(jd(i)),s.validateStyle=ic,s.validateTerrain=i=>qr(Da(i)),s.values=ii,s.vectorTile=Ha,s.version=Io,s.warnOnce=Pt,s.window=G,s.wrap=ut}),I(["./shared"],function(s){function G(H){if(typeof H=="number"||typeof H=="boolean"||typeof H=="string"||H==null)return JSON.stringify(H);if(Array.isArray(H)){let B="[";for(const X of H)B+=`${G(X)},`;return`${B}]`}let D="{";for(const B of Object.keys(H).sort())D+=`${B}:${G(H[B])},`;return`${D}}`}function ue(H){let D="";for(const B of s.refProperties)D+=`/${G(H[B])}`;return D}class ae{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,B){for(const Q of D)this._layerConfigs[Q.id]=Q,(this._layers[Q.id]=s.createStyleLayer(Q)).compileFilter(),this.keyCache[Q.id]&&delete this.keyCache[Q.id];for(const Q of B)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const X=function(Q,re){const _e={};for(let le=0;le<Q.length;le++){const be=re&&re[Q[le].id]||ue(Q[le]);re&&(re[Q[le].id]=be);let Le=_e[be];Le||(Le=_e[be]=[]),Le.push(Q[le])}const pe=[];for(const le in _e)pe.push(_e[le]);return pe}(s.values(this._layerConfigs),this.keyCache);for(const Q of X){const re=Q.map(et=>this._layers[et.id]),_e=re[0];if(_e.visibility==="none")continue;const pe=_e.source||"";let le=this.familiesBySource[pe];le||(le=this.familiesBySource[pe]={});const be=_e.sourceLayer||"_geojsonTileLayer";let Le=le[be];Le||(Le=le[be]=[]),Le.push(re)}}}class me{loadTile(D,B){const{uid:X,encoding:Q,rawImageData:re,padding:_e,buildQuadTree:pe}=D,le=s.window.ImageBitmap&&re instanceof s.window.ImageBitmap?this.getImageData(re,_e):re;B(null,new s.DEMData(X,le,Q,_e<1,pe))}getImageData(D,B){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const X=this.offscreenCanvasContext.getImageData(-B,-B,D.width+2*B,D.height+2*B);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),X}}var de=function H(D,B){var X,Q=D&&D.type;if(Q==="FeatureCollection")for(X=0;X<D.features.length;X++)H(D.features[X],B);else if(Q==="GeometryCollection")for(X=0;X<D.geometries.length;X++)H(D.geometries[X],B);else if(Q==="Feature")H(D.geometry,B);else if(Q==="Polygon")Ae(D.coordinates,B);else if(Q==="MultiPolygon")for(X=0;X<D.coordinates.length;X++)Ae(D.coordinates[X],B);return D};function Ae(H,D){if(H.length!==0){je(H[0],D);for(var B=1;B<H.length;B++)je(H[B],!D)}}function je(H,D){for(var B=0,X=0,Q=0,re=H.length,_e=re-1;Q<re;_e=Q++){var pe=(H[Q][0]-H[_e][0])*(H[_e][1]+H[Q][1]),le=B+pe;X+=Math.abs(B)>=Math.abs(pe)?B-le+pe:pe-le+B,B=le}B+X>=0!=!!D&&H.reverse()}const Ge=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Tt{constructor(D){this._feature=D,this.extent=s.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))}loadGeometry(){if(this._feature.type===1){const D=[];for(const B of this._feature.geometry)D.push([new s.pointGeometry(B[0],B[1])]);return D}{const D=[];for(const B of this._feature.geometry){const X=[];for(const Q of B)X.push(new s.pointGeometry(Q[0],Q[1]));D.push(X)}return D}}toGeoJSON(D,B,X){return Ge.call(this,D,B,X)}}class ve{constructor(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=D.length,this._features=D}feature(D){return new Tt(this._features[D])}}var he=s.vectorTile.VectorTileFeature,Se=Ze;function Ze(H,D){this.options=D||{},this.features=H,this.length=H.length}function Fe(H,D){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=D||4096}Ze.prototype.feature=function(H){return new Fe(this.features[H],this.options.extent)},Fe.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var D=0;D<H.length;D++){for(var B=H[D],X=[],Q=0;Q<B.length;Q++)X.push(new s.pointGeometry(B[Q][0],B[Q][1]));this.geometry.push(X)}return this.geometry},Fe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,D=1/0,B=-1/0,X=1/0,Q=-1/0,re=0;re<H.length;re++)for(var _e=H[re],pe=0;pe<_e.length;pe++){var le=_e[pe];D=Math.min(D,le.x),B=Math.max(B,le.x),X=Math.min(X,le.y),Q=Math.max(Q,le.y)}return[D,X,B,Q]},Fe.prototype.toGeoJSON=he.prototype.toGeoJSON;var ct=_t,ut=Se;function _t(H){var D=new s.pbf;return function(B,X){for(var Q in B.layers)X.writeMessage(3,ii,B.layers[Q])}(H,D),D.finish()}function ii(H,D){var B;D.writeVarintField(15,H.version||1),D.writeStringField(1,H.name||""),D.writeVarintField(5,H.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<H.length;B++)X.feature=H.feature(B),D.writeMessage(2,vt,X);var Q=X.keys;for(B=0;B<Q.length;B++)D.writeStringField(3,Q[B]);var re=X.values;for(B=0;B<re.length;B++)D.writeMessage(4,as,re[B])}function vt(H,D){var B=H.feature;B.id!==void 0&&D.writeVarintField(1,B.id),D.writeMessage(2,un,H),D.writeVarintField(3,B.type),D.writeMessage(4,Co,B)}function un(H,D){var B=H.feature,X=H.keys,Q=H.values,re=H.keycache,_e=H.valuecache;for(var pe in B.properties){var le=B.properties[pe],be=re[pe];if(le!==null){be===void 0&&(X.push(pe),re[pe]=be=X.length-1),D.writeVarint(be);var Le=typeof le;Le!=="string"&&Le!=="boolean"&&Le!=="number"&&(le=JSON.stringify(le));var et=Le+":"+le,Oe=_e[et];Oe===void 0&&(Q.push(le),_e[et]=Oe=Q.length-1),D.writeVarint(Oe)}}}function Un(H,D){return(D<<3)+(7&H)}function jn(H){return H<<1^H>>31}function Co(H,D){for(var B=H.loadGeometry(),X=H.type,Q=0,re=0,_e=B.length,pe=0;pe<_e;pe++){var le=B[pe],be=1;X===1&&(be=le.length),D.writeVarint(Un(1,be));for(var Le=X===3?le.length-1:le.length,et=0;et<Le;et++){et===1&&X!==1&&D.writeVarint(Un(2,Le-1));var Oe=le[et].x-Q,pt=le[et].y-re;D.writeVarint(jn(Oe)),D.writeVarint(jn(pt)),Q+=Oe,re+=pt}X===3&&D.writeVarint(Un(7,1))}}function as(H,D){var B=typeof H;B==="string"?D.writeStringField(1,H):B==="boolean"?D.writeBooleanField(7,H):B==="number"&&(H%1!=0?D.writeDoubleField(3,H):H<0?D.writeSVarintField(6,H):D.writeVarintField(5,H))}function Vn(H,D,B,X,Q,re){if(Q-X<=B)return;const _e=X+Q>>1;xr(H,D,_e,X,Q,re%2),Vn(H,D,B,X,_e-1,re+1),Vn(H,D,B,_e+1,Q,re+1)}function xr(H,D,B,X,Q,re){for(;Q>X;){if(Q-X>600){const be=Q-X+1,Le=B-X+1,et=Math.log(be),Oe=.5*Math.exp(2*et/3),pt=.5*Math.sqrt(et*Oe*(be-Oe)/be)*(Le-be/2<0?-1:1);xr(H,D,B,Math.max(X,Math.floor(B-Le*Oe/be+pt)),Math.min(Q,Math.floor(B+(be-Le)*Oe/be+pt)),re)}const _e=D[2*B+re];let pe=X,le=Q;for(at(H,D,X,B),D[2*Q+re]>_e&&at(H,D,X,Q);pe<le;){for(at(H,D,pe,le),pe++,le--;D[2*pe+re]<_e;)pe++;for(;D[2*le+re]>_e;)le--}D[2*X+re]===_e?at(H,D,X,le):(le++,at(H,D,le,Q)),le<=B&&(X=le+1),B<=le&&(Q=le-1)}}function at(H,D,B,X){Et(H,B,X),Et(D,2*B,2*X),Et(D,2*B+1,2*X+1)}function Et(H,D,B){const X=H[D];H[D]=H[B],H[B]=X}function wt(H,D,B,X){const Q=H-B,re=D-X;return Q*Q+re*re}ct.fromVectorTileJs=_t,ct.fromGeojsonVt=function(H,D){D=D||{};var B={};for(var X in H)B[X]=new Se(H[X].features,D),B[X].name=X,B[X].version=D.version,B[X].extent=D.extent;return _t({layers:B})},ct.GeoJSONWrapper=ut;const oi=H=>H[0],Pt=H=>H[1];class zi{constructor(D,B=oi,X=Pt,Q=64,re=Float64Array){this.nodeSize=Q,this.points=D;const _e=D.length<65536?Uint16Array:Uint32Array,pe=this.ids=new _e(D.length),le=this.coords=new re(2*D.length);for(let be=0;be<D.length;be++)pe[be]=be,le[2*be]=B(D[be]),le[2*be+1]=X(D[be]);Vn(pe,le,Q,0,pe.length-1,0)}range(D,B,X,Q){return function(re,_e,pe,le,be,Le,et){const Oe=[0,re.length-1,0],pt=[];let gt,ft;for(;Oe.length;){const xt=Oe.pop(),It=Oe.pop(),Gt=Oe.pop();if(It-Gt<=et){for(let fe=Gt;fe<=It;fe++)gt=_e[2*fe],ft=_e[2*fe+1],gt>=pe&&gt<=be&&ft>=le&&ft<=Le&&pt.push(re[fe]);continue}const ni=Math.floor((Gt+It)/2);gt=_e[2*ni],ft=_e[2*ni+1],gt>=pe&&gt<=be&&ft>=le&&ft<=Le&&pt.push(re[ni]);const Xt=(xt+1)%2;(xt===0?pe<=gt:le<=ft)&&(Oe.push(Gt),Oe.push(ni-1),Oe.push(Xt)),(xt===0?be>=gt:Le>=ft)&&(Oe.push(ni+1),Oe.push(It),Oe.push(Xt))}return pt}(this.ids,this.coords,D,B,X,Q,this.nodeSize)}within(D,B,X){return function(Q,re,_e,pe,le,be){const Le=[0,Q.length-1,0],et=[],Oe=le*le;for(;Le.length;){const pt=Le.pop(),gt=Le.pop(),ft=Le.pop();if(gt-ft<=be){for(let Xt=ft;Xt<=gt;Xt++)wt(re[2*Xt],re[2*Xt+1],_e,pe)<=Oe&&et.push(Q[Xt]);continue}const xt=Math.floor((ft+gt)/2),It=re[2*xt],Gt=re[2*xt+1];wt(It,Gt,_e,pe)<=Oe&&et.push(Q[xt]);const ni=(pt+1)%2;(pt===0?_e-le<=It:pe-le<=Gt)&&(Le.push(ft),Le.push(xt-1),Le.push(ni)),(pt===0?_e+le>=It:pe+le>=Gt)&&(Le.push(xt+1),Le.push(gt),Le.push(ni))}return et}(this.ids,this.coords,D,B,X,this.nodeSize)}}const qi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:H=>H},Wi=Math.fround||(Xi=new Float32Array(1),H=>(Xi[0]=+H,Xi[0]));var Xi;class gn{constructor(D){this.options=Fr(Object.create(qi),D),this.trees=new Array(this.options.maxZoom+1)}load(D){const{log:B,minZoom:X,maxZoom:Q,nodeSize:re}=this.options;B&&console.time("total time");const _e=`prepare ${D.length} points`;B&&console.time(_e),this.points=D;let pe=[];for(let le=0;le<D.length;le++)D[le].geometry&&pe.push(la(D[le],le));this.trees[Q+1]=new zi(pe,ko,vr,re,Float32Array),B&&console.timeEnd(_e);for(let le=Q;le>=X;le--){const be=+Date.now();pe=this._cluster(pe,le),this.trees[le]=new zi(pe,ko,vr,re,Float32Array),B&&console.log("z%d: %d clusters in %dms",le,pe.length,+Date.now()-be)}return B&&console.timeEnd("total time"),this}getClusters(D,B){let X=((D[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,D[1]));let re=D[2]===180?180:((D[2]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)X=-180,re=180;else if(X>re){const Le=this.getClusters([X,Q,180,_e],B),et=this.getClusters([-180,Q,re,_e],B);return Le.concat(et)}const pe=this.trees[this._limitZoom(B)],le=pe.range(Ao(X),Io(_e),Ao(re),Io(Q)),be=[];for(const Le of le){const et=pe.points[Le];be.push(et.numPoints?Rr(et):this.points[et.index])}return be}getChildren(D){const B=this._getOriginId(D),X=this._getOriginZoom(D),Q="No cluster with the specified id.",re=this.trees[X];if(!re)throw new Error(Q);const _e=re.points[B];if(!_e)throw new Error(Q);const pe=this.options.radius/(this.options.extent*Math.pow(2,X-1)),le=re.within(_e.x,_e.y,pe),be=[];for(const Le of le){const et=re.points[Le];et.parentId===D&&be.push(et.numPoints?Rr(et):this.points[et.index])}if(be.length===0)throw new Error(Q);return be}getLeaves(D,B,X){const Q=[];return this._appendLeaves(Q,D,B=B||10,X=X||0,0),Q}getTile(D,B,X){const Q=this.trees[this._limitZoom(D)],re=Math.pow(2,D),{extent:_e,radius:pe}=this.options,le=pe/_e,be=(X-le)/re,Le=(X+1+le)/re,et={features:[]};return this._addTileFeatures(Q.range((B-le)/re,be,(B+1+le)/re,Le),Q.points,B,X,re,et),B===0&&this._addTileFeatures(Q.range(1-le/re,be,1,Le),Q.points,re,X,re,et),B===re-1&&this._addTileFeatures(Q.range(0,be,le/re,Le),Q.points,-1,X,re,et),et.features.length?et:null}getClusterExpansionZoom(D){let B=this._getOriginZoom(D)-1;for(;B<=this.options.maxZoom;){const X=this.getChildren(D);if(B++,X.length!==1)break;D=X[0].properties.cluster_id}return B}_appendLeaves(D,B,X,Q,re){const _e=this.getChildren(B);for(const pe of _e){const le=pe.properties;if(le&&le.cluster?re+le.point_count<=Q?re+=le.point_count:re=this._appendLeaves(D,le.cluster_id,X,Q,re):re<Q?re++:D.push(pe),D.length===X)break}return re}_addTileFeatures(D,B,X,Q,re,_e){for(const pe of D){const le=B[pe],be=le.numPoints;let Le,et,Oe;if(be)Le=pl(le),et=le.x,Oe=le.y;else{const ft=this.points[le.index];Le=ft.properties,et=Ao(ft.geometry.coordinates[0]),Oe=Io(ft.geometry.coordinates[1])}const pt={type:1,geometry:[[Math.round(this.options.extent*(et*re-X)),Math.round(this.options.extent*(Oe*re-Q))]],tags:Le};let gt;be?gt=le.id:this.options.generateId?gt=le.index:this.points[le.index].id&&(gt=this.points[le.index].id),gt!==void 0&&(pt.id=gt),_e.features.push(pt)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(+D,this.options.maxZoom+1))}_cluster(D,B){const X=[],{radius:Q,extent:re,reduce:_e,minPoints:pe}=this.options,le=Q/(re*Math.pow(2,B));for(let be=0;be<D.length;be++){const Le=D[be];if(Le.zoom<=B)continue;Le.zoom=B;const et=this.trees[B+1],Oe=et.within(Le.x,Le.y,le),pt=Le.numPoints||1;let gt=pt;for(const ft of Oe){const xt=et.points[ft];xt.zoom>B&&(gt+=xt.numPoints||1)}if(gt>pt&&gt>=pe){let ft=Le.x*pt,xt=Le.y*pt,It=_e&&pt>1?this._map(Le,!0):null;const Gt=(be<<5)+(B+1)+this.points.length;for(const ni of Oe){const Xt=et.points[ni];if(Xt.zoom<=B)continue;Xt.zoom=B;const fe=Xt.numPoints||1;ft+=Xt.x*fe,xt+=Xt.y*fe,Xt.parentId=Gt,_e&&(It||(It=this._map(Le,!0)),_e(It,this._map(Xt)))}Le.parentId=Gt,X.push(ls(ft/gt,xt/gt,Gt,gt,It))}else if(X.push(Le),gt>1)for(const ft of Oe){const xt=et.points[ft];xt.zoom<=B||(xt.zoom=B,X.push(xt))}}return X}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,B){if(D.numPoints)return B?Fr({},D.properties):D.properties;const X=this.points[D.index].properties,Q=this.options.map(X);return B&&Q===X?Fr({},Q):Q}}function ls(H,D,B,X,Q){return{x:Wi(H),y:Wi(D),zoom:1/0,id:B,parentId:-1,numPoints:X,properties:Q}}function la(H,D){const[B,X]=H.geometry.coordinates;return{x:Wi(Ao(B)),y:Wi(Io(X)),zoom:1/0,index:D,parentId:-1}}function Rr(H){return{type:"Feature",id:H.id,properties:pl(H),geometry:{type:"Point",coordinates:[(D=H.x,360*(D-.5)),Nt(H.y)]}};var D}function pl(H){const D=H.numPoints,B=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D;return Fr(Fr({},H.properties),{cluster:!0,cluster_id:H.id,point_count:D,point_count_abbreviated:B})}function Ao(H){return H/360+.5}function Io(H){const D=Math.sin(H*Math.PI/180),B=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return B<0?0:B>1?1:B}function Nt(H){const D=(180-360*H)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Fr(H,D){for(const B in D)H[B]=D[B];return H}function ko(H){return H.x}function vr(H){return H.y}function Gn(H,D,B,X){for(var Q,re=X,_e=B-D>>1,pe=B-D,le=H[D],be=H[D+1],Le=H[B],et=H[B+1],Oe=D+3;Oe<B;Oe+=3){var pt=cs(H[Oe],H[Oe+1],le,be,Le,et);if(pt>re)Q=Oe,re=pt;else if(pt===re){var gt=Math.abs(Oe-_e);gt<pe&&(Q=Oe,pe=gt)}}re>X&&(Q-D>3&&Gn(H,D,Q,X),H[Q+2]=re,B-Q>3&&Gn(H,Q,B,X))}function cs(H,D,B,X,Q,re){var _e=Q-B,pe=re-X;if(_e!==0||pe!==0){var le=((H-B)*_e+(D-X)*pe)/(_e*_e+pe*pe);le>1?(B=Q,X=re):le>0&&(B+=_e*le,X+=pe*le)}return(_e=H-B)*_e+(pe=D-X)*pe}function Ft(H,D,B,X){var Q={id:H===void 0?null:H,type:D,geometry:B,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(re){var _e=re.geometry,pe=re.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")oo(re,_e);else if(pe==="Polygon"||pe==="MultiLineString")for(var le=0;le<_e.length;le++)oo(re,_e[le]);else if(pe==="MultiPolygon")for(le=0;le<_e.length;le++)for(var be=0;be<_e[le].length;be++)oo(re,_e[le][be])}(Q),Q}function oo(H,D){for(var B=0;B<D.length;B+=3)H.minX=Math.min(H.minX,D[B]),H.minY=Math.min(H.minY,D[B+1]),H.maxX=Math.max(H.maxX,D[B]),H.maxY=Math.max(H.maxY,D[B+1])}function Or(H,D,B,X){if(D.geometry){var Q=D.geometry.coordinates,re=D.geometry.type,_e=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),pe=[],le=D.id;if(B.promoteId?le=D.properties[B.promoteId]:B.generateId&&(le=X||0),re==="Point")Nr(Q,pe);else if(re==="MultiPoint")for(var be=0;be<Q.length;be++)Nr(Q[be],pe);else if(re==="LineString")Mo(Q,pe,_e,!1);else if(re==="MultiLineString"){if(B.lineMetrics){for(be=0;be<Q.length;be++)Mo(Q[be],pe=[],_e,!1),H.push(Ft(le,"LineString",pe,D.properties));return}us(Q,pe,_e,!1)}else if(re==="Polygon")us(Q,pe,_e,!0);else{if(re!=="MultiPolygon"){if(re==="GeometryCollection"){for(be=0;be<D.geometry.geometries.length;be++)Or(H,{id:le,geometry:D.geometry.geometries[be],properties:D.properties},B,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(be=0;be<Q.length;be++){var Le=[];us(Q[be],Le,_e,!0),pe.push(Le)}}H.push(Ft(le,re,pe,D.properties))}}function Nr(H,D){D.push(ca(H[0])),D.push(ua(H[1])),D.push(0)}function Mo(H,D,B,X){for(var Q,re,_e=0,pe=0;pe<H.length;pe++){var le=ca(H[pe][0]),be=ua(H[pe][1]);D.push(le),D.push(be),D.push(0),pe>0&&(_e+=X?(Q*be-le*re)/2:Math.sqrt(Math.pow(le-Q,2)+Math.pow(be-re,2))),Q=le,re=be}var Le=D.length-3;D[2]=1,Gn(D,0,Le,B),D[Le+2]=1,D.size=Math.abs(_e),D.start=0,D.end=D.size}function us(H,D,B,X){for(var Q=0;Q<H.length;Q++){var re=[];Mo(H[Q],re,B,X),D.push(re)}}function ca(H){return H/360+.5}function ua(H){var D=Math.sin(H*Math.PI/180),B=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return B<0?0:B>1?1:B}function Mn(H,D,B,X,Q,re,_e,pe){if(X/=D,re>=(B/=D)&&_e<X)return H;if(_e<B||re>=X)return null;for(var le=[],be=0;be<H.length;be++){var Le=H[be],et=Le.geometry,Oe=Le.type,pt=Q===0?Le.minX:Le.minY,gt=Q===0?Le.maxX:Le.maxY;if(pt>=B&&gt<X)le.push(Le);else if(!(gt<B||pt>=X)){var ft=[];if(Oe==="Point"||Oe==="MultiPoint")wr(et,ft,B,X,Q);else if(Oe==="LineString")zo(et,ft,B,X,Q,!1,pe.lineMetrics);else if(Oe==="MultiLineString")zn(et,ft,B,X,Q,!1);else if(Oe==="Polygon")zn(et,ft,B,X,Q,!0);else if(Oe==="MultiPolygon")for(var xt=0;xt<et.length;xt++){var It=[];zn(et[xt],It,B,X,Q,!0),It.length&&ft.push(It)}if(ft.length){if(pe.lineMetrics&&Oe==="LineString"){for(xt=0;xt<ft.length;xt++)le.push(Ft(Le.id,Oe,ft[xt],Le.tags));continue}Oe!=="LineString"&&Oe!=="MultiLineString"||(ft.length===1?(Oe="LineString",ft=ft[0]):Oe="MultiLineString"),Oe!=="Point"&&Oe!=="MultiPoint"||(Oe=ft.length===3?"Point":"MultiPoint"),le.push(Ft(Le.id,Oe,ft,Le.tags))}}}return le.length?le:null}function wr(H,D,B,X,Q){for(var re=0;re<H.length;re+=3){var _e=H[re+Q];_e>=B&&_e<=X&&(D.push(H[re]),D.push(H[re+1]),D.push(H[re+2]))}}function zo(H,D,B,X,Q,re,_e){for(var pe,le,be=fl(H),Le=Q===0?ml:ha,et=H.start,Oe=0;Oe<H.length-3;Oe+=3){var pt=H[Oe],gt=H[Oe+1],ft=H[Oe+2],xt=H[Oe+3],It=H[Oe+4],Gt=Q===0?pt:gt,ni=Q===0?xt:It,Xt=!1;_e&&(pe=Math.sqrt(Math.pow(pt-xt,2)+Math.pow(gt-It,2))),Gt<B?ni>B&&(le=Le(be,pt,gt,xt,It,B),_e&&(be.start=et+pe*le)):Gt>X?ni<X&&(le=Le(be,pt,gt,xt,It,X),_e&&(be.start=et+pe*le)):Ur(be,pt,gt,ft),ni<B&&Gt>=B&&(le=Le(be,pt,gt,xt,It,B),Xt=!0),ni>X&&Gt<=X&&(le=Le(be,pt,gt,xt,It,X),Xt=!0),!re&&Xt&&(_e&&(be.end=et+pe*le),D.push(be),be=fl(H)),_e&&(et+=pe)}var fe=H.length-3;pt=H[fe],gt=H[fe+1],ft=H[fe+2],(Gt=Q===0?pt:gt)>=B&&Gt<=X&&Ur(be,pt,gt,ft),fe=be.length-3,re&&fe>=3&&(be[fe]!==be[0]||be[fe+1]!==be[1])&&Ur(be,be[0],be[1],be[2]),be.length&&D.push(be)}function fl(H){var D=[];return D.size=H.size,D.start=H.start,D.end=H.end,D}function zn(H,D,B,X,Q,re){for(var _e=0;_e<H.length;_e++)zo(H[_e],D,B,X,Q,re,!1)}function Ur(H,D,B,X){H.push(D),H.push(B),H.push(X)}function ml(H,D,B,X,Q,re){var _e=(re-D)/(X-D);return H.push(re),H.push(B+(Q-B)*_e),H.push(1),_e}function ha(H,D,B,X,Q,re){var _e=(re-B)/(Q-B);return H.push(D+(X-D)*_e),H.push(re),H.push(1),_e}function da(H,D){for(var B=[],X=0;X<H.length;X++){var Q,re=H[X],_e=re.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Q=pa(re.geometry,D);else if(_e==="MultiLineString"||_e==="Polygon"){Q=[];for(var pe=0;pe<re.geometry.length;pe++)Q.push(pa(re.geometry[pe],D))}else if(_e==="MultiPolygon")for(Q=[],pe=0;pe<re.geometry.length;pe++){for(var le=[],be=0;be<re.geometry[pe].length;be++)le.push(pa(re.geometry[pe][be],D));Q.push(le)}B.push(Ft(re.id,_e,Q,re.tags))}return B}function pa(H,D){var B=[];B.size=H.size,H.start!==void 0&&(B.start=H.start,B.end=H.end);for(var X=0;X<H.length;X+=3)B.push(H[X]+D,H[X+1],H[X+2]);return B}function fa(H,D){if(H.transformed)return H;var B,X,Q,re=1<<H.z,_e=H.x,pe=H.y;for(B=0;B<H.features.length;B++){var le=H.features[B],be=le.geometry,Le=le.type;if(le.geometry=[],Le===1)for(X=0;X<be.length;X+=2)le.geometry.push(_l(be[X],be[X+1],D,re,_e,pe));else for(X=0;X<be.length;X++){var et=[];for(Q=0;Q<be[X].length;Q+=2)et.push(_l(be[X][Q],be[X][Q+1],D,re,_e,pe));le.geometry.push(et)}}return H.transformed=!0,H}function _l(H,D,B,X,Q,re){return[Math.round(B*(H*X-Q)),Math.round(B*(D*X-re))]}function gl(H,D,B,X,Q){for(var re=D===Q.maxZoom?0:Q.tolerance/((1<<D)*Q.extent),_e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:X,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<H.length;pe++){_e.numFeatures++,eu(_e,H[pe],re,Q);var le=H[pe].minX,be=H[pe].minY,Le=H[pe].maxX,et=H[pe].maxY;le<_e.minX&&(_e.minX=le),be<_e.minY&&(_e.minY=be),Le>_e.maxX&&(_e.maxX=Le),et>_e.maxY&&(_e.maxY=et)}return _e}function eu(H,D,B,X){var Q=D.geometry,re=D.type,_e=[];if(re==="Point"||re==="MultiPoint")for(var pe=0;pe<Q.length;pe+=3)_e.push(Q[pe]),_e.push(Q[pe+1]),H.numPoints++,H.numSimplified++;else if(re==="LineString")so(_e,Q,H,B,!1,!1);else if(re==="MultiLineString"||re==="Polygon")for(pe=0;pe<Q.length;pe++)so(_e,Q[pe],H,B,re==="Polygon",pe===0);else if(re==="MultiPolygon")for(var le=0;le<Q.length;le++){var be=Q[le];for(pe=0;pe<be.length;pe++)so(_e,be[pe],H,B,!0,pe===0)}if(_e.length){var Le=D.tags||null;if(re==="LineString"&&X.lineMetrics){for(var et in Le={},D.tags)Le[et]=D.tags[et];Le.mapbox_clip_start=Q.start/Q.size,Le.mapbox_clip_end=Q.end/Q.size}var Oe={geometry:_e,type:re==="Polygon"||re==="MultiPolygon"?3:re==="LineString"||re==="MultiLineString"?2:1,tags:Le};D.id!==null&&(Oe.id=D.id),H.features.push(Oe)}}function so(H,D,B,X,Q,re){var _e=X*X;if(X>0&&D.size<(Q?_e:X))B.numPoints+=D.length/3;else{for(var pe=[],le=0;le<D.length;le+=3)(X===0||D[le+2]>_e)&&(B.numSimplified++,pe.push(D[le]),pe.push(D[le+1])),B.numPoints++;Q&&function(be,Le){for(var et=0,Oe=0,pt=be.length,gt=pt-2;Oe<pt;gt=Oe,Oe+=2)et+=(be[Oe]-be[gt])*(be[Oe+1]+be[gt+1]);if(et>0===Le)for(Oe=0,pt=be.length;Oe<pt/2;Oe+=2){var ft=be[Oe],xt=be[Oe+1];be[Oe]=be[pt-2-Oe],be[Oe+1]=be[pt-1-Oe],be[pt-2-Oe]=ft,be[pt-1-Oe]=xt}}(pe,re),H.push(pe)}}function jr(H,D){var B=(D=this.options=function(Q,re){for(var _e in re)Q[_e]=re[_e];return Q}(Object.create(this.options),D)).debug;if(B&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var X=function(Q,re){var _e=[];if(Q.type==="FeatureCollection")for(var pe=0;pe<Q.features.length;pe++)Or(_e,Q.features[pe],re,pe);else Or(_e,Q.type==="Feature"?Q:{geometry:Q},re);return _e}(H,D);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(X=function(Q,re){var _e=re.buffer/re.extent,pe=Q,le=Mn(Q,1,-1-_e,_e,0,-1,2,re),be=Mn(Q,1,1-_e,2+_e,0,-1,2,re);return(le||be)&&(pe=Mn(Q,1,-_e,1+_e,0,-1,2,re)||[],le&&(pe=da(le,1).concat(pe)),be&&(pe=pe.concat(da(be,-1)))),pe}(X,D)).length&&this.splitTile(X,0,0,0),B&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hs(H,D,B){return 32*((1<<H)*B+D)+H}function yl(H,D){const B=H.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const X=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!X)return D(null,null);const Q=new ve(X.features);let re=ct(Q);re.byteOffset===0&&re.byteLength===re.buffer.byteLength||(re=new Uint8Array(re)),D(null,{vectorTile:Q,rawData:re.buffer})}jr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},jr.prototype.splitTile=function(H,D,B,X,Q,re,_e){for(var pe=[H,D,B,X],le=this.options,be=le.debug;pe.length;){X=pe.pop(),B=pe.pop(),D=pe.pop(),H=pe.pop();var Le=1<<D,et=hs(D,B,X),Oe=this.tiles[et];if(!Oe&&(be>1&&console.time("creation"),Oe=this.tiles[et]=gl(H,D,B,X,le),this.tileCoords.push({z:D,x:B,y:X}),be)){be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,B,X,Oe.numFeatures,Oe.numPoints,Oe.numSimplified),console.timeEnd("creation"));var pt="z"+D;this.stats[pt]=(this.stats[pt]||0)+1,this.total++}if(Oe.source=H,Q){if(D===le.maxZoom||D===Q)continue;var gt=1<<Q-D;if(B!==Math.floor(re/gt)||X!==Math.floor(_e/gt))continue}else if(D===le.indexMaxZoom||Oe.numPoints<=le.indexMaxPoints)continue;if(Oe.source=null,H.length!==0){be>1&&console.time("clipping");var ft,xt,It,Gt,ni,Xt,fe=.5*le.buffer/le.extent,Pn=.5-fe,di=.5+fe,$n=1+fe;ft=xt=It=Gt=null,ni=Mn(H,Le,B-fe,B+di,0,Oe.minX,Oe.maxX,le),Xt=Mn(H,Le,B+Pn,B+$n,0,Oe.minX,Oe.maxX,le),H=null,ni&&(ft=Mn(ni,Le,X-fe,X+di,1,Oe.minY,Oe.maxY,le),xt=Mn(ni,Le,X+Pn,X+$n,1,Oe.minY,Oe.maxY,le),ni=null),Xt&&(It=Mn(Xt,Le,X-fe,X+di,1,Oe.minY,Oe.maxY,le),Gt=Mn(Xt,Le,X+Pn,X+$n,1,Oe.minY,Oe.maxY,le),Xt=null),be>1&&console.timeEnd("clipping"),pe.push(ft||[],D+1,2*B,2*X),pe.push(xt||[],D+1,2*B,2*X+1),pe.push(It||[],D+1,2*B+1,2*X),pe.push(Gt||[],D+1,2*B+1,2*X+1)}}},jr.prototype.getTile=function(H,D,B){var X=this.options,Q=X.extent,re=X.debug;if(H<0||H>24)return null;var _e=1<<H,pe=hs(H,D=(D%_e+_e)%_e,B);if(this.tiles[pe])return fa(this.tiles[pe],Q);re>1&&console.log("drilling down to z%d-%d-%d",H,D,B);for(var le,be=H,Le=D,et=B;!le&&be>0;)be--,Le=Math.floor(Le/2),et=Math.floor(et/2),le=this.tiles[hs(be,Le,et)];return le&&le.source?(re>1&&console.log("found parent tile z%d-%d-%d",be,Le,et),re>1&&console.time("drilling down"),this.splitTile(le.source,be,Le,et,H,D,B),re>1&&console.timeEnd("drilling down"),this.tiles[pe]?fa(this.tiles[pe],Q):null):null};class yn extends s.VectorTileWorkerSource{constructor(D,B,X,Q,re){super(D,B,X,Q,yl),re&&(this.loadGeoJSON=re)}loadData(D,B){const X=D&&D.request,Q=X&&X.collectResourceTiming;this.loadGeoJSON(D,(re,_e)=>{if(re||!_e)return B(re);if(typeof _e!="object")return B(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{de(_e,!0);try{if(D.filter){const le=s.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(Le=>`${Le.key}: ${Le.message}`).join(", "));const be=_e.features.filter(Le=>le.value.evaluate({zoom:0},Le));_e={type:"FeatureCollection",features:be}}this._geoJSONIndex=D.cluster?new gn(function({superclusterOptions:le,clusterProperties:be}){if(!be||!le)return le;const Le={},et={},Oe={accumulated:null,zoom:0},pt={properties:null},gt=Object.keys(be);for(const ft of gt){const[xt,It]=be[ft],Gt=s.createExpression(It),ni=s.createExpression(typeof xt=="string"?[xt,["accumulated"],["get",ft]]:xt);Le[ft]=Gt.value,et[ft]=ni.value}return le.map=ft=>{pt.properties=ft;const xt={};for(const It of gt)xt[It]=Le[It].evaluate(Oe,pt);return xt},le.reduce=(ft,xt)=>{pt.properties=xt;for(const It of gt)Oe.accumulated=ft[It],ft[It]=et[It].evaluate(Oe,pt)},le}(D)).load(_e.features):function(le,be){return new jr(le,be)}(_e,D.geojsonVtOptions)}catch(le){return B(le)}this.loaded={};const pe={};if(Q){const le=s.getPerformanceMeasurement(X);le&&(pe.resourceTiming={},pe.resourceTiming[D.source]=JSON.parse(JSON.stringify(le)))}B(null,pe)}})}reloadTile(D,B){const X=this.loaded;return X&&X[D.uid]?super.reloadTile(D,B):this.loadTile(D,B)}loadGeoJSON(D,B){if(D.request)s.getJSON(D.request,B);else{if(typeof D.data!="string")return B(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));try{return B(null,JSON.parse(D.data))}catch{return B(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(D,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(X){B(X)}}getClusterChildren(D,B){try{B(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(X){B(X)}}getClusterLeaves(D,B){try{B(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(X){B(X)}}}class ma{constructor(D){this.self=D,this.actor=new s.Actor(D,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:yn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,X)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=X},this.self.registerRTLTextPlugin=B=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=B.applyArabicShaping,s.plugin.processBidirectionalText=B.processBidirectionalText,s.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}clearCaches(D,B,X){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D],X()}checkIfReady(D,B,X){X()}setReferrer(D,B){this.referrer=B}spriteLoaded(D,B){this.isSpriteLoaded[D]=B;for(const X in this.workerSources[D]){const Q=this.workerSources[D][X];for(const re in Q)Q[re]instanceof s.VectorTileWorkerSource&&(Q[re].isSpriteLoaded=B,Q[re].fire(new s.Event("isSpriteLoaded")))}}setImages(D,B,X){this.availableImages[D]=B;for(const Q in this.workerSources[D]){const re=this.workerSources[D][Q];for(const _e in re)re[_e].availableImages=B}X()}enableTerrain(D,B,X){this.terrain=B,X()}setProjection(D,B){this.projections[D]=s.getProjection(B)}setLayers(D,B,X){this.getLayerIndex(D).replace(B),X()}updateLayers(D,B,X){this.getLayerIndex(D).update(B.layers,B.removedIds),X()}loadTile(D,B,X){const Q=this.enableTerrain?s.extend({enableTerrain:this.terrain},B):B;Q.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,B.type,B.source).loadTile(Q,X)}loadDEMTile(D,B,X){const Q=this.enableTerrain?s.extend({buildQuadTree:this.terrain},B):B;this.getDEMWorkerSource(D,B.source).loadTile(Q,X)}reloadTile(D,B,X){const Q=this.enableTerrain?s.extend({enableTerrain:this.terrain},B):B;Q.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,B.type,B.source).reloadTile(Q,X)}abortTile(D,B,X){this.getWorkerSource(D,B.type,B.source).abortTile(B,X)}removeTile(D,B,X){this.getWorkerSource(D,B.type,B.source).removeTile(B,X)}removeSource(D,B,X){if(!this.workerSources[D]||!this.workerSources[D][B.type]||!this.workerSources[D][B.type][B.source])return;const Q=this.workerSources[D][B.type][B.source];delete this.workerSources[D][B.type][B.source],Q.removeSource!==void 0?Q.removeSource(B,X):X()}loadWorkerSource(D,B,X){try{this.self.importScripts(B.url),X()}catch(Q){X(Q.toString())}}syncRTLPluginState(D,B,X){try{s.plugin.setState(B);const Q=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&Q!=null){this.self.importScripts(Q);const re=s.plugin.isParsed();X(re?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Q}`),re)}}catch(Q){X(Q.toString())}}getAvailableImages(D){let B=this.availableImages[D];return B||(B=[]),B}getLayerIndex(D){let B=this.layerIndexes[D];return B||(B=this.layerIndexes[D]=new ae),B}getWorkerSource(D,B,X){return this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][B]||(this.workerSources[D][B]={}),this.workerSources[D][B][X]||(this.workerSources[D][B][X]=new this.workerSourceTypes[B]({send:(Q,re,_e,pe,le,be)=>{this.actor.send(Q,re,_e,D,le,be)},scheduler:this.actor.scheduler},this.getLayerIndex(D),this.getAvailableImages(D),this.isSpriteLoaded[D])),this.workerSources[D][B][X]}getDEMWorkerSource(D,B){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][B]||(this.demWorkerSources[D][B]=new me),this.demWorkerSources[D][B]}enforceCacheSizeLimit(D,B){s.enforceCacheSizeLimit(B)}getWorkerPerformanceMetrics(D,B,X){X(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ma(self)),ma}),I(["./shared"],function(s){function G(u,t){if(Array.isArray(u)){if(!Array.isArray(t)||u.length!==t.length)return!1;for(let a=0;a<u.length;a++)if(!G(u[a],t[a]))return!1;return!0}if(typeof u=="object"&&u!==null&&t!==null){if(typeof t!="object"||Object.keys(u).length!==Object.keys(t).length)return!1;for(const a in u)if(!G(u[a],t[a]))return!1;return!0}return u===t}var ue=ae;function ae(u){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,m,g=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(g);try{m=new Worker(w),d=!0}catch{d=!1}return m&&m.terminate(),URL.revokeObjectURL(w),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var m=d.getContext("2d");if(!m)return!1;var g=m.getImageData(0,0,1,1);return g&&g.width===d.width}()?(me[a=t&&t.failIfMajorPerformanceCaveat]===void 0&&(me[a]=function(d){var m,g=function(w){var b=document.createElement("canvas"),S=Object.create(ae.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=w,b.getContext("webgl",S)||b.getContext("experimental-webgl",S)}(d);if(!g)return!1;try{m=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!m||g.isContextLost())&&(g.shaderSource(m,"void main() {}"),g.compileShader(m),g.getShaderParameter(m,g.COMPILE_STATUS)===!0)}(a)),me[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(u)}var me={};function de(u,t,a){const d=s.window.document.createElement(u);return t!==void 0&&(d.className=t),a&&a.appendChild(d),d}function Ae(u,t,a){const d=s.window.document.createElementNS("http://www.w3.org/2000/svg",u);for(const m of Object.keys(t))d.setAttributeNS(null,m,t[m]);return a&&a.appendChild(d),d}ae.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const je=s.window.document&&s.window.document.documentElement.style,Ge=je&&je.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Tt;function ve(){je&&Ge&&(Tt=je[Ge],je[Ge]="none")}function he(){je&&Ge&&(je[Ge]=Tt)}function Se(u){u.preventDefault(),u.stopPropagation(),s.window.removeEventListener("click",Se,!0)}function Ze(){s.window.addEventListener("click",Se,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",Se,!0)},0)}function Fe(u,t){const a=u.getBoundingClientRect();return _t(u,a,t)}function ct(u,t){const a=u.getBoundingClientRect(),d=[];for(let m=0;m<t.length;m++)d.push(_t(u,a,t[m]));return d}function ut(u){return s.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function _t(u,t,a){const d=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new s.pointGeometry((a.clientX-t.left)*d,(a.clientY-t.top)*d)}function ii(u,t){var a=t[0],d=t[1],m=t[2],g=t[3],w=a*g-m*d;return w?(u[0]=g*(w=1/w),u[1]=-d*w,u[2]=-m*w,u[3]=a*w,u):null}function vt(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class un extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:d}of this.requestors)this._notify(a,d);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,a){this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,a){if(!t)return!0;let d=0;for(const m of t){if(m[0]<d||m[1]<m[0]||a<m[1])return!1;d=m[1]}return!0}_validateContent(t,a){return!(t&&(t.length!==4||t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,a){a.version=this.images[t].version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let d=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(d=!1);this.isLoaded()||d?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const d={};for(const m of t){this.images[m]||this.fire(new s.Event("styleimagemissing",{id:m}));const g=this.images[m];g?d[m]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:s.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,d)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],d=this.getImage(t);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},g=new s.ImagePosition(m,d);this.patterns[t]={bin:m,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:a,h:d}=s.potpack(t),m=this.atlasImage;m.resize({width:a||1,height:d||1});for(const g in this.patterns){const{bin:w}=this.patterns[g],b=w.x+1,S=w.y+1,k=this.images[g].data,z=k.width,L=k.height;s.RGBAImage.copy(k,m,{x:0,y:0},{x:b,y:S},{width:z,height:L}),s.RGBAImage.copy(k,m,{x:0,y:L-1},{x:b,y:S-1},{width:z,height:1}),s.RGBAImage.copy(k,m,{x:0,y:0},{x:b,y:S+L},{width:z,height:1}),s.RGBAImage.copy(k,m,{x:z-1,y:0},{x:b-1,y:S},{width:1,height:L}),s.RGBAImage.copy(k,m,{x:0,y:0},{x:b+z,y:S},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.images[a];vt(d)&&this.updateImage(a,d)}}}const Un=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(u,t){return function([a,d,m]){const g=s.degToRad(d+90),w=s.degToRad(m);return{x:a*Math.cos(g)*Math.sin(w),y:a*Math.sin(g)*Math.sin(w),z:a*Math.cos(w),azimuthal:d,polar:m}}(u.expression.evaluate(t))}interpolate(u,t,a){return{x:s.number(u.x,t.x,a),y:s.number(u.y,t.y,a),z:s.number(u.z,t.z,a),azimuthal:s.number(u.azimuthal,t.azimuthal,a),polar:s.number(u.polar,t.polar,a)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),jn="-transition";class Co extends s.Evented{constructor(t){super(),this._transitionable=new s.Transitionable(Un),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(s.validateLight,t,a))for(const d in t){const m=t[d];s.endsWith(d,jn)?this._transitionable.setTransition(d.slice(0,-jn.length),m):this._transitionable.setValue(d,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&s.emitValidationErrors(this,t.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const as=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Vn="-transition";class xr extends s.Evented{constructor(t,a){super(),this._transitionable=new s.Transitionable(as),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(t){for(const a in t){const d=t[a];s.endsWith(a,Vn)?this._transitionable.setTransition(a.slice(0,-Vn.length),d):this._transitionable.setValue(a,d)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function at(u,t,a,d){const m=s.smoothstep(45,65,a),[g,w]=Et(u,d),b=s.length(t);let S=1-Math.min(1,Math.exp((b-g)/(w-g)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*m*u.alpha}function Et(u,t){const a=.5/Math.tan(.5*t);return[u.range[0]+a,u.range[1]+a]}const wt=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),oi="-transition";class Pt extends s.Evented{constructor(t,a){super(),this._transitionable=new s.Transitionable(wt),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const t=this._transform,a=t.projection.name==="globe",d=s.globeToMercatorTransition(t.zoom),m=this.properties.get("range"),g=[.5,3];return{range:a?[s.number(g[0],m[0],d),s.number(g[1],m[1],d)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,d={}){if(!this._validate(s.validateFog,t,d)){for(const m of Object.keys(s.spec.fog))t&&t[m]===void 0&&(!a||a&&a[m]===void 0)&&(t[m]=s.spec.fog[m].default);for(const m in t){const g=t[m];s.endsWith(m,oi)?this._transitionable.setTransition(m.slice(0,-oi.length),g):this._transitionable.setValue(m,g)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?function(d,m,g){const w=s.MercatorCoordinate.fromLngLat(m),b=g.elevation?g.elevation.getAtPointOrZero(w):0,S=[w.x,w.y,b];return s.transformMat4(S,S,g.mercatorFogMatrix),at(d,S,g.pitch,g._fov)}(this.state,t,a):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Et(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&s.emitValidationErrors(this,t.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class zi{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const d=this.workerPool.acquire(this.id);for(let m=0;m<d.length;m++){const g=new zi.Actor(d[m],a,this.id);g.name=`Worker ${m}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,a,d){s.asyncAll(this.actors,(m,g)=>{m.send(t,a,g)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qi(u,t,a){return t*(s.EXTENT/(u.tileSize*Math.pow(2,a-u.tileID.overscaledZ)))}zi.Actor=s.Actor;class Wi{constructor(t,a,d,m){this.screenBounds=t,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(t,a){let d,m;if(t instanceof s.pointGeometry||typeof t[0]=="number"){const g=s.pointGeometry.convert(t);d=[s.pointGeometry.convert(t)],m=a.isPointAboveHorizon(g)}else{const g=s.pointGeometry.convert(t[0]),w=s.pointGeometry.convert(t[1]);d=[g,w],m=s.polygonizeBounds(g,w).every(b=>a.isPointAboveHorizon(b))}return new Wi(d,a.getCameraPoint(),m,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],m=s.polygonizeBounds(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?m[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(m[3]=this.cameraPoint)),s.bufferConvexPolygon(m,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],m=s.polygonizeBounds(a,d,t),g=this.cameraPoint.clone();switch(3*((g.y>a.y)+(g.y>d.y))+((g.x>a.x)+(g.x>d.x))){case 0:m[0]=g,m[4]=g.clone();break;case 1:m.splice(1,0,g);break;case 2:m[1]=g;break;case 3:m.splice(4,0,g);break;case 5:m.splice(2,0,g);break;case 6:m[3]=g;break;case 7:m.splice(3,0,g);break;case 8:m[2]=g}return m}containsTile(t,a,d,m=0){const g=t.queryPadding/a._projectionScaler+1,w=d?this._bufferedCameraMercator(g,a):this._bufferedScreenMercator(g,a);let b=t.tileID.wrap+(w.unwrapped?m:0);const S=w.polygon.map(J=>s.getTilePoint(t.tileTransform,J,b));if(!s.polygonIntersectsBox(S,0,0,s.EXTENT,s.EXTENT))return;b=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const k=this.screenGeometryMercator.polygon.map(J=>s.getTileVec3(t.tileTransform,J,b)),z=k.map(J=>new s.pointGeometry(J[0],J[1])),L=a.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),O=s.getTileVec3(t.tileTransform,L,b),j=k.map(J=>{const $=s.sub(J,J,O);return s.normalize($,$),new s.Ray(O,$)}),U=qi(t,1,a.zoom);return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:j,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(N=s.getBounds(S),N.min.x=s.clamp(N.min.x,0,s.EXTENT),N.min.y=s.clamp(N.min.y,0,s.EXTENT),N.max.x=s.clamp(N.max.x,0,s.EXTENT),N.max.y=s.clamp(N.max.y,0,s.EXTENT),N),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:U};var N}_bufferedScreenMercator(t,a){const d=ls(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let m;return m=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[d]=m,m}}_bufferedCameraMercator(t,a){const d=ls(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let m;return m=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[d]=m,m}}_projectAndResample(t,a){const d=function(g,w){const b=s.multiply([],w.pixelMatrix,w.globeMatrix),S=[0,-s.GLOBE_RADIUS,0,1],k=[0,s.GLOBE_RADIUS,0,1],z=[0,0,0,1];s.transformMat4$1(S,S,b),s.transformMat4$1(k,k,b),s.transformMat4$1(z,z,b);const L=new s.pointGeometry(S[0]/S[3],S[1]/S[3]),O=new s.pointGeometry(k[0]/k[3],k[1]/k[3]),j=s.polygonContainsPoint(g,L)&&S[3]<z[3],U=s.polygonContainsPoint(g,O)&&k[3]<z[3];if(!j&&!U)return null;const N=function(oe,Ee,Me){for(let ke=1;ke<oe.length;ke++){const $e=gn(Ee.pointCoordinate3D(oe[ke-1]).x),ye=gn(Ee.pointCoordinate3D(oe[ke]).x);if(Me<0){if($e<ye)return{idx:ke,t:-$e/(ye-1-$e)}}else if(ye<$e)return{idx:ke,t:(1-$e)/(ye+1-$e)}}return null}(g,w,j?-1:1);if(!N)return null;const{idx:J,t:$}=N;let K=J>1?Xi(g.slice(0,J),w):[],q=J<g.length?Xi(g.slice(J),w):[];K=K.map(oe=>new s.pointGeometry(gn(oe.x),oe.y)),q=q.map(oe=>new s.pointGeometry(gn(oe.x),oe.y));const ee=[...K];ee.length===0&&ee.push(q[q.length-1]);const Z=s.number(ee[ee.length-1].y,(q.length===0?K[0]:q[0]).y,$);let Y;return Y=j?[new s.pointGeometry(0,Z),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,Z)]:[new s.pointGeometry(1,Z),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,Z)],ee.push(...Y),q.length===0?ee.push(K[0]):ee.push(...q),{polygon:ee.map(oe=>new s.MercatorCoordinate(oe.x,oe.y)),unwrapped:!1}}(t,a);if(d)return d;const m=function(g,w){let b=!1,S=-1/0,k=0;for(let L=0;L<g.length-1;L++)g[L].x>S&&(S=g[L].x,k=L);for(let L=0;L<g.length-1;L++){const O=(k+L)%(g.length-1),j=g[O],U=g[O+1];Math.abs(j.x-U.x)>.5&&(j.x<U.x?(j.x+=1,O===0&&(g[g.length-1].x+=1)):(U.x+=1,O+1===g.length-1&&(g[0].x+=1)),b=!0)}const z=s.mercatorXfromLng(w.center.lng);return b&&z<Math.abs(z-1)&&g.forEach(L=>{L.x-=1}),{polygon:g,unwrapped:b}}(Xi(t,a).map(g=>new s.pointGeometry(gn(g.x),g.y)),a);return{polygon:m.polygon.map(g=>new s.MercatorCoordinate(g.x,g.y)),unwrapped:m.unwrapped}}}function Xi(u,t){return s.resample(u,a=>{const d=t.pointCoordinate3D(a);a.x=d.x,a.y=d.y},1/256)}function gn(u){return u<0?1+u%1:u%1}function ls(u){return 100*u|0}function la(u,t,a,d,m){const g=function(w,b){if(w)return m(w);if(b){const S=s.pick(s.extend(b,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(S.vectorLayers=b.vector_layers,S.vectorLayerIds=S.vectorLayers.map(k=>k.id)),b.language_options&&(S.languageOptions=b.language_options),b.language&&b.language[b.id]&&(S.language=b.language[b.id]),b.worldview_options&&(S.worldviewOptions=b.worldview_options),b.worldview?S.worldview=b.worldview[b.id]:b.worldview_default&&(S.worldview=b.worldview_default),S.tiles=t.canonicalizeTileset(S,u.url),m(null,S)}};return u.url?s.getJSON(t.transformRequest(t.normalizeSourceURL(u.url,null,a,d),s.ResourceType.Source),g):s.exported.frame(()=>g(null,u))}class Rr{constructor(t,a,d){this.bounds=s.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),d=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*a),m=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*a),g=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*a),w=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*a);return t.x>=d&&t.x<g&&t.y>=m&&t.y<w}}class pl{constructor(t,a,d){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ao={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Io{constructor(t,a,d,m){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=m,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let d=0;d<this.attributes.length;d++){const m=a.attributes[this.attributes[d].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,a,d){for(let m=0;m<this.attributes.length;m++){const g=this.attributes[m],w=a.attributes[g.name];w!==void 0&&t.vertexAttribPointer(w,g.components,t[Ao[g.type]],!1,this.itemSize,g.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Fr extends Nt{getDefault(){return s.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ko extends Nt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class vr extends Nt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Gn extends Nt{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cs extends Nt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ft extends Nt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class oo extends Nt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Or extends Nt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Nr extends Nt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Mo extends Nt{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class us extends Nt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class ca extends Nt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ua extends Nt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Mn extends Nt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class wr extends Nt{getDefault(){return s.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class zo extends Nt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class fl extends Nt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class zn extends Nt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ur extends Nt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ml extends Nt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ha extends Nt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class da extends Nt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pa extends Nt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class fa extends Nt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _l extends Nt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class gl extends Nt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class eu extends Nt{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class so extends Nt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class jr extends Nt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class hs extends Nt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class yl extends Nt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class yn extends Nt{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class ma extends yn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class H extends yn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class D extends H{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class B{constructor(t,a,d,m){this.context=t,this.width=a,this.height=d;const g=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new ma(t,g),m&&(this.depthAttachment=new H(t,g))}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&t.deleteRenderbuffer(d)}t.deleteFramebuffer(this.framebuffer)}}class X{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Fr(this),this.clearDepth=new ko(this),this.clearStencil=new vr(this),this.colorMask=new Gn(this),this.depthMask=new cs(this),this.stencilMask=new Ft(this),this.stencilFunc=new oo(this),this.stencilOp=new Or(this),this.stencilTest=new Nr(this),this.depthRange=new Mo(this),this.depthTest=new us(this),this.depthFunc=new ca(this),this.blend=new ua(this),this.blendFunc=new Mn(this),this.blendColor=new wr(this),this.blendEquation=new zo(this),this.cullFace=new fl(this),this.cullFaceSide=new zn(this),this.frontFace=new Ur(this),this.program=new ml(this),this.activeTexture=new ha(this),this.viewport=new da(this),this.bindFramebuffer=new pa(this),this.bindRenderbuffer=new fa(this),this.bindTexture=new _l(this),this.bindVertexBuffer=new gl(this),this.bindElementBuffer=new eu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new so(this),this.pixelStoreUnpack=new jr(this),this.pixelStoreUnpackPremultiplyAlpha=new hs(this),this.pixelStoreUnpackFlipY=new yl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t.getExtension("OES_standard_derivatives"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new pl(this,t,a)}createVertexBuffer(t,a,d){return new Io(this,t,a,d)}createRenderbuffer(t,a,d){const m=this.gl,g=m.createRenderbuffer();return this.bindRenderbuffer.set(g),m.renderbufferStorage(m.RENDERBUFFER,t,a,d),this.bindRenderbuffer.set(null),g}createFramebuffer(t,a,d){return new B(this,t,a,d)}clear({color:t,depth:a,stencil:d}){const m=this.gl;let g=0;t&&(g|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(g|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(g)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){G(t.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Q extends s.Evented{constructor(t,a,d,m){super(),this.id=t,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},a),s.extend(this,s.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=la(this._options,this.map._requestManager,null,null,(t,a)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new s.ErrorEvent(t)):a&&(s.extend(this,a),a.bounds&&(this.tileBounds=new Rr(a.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(a.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const d=s.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=s.getImage(this.map._requestManager.transformRequest(m,s.ResourceType.Tile),(g,w,b,S)=>(delete t.request,t.aborted?(t.state="unloaded",a(null)):g?(t.state="errored",a(g)):w?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:b,expires:S}),t.setTexture(w,this.map.painter),t.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(t,a,d){t.setTexture(a,d)}static unloadTileData(t,a){t.texture&&a.saveTileTexture(t.texture)}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}}let re;function _e(u,t,a,d,m,g,w,b){const S=[u,a,m,t,d,g,1,1,1],k=[w,b,1],z=s.adjoint([],S),[L,O,j]=s.transformMat3(k,k,s.transpose(z,z));return s.multiply$1(S,[L,0,0,0,O,0,0,0,j],S)}class pe extends s.Evented{constructor(t,a,d,m){super(),this.id=t,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=a}load(t,a){this._loaded=a||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(d,m)=>{if(this._loaded=!0,d)this.fire(new s.ErrorEvent(d));else if(m){const{HTMLImageElement:g}=s.window;this.image=m instanceof g?s.exported.getImageData(m):m,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const a=t.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(d){let m=1/0,g=1/0,w=-1/0,b=-1/0;for(const L of d)m=Math.min(m,L.x),g=Math.min(g,L.y),w=Math.max(w,L.x),b=Math.max(b,L.y);const S=Math.max(w-m,b-g),k=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),z=Math.pow(2,k);return new s.CanonicalTileID(k,Math.floor((m+w)/2*z),Math.floor((g+b)/2*z))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const S in this.tiles){const k=this.tiles[S];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const a=s.tileTransform(this.tileID,this.map.transform.projection),[d,m,g,w]=this.coordinates.map(S=>{const k=a.projection.project(S[0],S[1]);return s.getTilePoint(a,k)._round()});this.perspectiveTransform=function(S,k,z,L,O,j,U,N,J,$){const K=_e(0,0,S,0,0,k,S,k),q=_e(z,L,O,j,U,N,J,$);return s.multiply$1(q,s.adjoint(K,K),q),[q[6]/q[8]*S/s.EXTENT,q[7]/q[8]*k/s.EXTENT]}(this.width,this.height,d.x,d.y,m.x,m.y,w.x,w.y,g.x,g.y);const b=this._boundsArray=new s.StructArrayLayout4i8;b.emplaceBack(d.x,d.y,0,0),b.emplaceBack(m.x,m.y,s.EXTENT,0),b.emplaceBack(w.x,w.y,0,s.EXTENT),b.emplaceBack(g.x,g.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(b,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture?this.texture.update(this.image):(this.texture=new s.Texture(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const le={vector:class extends s.Evented{constructor(u,t,a,d){if(super(),this.id=u,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(t,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(u){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const t=this.language||this.map._language,a=this.worldview||this.map._worldview;this._tileJSONRequest=la(this._options,this.map._requestManager,t,a,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.ErrorEvent(d))):m&&(s.extend(this,m),m.bounds&&(this.tileBounds=new Rr(m.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),u&&u(d)})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}setSourceProperty(u){this._tileJSONRequest&&this._tileJSONRequest.cancel(),u(),this.load(()=>{const t=this.map.style._getSourceCaches(this.id);for(const a of t)a.clearTiles()})}setTiles(u){return this.setSourceProperty(()=>{this._options.tiles=u}),this}setUrl(u){return this.setSourceProperty(()=>{this.url=u,this._options.url=u}),this}_setLanguage(u){return u===this.language||this.setSourceProperty(()=>{this.language=u}),this}_setWorldview(u){return u===this.worldview?this:this.worldviewOptions&&u&&!this.worldviewOptions[u]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${u}".`),this):(this.setSourceProperty(()=>{this.worldview=u}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(u,t){const a=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,s.ResourceType.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile};if(d.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=t:u.request=u.actor.send("reloadTile",d,m.bind(this));else if(u.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",d,m.bind(this),void 0,!0);else{const g=s.loadVectorTile.call({deduped:this._deduped},d,(w,b)=>{w||!b?m.call(this,w):(d.data={cacheControl:b.cacheControl,expires:b.expires,rawData:b.rawData.slice(0)},u.actor&&u.actor.send("loadTile",d,m.bind(this),void 0,!0))},!0);u.request={cancel:g}}function m(g,w){return delete u.request,u.aborted?t(null):g&&g.status!==404?t(g):(w&&w.resourceTiming&&(u.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&u.setExpiryData(w),u.loadVectorData(w,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id})}unloadTile(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Q,"raster-dem":class extends Q{constructor(u,t,a,d){super(u,t,a,d),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const a=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(m,g){m&&(u.state="errored",t(m)),g&&(u.dem=g,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=s.getImage(this.map._requestManager.transformRequest(a,s.ResourceType.Tile),function(m,g,w,b){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(m)u.state="errored",t(m);else if(g){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:w,expires:b});const S=s.window.ImageBitmap&&g instanceof s.window.ImageBitmap&&(re==null&&(re=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),re),k=1-(g.width-s.prevPowerOfTwo(g.width))/2;k<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const z=S?g:s.exported.getImageData(g,k),L={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:k};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",L,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(u){const t=u.canonical,a=Math.pow(2,t.z),d=(t.x-1+a)%a,m=t.x===0?u.wrap-1:u.wrap,g=(t.x+1+a)%a,w=t.x+1===a?u.wrap+1:u.wrap,b={};return b[new s.OverscaledTileID(u.overscaledZ,m,t.z,d,t.y).key]={backfilled:!1},b[new s.OverscaledTileID(u.overscaledZ,w,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(b[new s.OverscaledTileID(u.overscaledZ,m,t.z,d,t.y-1).key]={backfilled:!1},b[new s.OverscaledTileID(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},b[new s.OverscaledTileID(u.overscaledZ,w,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<a&&(b[new s.OverscaledTileID(u.overscaledZ,m,t.z,d,t.y+1).key]={backfilled:!1},b[new s.OverscaledTileID(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},b[new s.OverscaledTileID(u.overscaledZ,w,t.z,g,t.y+1).key]={backfilled:!1}),b}unloadTile(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded"}},geojson:class extends s.Evented{constructor(u,t,a,d){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=t.data,this._options=s.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},t),this}getClusterLeaves(u,t,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:t,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const u=s.extend({},this.workerOptions),t=this._data;typeof t=="string"?(u.request=this.map._requestManager.transformRequest(s.exported.resolveURL(t),s.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new s.ErrorEvent(a));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(m.resourceTiming=d.resourceTiming[this.id]),this.fire(new s.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,t){const a=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(a,{type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(d,m)=>(delete u.request,u.unloadVectorData(),u.aborted?t(null):d?t(d):(u.loadVectorData(m,this.map.painter,a==="reloadTile"),t(null))),void 0,a==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pe{constructor(u,t,a,d){super(u,t,a,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.ResourceType.Source).url);s.getVideo(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new s.ErrorEvent(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(u,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pe,canvas:class extends pe{constructor(u,t,a,d){super(u,t,a,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(g=>typeof g!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends s.Evented{constructor(u,t,a,d){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Rr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this._map=u,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:a,z:d}=u.canonical;return this._implementation.hasTile({x:t,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:a,y:d,z:m}=u.tileID.canonical,g=new s.window.AbortController,w=this._implementation.loadTile({x:a,y:d,z:m},{signal:g.signal});if(!w)return this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null);w.cancel=()=>g.abort(),u.request=w.then(function(b){return delete u.request,u.aborted?(u.state="unloaded",t(null)):b?function(S){return S instanceof s.window.ImageData||S instanceof s.window.ImageBitmap||S instanceof s.window.HTMLCanvasElement}(b)?(this.loadTileData(u,b),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null))}.bind(this)).catch(b=>{b.code!==20&&(u.state="errored",t(b))})}loadTileData(u,t){Q.loadTileData(u,t,this._map.painter)}unloadTileData(u){Q.unloadTileData(u,this._map.painter)}prepareTile(u){if(!this._implementation.prepareTile)return null;const{x:t,y:a,z:d}=u.tileID.canonical,m=this._implementation.prepareTile({x:t,y:a,z:d});return m?(this.loadTileData(u,m),u.state="loaded",m):null}unloadTile(u,t){if(this.unloadTileData(u),this._implementation.unloadTile){const{x:a,y:d,z:m}=u.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:m})}t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},be=function(u,t,a,d){const m=new le[t.type](u,t,a,d);if(m.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${m.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],m),m};function Le(u,t){const a=s.identity([]);return s.scale(a,a,[.5*u.width,.5*-u.height,1]),s.translate(a,a,[1,-1,0]),s.multiply(a,a,u.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(a)}function et(u,t,a,d,m,g,w,b=!1){const S=u.tilesIn(d,w,b);S.sort(pt);const k=[];for(const L of S)k.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(t,a,u._state,L,m,g,Le(u.transform,L.tile.tileID),b)});const z=function(L){const O={},j={};for(const U of L){const N=U.queryResults,J=U.wrappedTileID,$=j[J]=j[J]||{};for(const K in N){const q=N[K],ee=$[K]=$[K]||{},Z=O[K]=O[K]||[];for(const Y of q)ee[Y.featureIndex]||(ee[Y.featureIndex]=!0,Z.push(Y))}}return O}(k);for(const L in z)z[L].forEach(O=>{const j=O.feature,U=j.layer;U&&U.type!=="background"&&U.type!=="sky"&&(j.source=U.source,U["source-layer"]&&(j.sourceLayer=U["source-layer"]),j.state=j.id!==void 0?u.getFeatureState(U["source-layer"],j.id):{})});return z}function Oe(u,t){const a=u.getRenderableIds().map(g=>u.getTileByID(g)),d=[],m={};for(let g=0;g<a.length;g++){const w=a[g],b=w.tileID.canonical.key;m[b]||(m[b]=!0,w.querySourceFeatures(d,t))}return d}function pt(u,t){const a=u.tileID,d=t.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function gt(){return Ua.workerClass!=null?new Ua.workerClass:new s.window.Worker(Ua.workerUrl)}const ft="mapboxgl_preloaded_worker_pool";class xt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<xt.workerCount;)this.workers.push(new gt);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ft]}numActive(){return Object.keys(this.active).length}}let It;function Gt(){return It||(It=new xt),It}function ni(u,t){const a={};for(const d in u)d!=="ref"&&(a[d]=u[d]);return s.refProperties.forEach(d=>{d in t&&(a[d]=t[d])}),a}function Xt(u){u=u.slice();const t=Object.create(null);for(let a=0;a<u.length;a++)t[u[a].id]=u[a];for(let a=0;a<u.length;a++)"ref"in u[a]&&(u[a]=ni(u[a],t[u[a].ref]));return u}xt.workerCount=2;const fe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Pn(u,t,a){a.push({command:fe.addSource,args:[u,t[u]]})}function di(u,t,a){t.push({command:fe.removeSource,args:[u]}),a[u]=!0}function $n(u,t,a,d){di(u,a,d),Pn(u,t,a)}function lm(u,t,a){let d;for(d in u[a])if(u[a].hasOwnProperty(d)&&d!=="data"&&!G(u[a][d],t[a][d]))return!1;for(d in t[a])if(t[a].hasOwnProperty(d)&&d!=="data"&&!G(u[a][d],t[a][d]))return!1;return!0}function Dn(u,t,a,d,m,g){let w;for(w in t=t||{},u=u||{})u.hasOwnProperty(w)&&(G(u[w],t[w])||a.push({command:g,args:[d,w,t[w],m]}));for(w in t)t.hasOwnProperty(w)&&!u.hasOwnProperty(w)&&(G(u[w],t[w])||a.push({command:g,args:[d,w,t[w],m]}))}function xl(u){return u.id}function sd(u,t){return u[t.id]=t,u}class _a{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.clamp(t,0,1);let a=1,d=this._distances[a];const m=t*this.paddedLength+this.padding;for(;d<m&&a<this._distances.length;)d=this._distances[++a];const g=a-1,w=this._distances[g],b=d-w,S=b>0?(m-w)/b:0;return this.points[g].mult(1-S).add(this.points[a].mult(S))}}class Je{constructor(t,a,d){const m=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(a/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,d,m,g){this._forEachCell(a,d,m,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(g)}insertCircle(t,a,d,m){this._forEachCell(a-m,d-m,a+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(d),this.circles.push(m)}_insertBoxCell(t,a,d,m,g,w){this.boxCells[g].push(w)}_insertCircleCell(t,a,d,m,g,w){this.circleCells[g].push(w)}_query(t,a,d,m,g,w){if(d<0||t>this.width||m<0||a>this.height)return!g&&[];const b=[];if(t<=0&&a<=0&&this.width<=d&&this.height<=m){if(g)return!0;for(let S=0;S<this.boxKeys.length;S++)b.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const k=this.circles[3*S],z=this.circles[3*S+1],L=this.circles[3*S+2];b.push({key:this.circleKeys[S],x1:k-L,y1:z-L,x2:k+L,y2:z+L})}return w?b.filter(w):b}return this._forEachCell(t,a,d,m,this._queryCell,b,{hitTest:g,seenUids:{box:{},circle:{}}},w),g?b.length>0:b}_queryCircle(t,a,d,m,g){const w=t-d,b=t+d,S=a-d,k=a+d;if(b<0||w>this.width||k<0||S>this.height)return!m&&[];const z=[];return this._forEachCell(w,S,b,k,this._queryCellCircle,z,{hitTest:m,circle:{x:t,y:a,radius:d},seenUids:{box:{},circle:{}}},g),m?z.length>0:z}query(t,a,d,m,g){return this._query(t,a,d,m,!1,g)}hitTest(t,a,d,m,g){return this._query(t,a,d,m,!0,g)}hitTestCircle(t,a,d,m){return this._queryCircle(t,a,d,!0,m)}_queryCell(t,a,d,m,g,w,b,S){const k=b.seenUids,z=this.boxCells[g];if(z!==null){const O=this.bboxes;for(const j of z)if(!k.box[j]){k.box[j]=!0;const U=4*j;if(t<=O[U+2]&&a<=O[U+3]&&d>=O[U+0]&&m>=O[U+1]&&(!S||S(this.boxKeys[j]))){if(b.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[j],x1:O[U],y1:O[U+1],x2:O[U+2],y2:O[U+3]})}}}const L=this.circleCells[g];if(L!==null){const O=this.circles;for(const j of L)if(!k.circle[j]){k.circle[j]=!0;const U=3*j;if(this._circleAndRectCollide(O[U],O[U+1],O[U+2],t,a,d,m)&&(!S||S(this.circleKeys[j]))){if(b.hitTest)return w.push(!0),!0;{const N=O[U],J=O[U+1],$=O[U+2];w.push({key:this.circleKeys[j],x1:N-$,y1:J-$,x2:N+$,y2:J+$})}}}}}_queryCellCircle(t,a,d,m,g,w,b,S){const k=b.circle,z=b.seenUids,L=this.boxCells[g];if(L!==null){const j=this.bboxes;for(const U of L)if(!z.box[U]){z.box[U]=!0;const N=4*U;if(this._circleAndRectCollide(k.x,k.y,k.radius,j[N+0],j[N+1],j[N+2],j[N+3])&&(!S||S(this.boxKeys[U])))return w.push(!0),!0}}const O=this.circleCells[g];if(O!==null){const j=this.circles;for(const U of O)if(!z.circle[U]){z.circle[U]=!0;const N=3*U;if(this._circlesCollide(j[N],j[N+1],j[N+2],k.x,k.y,k.radius)&&(!S||S(this.circleKeys[U])))return w.push(!0),!0}}}_forEachCell(t,a,d,m,g,w,b,S){const k=this._convertToXCellCoord(t),z=this._convertToYCellCoord(a),L=this._convertToXCellCoord(d),O=this._convertToYCellCoord(m);for(let j=k;j<=L;j++)for(let U=z;U<=O;U++)if(g.call(this,t,a,d,m,this.xCellCount*U+j,w,b,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,d,m,g,w){const b=m-t,S=g-a,k=d+w;return k*k>b*b+S*S}_circleAndRectCollide(t,a,d,m,g,w,b){const S=(w-m)/2,k=Math.abs(t-(m+S));if(k>S+d)return!1;const z=(b-g)/2,L=Math.abs(a-(g+z));if(L>z+d)return!1;if(k<=S||L<=z)return!0;const O=k-S,j=L-z;return O*O+j*j<=d*d}}const Bt=Math.tan(85*Math.PI/180);function kt(u,t,a,d,m,g){const w=s.create();if(a)if(m.projection.name==="globe"){const b=s.calculateGlobeLabelMatrix(m,t);s.multiply(w,w,b)}else{const b=ii([],g);w[0]=b[0],w[1]=b[1],w[4]=b[2],w[5]=b[3],d||s.rotateZ(w,w,m.angle)}else s.multiply(w,m.labelPlaneMatrix,u);return w}function cr(u,t,a,d,m,g){const w=kt(u,t,a,d,m,g);return m.projection.name==="globe"&&a||(w[2]=w[6]=w[10]=w[14]=0),w}function Po(u,t,a,d,m,g){if(a){if(m.projection.name==="globe"){const w=kt(u,t,a,d,m,g);return s.invert(w,w),s.multiply(w,u,w),w}{const w=s.clone(u),b=s.identity([]);return b[0]=g[0],b[1]=g[1],b[4]=g[2],b[5]=g[3],s.multiply(w,w,b),d||s.rotateZ(w,w,-m.angle),w}}return m.glCoordMatrix}function Ct(u,t,a=0){const d=[u.x,u.y,a,1];a?s.transformMat4$1(d,d,t):xi(d,d,t);const m=d[3];return{point:[d[0]/m,d[1]/m,d[2]/m],signedDistanceFromCamera:m}}function Vr(u,t){const a=[u[0],u[1],u[2],1];s.transformMat4$1(a,a,t);const d=a[3];return{point:[a[0]/d,a[1]/d,a[2]/d],signedDistanceFromCamera:d}}function ds(u,t){return Math.min(.5+u/t*.5,1.5)}function ga(u,t){const a=u[0]/u[3],d=u[1]/u[3];return a>=-t[0]&&a<=t[0]&&d>=-t[1]&&d<=t[1]}function Zn(u,t,a,d,m,g,w,b,S,k){const z=a.transform,L=d?u.textSizeData:u.iconSizeData,O=s.evaluateSizeForZoom(L,a.transform.zoom),j=z.projection.name==="globe",U=[256/a.width*2+1,256/a.height*2+1],N=d?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;N.clear();let J=null;j&&(J=d?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const $=u.lineVertexArray,K=d?u.text.placedSymbolArray:u.icon.placedSymbolArray,q=a.transform.width/a.transform.height;let ee=!1;for(let Z=0;Z<K.length;Z++){const Y=K.get(Z);if(Y.writingMode!==s.WritingMode.vertical||ee||Z!==0&&K.get(Z-1).writingMode===s.WritingMode.horizontal||(ee=!0),(Y.hidden||Y.writingMode===s.WritingMode.vertical)&&!ee){Oi(Y.numGlyphs,N);continue}ee=!1;const oe=new s.pointGeometry(Y.tileAnchorX,Y.tileAnchorY),Ee=S?S(oe):[0,0,0],Me=z.projection.projectTilePoint(oe.x,oe.y,k.canonical),ke=[Me.x+Ee[0],Me.y+Ee[1],Me.z+Ee[2]],$e=[...ke,1];if(s.transformMat4$1($e,$e,t),!ga($e,U)){Oi(Y.numGlyphs,N);continue}const ye=ds(a.transform.cameraToCenterDistance,$e[3]),Be=s.evaluateSizeForFeature(L,O,Y),Pe=w?Be/ye:Be*ye,xe=Ct(new s.pointGeometry(ke[0],ke[1]),m,ke[2]);if(xe.signedDistanceFromCamera<=0){Oi(Y.numGlyphs,N);continue}let ge={};const tt=w?null:S,st=ps(Y,Pe,!1,b,t,m,g,u.glyphOffsetArray,$,N,J,xe.point,oe,ge,q,tt,z.projection,k,w);ee=st.useVertical,tt&&st.needsFlipping&&(ge={}),(st.notEnoughRoom||ee||st.needsFlipping&&ps(Y,Pe,!0,b,t,m,g,u.glyphOffsetArray,$,N,J,xe.point,oe,ge,q,tt,z.projection,k,w).notEnoughRoom)&&Oi(Y.numGlyphs,N)}d?(u.text.dynamicLayoutVertexBuffer.updateData(N),J&&u.text.globeExtVertexBuffer.updateData(J)):(u.icon.dynamicLayoutVertexBuffer.updateData(N),J&&u.icon.globeExtVertexBuffer.updateData(J))}function pi(u,t,a,d,m,g,w,b,S,k,z,L,O,j,U,N){const J=b.glyphStartIndex+b.numGlyphs,$=b.lineStartIndex,K=b.lineStartIndex+b.lineLength,q=t.getoffsetX(b.glyphStartIndex),ee=t.getoffsetX(J-1),Z=ms(u*q,a,d,m,g,w,b.segment,$,K,S,k,z,L,O,!0,j,U,N);if(!Z)return null;const Y=ms(u*ee,a,d,m,g,w,b.segment,$,K,S,k,z,L,O,!0,j,U,N);return Y?{first:Z,last:Y}:null}function ad(u,t,a,d){return u.writingMode===s.WritingMode.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*d?{useVertical:!0}:u.writingMode===s.WritingMode.vertical?t.y<a.y?{needsFlipping:!0}:null:u.flipState!==0&&function(m,g,w){const b=(g.x-m.x)*w;return b===0||Math.abs((g.y-m.y)/b)>Bt}(t,a,d)?u.flipState===1?{needsFlipping:!0}:null:t.x>a.x?{needsFlipping:!0}:null}function ps(u,t,a,d,m,g,w,b,S,k,z,L,O,j,U,N,J,$,K){const q=t/24,ee=u.lineOffsetX*q,Z=u.lineOffsetY*q;let Y;if(u.numGlyphs>1){const oe=u.glyphStartIndex+u.numGlyphs,Ee=u.lineStartIndex,Me=u.lineStartIndex+u.lineLength,ke=pi(q,b,ee,Z,a,L,O,u,S,g,j,N,!1,J,$,K);if(!ke)return{notEnoughRoom:!0};const $e=Vr(ke.first.point,w).point,ye=Vr(ke.last.point,w).point,Be=new s.pointGeometry($e[0],$e[1]),Pe=new s.pointGeometry(ye[0],ye[1]);if(d&&!a){const xe=ad(u,Be,Pe,U);if(u.flipState=xe&&xe.needsFlipping?1:2,xe)return xe}Y=[ke.first];for(let xe=u.glyphStartIndex+1;xe<oe-1;xe++)Y.push(ms(q*b.getoffsetX(xe),ee,Z,a,L,O,u.segment,Ee,Me,S,g,j,N,!1,!1,J,$,K));Y.push(ke.last)}else{if(d&&!a){const Ee=Ct(O,m).point,Me=u.lineStartIndex+u.segment+1,ke=new s.pointGeometry(S.getx(Me),S.gety(Me)),$e=Ct(ke,m),ye=$e.signedDistanceFromCamera>0?$e.point:fs(O,ke,Ee,1,m,void 0,J,$.canonical),Be=ad(u,new s.pointGeometry(Ee[0],Ee[1]),new s.pointGeometry(ye[0],ye[1]),U);if(u.flipState=Be&&Be.needsFlipping?1:2,Be)return Be}const oe=ms(q*b.getoffsetX(u.glyphStartIndex),ee,Z,a,L,O,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,S,g,j,N,!1,!1,J,$,K);if(!oe)return{notEnoughRoom:!0};Y=[oe]}if(z)for(const oe of Y)s.updateGlobeVertexNormal(z,k.length+0,oe.up[0],oe.up[1],oe.up[2]),s.updateGlobeVertexNormal(z,k.length+1,oe.up[0],oe.up[1],oe.up[2]),s.updateGlobeVertexNormal(z,k.length+2,oe.up[0],oe.up[1],oe.up[2]),s.updateGlobeVertexNormal(z,k.length+3,oe.up[0],oe.up[1],oe.up[2]),s.addDynamicAttributes(k,oe.point[0],oe.point[1],oe.point[2],oe.angle);else for(const oe of Y)s.addDynamicAttributes(k,oe.point[0],oe.point[1],oe.point[2],oe.angle);return{}}function vl(u,t,a,d,m){const g=d.projectTilePoint(u.x,u.y,t);if(!m)return Ct(g,a,g.z);const w=m(u);return Ct(new s.pointGeometry(g.x+w[0],g.y+w[1]),a,g.z+w[2])}function fs(u,t,a,d,m,g,w,b){const S=vl(u.add(u.sub(t)._unit()),b,m,w,g).point,k=s.sub([],a,S);return s.scaleAndAdd([],a,k,d/s.length(k))}function ms(u,t,a,d,m,g,w,b,S,k,z,L,O,j,U,N,J,$){const K=d?u-t:u+t;let q=K>0?1:-1,ee=0;d&&(q*=-1,ee=Math.PI),q<0&&(ee+=Math.PI);let Z=q>0?b+w:b+w+1,Y=m,oe=m,Ee=0,Me=0;const ke=Math.abs(K),$e=[],ye=[];let Be=g;const Pe=()=>{const Ke=Z-q;return Ee===0?g:new s.pointGeometry(k.getx(Ke),k.gety(Ke))},xe=()=>fs(Pe(),Be,oe,ke-Ee+1,z,O,N,J.canonical);for(;Ee+Me<=ke;){if(Z+=q,Z<b||Z>=S)return null;if(oe=Y,$e.push(Y),j&&ye.push(Be||Pe()),Y=L[Z],Y===void 0){Be=new s.pointGeometry(k.getx(Z),k.gety(Z));const Ke=vl(Be,J.canonical,z,N,O);Y=Ke.signedDistanceFromCamera>0?L[Z]=Ke.point:xe()}else Be=null;Ee+=Me,Me=s.distance(oe,Y)}Be=Be||new s.pointGeometry(k.getx(Z),k.gety(Z));const ge=Pe();U&&O&&(L[Z]=Y=L[Z]===void 0?Y:xe(),Me=s.distance(oe,Y));const tt=(ke-Ee)/Me,st=Be.sub(ge).mult(tt)._add(ge),qe=s.sub([],Y,oe),rt=s.scaleAndAdd([],oe,qe,tt);let ot=[0,0,1],bt=qe[0],mt=qe[1];if($&&(ot=N.upVector(J.canonical,st.x,st.y),ot[0]!==0||ot[1]!==0||ot[2]!==1)){const Ke=[1,0,0],zt=[0,1,0];Ke[0]=ot[2],Ke[1]=0,Ke[2]=-ot[0],s.cross(zt,ot,Ke),s.normalize(Ke,Ke),s.normalize(zt,zt),bt=s.dot(qe,Ke),mt=s.dot(qe,zt)}if(a){const Ke=s.cross([],ot,qe);s.normalize(Ke,Ke),s.scaleAndAdd(rt,rt,Ke,a*q)}const Ye=ee+Math.atan2(mt,bt);return $e.push(rt),j&&ye.push(st),{point:rt,angle:Ye,path:$e,tilePath:ye,up:ot}}const ld=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oi(u,t){for(let a=0;a<u;a++){const d=t.length;t.resize(d+4),t.float32.set(ld,4*d)}}function xi(u,t,a){const d=t[0],m=t[1];return u[0]=a[0]*d+a[4]*m+a[12],u[1]=a[1]*d+a[5]*m+a[13],u[3]=a[3]*d+a[7]*m+a[15],u}const qn=100;class tu{constructor(t,a,d=new Je(t.width+200,t.height+200,25),m=new Je(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+qn,this.screenBottomBoundary=t.height+qn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,d,m,g,w,b){let S=a.projectedAnchorX,k=a.projectedAnchorY,z=a.projectedAnchorZ;const L=a.elevation,O=a.tileID;if(L&&O){const ee=this.transform.projection.upVector(O.canonical,a.tileAnchorX,a.tileAnchorY),Z=this.transform.projection.upVectorScale(O.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;S+=ee[0]*L*Z,k+=ee[1]*L*Z,z+=ee[2]*L*Z}const j=this.projectAndGetPerspectiveRatio(w,[S,k,z],a.tileID,this.transform.projection.name==="globe"||!!L||this.transform.pitch>0),U=g*j.perspectiveRatio,N=(a.x1*t+d.x-a.padding)*U+j.point.x,J=(a.y1*t+d.y-a.padding)*U+j.point.y,$=(a.x2*t+d.x+a.padding)*U+j.point.x,K=(a.y2*t+d.y+a.padding)*U+j.point.y,q=j.perspectiveRatio<=.55||j.occluded;return!this.isInsideGrid(N,J,$,K)||!m&&this.grid.hitTest(N,J,$,K,b)||q?{box:[],offscreen:!1,occluded:j.occluded}:{box:[N,J,$,K],offscreen:this.isOffscreen(N,J,$,K),occluded:!1}}placeCollisionCircles(t,a,d,m,g,w,b,S,k,z,L,O,j,U){const N=[],J=this.transform.elevation,$=J?J.getAtTileOffsetFunc(U,this.transform.center.lat,this.transform.worldSize,this.transform.projection):xe=>[0,0,0],K=new s.pointGeometry(a.tileAnchorX,a.tileAnchorY),q=this.transform.projection.projectTilePoint(a.tileAnchorX,a.tileAnchorY,U.canonical),ee=$(K),Z=[q.x+ee[0],q.y+ee[1],q.z+ee[2]],Y=this.transform.projection.name==="globe",oe=this.projectAndGetPerspectiveRatio(w,[Z[0],Z[1],Z[2]],U,Y||!!J||this.transform.pitch>0),{perspectiveRatio:Ee}=oe,Me=(z?g/Ee:g*Ee)/s.ONE_EM,ke=Ct(new s.pointGeometry(Z[0],Z[1]),b,Z[2]).point,$e=oe.signedDistanceFromCamera>0?pi(Me,m,a.lineOffsetX*Me,a.lineOffsetY*Me,!1,ke,K,a,d,b,{},J&&!z?$:null,z&&!!J,this.transform.projection,U,z):null;let ye=!1,Be=!1,Pe=!0;if($e&&!oe.occluded){const xe=.5*O*Ee+j,ge=new s.pointGeometry(-100,-100),tt=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),st=new _a,qe=$e.first,rt=$e.last;let ot=[];for(let Ye=qe.path.length-1;Ye>=1;Ye--)ot.push(qe.path[Ye]);for(let Ye=1;Ye<rt.path.length;Ye++)ot.push(rt.path[Ye]);const bt=2.5*xe;if(S){const Ye=ot.map(J&&!Y?(Ke,zt)=>{const Zt=$(zt<qe.path.length-1?qe.tilePath[qe.path.length-1-zt]:rt.tilePath[zt-qe.path.length+2]);return Ke[2]=Zt[2],Vr(Ke,S)}:Ke=>Vr(Ke,S));ot=Ye.some(Ke=>Ke.signedDistanceFromCamera<=0)?[]:Ye.map(Ke=>Ke.point)}let mt=[];if(ot.length>0){const Ye=ot.map(Jt=>new s.pointGeometry(Jt[0],Jt[1]));let Ke=1/0,zt=-1/0,Zt=1/0,ri=-1/0;for(let Jt=0;Jt<Ye.length;Jt++)Ke=Math.min(Ke,Ye[Jt].x),Zt=Math.min(Zt,Ye[Jt].y),zt=Math.max(zt,Ye[Jt].x),ri=Math.max(ri,Ye[Jt].y);mt=Ke>=ge.x&&zt<=tt.x&&Zt>=ge.y&&ri<=tt.y?[Ye]:zt<ge.x||Ke>tt.x||ri<ge.y||Zt>tt.y?[]:s.clipLine([Ye],ge.x,ge.y,tt.x,tt.y)}for(const Ye of mt){st.reset(Ye,.25*xe);let Ke=0;Ke=st.length<=.5*xe?1:Math.ceil(st.paddedLength/bt)+1;for(let zt=0;zt<Ke;zt++){const Zt=zt/Math.max(Ke-1,1),ri=st.lerp(Zt),Jt=ri.x+qn,dn=ri.y+qn;N.push(Jt,dn,xe,0);const Xn=Jt-xe,xn=dn-xe,Er=Jt+xe,si=dn+xe;if(Pe=Pe&&this.isOffscreen(Xn,xn,Er,si),Be=Be||this.isInsideGrid(Xn,xn,Er,si),!t&&this.grid.hitTestCircle(Jt,dn,xe,L)&&(ye=!0,!k))return{circles:[],offscreen:!1,collisionDetected:ye,occluded:!1}}}}return{circles:!k&&ye||!Be?[]:N,offscreen:Pe,collisionDetected:ye,occluded:oe.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,m=1/0,g=-1/0,w=-1/0;for(const z of t){const L=new s.pointGeometry(z.x+qn,z.y+qn);d=Math.min(d,L.x),m=Math.min(m,L.y),g=Math.max(g,L.x),w=Math.max(w,L.y),a.push(L)}const b=this.grid.query(d,m,g,w).concat(this.ignoredGrid.query(d,m,g,w)),S={},k={};for(const z of b){const L=z.key;if(S[L.bucketInstanceId]===void 0&&(S[L.bucketInstanceId]={}),S[L.bucketInstanceId][L.featureIndex])continue;const O=[new s.pointGeometry(z.x1,z.y1),new s.pointGeometry(z.x2,z.y1),new s.pointGeometry(z.x2,z.y2),new s.pointGeometry(z.x1,z.y2)];s.polygonIntersectsPolygon(a,O)&&(S[L.bucketInstanceId][L.featureIndex]=!0,k[L.bucketInstanceId]===void 0&&(k[L.bucketInstanceId]=[]),k[L.bucketInstanceId].push(L.featureIndex))}return k}insertCollisionBox(t,a,d,m,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:m,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,d,m,g){const w=a?this.ignoredGrid:this.grid,b={bucketInstanceId:d,featureIndex:m,collisionGroupID:g};for(let S=0;S<t.length;S+=4)w.insertCircle(b,t[S],t[S+1],t[S+2])}projectAndGetPerspectiveRatio(t,a,d,m){const g=[a[0],a[1],a[2],1];let w=!1;if(a[2]||this.transform.pitch>0){s.transformMat4$1(g,g,t);const b=this.transform.projection.name==="globe";this.fogState&&d&&!b&&(w=function(S,k,z,L,O,j){const U=j.calculateFogTileMatrix(O),N=[k,z,L];return s.transformMat4(N,N,U),at(S,N,j.pitch,j._fov)}(this.fogState,a[0],a[1],a[2],d.toUnwrapped(),this.transform)>.9)}else xi(g,g,t);return{point:new s.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+qn,(-g[1]/g[3]+1)/2*this.transform.height+qn),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/g[3]*.5,1.5),signedDistanceFromCamera:g[3],occluded:m&&g[2]>g[3]||w}}isOffscreen(t,a,d,m){return d<qn||t>=this.screenRightBoundary||m<qn||a>this.screenBottomBoundary}isInsideGrid(t,a,d,m){return d>=0&&t<this.gridRightBoundary&&m>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=s.identity([]);return s.translate(t,t,[-100,-100,0]),t}}class hn{constructor(t,a,d,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class rn{constructor(t,a,d,m,g,w=!1){this.text=new hn(t?t.text:null,a,d,g),this.icon=new hn(t?t.icon:null,a,m,g),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class wl{constructor(t,a,d,m=!1){this.text=t,this.icon=a,this.skipFade=d,this.clipped=m}}class bl{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Ni{constructor(t,a,d,m,g){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=g}}class ya{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[t]}}function Tl(u,t,a,d,m){const{horizontalAlign:g,verticalAlign:w}=s.getAnchorAlignment(u),b=-(g-.5)*t,S=-(w-.5)*a,k=s.evaluateVariableOffset(u,d);return new s.pointGeometry(b+k[0]*m,S+k[1]*m)}function Do(u,t,a,d,m){const g=new s.pointGeometry(u,t);return a&&g._rotate(d?m:-m),g}class Hi{constructor(t,a,d,m,g){this.transform=t.clone(),this.collisionIndex=new tu(this.transform,g),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new ya(d),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,d,m){const g=d.getBucket(a),w=d.latestFeatureIndex;if(!g||!w||a.id!==g.layerIds[0])return;const b=g.layers[0].layout,S=d.collisionBoxArray,k=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),z=d.tileSize/s.EXTENT,L=d.tileID.toUnwrapped(),O=this.transform.calculateProjMatrix(L),j=b.get("text-pitch-alignment")==="map",U=b.get("text-rotation-alignment")==="map";a.compileFilter();const N=a.dynamicFilter(),J=a.dynamicFilterNeedsFeature(),$=this.transform.calculatePixelsToTileUnitsMatrix(d),K=cr(O,d.tileID.canonical,j,U,this.transform,$);let q=null;if(j){const Y=Po(O,d.tileID.canonical,j,U,this.transform,$);q=s.multiply([],this.transform.labelPlaneMatrix,Y)}let ee=null;N&&d.latestFeatureIndex&&(ee={unwrappedTileID:L,dynamicFilter:N,dynamicFilterNeedsFeature:J,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[g.bucketInstanceId]=new Ni(g.bucketInstanceId,w,g.sourceLayerIndex,g.index,d.tileID);const Z={bucket:g,layout:b,posMatrix:O,textLabelPlaneMatrix:K,labelToScreenMatrix:q,clippingData:ee,scale:k,textPixelRatio:z,holdingForFade:d.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(g.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(m)for(const Y of g.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:Ee,symbolInstanceEnd:Me}=Y;t.push({sortKey:oe,symbolInstanceStart:Ee,symbolInstanceEnd:Me,parameters:Z})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:Z})}attemptAnchorPlacement(t,a,d,m,g,w,b,S,k,z,L,O,j,U,N,J,$,K){const q=[O.textOffset0,O.textOffset1],ee=Tl(t,d,m,q,g),Z=this.collisionIndex.placeCollisionBox(g,a,Do(ee.x,ee.y,w,b,this.transform.angle),L,S,k,z.predicate);if((!J||this.collisionIndex.placeCollisionBox(U.getSymbolInstanceIconSize(K,this.transform.zoom,j),J,Do(ee.x,ee.y,w,b,this.transform.angle),L,S,k,z.predicate).box.length!==0)&&Z.box.length>0){let Y;return this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(Y=this.prevPlacement.variableOffsets[O.crossTileID].anchor),this.variableOffsets[O.crossTileID]={textOffset:q,width:d,height:m,anchor:t,textScale:g,prevAnchor:Y},this.markUsedJustification(U,t,O,N),U.allowVerticalPlacement&&(this.markUsedOrientation(U,N,O),this.placedOrientations[O.crossTileID]=N),{shift:ee,placedGlyphBoxes:Z}}}placeLayerBucketPart(t,a,d,m){const{bucket:g,layout:w,posMatrix:b,textLabelPlaneMatrix:S,labelToScreenMatrix:k,clippingData:z,textPixelRatio:L,holdingForFade:O,collisionBoxArray:j,partiallyEvaluatedTextSize:U,partiallyEvaluatedIconSize:N,collisionGroup:J}=t.parameters,$=w.get("text-optional"),K=w.get("icon-optional"),q=w.get("text-allow-overlap"),ee=w.get("icon-allow-overlap"),Z=w.get("text-rotation-alignment")==="map",Y=w.get("text-pitch-alignment")==="map",oe=w.get("icon-text-fit")!=="none",Ee=w.get("symbol-z-order")==="viewport-y";let Me=q&&(ee||!g.hasIconData()||K),ke=ee&&(q||!g.hasTextData()||$);!g.collisionArrays&&j&&g.deserializeCollisionBoxes(j),d&&m&&g.updateCollisionDebugBuffers(this.transform.zoom,j);const $e=(ye,Be,Pe)=>{if(z){const si={zoom:this.transform.zoom,pitch:this.transform.pitch};let gi=null;if(z.dynamicFilterNeedsFeature){const Vt=this.retainedQueryData[g.bucketInstanceId];gi=z.featureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:Vt.bucketIndex,sourceLayerIndex:Vt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(si,gi,this.retainedQueryData[g.bucketInstanceId].tileID.canonical,new s.pointGeometry(ye.tileAnchorX,ye.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[ye.crossTileID]=new wl(!1,!1,!1,!0),void(a[ye.crossTileID]=!0)}if(a[ye.crossTileID])return;if(O)return void(this.placements[ye.crossTileID]=new wl(!1,!1,!1));let xe=!1,ge=!1,tt=!0,st=!1,qe=!1,rt=null,ot={box:null,offscreen:null,occluded:null},bt={box:null,offscreen:null,occluded:null},mt=null,Ye=null,Ke=null,zt=0,Zt=0,ri=0;Pe.textFeatureIndex?zt=Pe.textFeatureIndex:ye.useRuntimeCollisionCircles&&(zt=ye.featureIndex),Pe.verticalTextFeatureIndex&&(Zt=Pe.verticalTextFeatureIndex);const Jt=si=>{si.tileID=this.retainedQueryData[g.bucketInstanceId].tileID,(this.transform.elevation||si.elevation)&&(si.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[g.bucketInstanceId].tileID,si.tileAnchorX,si.tileAnchorY):0)},dn=Pe.textBox;if(dn){Jt(dn);const si=Vt=>{let Si=s.WritingMode.horizontal;if(g.allowVerticalPlacement&&!Vt&&this.prevPlacement){const on=this.prevPlacement.placedOrientations[ye.crossTileID];on&&(this.placedOrientations[ye.crossTileID]=on,Si=on,this.markUsedOrientation(g,Si,ye))}return Si},gi=(Vt,Si)=>{if(g.allowVerticalPlacement&&ye.numVerticalGlyphVertices>0&&Pe.verticalTextBox){for(const on of g.writingModes)if(on===s.WritingMode.vertical?(ot=Si(),bt=ot):ot=Vt(),ot&&ot.box&&ot.box.length)break}else ot=Vt()};if(w.get("text-variable-anchor")){let Vt=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ye.crossTileID]){const ai=this.prevPlacement.variableOffsets[ye.crossTileID];Vt.indexOf(ai.anchor)>0&&(Vt=Vt.filter(Hn=>Hn!==ai.anchor),Vt.unshift(ai.anchor))}const Si=(ai,Hn,Ss)=>{const Wr=g.getSymbolInstanceTextSize(U,ye,this.transform.zoom,Be),Ci=(ai.x2-ai.x1)*Wr+2*ai.padding,uo=(ai.y2-ai.y1)*Wr+2*ai.padding,Vo=oe&&!ee?Hn:null;Vo&&Jt(Vo);let Xr={box:[],offscreen:!1,occluded:!1};const cc=q?2*Vt.length:Vt.length;for(let Cs=0;Cs<cc;++Cs){const ja=this.attemptAnchorPlacement(Vt[Cs%Vt.length],ai,Ci,uo,Wr,Z,Y,L,b,J,Cs>=Vt.length,ye,Be,g,Ss,Vo,U,N);if(ja&&(Xr=ja.placedGlyphBoxes,Xr&&Xr.box&&Xr.box.length)){xe=!0,rt=ja.shift;break}}return Xr};gi(()=>Si(dn,Pe.iconBox,s.WritingMode.horizontal),()=>{const ai=Pe.verticalTextBox;return ai&&Jt(ai),g.allowVerticalPlacement&&!(ot&&ot.box&&ot.box.length)&&ye.numVerticalGlyphVertices>0&&ai?Si(ai,Pe.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ot&&(xe=ot.box,tt=ot.offscreen,st=ot.occluded);const on=si(ot&&ot.box);if(!xe&&this.prevPlacement){const ai=this.prevPlacement.variableOffsets[ye.crossTileID];ai&&(this.variableOffsets[ye.crossTileID]=ai,this.markUsedJustification(g,ai.anchor,ye,on))}}else{const Vt=(Si,on)=>{const ai=g.getSymbolInstanceTextSize(U,ye,this.transform.zoom,Be),Hn=this.collisionIndex.placeCollisionBox(ai,Si,new s.pointGeometry(0,0),q,L,b,J.predicate);return Hn&&Hn.box&&Hn.box.length&&(this.markUsedOrientation(g,on,ye),this.placedOrientations[ye.crossTileID]=on),Hn};gi(()=>Vt(dn,s.WritingMode.horizontal),()=>{const Si=Pe.verticalTextBox;return g.allowVerticalPlacement&&ye.numVerticalGlyphVertices>0&&Si?(Jt(Si),Vt(Si,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),si(ot&&ot.box&&ot.box.length)}}if(mt=ot,xe=mt&&mt.box&&mt.box.length>0,tt=mt&&mt.offscreen,st=mt&&mt.occluded,ye.useRuntimeCollisionCircles){const si=g.text.placedSymbolArray.get(ye.centerJustifiedTextSymbolIndex>=0?ye.centerJustifiedTextSymbolIndex:ye.verticalPlacedTextSymbolIndex),gi=s.evaluateSizeForFeature(g.textSizeData,U,si),Vt=w.get("text-padding");Ye=this.collisionIndex.placeCollisionCircles(q,si,g.lineVertexArray,g.glyphOffsetArray,gi,b,S,k,d,Y,J.predicate,ye.collisionCircleDiameter*gi/s.ONE_EM,Vt,this.retainedQueryData[g.bucketInstanceId].tileID),xe=q||Ye.circles.length>0&&!Ye.collisionDetected,tt=tt&&Ye.offscreen,st=Ye.occluded}if(Pe.iconFeatureIndex&&(ri=Pe.iconFeatureIndex),Pe.iconBox){const si=gi=>{Jt(gi);const Vt=oe&&rt?Do(rt.x,rt.y,Z,Y,this.transform.angle):new s.pointGeometry(0,0),Si=g.getSymbolInstanceIconSize(N,this.transform.zoom,Be);return this.collisionIndex.placeCollisionBox(Si,gi,Vt,ee,L,b,J.predicate)};bt&&bt.box&&bt.box.length&&Pe.verticalIconBox?(Ke=si(Pe.verticalIconBox),ge=Ke.box.length>0):(Ke=si(Pe.iconBox),ge=Ke.box.length>0),tt=tt&&Ke.offscreen,qe=Ke.occluded}const Xn=$||ye.numHorizontalGlyphVertices===0&&ye.numVerticalGlyphVertices===0,xn=K||ye.numIconVertices===0;if(Xn||xn?xn?Xn||(ge=ge&&xe):xe=ge&&xe:ge=xe=ge&&xe,xe&&mt&&mt.box&&this.collisionIndex.insertCollisionBox(mt.box,w.get("text-ignore-placement"),g.bucketInstanceId,bt&&bt.box&&Zt?Zt:zt,J.ID),ge&&Ke&&this.collisionIndex.insertCollisionBox(Ke.box,w.get("icon-ignore-placement"),g.bucketInstanceId,ri,J.ID),Ye&&(xe&&this.collisionIndex.insertCollisionCircles(Ye.circles,w.get("text-ignore-placement"),g.bucketInstanceId,zt,J.ID),d)){const si=g.bucketInstanceId;let gi=this.collisionCircleArrays[si];gi===void 0&&(gi=this.collisionCircleArrays[si]=new bl);for(let Vt=0;Vt<Ye.circles.length;Vt+=4)gi.circles.push(Ye.circles[Vt+0]),gi.circles.push(Ye.circles[Vt+1]),gi.circles.push(Ye.circles[Vt+2]),gi.circles.push(Ye.collisionDetected?1:0)}const Er=this.transform.projection.name!=="globe";Me=Me&&(Er||!st),ke=ke&&(Er||!qe),this.placements[ye.crossTileID]=new wl(xe||Me,ge||ke,tt||g.justReloaded),a[ye.crossTileID]=!0};if(Ee){const ye=g.getSortedSymbolIndexes(this.transform.angle);for(let Be=ye.length-1;Be>=0;--Be){const Pe=ye[Be];$e(g.symbolInstances.get(Pe),Pe,g.collisionArrays[Pe])}}else for(let ye=t.symbolInstanceStart;ye<t.symbolInstanceEnd;ye++)$e(g.symbolInstances.get(ye),ye,g.collisionArrays[ye]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[g.bucketInstanceId];s.invert(ye.invProjMatrix,b),ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(t,a,d,m){let g;g=m===s.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(a)];const w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const b of w)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=g>=0&&b!==g?0:d.crossTileID)}markUsedOrientation(t,a,d){const m=a===s.WritingMode.horizontal||a===s.WritingMode.horizontalOnly?a:0,g=a===s.WritingMode.vertical?a:0,w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const b of w)t.text.placedSymbolArray.get(b).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const m=a?a.symbolFadeChange(t):1,g=a?a.opacities:{},w=a?a.variableOffsets:{},b=a?a.placedOrientations:{};for(const S in this.placements){const k=this.placements[S],z=g[S];z?(this.opacities[S]=new rn(z,m,k.text,k.icon,null,k.clipped),d=d||k.text!==z.text.placed||k.icon!==z.icon.placed):(this.opacities[S]=new rn(null,m,k.text,k.icon,k.skipFade,k.clipped),d=d||k.text||k.icon)}for(const S in g){const k=g[S];if(!this.opacities[S]){const z=new rn(k,m,!1,!1);z.isHidden()||(this.opacities[S]=z,d=d||k.text.placed||k.icon.placed)}}for(const S in w)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=w[S]);for(const S in b)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=b[S]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const d={};for(const m of a){const g=m.getBucket(t);g&&m.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,d,m.collisionBoxArray)}}updateBucketOpacities(t,a,d){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,g=!!t.layers[0].dynamicFilter(),w=new rn(null,0,!1,!1,!0),b=m.get("text-allow-overlap"),S=m.get("icon-allow-overlap"),k=m.get("text-variable-anchor"),z=m.get("text-rotation-alignment")==="map",L=m.get("text-pitch-alignment")==="map",O=m.get("icon-text-fit")!=="none",j=new rn(null,0,b&&(S||!t.hasIconData()||m.get("icon-optional")),S&&(b||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const U=(J,$,K)=>{for(let q=0;q<$/4;q++)J.opacityVertexArray.emplaceBack(K)};let N=0;for(let J=0;J<t.symbolInstances.length;J++){const $=t.symbolInstances.get(J),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:q,crossTileID:ee}=$;let Z=this.opacities[ee];a[ee]?Z=w:Z||(Z=j,this.opacities[ee]=Z),a[ee]=!0;const Y=K>0||q>0,oe=$.numIconVertices>0,Ee=this.placedOrientations[$.crossTileID],Me=Ee===s.WritingMode.vertical,ke=Ee===s.WritingMode.horizontal||Ee===s.WritingMode.horizontalOnly;if(!Y&&!oe||Z.isHidden()||N++,Y){const $e=cd(Z.text);U(t.text,K,Me?va:$e),U(t.text,q,ke?va:$e);const ye=Z.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(xe=>{xe>=0&&(t.text.placedSymbolArray.get(xe).hidden=ye||Me?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=ye||ke?1:0);const Be=this.variableOffsets[$.crossTileID];Be&&this.markUsedJustification(t,Be.anchor,$,Ee);const Pe=this.placedOrientations[$.crossTileID];Pe&&(this.markUsedJustification(t,"left",$,Pe),this.markUsedOrientation(t,Pe,$))}if(oe){const $e=cd(Z.icon);$.placedIconSymbolIndex>=0&&(U(t.icon,$.numIconVertices,Me?va:$e),t.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=Z.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(U(t.icon,$.numVerticalIconVertices,ke?va:$e),t.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=Z.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const $e=t.collisionArrays[J];if($e){let ye=new s.pointGeometry(0,0),Be=!0;if($e.textBox||$e.verticalTextBox){if(k){const xe=this.variableOffsets[ee];xe?(ye=Tl(xe.anchor,xe.width,xe.height,xe.textOffset,xe.textScale),z&&ye._rotate(L?this.transform.angle:-this.transform.angle)):Be=!1}g&&(Be=!Z.clipped),$e.textBox&&_s(t.textCollisionBox.collisionVertexArray,Z.text.placed,!Be||Me,ye.x,ye.y),$e.verticalTextBox&&_s(t.textCollisionBox.collisionVertexArray,Z.text.placed,!Be||ke,ye.x,ye.y)}const Pe=Be&&Boolean(!ke&&$e.verticalIconBox);$e.iconBox&&_s(t.iconCollisionBox.collisionVertexArray,Z.icon.placed,Pe,O?ye.x:0,O?ye.y:0),$e.verticalIconBox&&_s(t.iconCollisionBox.collisionVertexArray,Z.icon.placed,!Pe,O?ye.x:0,O?ye.y:0)}}}if(t.fullyClipped=N===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=J.invProjMatrix,t.placementViewportMatrix=J.viewportMatrix,t.collisionCircleArray=J.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function _s(u,t,a,d,m){u.emplaceBack(t?1:0,a?1:0,d||0,m||0),u.emplaceBack(t?1:0,a?1:0,d||0,m||0),u.emplaceBack(t?1:0,a?1:0,d||0,m||0),u.emplaceBack(t?1:0,a?1:0,d||0,m||0)}const iu=Math.pow(2,25),Gr=Math.pow(2,24),xa=Math.pow(2,17),El=Math.pow(2,16),cm=Math.pow(2,9),nu=Math.pow(2,8),gs=Math.pow(2,1);function cd(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,a=Math.floor(127*u.opacity);return a*iu+t*Gr+a*xa+t*El+a*cm+t*nu+a*gs+t}const va=0;class ys{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,d,m,g){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(w,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((b,S)=>b.sortKey-S.sortKey));this._currentPartIndex<w.length;){const b=w[this._currentPartIndex];if(a.placeLayerBucketPart(b,this._seenCrossTileIDs,d,b.symbolInstanceStart===0),this._currentPartIndex++,g())return!0}return!1}}class ao{constructor(t,a,d,m,g,w,b,S){this.placement=new Hi(t,g,w,b,S),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,a,d){const m=s.exported.now(),g=()=>{const w=s.exported.now()-m;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=a[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=b)&&(!w.maxzoom||w.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new ys(w)),this._inProgressLayer.continuePlacement(d[w.source],this.placement,this._showCollisionBoxes,w,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Sl=512/s.EXTENT/2;class lo{constructor(t,a,d){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let m=0;m<a.length;m++){const g=a.get(m),w=g.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,t)})}}getScaledCoordinates(t,a){const d=Sl/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*s.EXTENT+t.tileAnchorX)*d),y:Math.floor((a.canonical.y*s.EXTENT+t.tileAnchorY)*d)}}findMatches(t,a,d){const m=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<t.length;g++){const w=t.get(g);if(w.crossTileID)continue;const b=this.indexedSymbolInstances[w.key];if(!b)continue;const S=this.getScaledCoordinates(w,a);for(const k of b)if(Math.abs(k.coord.x-S.x)<=m&&Math.abs(k.coord.y-S.y)<=m&&!d[k.crossTileID]){d[k.crossTileID]=!0,w.crossTileID=k.crossTileID;break}}}}class ru{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const d in this.indexes){const m=this.indexes[d],g={};for(const w in m){const b=m[w];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),g[b.tileID.key]=b}this.indexes[d]=g}this.lng=t}addBucket(t,a,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const w=this.indexes[g];if(Number(g)>t.overscaledZ)for(const b in w){const S=w[b];S.tileID.isChildOf(t)&&S.findMatches(a.symbolInstances,t,m)}else{const b=w[t.scaledTo(Number(g)).key];b&&b.findMatches(a.symbolInstances,t,m)}}for(let g=0;g<a.symbolInstances.length;g++){const w=a.symbolInstances.get(g);w.crossTileID||(w.crossTileID=d.generate(),m[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new lo(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const d in a.indexedSymbolInstances)for(const m of a.indexedSymbolInstances[d])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let a=!1;for(const d in this.indexes){const m=this.indexes[d];for(const g in m)t[m[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[g]),delete m[g],a=!0)}return a}}class ud{constructor(){this.layerIndexes={},this.crossTileIDs=new ru,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,d,m){let g=this.layerIndexes[t.id];g===void 0&&(g=this.layerIndexes[t.id]=new Cl);let w=!1;const b={};m.name!=="globe"&&g.handleWrapJump(d);for(const S of a){const k=S.getBucket(t);k&&t.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(S.tileID,k,this.crossTileIDs)&&(w=!0),b[k.bucketInstanceId]=!0)}return g.removeStaleBuckets(b)&&(w=!0),w}pruneUnusedLayers(t){const a={};t.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const Al=(u,t)=>s.emitValidationErrors(u,t&&t.filter(a=>a.identifier!=="source.canvas")),ou=s.pick(fe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),um=s.pick(fe,["setCenter","setZoom","setBearing","setPitch"]),hd={version:8,layers:[],sources:{}},hm={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ur extends s.Evented{constructor(t,a={}){super(),this.map=t,this.dispatcher=new zi(Gt(),this),this.imageManager=new un,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(t._requestManager,a.localFontFamily?s.LocalGlyphMode.all:a.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.lineAtlas=new s.LineAtlas(256,512),this.crossTileSymbolIndex=new ud,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const d=this;this._rtlTextPluginCallback=ur.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(g,w)=>{if(s.triggerPluginCompletionEvent(g),w&&w.every(b=>b))for(const b in d._sourceCaches){const S=d._sourceCaches[b],k=S.getSource().type;k!=="vector"&&k!=="geojson"||S.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.getSource(m.sourceId);if(g&&g.vectorLayerIds)for(const w in this._layers){const b=this._layers[w];b.source===g.id&&this._validateLayer(b)}})}loadURL(t,a={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!s.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,a.accessToken);const m=this.map._requestManager.transformRequest(t,s.ResourceType.Style);this._request=s.getJSON(m,(g,w)=>{this._request=null,g?this.fire(new s.ErrorEvent(g)):w&&this._load(w,d)})}loadJSON(t,a={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(hd,!1)}_updateLayerCount(t,a){const d=a?1:-1;t.is3D()&&(this._num3DLayers+=d),t.type==="circle"&&(this._numCircleLayers+=d),t.type==="symbol"&&(this._numSymbolLayers+=d)}_load(t,a){if(a&&Al(this,s.validateStyle(t)))return;this._loaded=!0,this.stylesheet=s.clone$1(t),this._updateMapProjection();for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const d=Xt(this.stylesheet.layers);this._order=d.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of d)m=s.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Co(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(a,d,m){let g,w,b;const S=s.exported.devicePixelRatio>1?"@2x":"";let k=s.getJSON(d.transformRequest(d.normalizeSpriteURL(a,S,".json"),s.ResourceType.SpriteJSON),(O,j)=>{k=null,b||(b=O,g=j,L())}),z=s.getImage(d.transformRequest(d.normalizeSpriteURL(a,S,".png"),s.ResourceType.SpriteImage),(O,j)=>{z=null,b||(b=O,w=j,L())});function L(){if(b)m(b);else if(g&&w){const O=s.exported.getImageData(w),j={};for(const U in g){const{width:N,height:J,x:$,y:K,sdf:q,pixelRatio:ee,stretchX:Z,stretchY:Y,content:oe}=g[U],Ee=new s.RGBAImage({width:N,height:J});s.RGBAImage.copy(O,Ee,{x:$,y:K},{x:0,y:0},{width:N,height:J}),j[U]={data:Ee,pixelRatio:ee,sdf:q,stretchX:Z,stretchY:Y,content:oe}}m(null,j)}}return{cancel(){k&&(k.cancel(),k=null),z&&(z.cancel(),z=null)}}}(t,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new s.ErrorEvent(a));else if(d)for(const m in d)this.imageManager.addImage(m,d[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(t){const a=this.getSource(t.source);if(!a)return;const d=t.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const a=[];for(const d of t){const m=this._layers[d];m.type!=="custom"&&a.push(m.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&hm[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(m.length||g.length)&&this._updateWorkerLayers(m,g);for(const w in this._updatedSources){const b=this._updatedSources[w];b==="reload"?this._reloadSource(w):b==="clear"&&this._clearSource(w)}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const d={};for(const m in this._sourceCaches){const g=this._sourceCaches[m];d[m]=g.used,g.used=!1}for(const m of this._order){const g=this._layers[m];if(g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)){const b=this._getLayerSourceCache(g);b&&(b.used=!0)}const w=this.map.painter;if(w){const b=g.getProgramIds();if(!b)continue;const S=g.getProgramConfiguration(t.zoom);for(const k of b)w.useProgram(k,S)}}for(const m in d){const g=this._sourceCaches[m];d[m]!==g.used&&g.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Al(this,s.validateStyle(t)))return!1;(t=s.clone$1(t)).layers=Xt(t.layers);const a=function(m,g){if(!m)return[{command:fe.setStyle,args:[g]}];let w=[];try{if(!G(m.version,g.version))return[{command:fe.setStyle,args:[g]}];G(m.center,g.center)||w.push({command:fe.setCenter,args:[g.center]}),G(m.zoom,g.zoom)||w.push({command:fe.setZoom,args:[g.zoom]}),G(m.bearing,g.bearing)||w.push({command:fe.setBearing,args:[g.bearing]}),G(m.pitch,g.pitch)||w.push({command:fe.setPitch,args:[g.pitch]}),G(m.sprite,g.sprite)||w.push({command:fe.setSprite,args:[g.sprite]}),G(m.glyphs,g.glyphs)||w.push({command:fe.setGlyphs,args:[g.glyphs]}),G(m.transition,g.transition)||w.push({command:fe.setTransition,args:[g.transition]}),G(m.light,g.light)||w.push({command:fe.setLight,args:[g.light]}),G(m.fog,g.fog)||w.push({command:fe.setFog,args:[g.fog]}),G(m.projection,g.projection)||w.push({command:fe.setProjection,args:[g.projection]});const b={},S=[];(function(L,O,j,U){let N;for(N in O=O||{},L=L||{})L.hasOwnProperty(N)&&(O.hasOwnProperty(N)||di(N,j,U));for(N in O)O.hasOwnProperty(N)&&(L.hasOwnProperty(N)?G(L[N],O[N])||(L[N].type==="geojson"&&O[N].type==="geojson"&&lm(L,O,N)?j.push({command:fe.setGeoJSONSourceData,args:[N,O[N].data]}):$n(N,O,j,U)):Pn(N,O,j))})(m.sources,g.sources,S,b);const k=[];m.layers&&m.layers.forEach(L=>{L.source&&b[L.source]?w.push({command:fe.removeLayer,args:[L.id]}):k.push(L)});let z=m.terrain;z&&b[z.source]&&(w.push({command:fe.setTerrain,args:[void 0]}),z=void 0),w=w.concat(S),G(z,g.terrain)||w.push({command:fe.setTerrain,args:[g.terrain]}),function(L,O,j){O=O||[];const U=(L=L||[]).map(xl),N=O.map(xl),J=L.reduce(sd,{}),$=O.reduce(sd,{}),K=U.slice(),q=Object.create(null);let ee,Z,Y,oe,Ee,Me,ke;for(ee=0,Z=0;ee<U.length;ee++)Y=U[ee],$.hasOwnProperty(Y)?Z++:(j.push({command:fe.removeLayer,args:[Y]}),K.splice(K.indexOf(Y,Z),1));for(ee=0,Z=0;ee<N.length;ee++)Y=N[N.length-1-ee],K[K.length-1-ee]!==Y&&(J.hasOwnProperty(Y)?(j.push({command:fe.removeLayer,args:[Y]}),K.splice(K.lastIndexOf(Y,K.length-Z),1)):Z++,Me=K[K.length-ee],j.push({command:fe.addLayer,args:[$[Y],Me]}),K.splice(K.length-ee,0,Y),q[Y]=!0);for(ee=0;ee<N.length;ee++)if(Y=N[ee],oe=J[Y],Ee=$[Y],!q[Y]&&!G(oe,Ee))if(G(oe.source,Ee.source)&&G(oe["source-layer"],Ee["source-layer"])&&G(oe.type,Ee.type)){for(ke in Dn(oe.layout,Ee.layout,j,Y,null,fe.setLayoutProperty),Dn(oe.paint,Ee.paint,j,Y,null,fe.setPaintProperty),G(oe.filter,Ee.filter)||j.push({command:fe.setFilter,args:[Y,Ee.filter]}),G(oe.minzoom,Ee.minzoom)&&G(oe.maxzoom,Ee.maxzoom)||j.push({command:fe.setLayerZoomRange,args:[Y,Ee.minzoom,Ee.maxzoom]}),oe)oe.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Dn(oe[ke],Ee[ke],j,Y,ke.slice(6),fe.setPaintProperty):G(oe[ke],Ee[ke])||j.push({command:fe.setLayerProperty,args:[Y,ke,Ee[ke]]}));for(ke in Ee)Ee.hasOwnProperty(ke)&&!oe.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Dn(oe[ke],Ee[ke],j,Y,ke.slice(6),fe.setPaintProperty):G(oe[ke],Ee[ke])||j.push({command:fe.setLayerProperty,args:[Y,ke,Ee[ke]]}))}else j.push({command:fe.removeLayer,args:[Y]}),Me=K[K.lastIndexOf(Y)+1],j.push({command:fe.addLayer,args:[Ee,Me]})}(k,g.layers,w)}catch(b){console.warn("Unable to compute style diff:",b),w=[{command:fe.setStyle,args:[g]}]}return w}(this.serialize(),t).filter(m=>!(m.command in um));if(a.length===0)return!1;const d=a.filter(m=>!(m.command in ou));if(d.length>0)throw new Error(`Unimplemented: ${d.map(m=>m.command).join(", ")}.`);return a.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,a){return this.getImage(t)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,a),this._afterImageUpdated(t),this)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,a,d={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.validateSource,`sources.${t}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const m=be(t,a,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:m.serialize(),sourceId:t}));const g=w=>{const b=(w?"symbol:":"other:")+t,S=this._sourceCaches[b]=new s.SourceCache(b,m,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[t]=S,S.style=this,S.onAdd(this.map)};g(!1),a.type!=="vector"&&a.type!=="geojson"||g(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const a=this.getSource(t);if(!a)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new s.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new s.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const d=this._getSourceCaches(t);for(const m of d)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getSource(t).setData(a),this._changed=!0}getSource(t){const a=this._getSourceCache(t);return a&&a.getSource()}addLayer(t,a,d={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let g;if(t.type==="custom"){if(Al(this,s.validateCustomStyleLayer(t)))return;g=s.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=s.clone$1(t),t=s.extend(t,{source:m})),this._validate(s.validateLayer,`layers.${m}`,t,{arrayIndex:-1},d))return;g=s.createStyleLayer(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[g.id]=g.serialize(),this._updateLayerCount(g,!0)}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=g;const b=this._getLayerSourceCache(g);if(this._removedLayers[m]&&g.source&&b&&g.type!=="custom"){const S=this._removedLayers[m];delete this._removedLayers[m],S.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",b.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const d=this._order.indexOf(t);this._order.splice(d,1);const m=a?this._order.indexOf(a):this._order.length;a&&m===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const d=this._order.indexOf(t);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,d){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===a&&m.maxzoom===d||(a!=null&&(m.minzoom=a),d!=null&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,a,d={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!G(m.filter,a))return a==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(s.validateFilter,`layers.${m.id}.filter`,a,{layerType:m.type},d)||(m.filter=s.clone$1(a),this._updateLayer(m)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const a=this.getLayer(t);return a&&s.clone$1(a.filter)}setLayoutProperty(t,a,d,m={}){this._checkLoaded();const g=this.getLayer(t);g?G(g.getLayoutProperty(a),d)||(g.setLayoutProperty(a,d,m),this._updateLayer(g)):this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,a){const d=this.getLayer(t);if(d)return d.getLayoutProperty(a);this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,a,d,m={}){this._checkLoaded();const g=this.getLayer(t);g?G(g.getPaintProperty(a),d)||(g.setPaintProperty(a,d,m)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,a){const d=this.getLayer(t);return d&&d.getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const d=t.source,m=t.sourceLayer,g=this.getSource(d);if(!g)return void this.fire(new s.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const w=g.type;if(w==="geojson"&&m)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!m)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const b=this._getSourceCaches(d);for(const S of b)S.setFeatureState(m,t.id,a)}removeFeatureState(t,a){this._checkLoaded();const d=t.source,m=this.getSource(d);if(!m)return void this.fire(new s.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const g=m.type,w=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!w)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const b=this._getSourceCaches(d);for(const S of b)S.removeFeatureState(w,t.id,a)}getFeatureState(t){this._checkLoaded();const a=t.source,d=t.sourceLayer,m=this.getSource(a);if(m){if(m.type!=="vector"||d)return t.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(d,t.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();t[d.id]||(t[d.id]=d.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const a=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",a.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=w=>this._layers[w].type==="fill-extrusion",d={},m=[];for(let w=this._order.length-1;w>=0;w--){const b=this._order[w];if(a(b)){d[b]=w;for(const S of t){const k=S[b];if(k)for(const z of k)m.push(z)}}}m.sort((w,b)=>b.intersectionZ-w.intersectionZ);const g=[];for(let w=this._order.length-1;w>=0;w--){const b=this._order[w];if(a(b))for(let S=m.length-1;S>=0;S--){const k=m[S].feature;if(d[k.layer.id]<w)break;g.push(k),m.pop()}else for(const S of t){const k=S[b];if(k)for(const z of k)g.push(z.feature)}}return g}queryRenderedFeatures(t,a,d){a&&a.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const m={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const S of a.layers){const k=this._layers[S];if(!k)return this.fire(new s.ErrorEvent(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];m[k.source]=!0}}const g=[];a.availableImages=this._availableImages;const w=a&&a.layers?a.layers.some(S=>{const k=this.getLayer(S);return k&&k.is3D()}):this.has3DLayers(),b=Wi.createFromScreenPoints(t,d);for(const S in this._sourceCaches){const k=this._sourceCaches[S].getSource().id;a.layers&&!m[k]||g.push(et(this._sourceCaches[S],this._layers,this._serializedLayers,b,a,d,w,!!this.map._showQueryGeometry))}return this.placement&&g.push(function(S,k,z,L,O,j,U){const N={},J=j.queryRenderedSymbols(L),$=[];for(const K of Object.keys(J).map(Number))$.push(U[K]);$.sort(pt);for(const K of $){const q=K.featureIndex.lookupSymbolFeatures(J[K.bucketInstanceId],k,K.bucketIndex,K.sourceLayerIndex,O.filter,O.layers,O.availableImages,S);for(const ee in q){const Z=N[ee]=N[ee]||[],Y=q[ee];Y.sort((oe,Ee)=>{const Me=K.featureSortOrder;if(Me){const ke=Me.indexOf(oe.featureIndex);return Me.indexOf(Ee.featureIndex)-ke}return Ee.featureIndex-oe.featureIndex});for(const oe of Y)Z.push(oe)}}for(const K in N)N[K].forEach(q=>{const ee=q.feature,Z=z(S[K]).getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=Z});return N}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),b.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,a){a&&a.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const d=this._getSourceCaches(t);let m=[];for(const g of d)m=m.concat(Oe(g,a));return m}addSourceType(t,a,d){return ur.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(ur.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const w in t)if(!G(t[w],d[w])){m=!0;break}if(!m)return;const g=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(t,a),this.light.updateTransitions(g)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,a=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(a===1){if(typeof t.source=="object"){const d="terrain-dem-src";this.addSource(d,t.source),t=s.clone$1(t),t=s.extend(t,{source:d})}if(this._validate(s.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode)this._createTerrain(t,a);else{const d=this.terrain,m=d.get();for(const g of Object.keys(s.spec.terrain))!t.hasOwnProperty(g)&&s.spec.terrain[g].default&&(t[g]=s.spec.terrain[g].default);for(const g in t)if(!G(t[g],m[g])){d.set(t),this.stylesheet.terrain=t;const w=this._setTransitionParameters({duration:0});d.updateTransitions(w);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Pt(t,this.map.transform);this.stylesheet.fog=t;const d=this._setTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,d=a.get();for(const m in t)if(!G(t[m],d[m])){a.set(t,d),this.stylesheet.fog=t;const g=this._setTransitionParameters({duration:0});a.updateTransitions(g);break}}else this._createFog(t);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:s.exported.now(),transition:s.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(d=>this.isLayerDraped(this._layers[d])),a=this._order.filter(d=>!this.isLayerDraped(this._layers[d]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const d=this.terrain=new xr(t,a);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const m=this._setTransitionParameters({duration:0});d.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,d,m,g={}){return(!g||g.validate!==!1)&&Al(this,t.call(s.validateStyle,s.extend({key:a,style:this.serialize(),value:d,styleSpec:s.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const a=this._getSourceCaches(t);for(const d of a)d.clearTiles()}_reloadSource(t){const a=this._getSourceCaches(t);for(const d of a)d.resume(),d.reload()}_updateSources(t){for(const a in this._sourceCaches)this._sourceCaches[a].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,d,m,g=!1){let w=!1,b=!1;const S={};for(const k of this._order){const z=this._layers[k];if(z.type!=="symbol")continue;if(!S[z.source]){const O=this._getLayerSourceCache(z);if(!O)continue;S[z.source]=O.getRenderableIds(!0).map(j=>O.getTileByID(j)).sort((j,U)=>U.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(U.tileID)?-1:1))}const L=this.crossTileSymbolIndex.addLayer(z,S[z.source],t.center.lng,t.projection);w=w||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),g=g||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(g||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),t.zoom))&&(this.pauseablePlacement=new ao(t,this._order,g,a,d,m,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),b=!0),w&&this.pauseablePlacement.placement.setStale()),b||w)for(const k of this._order){const z=this._layers[k];z.type==="symbol"&&this.placement.updateLayerOpacities(z,S[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,d){this.imageManager.getImages(a.icons,d),this._updateTilesForChangedImages();const m=g=>{g&&g.setDependencies(a.tileID.key,a.type,a.icons)};m(this._otherSourceCaches[a.source]),m(this._symbolSourceCaches[a.source])}getGlyphs(t,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(t,a,d){return s.makeRequest(a,d)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this._getSourceCaches(t);return a.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):a.every(d=>d.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ur.getSourceType=function(u){return le[u]},ur.setSourceType=function(u,t){le[u]=t},ur.registerForPluginStateChange=s.registerForPluginStateChange;var dd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Il="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let wa={},xs={};wa=Ut("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),xs=Ut(`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const su=Ut(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),au=dd,Lo=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var lu={background:Ut(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ut(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ut(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ut("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ut(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ut(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ut("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ut("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ut("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ut(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ut(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ut(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ut(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ut(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ut(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ut(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ut(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ut(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec4 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv.xy);float start=v_uv[2];float end=v_uv[3];float trim_start=u_trim_offset[0];float trim_end=u_trim_offset[1];float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start && (line_progress <=trim_end && line_progress >=trim_start)) {out_color=vec4(0,0,0,0);}
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec4 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_clip_start=a_packed[2];float a_clip_end=a_packed[3];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ut(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ut(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ut(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ut(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ut(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ut(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Ut(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ut(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Il),skyboxGradient:Ut(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Il),skyboxCapture:Ut(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ut(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ut(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ut(u,t,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,g=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w=u.match(m),b=t.match(m),S=dd.match(m);let k=b?b.concat(w):w;a||(wa.staticUniforms&&(k=wa.staticUniforms.concat(k)),xs.staticUniforms&&(k=xs.staticUniforms.concat(k))),k&&(k=k.concat(S));const z={};return{fragmentSource:u=u.replace(d,(L,O,j,U,N)=>(z[N]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${j} ${U} ${N};
#else
uniform ${j} ${U} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${j} ${U} ${N} = u_${N};
#endif
`)),vertexSource:t=t.replace(d,(L,O,j,U,N)=>{const J=U==="float"?"vec2":"vec4",$=N.match(/color/)?"color":J;return z[N]?O==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${j} ${J} a_${N};
varying ${j} ${U} ${N};
#else
uniform ${j} ${U} u_${N};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${j} ${U} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${$}(a_${N}, u_${N}_t);
#else
    ${j} ${U} ${N} = u_${N};
#endif
`:O==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${j} ${J} a_${N};
#else
uniform ${j} ${U} u_${N};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${j} ${U} ${N} = a_${N};
#else
    ${j} ${U} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${j} ${U} ${N} = unpack_mix_${$}(a_${N}, u_${N}_t);
#else
    ${j} ${U} ${N} = u_${N};
#endif
`}),staticAttributes:g,staticUniforms:k}}class kl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,d,m,g,w,b,S,k){this.context=t;let z=this.boundPaintVertexBuffers.length!==m.length;for(let L=0;!z&&L<m.length;L++)this.boundPaintVertexBuffers[L]!==m[L]&&(z=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===a&&this.boundLayoutVertexBuffer===d&&!z&&this.boundIndexBuffer===g&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===b&&this.boundDynamicVertexBuffer2===S&&this.boundDynamicVertexBuffer3===k?(t.bindVertexArrayOES.set(this.vao),b&&b.bind(),g&&g.dynamicDraw&&g.bind(),S&&S.bind(),k&&k.bind()):this.freshBind(a,d,m,g,w,b,S,k)}freshBind(t,a,d,m,g,w,b,S){let k;const z=t.numAttributes,L=this.context,O=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=S;else{k=L.currentNumAttributes||0;for(let j=z;j<k;j++)O.disableVertexAttribArray(j)}a.enableAttributes(O,t);for(const j of d)j.enableAttributes(O,t);w&&w.enableAttributes(O,t),b&&b.enableAttributes(O,t),S&&S.enableAttributes(O,t),a.bind(),a.setVertexAttribPointers(O,t,g);for(const j of d)j.bind(),j.setVertexAttribPointers(O,t,g);w&&(w.bind(),w.setVertexAttribPointers(O,t,g)),m&&m.bind(),b&&(b.bind(),b.setVertexAttribPointers(O,t,g)),S&&(S.bind(),S.setVertexAttribPointers(O,t,g)),L.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ml(u,t){const a=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new s.MercatorCoordinate(0,d/a).toLngLat().lat,new s.MercatorCoordinate(0,(d+1)/a).toLngLat().lat]}function cu(u,t,a,d,m,g,w){const b=u.context,S=b.gl,k=a.fbo;if(!k)return;u.prepareDrawTile();const z=u.useProgram("hillshade");b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get());const L=((N,J,$,K)=>{const q=$.paint.get("hillshade-shadow-color"),ee=$.paint.get("hillshade-highlight-color"),Z=$.paint.get("hillshade-accent-color");let Y=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(Y-=N.transform.angle);const oe=!N.options.moving;return{u_matrix:K||N.transform.calculateProjMatrix(J.tileID.toUnwrapped(),oe),u_image:0,u_latrange:Ml(0,J.tileID),u_light:[$.paint.get("hillshade-exaggeration"),Y],u_shadow:q,u_highlight:ee,u_accent:Z}})(u,a,d,u.terrain?t.projMatrix:null);u.prepareDrawProgram(b,z,t.toUnwrapped());const{tileBoundsBuffer:O,tileBoundsIndexBuffer:j,tileBoundsSegments:U}=u.getTileBoundsBuffers(a);z.draw(b,S.TRIANGLES,m,g,w,s.CullFaceMode.disabled,L,d.id,O,j,U)}function uu(u,t,a){if(!t.needsDEMTextureUpload)return;const d=u.context,m=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(a.stride);const g=a.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new s.Texture(d,g,m.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function hu(u,t,a,d,m,g){const w=u.context,b=w.gl;if(!t.dem)return;const S=t.dem;if(w.activeTexture.set(b.TEXTURE1),uu(u,t,S),!t.demTexture)return;t.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const k=S.dim;w.activeTexture.set(b.TEXTURE0);let z=t.fbo;if(!z){const U=new s.Texture(w,{width:k,height:k,data:null},b.RGBA);U.bind(b.LINEAR,b.CLAMP_TO_EDGE),z=t.fbo=w.createFramebuffer(k,k,!0),z.colorAttachment.set(U.texture)}w.bindFramebuffer.set(z.framebuffer),w.viewport.set([0,0,k,k]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:O,tileBoundsSegments:j}=u.getMercatorTileBoundsBuffers();u.useProgram("hillshadePrepare").draw(w,b.TRIANGLES,d,m,g,s.CullFaceMode.disabled,((U,N)=>{const J=N.stride,$=s.create();return s.ortho($,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate($,$,[0,-s.EXTENT,0]),{u_matrix:$,u_image:1,u_dimension:[J,J],u_zoom:U.overscaledZ,u_unpack:N.unpackVector}})(t.tileID,S),a.id,L,O,j),t.needsHillshadePrepare=!1}const du=(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_image0:new s.Uniform1i(u,t.u_image0),u_skirt_height:new s.Uniform1f(u,t.u_skirt_height)}),zl=(u,t)=>({u_matrix:u,u_image0:0,u_skirt_height:t}),ba=(u,t,a,d,m,g,w,b,S,k,z,L,O,j)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:m,u_merc_center:g,u_image0:0,u_frustum_tl:w,u_frustum_tr:b,u_frustum_br:S,u_frustum_bl:k,u_globe_pos:z,u_globe_radius:L,u_viewport:O,u_grid_matrix:j?Float32Array.from(j):new Float32Array(9)});function Pl(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const co=new class{constructor(){this.operations={}}newMorphing(u,t,a,d,m){if(u in this.operations){const g=this.operations[u];g.to.tileID.key!==a.tileID.key&&(g.queued=a)}else this.operations[u]={startTime:d,phase:0,duration:m,from:t,to:a,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const a=this.operations[t];for(a.phase=(u-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Ot={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Dl(u,t){const a=1<<u.z;return!t&&(u.x===0||u.x===a-1)||u.y===0||u.y===a-1}const Ll=u=>({u_matrix:u});function pu(u,t,a,d,m){if(m>0){const g=s.exported.now(),w=(g-u.timeAdded)/m,b=t?(g-t.timeAdded)/m:-1,S=a.getSource(),k=d.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),z=!t||Math.abs(t.tileID.overscaledZ-k)>Math.abs(u.tileID.overscaledZ-k),L=z&&u.refreshedUponExpiration?1:s.clamp(z?w:1-b,0,1);return u.refreshedUponExpiration&&w>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}class pd extends s.SourceCache{constructor(t){const a={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new zi(Gt(),null),m=be("mock-dem",a,d,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class fu extends s.SourceCache{constructor(t){const a=be("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new zi(Gt(),null),t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,d){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,w)=>{if(g[w.key]="",!this._tiles[w.key]){const b=new s.Tile(w,this._source.tileSize*w.overscaleFactor(),t.tileZoom);b.state="loaded",this._tiles[w.key]=b}return g},{});for(const g in this._tiles)g in m||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class mu extends s.OverscaledTileID{constructor(t,a,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class dm extends s.Elevation{constructor(t,a){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,m,g]=function(S){const k=new s.StructArrayLayout4i8,z=new s.StructArrayLayout3ui6,L=131;k.reserve(17161),z.reserve(33800);const O=s.EXTENT/128,j=s.EXTENT+O/2,U=j+O;for(let J=-O;J<U;J+=O)for(let $=-O;$<U;$+=O){const K=$<0||$>j||J<0||J>j?24575:0,q=s.clamp(Math.round($),0,s.EXTENT),ee=s.clamp(Math.round(J),0,s.EXTENT);k.emplaceBack(q+K,ee,q,ee)}const N=(J,$)=>{const K=$*L+J;z.emplaceBack(K+1,K,K+L),z.emplaceBack(K+L,K+L+1,K+1)};for(let J=1;J<129;J++)for(let $=1;$<129;$++)N($,J);return[0,129].forEach(J=>{for(let $=0;$<130;$++)N($,J),N(J,$)}),[k,z,32768]}(),w=t.context;this.gridBuffer=w.createVertexBuffer(d,s.boundsAttributes.members),this.gridIndexBuffer=w.createIndexBuffer(m),this.gridSegments=s.SegmentVector.simpleSegment(0,0,d.length,m.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,d.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new fu(a.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,0,s.EXTENT,0,s.EXTENT,0,1);const b=w.gl;this._overlapStencilMode=new s.StencilMode({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new pd(a.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,a,d){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const m=t.terrain.properties;this.sourceCache=t.terrain.drapeRenderMode===0?this._mockSourceCache:t._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const g=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(a,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),a.updateElevation(!d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=a.getIds().map(S=>{const k=a.getTileByID(S).tileID;return k.projMatrix=d.calculateProjMatrix(k.toUnwrapped()),k});(function(S,k){const z=k.transform.pointCoordinate(k.transform.getCameraPoint()),L=new s.pointGeometry(z.x,z.y);S.sort((O,j)=>{if(j.overscaledZ-O.overscaledZ)return j.overscaledZ-O.overscaledZ;const U=new s.pointGeometry(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),N=new s.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),J=L.mult(1<<O.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(U)-J.distSqr(N)})})(m,this.painter),this._previousZoom=d.zoom;const g=this.proxyToSource||{};this.proxyToSource={},m.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const w=this._style._sourceCaches;for(const S in w){const k=w[S];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,t[S],g),k.usedForTerrain))continue;const z=t[S];k.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[a.id]=m.map(S=>new mu(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const b={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const k=this.terrainTileForTile[S.key];if(!k)continue;const z=k.tileID.key;z in b||(this._visibleDemTiles.push(k),b[z]=z)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const d in this.terrainTileForTile){const m=this.terrainTileForTile[d],g=m.dem;!g||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),uu(this.painter,m,g))}}_prepareDemTileUniforms(t,a,d,m){if(!a||a.demTexture==null)return!1;const g=t.tileID.canonical,w=Math.pow(2,a.tileID.canonical.z-g.z),b=m||"";return d[`u_dem_tl${b}`]=[g.x*w%1,g.y*w%1],d[`u_dem_scale${b}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,a=t.gl;if(!this._emptyDepthBufferTexture){const d=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(t,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const a=this._visibleDemTiles.reduce((d,m)=>{if(!m.dem)return d;const g=m.dem.tree.minimums[0];return g>0&&t++,d+g},0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),m=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(d,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(m,{premultiply:!1}):g=this._emptyDEMTexture=new s.Texture(t,m,a.RGBA,{premultiply:!1}),g}setupElevationDraw(t,a,d){const m=this.painter.context,g=m.gl,w=(b=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(b),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var b;w.u_dem_size=this.sourceCache.getSource().tileSize,w.u_exaggeration=this.exaggeration();const S=this.painter.transform,k=S.projection,z=t.tileID.canonical;w.u_tile_tl_up=k.upVector(z,0,0),w.u_tile_tr_up=k.upVector(z,s.EXTENT,0),w.u_tile_br_up=k.upVector(z,s.EXTENT,s.EXTENT),w.u_tile_bl_up=k.upVector(z,0,s.EXTENT),w.u_tile_up_scale=d&&d.useDenormalizedUpVectorScale?s.GLOBE_METERS_TO_ECEF:k.upVectorScale(z,S.center.lat,S.worldSize).metersToTile;let L=null,O=null,j=1;if(d&&d.morphing&&this._useVertexMorphing){const U=d.morphing.srcDemTile,N=d.morphing.dstDemTile;j=d.morphing.phase,U&&N&&(this._prepareDemTileUniforms(t,U,w,"_prev")&&(O=U),this._prepareDemTileUniforms(t,N,w)&&(L=N))}if(O&&L?(m.activeTexture.set(g.TEXTURE2),L.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),m.activeTexture.set(g.TEXTURE4),O.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),w.u_dem_lerp=j):(L=this.terrainTileForTile[t.tileID.key],m.activeTexture.set(g.TEXTURE2),(this._prepareDemTileUniforms(t,L,w)?L.demTexture:this.emptyDEMTexture).bind(g.NEAREST,g.CLAMP_TO_EDGE)),m.activeTexture.set(g.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&L){const U=(1<<L.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=U}d&&d.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(m,w)}renderToBackBuffer(t){const a=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,g,w,b,S){if(m.transform.projection.name==="globe")(function(k,z,L,O,j){const U=k.context,N=U.gl;let J,$;const K=k.options.showTerrainWireframe?2:0,q=k.transform,ee=s.globeUseCustomAntiAliasing(k,U,q),Z=(ye,Be)=>{if($===ye)return;const Pe=[Ot[ye],"PROJECTION_GLOBE_VIEW"];ee&&Pe.push("CUSTOM_ANTIALIASING"),Be&&Pe.push(Ot[K]),J=k.useProgram("globeRaster",null,Pe),$=ye},Y=k.colorModeForRenderPass(),oe=new s.DepthMode(N.LEQUAL,s.DepthMode.ReadWrite,k.depthRangeFor3D);co.update(j);const Ee=s.calculateGlobeMercatorMatrix(q),Me=[s.mercatorXfromLng(q.center.lng),s.mercatorYfromLat(q.center.lat)],ke=k.globeSharedBuffers,$e=[q.width*s.exported.devicePixelRatio,q.height*s.exported.devicePixelRatio];if((K?[!1,!0]:[!1]).forEach(ye=>{$=-1;const Be=ye?N.LINES:N.TRIANGLES;for(const Pe of O){const xe=L.getTile(Pe),ge=s.StencilMode.disabled,tt=z.prevTerrainTileForTile[Pe.key],st=z.terrainTileForTile[Pe.key];Pl(tt,st)&&co.newMorphing(Pe.key,tt,st,j,250),U.activeTexture.set(N.TEXTURE0),xe.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const qe=co.getMorphValuesForProxy(Pe.key),rt=qe?1:0,ot={useDenormalizedUpVectorScale:!0};qe&&s.extend$1(ot,{morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:s.easeCubicInOut(qe.phase)}});const bt=Float32Array.from(q.globeMatrix),mt=s.globeTileLatLngCorners(Pe.canonical),Ye=s.getLatitudinalLod((mt[0][0]+mt[1][0])/2),Ke=s.getGridMatrix(Pe.canonical,mt,Ye),zt=s.globeNormalizeECEF(s.globeTileBounds(Pe.canonical)),Zt=ba(q.projMatrix,bt,Ee,zt,s.globeToMercatorTransition(q.zoom),Me,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,$e,Ke);if(Z(rt,ye),z.setupElevationDraw(xe,J,ot),k.prepareDrawProgram(U,J,Pe.toUnwrapped()),ke){const[ri,Jt,dn]=ye?ke.getWirefameBuffers(k.context,Ye):ke.getGridBuffers(Ye);J.draw(U,Be,oe,ge,Y,s.CullFaceMode.backCCW,Zt,"globe_raster",ri,Jt,dn)}}}),ke){const ye=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ee&&ye.push("CUSTOM_ANTIALIASING"),J=k.useProgram("globeRaster",null,ye);for(const Be of O){const{x:Pe,y:xe,z:ge}=Be.canonical,tt=xe===0,st=xe===(1<<ge)-1,[qe,rt,ot,bt]=ke.getPoleBuffers(ge);if(bt&&(tt||st)){const mt=L.getTile(Be);U.activeTexture.set(N.TEXTURE0),mt.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let Ye=s.globePoleMatrixForTile(ge,Pe,q);const Ke=s.globeNormalizeECEF(s.globeTileBounds(Be.canonical)),zt=(Zt,ri)=>Zt.draw(U,N.TRIANGLES,oe,s.StencilMode.disabled,Y,s.CullFaceMode.disabled,ba(q.projMatrix,Ye,Ye,Ke,0,Me,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,$e),"globe_pole_raster",ri,ot,bt);z.setupElevationDraw(mt,J,{}),k.prepareDrawProgram(U,J,Be.toUnwrapped()),tt&&zt(J,qe),st&&(Ye=s.scale(s.create(),Ye,[1,-1,1]),zt(J,rt))}}}})(m,g,w,b,S);else{const k=m.context,z=k.gl;let L,O;const j=m.options.showTerrainWireframe?2:0,U=(q,ee)=>{if(O===q)return;const Z=[Ot[q]];ee&&Z.push(Ot[j]),L=m.useProgram("terrainRaster",null,Z),O=q},N=m.colorModeForRenderPass(),J=new s.DepthMode(z.LEQUAL,s.DepthMode.ReadWrite,m.depthRangeFor3D);co.update(S);const $=m.transform,K=6*Math.pow(1.5,22-$.zoom)*g.exaggeration();(j?[!1,!0]:[!1]).forEach(q=>{O=-1;const ee=q?z.LINES:z.TRIANGLES,[Z,Y]=q?g.getWirefameBuffer():[g.gridIndexBuffer,g.gridSegments];for(const oe of b){const Ee=w.getTile(oe),Me=s.StencilMode.disabled,ke=g.prevTerrainTileForTile[oe.key],$e=g.terrainTileForTile[oe.key];Pl(ke,$e)&&co.newMorphing(oe.key,ke,$e,S,250),k.activeTexture.set(z.TEXTURE0),Ee.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const ye=co.getMorphValuesForProxy(oe.key),Be=ye?1:0;let Pe;ye&&(Pe={morphing:{srcDemTile:ye.from,dstDemTile:ye.to,phase:s.easeCubicInOut(ye.phase)}});const xe=zl(oe.projMatrix,Dl(oe.canonical,$.renderWorldCopies)?K/10:K);U(Be,q),g.setupElevationDraw(Ee,L,Pe),m.prepareDrawProgram(k,L,oe.toUnwrapped()),L.draw(k,ee,J,Me,N,s.CullFaceMode.backCCW,xe,"terrain_raster",g.gridBuffer,Z,Y)}})}}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,m=this.proxySourceCache,g=this.proxiedCoords[m.id],w=this._drapedRenderBatches.shift(),b=[],S=a.style.order;let k=0;for(const z of g){const L=m.getTileByID(z.proxyTileKey),O=m.proxyCachedFBO[z.key]?m.proxyCachedFBO[z.key][t]:void 0,j=O!==void 0?m.renderCache[O]:this.pool[k++],U=O!==void 0;if(L.texture=j.tex,U&&!j.dirty){b.push(L.tileID);continue}let N;d.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(d.clear({color:s.Color.transparent,stencil:0}),j.dirty=!1);for(let J=w.start;J<=w.end;++J){const $=a.style._layers[S[J]];if($.isHidden(a.transform.zoom))continue;const K=a.style._getLayerSourceCache($),q=K?this.proxyToSource[z.key][K.id]:[z];if(!q)continue;const ee=q;d.viewport.set([0,0,j.fb.width,j.fb.height]),N!==(K?K.id:null)&&(this._setupStencil(j,q,$,K),N=K?K.id:null),a.renderLayer(a,K,$,ee)}this.renderedToTile?(j.dirty=!0,b.push(L.tileID)):U||--k,k===5&&(k=0,this.renderToBackBuffer(b))}return this.renderToBackBuffer(b),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),w.end+1}postRender(){}renderCacheEfficiency(t){const a=t.order.length;if(a===0)return{efficiency:100};let d,m=0,g=0,w=!1;for(let b=0;b<a;++b){const S=t._layers[t.order[b]];this._style.isLayerDraped(S)?(w&&++m,++g):w||(w=!0,d=S.id)}return g===0?{efficiency:100}:{efficiency:100*(1-m/g),firstUndrapedLayer:d}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,a,d){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const w=g.tileID,b=Math.pow(2,w.overscaledZ),{x:S,y:k}=w.canonical,z=S/b,L=(S+1)/b,O=k/b,j=(k+1)/b;return{minx:z,miny:O,maxx:L,maxy:j,t:g.dem.tree.raycastRoot(z,O,L,j,t,a,d),tile:g}});m.sort((g,w)=>(g.t!==null?g.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const g of m){if(g.t==null)return null;const w=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,a,d);if(w!=null)return w}return null}_createFBO(){const t=this.painter.context,a=t.gl,d=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const m=new s.Texture(t,{width:d[0],height:d[1],data:null},a.RGBA);m.bind(a.LINEAR,a.CLAMP_TO_EDGE);const g=t.createFramebuffer(d[0],d[1],!1);return g.colorAttachment.set(m.texture),g.depthAttachment=new D(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const a=this._style._layers[t],d=a.isHidden(this.painter.transform.zoom),m=a.getCrossfadeParameters(),g=!!m&&m.t!==1,w=a.hasTransition();return a.type!=="custom"&&!d&&(g||w)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof Q){t=!0;break}if(t)for(let a=0;a<this._style.order.length;++a){const d=this._style._layers[this._style.order[a]],m=d.isHidden(this.painter.transform.zoom),g=this._style._getLayerSourceCache(d);if(d.type!=="raster"||m||!g)continue;const w=d.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const S=this.proxyToSource[b.key][g.id];if(S)for(const k of S){const z=pu(g.getTile(k),g.findLoadedParent(k,0),g,this.painter.transform,w);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(g.id,k)}}}}_setupDrapedRenderBatches(){const t=this._style.order,a=t.length;if(a===0)return;const d=[];let m,g=0,w=this._style._layers[t[g]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++g<a;)w=this._style._layers[t[g]];for(;g<a;++g){const b=this._style._layers[t[g]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?m===void 0&&(m=g):m!==void 0&&(d.push({start:m,end:g-1}),m=void 0))}m!==void 0&&d.push({start:m,end:g-1}),this._drapedRenderBatches=d}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const w=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let b=0;b<w.length;++b){const S=Object.values(w[b]);a.renderCachePool.push(...S)}}return}this._clearRasterFadeFromRenderCache();const d=this.proxyCoords,m=this._tilesDirty;for(let w=d.length-1;w>=0;w--){const b=d[w];if(a.getTileByID(b.key),a.proxyCachedFBO[b.key]!==void 0){const S=t[b.key],k=this.proxyToSource[b.key];let z=0;for(const L in k){const O=k[L],j=S[L];if(!j||j.length!==O.length||O.some((U,N)=>U!==j[N]||m[L]&&m[L].hasOwnProperty(U.key))){z=-1;break}++z}for(const L in a.proxyCachedFBO[b.key])a.renderCache[a.proxyCachedFBO[b.key][L]].dirty=z<0||z!==Object.values(S).length}}const g=[...this._drapedRenderBatches];g.sort((w,b)=>b.end-b.start-(w.end-w.start));for(const w of g)for(const b of d){if(a.proxyCachedFBO[b.key])continue;let S=a.renderCachePool.pop();S===void 0&&a.renderCache.length<50&&(S=a.renderCache.length,a.renderCache.push(this._createFBO())),S!==void 0&&(a.proxyCachedFBO[b.key]={},a.proxyCachedFBO[b.key][w.start]=S,a.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,d,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,w=g.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let b;if(d.isTileClipped())b=a.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(t,a){const d=this.painter,m=this.painter.context,g=m.gl;d._tileClippingMaskIDs={},m.setColorMode(s.ColorMode.disabled),m.setDepthMode(s.DepthMode.disabled);const w=d.useProgram("clippingMask");for(const b of t){const S=d._tileClippingMaskIDs[b.key]=--a;w.draw(m,g.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:g.ALWAYS,mask:0},S,255,g.KEEP,g.KEEP,g.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Ll(b.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const d=[t.x,t.y,1,1];s.transformMat4$1(d,d,a.pixelMatrixInverse),s.scale$1(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const m=a._camera.position,g=s.mercatorZfromAltitude(1,a.center.lat),w=[m[0],m[1],m[2]/g,0],b=s.subtract([],d.slice(0,3),w);s.normalize(b,b);const S=this.raycast(w,b,this._exaggeration);return S!==null&&S?(s.scaleAndAdd(w,w,b,S),w[3]=w[2],w[2]*=g,w):null}drawDepth(){const t=this.painter,a=t.context,d=this.proxySourceCache,m=Math.ceil(t.width),g=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===g||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const w=a.gl,b=a.createFramebuffer(m,g,!0);a.activeTexture.set(w.TEXTURE0);const S=new s.Texture(a,{width:m,height:g,data:null},w.RGBA);S.bind(w.NEAREST,w.CLAMP_TO_EDGE),b.colorAttachment.set(S.texture);const k=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,m,g);b.depthAttachment.set(k),this._depthFBO=b,this._depthTexture=S}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,m,g]),function(w,b,S,k){if(w.transform.projection.name==="globe")return;const z=w.context,L=z.gl;z.clear({depth:1});const O=w.useProgram("terrainDepth"),j=new s.DepthMode(L.LESS,s.DepthMode.ReadWrite,w.depthRangeFor3D);for(const U of k){const N=S.getTile(U),J=zl(U.projMatrix,0);b.setupElevationDraw(N,O),O.draw(z,L.TRIANGLES,j,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,J,"terrain_depth",b.gridBuffer,b.gridIndexBuffer,b.gridNoSkirtSegments)}}(t,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,a,d){if(t.getSource()instanceof pe)return this._setupProxiedCoordsForImageSource(t,a,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let b=0;b<g.length;b++){const S=g[b],k=this._findTileCoveringTileID(S,t);if(k){const z=this._createProxiedId(S,k,d[S.key]&&d[S.key][t.id]);m.push(z),this.proxyToSource[S.key][t.id]=[z]}}let w=!1;for(let b=0;b<a.length;b++){const S=t.getTile(a[b]);if(!S||!S.hasData())continue;const k=this._findTileCoveringTileID(S.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==S.tileID.canonical.z){const z=this.proxyToSource[k.tileID.key][t.id],L=this._createProxiedId(k.tileID,S,d[k.tileID.key]&&d[k.tileID.key][t.id]);z?z.splice(z.length-1,0,L):this.proxyToSource[k.tileID.key][t.id]=[L],m.push(L),w=!0}}this._sourceTilesOverlap[t.id]=w}_setupProxiedCoordsForImageSource(t,a,d){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords,w=t.getSource(),b=new s.pointGeometry(w.tileID.x,w.tileID.y)._div(1<<w.tileID.z),S=w.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((z,L)=>(z.min.x=Math.min(z.min.x,L.x-b.x),z.min.y=Math.min(z.min.y,L.y-b.y),z.max.x=Math.max(z.max.x,L.x-b.x),z.max.y=Math.max(z.max.y,L.y-b.y),z),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(z,L)=>{const O=z.wrap+z.canonical.x/(1<<z.canonical.z),j=z.canonical.y/(1<<z.canonical.z),U=s.EXTENT/(1<<z.canonical.z),N=L.wrap+L.canonical.x/(1<<L.canonical.z),J=L.canonical.y/(1<<L.canonical.z);return O+U<N+S.min.x||O>N+S.max.x||j+U<J+S.min.y||j>J+S.max.y};for(let z=0;z<g.length;z++){const L=g[z];for(let O=0;O<a.length;O++){const j=t.getTile(a[O]);if(!j||!j.hasData()||k(L,j.tileID))continue;const U=this._createProxiedId(L,j,d[L.key]&&d[L.key][t.id]),N=this.proxyToSource[L.key][t.id];N?N.push(U):this.proxyToSource[L.key][t.id]=[U],m.push(U)}}}_createProxiedId(t,a,d){let m=this.orthoMatrix;if(d){const g=d.find(w=>w.key===a.tileID.key);if(g)return g}if(a.tileID.key!==t.key){const g=t.canonical.z-a.tileID.canonical.z;let w,b,S;m=s.create();const k=a.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(w=s.EXTENT>>g,b=w*((a.tileID.canonical.x<<g)-t.canonical.x+k),S=w*((a.tileID.canonical.y<<g)-t.canonical.y)):(w=s.EXTENT<<-g,b=s.EXTENT*(a.tileID.canonical.x-(t.canonical.x+k<<-g)),S=s.EXTENT*(a.tileID.canonical.y-(t.canonical.y<<-g))),s.ortho(m,0,w,0,w,0,1),s.translate(m,m,[b,S,0])}return new mu(a.tileID,t.key,m)}_findTileCoveringTileID(t,a){let d=a.getTile(t);if(d&&d.hasData())return d;const m=this._findCoveringTileCache[a.id],g=m[t.key];if(d=g?a.getTileByID(g):null,d&&d.hasData()||g===null)return d;let w=d?d.tileID:t,b=w.overscaledZ;const S=a.getSource().minzoom,k=[];if(!g){const L=a.getSource().maxzoom;if(t.canonical.z>=L){const O=t.canonical.z-L;a.getSource().reparseOverscaled?(b=Math.max(t.canonical.z+2,a.transform.tileZoom),w=new s.OverscaledTileID(b,t.wrap,L,t.canonical.x>>O,t.canonical.y>>O)):O!==0&&(b=L,w=new s.OverscaledTileID(b,t.wrap,L,t.canonical.x>>O,t.canonical.y>>O))}w.key!==t.key&&(k.push(w.key),d=a.getTile(w))}const z=L=>{k.forEach(O=>{m[O]=L}),k.length=0};for(b-=1;b>=S&&(!d||!d.hasData());b--){d&&z(d.tileID.key);const L=w.calculateScaledKey(b);if(d=a.getTileByID(L),d&&d.hasData())break;const O=m[L];if(O===null)break;O===void 0?k.push(L):d=a.getTileByID(O)}return z(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(a){let d=0;const m=new s.StructArrayLayout2ui4,g=131;for(let w=1;w<129;w++){for(let b=1;b<129;b++)d=w*g+b,m.emplaceBack(d,d+1),m.emplaceBack(d,d+g),m.emplaceBack(d+1,d+g),w===128&&m.emplaceBack(d+g,d+g+1);m.emplaceBack(d+1,d+1+g)}return m}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function fd(u){const t=[];for(let a=0;a<u.length;a++){if(u[a]===null)continue;const d=u[a].split(" ");t.push(d.pop())}return t}class Bl{static cacheKey(t,a,d){let m=`${t}${d?d.cacheKey:""}`;for(const g of a)m+=`/${g}`;return m}constructor(t,a,d,m,g,w){const b=t.gl;this.program=b.createProgram();const S=fd(d.staticAttributes),k=m?m.getBinderAttributes():[],z=S.concat(k),L=d.staticUniforms?fd(d.staticUniforms):[],O=m?m.getBinderUniforms():[],j=L.concat(O),U=[];for(const Z of j)U.indexOf(Z)<0&&U.push(Z);let N=m?m.defines():[];N=N.concat(w.map(Z=>`#define ${Z}`));const J=N.concat(t.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Lo):Lo,Lo,au,su.fragmentSource,xs.fragmentSource,d.fragmentSource).join(`
`),$=N.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,au,su.vertexSource,xs.vertexSource,wa.vertexSource,d.vertexSource).join(`
`),K=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(K,J),b.compileShader(K),b.attachShader(this.program,K);const q=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(q,$),b.compileShader(q),b.attachShader(this.program,q),this.attributes={};const ee={};this.numAttributes=z.length;for(let Z=0;Z<this.numAttributes;Z++)z[Z]&&(b.bindAttribLocation(this.program,Z,z[Z]),this.attributes[z[Z]]=Z);b.linkProgram(this.program),b.deleteShader(q),b.deleteShader(K);for(let Z=0;Z<U.length;Z++){const Y=U[Z];if(Y&&!ee[Y]){const oe=b.getUniformLocation(this.program,Y);oe&&(ee[Y]=oe)}}this.fixedUniforms=g(t,ee),this.binderUniforms=m?m.getUniforms(t,ee):[],w.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Z,Y)=>({u_dem:new s.Uniform1i(Z,Y.u_dem),u_dem_prev:new s.Uniform1i(Z,Y.u_dem_prev),u_dem_unpack:new s.Uniform4f(Z,Y.u_dem_unpack),u_dem_tl:new s.Uniform2f(Z,Y.u_dem_tl),u_dem_scale:new s.Uniform1f(Z,Y.u_dem_scale),u_dem_tl_prev:new s.Uniform2f(Z,Y.u_dem_tl_prev),u_dem_scale_prev:new s.Uniform1f(Z,Y.u_dem_scale_prev),u_dem_size:new s.Uniform1f(Z,Y.u_dem_size),u_dem_lerp:new s.Uniform1f(Z,Y.u_dem_lerp),u_exaggeration:new s.Uniform1f(Z,Y.u_exaggeration),u_depth:new s.Uniform1i(Z,Y.u_depth),u_depth_size_inv:new s.Uniform2f(Z,Y.u_depth_size_inv),u_meter_to_dem:new s.Uniform1f(Z,Y.u_meter_to_dem),u_label_plane_matrix_inv:new s.UniformMatrix4f(Z,Y.u_label_plane_matrix_inv),u_tile_tl_up:new s.Uniform3f(Z,Y.u_tile_tl_up),u_tile_tr_up:new s.Uniform3f(Z,Y.u_tile_tr_up),u_tile_br_up:new s.Uniform3f(Z,Y.u_tile_br_up),u_tile_bl_up:new s.Uniform3f(Z,Y.u_tile_bl_up),u_tile_up_scale:new s.Uniform1f(Z,Y.u_tile_up_scale)}))(t,ee)),w.indexOf("FOG")!==-1&&(this.fogUniforms=((Z,Y)=>({u_fog_matrix:new s.UniformMatrix4f(Z,Y.u_fog_matrix),u_fog_range:new s.Uniform2f(Z,Y.u_fog_range),u_fog_color:new s.Uniform4f(Z,Y.u_fog_color),u_fog_horizon_blend:new s.Uniform1f(Z,Y.u_fog_horizon_blend),u_fog_temporal_offset:new s.Uniform1f(Z,Y.u_fog_temporal_offset),u_frustum_tl:new s.Uniform3f(Z,Y.u_frustum_tl),u_frustum_tr:new s.Uniform3f(Z,Y.u_frustum_tr),u_frustum_br:new s.Uniform3f(Z,Y.u_frustum_br),u_frustum_bl:new s.Uniform3f(Z,Y.u_frustum_bl),u_globe_pos:new s.Uniform3f(Z,Y.u_globe_pos),u_globe_radius:new s.Uniform1f(Z,Y.u_globe_radius),u_globe_transition:new s.Uniform1f(Z,Y.u_globe_transition),u_is_globe:new s.Uniform1i(Z,Y.u_is_globe),u_viewport:new s.Uniform2f(Z,Y.u_viewport)}))(t,ee))}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in a)d[m].set(a[m])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in a)d[m].location&&d[m].set(a[m])}}draw(t,a,d,m,g,w,b,S,k,z,L,O,j,U,N,J,$){const K=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(d),t.setStencilMode(m),t.setColorMode(g),t.setCullFace(w);for(const ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(b[ee]);U&&U.setUniforms(t,this.binderUniforms,O,{zoom:j});const q={[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[a];for(const ee of L.get()){const Z=ee.vaos||(ee.vaos={});(Z[S]||(Z[S]=new kl)).bind(t,this,k,U?U.getPaintVertexBuffers():[],z,ee.vertexOffset,N,J,$),K.drawElements(a,ee.primitiveLength*q,K.UNSIGNED_SHORT,ee.primitiveOffset*q*2)}}}function Rl(u,t,a){const d=1/qi(a,1,t.transform.tileZoom),m=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,t.transform.tileZoom)/m,w=g*(a.tileID.canonical.x+a.tileID.wrap*m),b=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[d,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[w>>16,b>>16],u_pixel_coord_lower:[65535&w,65535&b]}}const _u=s.create(),Fl=(u,t,a,d,m,g,w,b,S)=>{const k=t.style.light,z=k.properties.get("position"),L=[z.x,z.y,z.z],O=s.create$1();k.properties.get("anchor")==="viewport"&&(s.fromRotation(O,-t.transform.angle),s.transformMat3(L,L,O));const j=k.properties.get("color"),U=t.transform,N={u_matrix:u,u_lightpos:L,u_lightintensity:k.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_u,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return U.projection.name==="globe"&&(N.u_tile_id=[m.canonical.x,m.canonical.y,1<<m.canonical.z],N.u_zoom_transition=w,N.u_inv_rot_matrix=S,N.u_merc_center=b,N.u_up_dir=U.projection.upVector(new s.CanonicalTileID(0,0,0),b[0]*s.EXTENT,b[1]*s.EXTENT),N.u_height_lift=g),N},md=(u,t,a,d,m,g,w,b,S,k,z)=>{const L=Fl(u,t,a,d,m,b,S,k,z),O={u_height_factor:-Math.pow(2,m.overscaledZ)/w.tileSize/8};return s.extend(L,Rl(g,t,w),O)},gu=u=>({u_matrix:u}),_d=(u,t,a,d)=>s.extend(gu(u),Rl(a,t,d)),Ta=(u,t)=>({u_matrix:u,u_world:t}),Ea=(u,t,a,d,m)=>s.extend(_d(u,t,a,d),{u_world:m}),gd=s.create(),Ol=(u,t,a,d,m,g)=>{const w=u.transform,b=w.projection.name==="globe";let S;if(g.paint.get("circle-pitch-alignment")==="map")if(b){const z=s.globePixelsToTileUnits(w.zoom,t.canonical);S=Float32Array.from([z,0,0,z])}else S=w.calculatePixelsToTileUnitsMatrix(a);else S=new Float32Array([w.pixelsToGLUnits[0],0,0,w.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:w.cameraToCenterDistance,u_matrix:u.translatePosMatrix(t.projMatrix,a,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:gd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(b){k.u_inv_rot_matrix=d,k.u_merc_center=m,k.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(w.zoom);const z=m[0]*s.EXTENT,L=m[1]*s.EXTENT;k.u_up_dir=w.projection.upVector(new s.CanonicalTileID(0,0,0),z,L)}return k},yu=u=>{const t=[];return u.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},br=(u,t,a)=>{const d=s.EXTENT/a.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/d,t.pixelsToGLUnits[1]/d]}},Nl=(u,t,a=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:a}),yd=s.create(),xu=(u,t,a,d,m,g,w)=>{const b=u.transform,S=b.projection.name==="globe",k=S?s.globePixelsToTileUnits(b.zoom,t.canonical):qi(a,1,g),z={u_matrix:t.projMatrix,u_extrude_scale:k,u_intensity:w,u_inv_rot_matrix:yd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){z.u_inv_rot_matrix=d,z.u_merc_center=m,z.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],z.u_zoom_transition=s.globeToMercatorTransition(b.zoom);const L=m[0]*s.EXTENT,O=m[1]*s.EXTENT;z.u_up_dir=b.projection.upVector(new s.CanonicalTileID(0,0,0),L,O)}return z},xd=(u,t,a,d,m,g,w,b)=>{const S=u.transform,k=S.calculatePixelsToTileUnitsMatrix(t),z={u_matrix:Ul(u,t,a,m),u_pixels_to_tile_units:k,u_device_pixel_ratio:w,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:b};if(wd(a)){const L=vd(t,u.transform);z.u_texsize=t.lineAtlasTexture.size,z.u_scale=[L,d.fromScale,d.toScale],z.u_mix=d.t}return z},vu=(u,t,a,d,m,g)=>{const w=u.transform,b=vd(t,w);return{u_matrix:Ul(u,t,a,m),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:g,u_image:0,u_scale:[b,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function vd(u,t){return 1/qi(u,1,t.tileZoom)}function Ul(u,t,a,d){return u.translatePosMatrix(d||t.tileID.projMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function wd(u){const t=u.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const jl=(u,t,a,d,m,g)=>{return{u_matrix:u,u_tl_parent:t,u_scale_parent:a,u_fade_t:d.mix,u_opacity:d.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(b=m.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(w=m.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:pm(m.paint.get("raster-hue-rotate")),u_perspective_transform:g};var w,b};function pm(u){u*=Math.PI/180;const t=Math.sin(u),a=Math.cos(u);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Vl=s.create(),bd=(u,t,a,d,m,g,w,b,S,k,z,L,O,j,U)=>{const N=m.transform,J={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:N.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:N.width/N.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:w,u_coord_matrix:b,u_is_text:+S,u_pitch_with_map:+d,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Vl,u_up_vector:[0,-1,0]};return N.projection.name==="globe"&&(J.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],J.u_zoom_transition=L,J.u_inv_rot_matrix=j,J.u_merc_center=O,J.u_camera_forward=N._camera.forward(),J.u_ecef_origin=s.globeECEFOrigin(N.globeMatrix,z.toUnwrapped()),J.u_tile_matrix=Float32Array.from(N.globeMatrix),J.u_up_vector=U),J},Gl=(u,t,a,d,m,g,w,b,S,k,z,L,O,j,U,N)=>{const{cameraToCenterDistance:J,_pitch:$}=m.transform;return s.extend(bd(u,t,a,d,m,g,w,b,S,k,L,O,j,U,N),{u_gamma_scale:d?J*Math.cos(m.terrain?0:$):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+z})},fm=(u,t,a,d,m,g,w,b,S,k,z,L,O,j,U)=>s.extend(Gl(u,t,a,d,m,g,w,b,!0,S,!0,z,L,O,j,U),{u_texsize_icon:k,u_texture_icon:1}),$l=(u,t,a)=>({u_matrix:u,u_opacity:t,u_color:a}),mm=(u,t,a,d,m,g)=>s.extend(function(w,b,S,k){const z=S.imageManager.getPattern(w.from.toString()),L=S.imageManager.getPattern(w.to.toString()),{width:O,height:j}=S.imageManager.getPixelSize(),U=Math.pow(2,k.tileID.overscaledZ),N=k.tileSize*Math.pow(2,S.transform.tileZoom)/U,J=N*(k.tileID.canonical.x+k.tileID.wrap*U),$=N*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[O,j],u_mix:b.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/qi(k,1,S.transform.tileZoom),u_pixel_coord_upper:[J>>16,$>>16],u_pixel_coord_lower:[65535&J,65535&$]}}(d,g,a,m),{u_matrix:u,u_opacity:t}),Td={fillExtrusion:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_lightpos:new s.Uniform3f(u,t.u_lightpos),u_lightintensity:new s.Uniform1f(u,t.u_lightintensity),u_lightcolor:new s.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new s.Uniform1f(u,t.u_vertical_gradient),u_opacity:new s.Uniform1f(u,t.u_opacity),u_tile_id:new s.Uniform3f(u,t.u_tile_id),u_zoom_transition:new s.Uniform1f(u,t.u_zoom_transition),u_inv_rot_matrix:new s.UniformMatrix4f(u,t.u_inv_rot_matrix),u_merc_center:new s.Uniform2f(u,t.u_merc_center),u_up_dir:new s.Uniform3f(u,t.u_up_dir),u_height_lift:new s.Uniform1f(u,t.u_height_lift)}),fillExtrusionPattern:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_lightpos:new s.Uniform3f(u,t.u_lightpos),u_lightintensity:new s.Uniform1f(u,t.u_lightintensity),u_lightcolor:new s.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new s.Uniform1f(u,t.u_vertical_gradient),u_height_factor:new s.Uniform1f(u,t.u_height_factor),u_tile_id:new s.Uniform3f(u,t.u_tile_id),u_zoom_transition:new s.Uniform1f(u,t.u_zoom_transition),u_inv_rot_matrix:new s.UniformMatrix4f(u,t.u_inv_rot_matrix),u_merc_center:new s.Uniform2f(u,t.u_merc_center),u_up_dir:new s.Uniform3f(u,t.u_up_dir),u_height_lift:new s.Uniform1f(u,t.u_height_lift),u_image:new s.Uniform1i(u,t.u_image),u_texsize:new s.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(u,t.u_scale),u_fade:new s.Uniform1f(u,t.u_fade),u_opacity:new s.Uniform1f(u,t.u_opacity)}),fill:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix)}),fillPattern:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_image:new s.Uniform1i(u,t.u_image),u_texsize:new s.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(u,t.u_scale),u_fade:new s.Uniform1f(u,t.u_fade)}),fillOutline:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_world:new s.Uniform2f(u,t.u_world)}),fillOutlinePattern:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_world:new s.Uniform2f(u,t.u_world),u_image:new s.Uniform1i(u,t.u_image),u_texsize:new s.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(u,t.u_scale),u_fade:new s.Uniform1f(u,t.u_fade)}),circle:(u,t)=>({u_camera_to_center_distance:new s.Uniform1f(u,t.u_camera_to_center_distance),u_extrude_scale:new s.UniformMatrix2f(u,t.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(u,t.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_inv_rot_matrix:new s.UniformMatrix4f(u,t.u_inv_rot_matrix),u_merc_center:new s.Uniform2f(u,t.u_merc_center),u_tile_id:new s.Uniform3f(u,t.u_tile_id),u_zoom_transition:new s.Uniform1f(u,t.u_zoom_transition),u_up_dir:new s.Uniform3f(u,t.u_up_dir)}),collisionBox:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_camera_to_center_distance:new s.Uniform1f(u,t.u_camera_to_center_distance),u_extrude_scale:new s.Uniform2f(u,t.u_extrude_scale)}),collisionCircle:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_inv_matrix:new s.UniformMatrix4f(u,t.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(u,t.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(u,t.u_viewport_size)}),debug:(u,t)=>({u_color:new s.UniformColor(u,t.u_color),u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_overlay:new s.Uniform1i(u,t.u_overlay),u_overlay_scale:new s.Uniform1f(u,t.u_overlay_scale)}),clippingMask:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix)}),heatmap:(u,t)=>({u_extrude_scale:new s.Uniform1f(u,t.u_extrude_scale),u_intensity:new s.Uniform1f(u,t.u_intensity),u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_inv_rot_matrix:new s.UniformMatrix4f(u,t.u_inv_rot_matrix),u_merc_center:new s.Uniform2f(u,t.u_merc_center),u_tile_id:new s.Uniform3f(u,t.u_tile_id),u_zoom_transition:new s.Uniform1f(u,t.u_zoom_transition),u_up_dir:new s.Uniform3f(u,t.u_up_dir)}),heatmapTexture:(u,t)=>({u_image:new s.Uniform1i(u,t.u_image),u_color_ramp:new s.Uniform1i(u,t.u_color_ramp),u_opacity:new s.Uniform1f(u,t.u_opacity)}),hillshade:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_image:new s.Uniform1i(u,t.u_image),u_latrange:new s.Uniform2f(u,t.u_latrange),u_light:new s.Uniform2f(u,t.u_light),u_shadow:new s.UniformColor(u,t.u_shadow),u_highlight:new s.UniformColor(u,t.u_highlight),u_accent:new s.UniformColor(u,t.u_accent)}),hillshadePrepare:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_image:new s.Uniform1i(u,t.u_image),u_dimension:new s.Uniform2f(u,t.u_dimension),u_zoom:new s.Uniform1f(u,t.u_zoom),u_unpack:new s.Uniform4f(u,t.u_unpack)}),line:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_pixels_to_tile_units:new s.UniformMatrix2f(u,t.u_pixels_to_tile_units),u_device_pixel_ratio:new s.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(u,t.u_units_to_pixels),u_dash_image:new s.Uniform1i(u,t.u_dash_image),u_gradient_image:new s.Uniform1i(u,t.u_gradient_image),u_image_height:new s.Uniform1f(u,t.u_image_height),u_texsize:new s.Uniform2f(u,t.u_texsize),u_scale:new s.Uniform3f(u,t.u_scale),u_mix:new s.Uniform1f(u,t.u_mix),u_alpha_discard_threshold:new s.Uniform1f(u,t.u_alpha_discard_threshold),u_trim_offset:new s.Uniform2f(u,t.u_trim_offset)}),linePattern:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_texsize:new s.Uniform2f(u,t.u_texsize),u_pixels_to_tile_units:new s.UniformMatrix2f(u,t.u_pixels_to_tile_units),u_device_pixel_ratio:new s.Uniform1f(u,t.u_device_pixel_ratio),u_image:new s.Uniform1i(u,t.u_image),u_units_to_pixels:new s.Uniform2f(u,t.u_units_to_pixels),u_scale:new s.Uniform3f(u,t.u_scale),u_fade:new s.Uniform1f(u,t.u_fade),u_alpha_discard_threshold:new s.Uniform1f(u,t.u_alpha_discard_threshold)}),raster:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_tl_parent:new s.Uniform2f(u,t.u_tl_parent),u_scale_parent:new s.Uniform1f(u,t.u_scale_parent),u_fade_t:new s.Uniform1f(u,t.u_fade_t),u_opacity:new s.Uniform1f(u,t.u_opacity),u_image0:new s.Uniform1i(u,t.u_image0),u_image1:new s.Uniform1i(u,t.u_image1),u_brightness_low:new s.Uniform1f(u,t.u_brightness_low),u_brightness_high:new s.Uniform1f(u,t.u_brightness_high),u_saturation_factor:new s.Uniform1f(u,t.u_saturation_factor),u_contrast_factor:new s.Uniform1f(u,t.u_contrast_factor),u_spin_weights:new s.Uniform3f(u,t.u_spin_weights),u_perspective_transform:new s.Uniform2f(u,t.u_perspective_transform)}),symbolIcon:(u,t)=>({u_is_size_zoom_constant:new s.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(u,t.u_size_t),u_size:new s.Uniform1f(u,t.u_size),u_camera_to_center_distance:new s.Uniform1f(u,t.u_camera_to_center_distance),u_rotate_symbol:new s.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(u,t.u_fade_change),u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new s.Uniform1i(u,t.u_is_text),u_pitch_with_map:new s.Uniform1i(u,t.u_pitch_with_map),u_texsize:new s.Uniform2f(u,t.u_texsize),u_tile_id:new s.Uniform3f(u,t.u_tile_id),u_zoom_transition:new s.Uniform1f(u,t.u_zoom_transition),u_inv_rot_matrix:new s.UniformMatrix4f(u,t.u_inv_rot_matrix),u_merc_center:new s.Uniform2f(u,t.u_merc_center),u_camera_forward:new s.Uniform3f(u,t.u_camera_forward),u_tile_matrix:new s.UniformMatrix4f(u,t.u_tile_matrix),u_up_vector:new s.Uniform3f(u,t.u_up_vector),u_ecef_origin:new s.Uniform3f(u,t.u_ecef_origin),u_texture:new s.Uniform1i(u,t.u_texture)}),symbolSDF:(u,t)=>({u_is_size_zoom_constant:new s.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(u,t.u_size_t),u_size:new s.Uniform1f(u,t.u_size),u_camera_to_center_distance:new s.Uniform1f(u,t.u_camera_to_center_distance),u_rotate_symbol:new s.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(u,t.u_fade_change),u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new s.Uniform1i(u,t.u_is_text),u_pitch_with_map:new s.Uniform1i(u,t.u_pitch_with_map),u_texsize:new s.Uniform2f(u,t.u_texsize),u_texture:new s.Uniform1i(u,t.u_texture),u_gamma_scale:new s.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(u,t.u_device_pixel_ratio),u_tile_id:new s.Uniform3f(u,t.u_tile_id),u_zoom_transition:new s.Uniform1f(u,t.u_zoom_transition),u_inv_rot_matrix:new s.UniformMatrix4f(u,t.u_inv_rot_matrix),u_merc_center:new s.Uniform2f(u,t.u_merc_center),u_camera_forward:new s.Uniform3f(u,t.u_camera_forward),u_tile_matrix:new s.UniformMatrix4f(u,t.u_tile_matrix),u_up_vector:new s.Uniform3f(u,t.u_up_vector),u_ecef_origin:new s.Uniform3f(u,t.u_ecef_origin),u_is_halo:new s.Uniform1i(u,t.u_is_halo)}),symbolTextAndIcon:(u,t)=>({u_is_size_zoom_constant:new s.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(u,t.u_size_t),u_size:new s.Uniform1f(u,t.u_size),u_camera_to_center_distance:new s.Uniform1f(u,t.u_camera_to_center_distance),u_rotate_symbol:new s.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(u,t.u_fade_change),u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new s.Uniform1i(u,t.u_is_text),u_pitch_with_map:new s.Uniform1i(u,t.u_pitch_with_map),u_texsize:new s.Uniform2f(u,t.u_texsize),u_texsize_icon:new s.Uniform2f(u,t.u_texsize_icon),u_texture:new s.Uniform1i(u,t.u_texture),u_texture_icon:new s.Uniform1i(u,t.u_texture_icon),u_gamma_scale:new s.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(u,t.u_is_halo)}),background:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_opacity:new s.Uniform1f(u,t.u_opacity),u_color:new s.UniformColor(u,t.u_color)}),backgroundPattern:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_opacity:new s.Uniform1f(u,t.u_opacity),u_image:new s.Uniform1i(u,t.u_image),u_pattern_tl_a:new s.Uniform2f(u,t.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(u,t.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(u,t.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(u,t.u_pattern_br_b),u_texsize:new s.Uniform2f(u,t.u_texsize),u_mix:new s.Uniform1f(u,t.u_mix),u_pattern_size_a:new s.Uniform2f(u,t.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(u,t.u_pattern_size_b),u_scale_a:new s.Uniform1f(u,t.u_scale_a),u_scale_b:new s.Uniform1f(u,t.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(u,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(u,t.u_tile_units_to_pixels)}),terrainRaster:du,terrainDepth:du,skybox:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_sun_direction:new s.Uniform3f(u,t.u_sun_direction),u_cubemap:new s.Uniform1i(u,t.u_cubemap),u_opacity:new s.Uniform1f(u,t.u_opacity),u_temporal_offset:new s.Uniform1f(u,t.u_temporal_offset)}),skyboxGradient:(u,t)=>({u_matrix:new s.UniformMatrix4f(u,t.u_matrix),u_color_ramp:new s.Uniform1i(u,t.u_color_ramp),u_center_direction:new s.Uniform3f(u,t.u_center_direction),u_radius:new s.Uniform1f(u,t.u_radius),u_opacity:new s.Uniform1f(u,t.u_opacity),u_temporal_offset:new s.Uniform1f(u,t.u_temporal_offset)}),skyboxCapture:(u,t)=>({u_matrix_3f:new s.UniformMatrix3f(u,t.u_matrix_3f),u_sun_direction:new s.Uniform3f(u,t.u_sun_direction),u_sun_intensity:new s.Uniform1f(u,t.u_sun_intensity),u_color_tint_r:new s.Uniform4f(u,t.u_color_tint_r),u_color_tint_m:new s.Uniform4f(u,t.u_color_tint_m),u_luminance:new s.Uniform1f(u,t.u_luminance)}),globeRaster:(u,t)=>({u_proj_matrix:new s.UniformMatrix4f(u,t.u_proj_matrix),u_globe_matrix:new s.UniformMatrix4f(u,t.u_globe_matrix),u_normalize_matrix:new s.UniformMatrix4f(u,t.u_normalize_matrix),u_merc_matrix:new s.UniformMatrix4f(u,t.u_merc_matrix),u_zoom_transition:new s.Uniform1f(u,t.u_zoom_transition),u_merc_center:new s.Uniform2f(u,t.u_merc_center),u_image0:new s.Uniform1i(u,t.u_image0),u_grid_matrix:new s.UniformMatrix3f(u,t.u_grid_matrix),u_frustum_tl:new s.Uniform3f(u,t.u_frustum_tl),u_frustum_tr:new s.Uniform3f(u,t.u_frustum_tr),u_frustum_br:new s.Uniform3f(u,t.u_frustum_br),u_frustum_bl:new s.Uniform3f(u,t.u_frustum_bl),u_globe_pos:new s.Uniform3f(u,t.u_globe_pos),u_globe_radius:new s.Uniform1f(u,t.u_globe_radius),u_viewport:new s.Uniform2f(u,t.u_viewport)}),globeAtmosphere:(u,t)=>({u_frustum_tl:new s.Uniform3f(u,t.u_frustum_tl),u_frustum_tr:new s.Uniform3f(u,t.u_frustum_tr),u_frustum_br:new s.Uniform3f(u,t.u_frustum_br),u_frustum_bl:new s.Uniform3f(u,t.u_frustum_bl),u_horizon:new s.Uniform1f(u,t.u_horizon),u_transition:new s.Uniform1f(u,t.u_transition),u_fadeout_range:new s.Uniform1f(u,t.u_fadeout_range),u_color:new s.Uniform4f(u,t.u_color),u_high_color:new s.Uniform4f(u,t.u_high_color),u_space_color:new s.Uniform4f(u,t.u_space_color),u_star_intensity:new s.Uniform1f(u,t.u_star_intensity),u_star_density:new s.Uniform1f(u,t.u_star_density),u_star_size:new s.Uniform1f(u,t.u_star_size),u_temporal_offset:new s.Uniform1f(u,t.u_temporal_offset),u_horizon_angle:new s.Uniform1f(u,t.u_horizon_angle),u_rotation_matrix:new s.UniformMatrix4f(u,t.u_rotation_matrix)})};let Sa;function Bo(u,t,a,d,m,g,w){const b=u.context,S=b.gl,k=u.useProgram("collisionBox"),z=[];let L=0,O=0;for(let q=0;q<d.length;q++){const ee=d[q],Z=t.getTile(ee),Y=Z.getBucket(a);if(!Y)continue;let oe=ee.projMatrix;m[0]===0&&m[1]===0||(oe=u.translatePosMatrix(ee.projMatrix,Z,m,g));const Ee=w?Y.textCollisionBox:Y.iconCollisionBox,Me=Y.collisionCircleArray;if(Me.length>0){const ke=s.create(),$e=oe;s.mul(ke,Y.placementInvProjMatrix,u.transform.glCoordMatrix),s.mul(ke,ke,Y.placementViewportMatrix),z.push({circleArray:Me,circleOffset:O,transform:$e,invTransform:ke}),L+=Me.length/4,O=L}Ee&&(u.terrain&&u.terrain.setupElevationDraw(Z,k),k.draw(b,S.LINES,s.DepthMode.disabled,s.StencilMode.disabled,u.colorModeForRenderPass(),s.CullFaceMode.disabled,br(oe,u.transform,Z),a.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,u.transform.zoom,null,Ee.collisionVertexBuffer,Ee.collisionVertexBufferExt))}if(!w||!z.length)return;const j=u.useProgram("collisionCircle"),U=new s.StructArrayLayout2f1f2i16;U.resize(4*L),U._trim();let N=0;for(const q of z)for(let ee=0;ee<q.circleArray.length/4;ee++){const Z=4*ee,Y=q.circleArray[Z+0],oe=q.circleArray[Z+1],Ee=q.circleArray[Z+2],Me=q.circleArray[Z+3];U.emplace(N++,Y,oe,Ee,Me,0),U.emplace(N++,Y,oe,Ee,Me,1),U.emplace(N++,Y,oe,Ee,Me,2),U.emplace(N++,Y,oe,Ee,Me,3)}(!Sa||Sa.length<2*L)&&(Sa=function(q){const ee=2*q,Z=new s.StructArrayLayout3ui6;Z.resize(ee),Z._trim();for(let Y=0;Y<ee;Y++){const oe=6*Y;Z.uint16[oe+0]=4*Y+0,Z.uint16[oe+1]=4*Y+1,Z.uint16[oe+2]=4*Y+2,Z.uint16[oe+3]=4*Y+2,Z.uint16[oe+4]=4*Y+3,Z.uint16[oe+5]=4*Y+0}return Z}(L));const J=b.createIndexBuffer(Sa,!0),$=b.createVertexBuffer(U,s.collisionCircleLayout.members,!0);for(const q of z){const ee={u_matrix:q.transform,u_inv_matrix:q.invTransform,u_camera_to_center_distance:(K=u.transform).cameraToCenterDistance,u_viewport_size:[K.width,K.height]};j.draw(b,S.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,u.colorModeForRenderPass(),s.CullFaceMode.disabled,ee,a.id,$,J,s.SegmentVector.simpleSegment(0,2*q.circleOffset,q.circleArray.length,q.circleArray.length/2),null,u.transform.zoom,null,null,null)}var K;$.destroy(),J.destroy()}const Ed=s.create();function _m(u,t,a,d,m,g){const{horizontalAlign:w,verticalAlign:b}=s.getAnchorAlignment(u),S=-(w-.5)*t,k=-(b-.5)*a,z=s.evaluateVariableOffset(u,d);return new s.pointGeometry((S/m+z[0])*g,(k/m+z[1])*g)}function gm(u,t,a,d,m,g,w,b,S,k,z,L){const O=u.text.placedSymbolArray,j=u.text.dynamicLayoutVertexArray,U=u.icon.dynamicLayoutVertexArray,N={},J=b.projMatrix,$=g.elevation,K=L.upVectorScale(b.canonical,g.center.lat,g.worldSize);j.clear();for(let q=0;q<O.length;q++){const ee=O.get(q),Z=u.allowVerticalPlacement&&!ee.placedOrientation,Y=ee.hidden||!ee.crossTileID||Z?null:d[ee.crossTileID];if(Y){const oe=new s.pointGeometry(ee.tileAnchorX,ee.tileAnchorY),Ee=L.upVector(b.canonical,oe.x,oe.y),Me=$?$.getAtTileOffset(b,oe.x,oe.y):0,ke=Vr([ee.projectedAnchorX+Me*Ee[0]*K.metersToTile,ee.projectedAnchorY+Me*Ee[1]*K.metersToTile,ee.projectedAnchorZ+Me*Ee[2]*K.metersToTile],a?J:w),$e=ds(g.cameraToCenterDistance,ke.signedDistanceFromCamera);let ye=m.evaluateSizeForFeature(u.textSizeData,k,ee)*$e/s.ONE_EM;a&&(ye*=u.tilePixelRatio/S);const{width:Be,height:Pe,anchor:xe,textOffset:ge,textScale:tt}=Y,st=_m(xe,Be,Pe,ge,tt,ye);let qe;if(a){const ot=oe.add(st),{x:bt,y:mt,z:Ye}=L.projectTilePoint(ot.x,ot.y,b.canonical);qe=Vr([bt+Me*Ee[0]*K.metersToTile,mt+Me*Ee[1]*K.metersToTile,Ye+Me*Ee[2]*K.metersToTile],w).point}else{const ot=t?st.rotate(-g.angle):st;qe=[ke.point[0]+ot.x,ke.point[1]+ot.y,0]}const rt=u.allowVerticalPlacement&&ee.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let ot=0;ot<ee.numGlyphs;ot++)s.addDynamicAttributes(j,qe[0],qe[1],qe[2],rt);z&&ee.associatedIconIndex>=0&&(N[ee.associatedIconIndex]={shiftedAnchor:qe,angle:rt})}else Oi(ee.numGlyphs,j)}if(z){U.clear();const q=u.icon.placedSymbolArray;for(let ee=0;ee<q.length;ee++){const Z=q.get(ee);if(Z.hidden)Oi(Z.numGlyphs,U);else{const Y=N[ee];if(Y)for(let oe=0;oe<Z.numGlyphs;oe++)s.addDynamicAttributes(U,Y.shiftedAnchor[0],Y.shiftedAnchor[1],Y.shiftedAnchor[2],Y.angle);else Oi(Z.numGlyphs,U)}}u.icon.dynamicLayoutVertexBuffer.updateData(U)}u.text.dynamicLayoutVertexBuffer.updateData(j)}function ym(u,t,a){return a.iconsInText&&t?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Sd(u,t,a,d,m,g,w,b,S,k,z,L){const O=u.context,j=O.gl,U=u.transform,N=b==="map",J=S==="map",$=N&&a.layout.get("symbol-placement")!=="point",K=N&&!J&&!$,q=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ee=!1;const Z=u.depthModeForSublayer(0,s.DepthMode.ReadOnly),Y=[s.mercatorXfromLng(U.center.lng),s.mercatorYfromLat(U.center.lat)],oe=a.layout.get("text-variable-anchor"),Ee=U.projection.name==="globe",Me=Ee?s.globeToMercatorTransition(U.zoom):0,ke=[],$e=[];u.terrain&&J&&$e.push("PITCH_WITH_MAP_TERRAIN"),Ee&&$e.push("PROJECTION_GLOBE_VIEW");const ye=[0,-1,0];if(Ee&&!N){const Be=U._camera.getWorldToCamera(U.worldSize,1),Pe=s.multiply([],Be,U.globeMatrix);s.invert(Pe,Pe);const xe=s.transformMat4$1([],[0,1,0,0],Pe);ye[0]=xe[0],ye[1]=xe[1],ye[2]=xe[2],s.normalize(ye,ye)}for(const Be of d){const Pe=t.getTile(Be),xe=Pe.getBucket(a);if(!xe||xe.projection!==U.projection.name)continue;const ge=m?xe.text:xe.icon;if(!ge||xe.fullyClipped||!ge.segments.get().length)continue;const tt=ge.programConfigurations.get(a.id),st=m||xe.sdfIcons,qe=m?xe.textSizeData:xe.iconSizeData,rt=J||U.pitch!==0,ot=s.evaluateSizeForZoom(qe,U.zoom);let bt,mt,Ye,Ke,zt=[0,0],Zt=null;if(m){if(mt=Pe.glyphAtlasTexture,Ye=j.LINEAR,bt=Pe.glyphAtlasTexture.size,xe.iconsInText){zt=Pe.imageAtlasTexture.size,Zt=Pe.imageAtlasTexture;const Ci=qe.kind==="composite"||qe.kind==="camera";Ke=rt||u.options.rotating||u.options.zooming||Ci?j.LINEAR:j.NEAREST}}else{const Ci=a.layout.get("icon-size").constantOr(0)!==1||xe.iconsNeedLinear;mt=Pe.imageAtlasTexture,Ye=st||u.options.rotating||u.options.zooming||Ci||rt?j.LINEAR:j.NEAREST,bt=Pe.imageAtlasTexture.size}const ri=u.transform.calculatePixelsToTileUnitsMatrix(Pe),Jt=kt(Be.projMatrix,Pe.tileID.canonical,J,N,u.transform,ri),dn=u.terrain&&J&&$?s.invert(s.create(),Jt):Ed,Xn=Po(Be.projMatrix,Pe.tileID.canonical,J,N,u.transform,ri),xn=oe&&xe.hasTextData(),Er=a.layout.get("icon-text-fit")!=="none"&&xn&&xe.hasIconData();if($){const Ci=U.elevation,uo=Ci?Ci.getAtTileOffsetFunc(Be,U.center.lat,U.worldSize,U.projection):Xr=>[0,0,0],Vo=cr(Be.projMatrix,Pe.tileID.canonical,J,N,u.transform,ri);Zn(xe,Be.projMatrix,u,m,Vo,Xn,J,k,uo,Be)}const si=$||m&&oe||Er,gi=u.translatePosMatrix(Be.projMatrix,Pe,g,w),Vt=si?Ed:Jt,Si=u.translatePosMatrix(Xn,Pe,g,w,!0),on=U.projection.createInversionMatrix(U,Be.canonical),ai=si?$e.concat(["PROJECTED_POS_ON_VIEWPORT"]):$e,Hn=st&&a.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ss;Ss=st?xe.iconsInText?fm(qe.kind,ot,K,J,u,gi,Vt,Si,bt,zt,Be,Me,Y,on,ye):Gl(qe.kind,ot,K,J,u,gi,Vt,Si,m,bt,!0,Be,Me,Y,on,ye):bd(qe.kind,ot,K,J,u,gi,Vt,Si,m,bt,Be,Me,Y,on,ye);const Wr={program:u.useProgram(ym(st,m,xe),tt,ai),buffers:ge,uniformValues:Ss,atlasTexture:mt,atlasTextureIcon:Zt,atlasInterpolation:Ye,atlasInterpolationIcon:Ke,isSDF:st,hasHalo:Hn,tile:Pe,labelPlaneMatrixInv:dn};if(q&&xe.canOverlap){ee=!0;const Ci=ge.segments.get();for(const uo of Ci)ke.push({segments:new s.SegmentVector([uo]),sortKey:uo.sortKey,state:Wr})}else ke.push({segments:ge.segments,sortKey:0,state:Wr})}ee&&ke.sort((Be,Pe)=>Be.sortKey-Pe.sortKey);for(const Be of ke){const Pe=Be.state;if(u.terrain&&u.terrain.setupElevationDraw(Pe.tile,Pe.program,{useDepthForOcclusion:!Ee,labelPlaneMatrixInv:Pe.labelPlaneMatrixInv}),O.activeTexture.set(j.TEXTURE0),Pe.atlasTexture.bind(Pe.atlasInterpolation,j.CLAMP_TO_EDGE),Pe.atlasTextureIcon&&(O.activeTexture.set(j.TEXTURE1),Pe.atlasTextureIcon&&Pe.atlasTextureIcon.bind(Pe.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),Pe.isSDF){const xe=Pe.uniformValues;Pe.hasHalo&&(xe.u_is_halo=1,Cd(Pe.buffers,Be.segments,a,u,Pe.program,Z,z,L,xe)),xe.u_is_halo=0}Cd(Pe.buffers,Be.segments,a,u,Pe.program,Z,z,L,Pe.uniformValues)}}function Cd(u,t,a,d,m,g,w,b,S){const k=d.context;m.draw(k,k.gl.TRIANGLES,g,w,b,s.CullFaceMode.disabled,S,a.id,u.layoutVertexBuffer,u.indexBuffer,t,a.paint,d.transform.zoom,u.programConfigurations.get(a.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.globeExtVertexBuffer)}function Zl(u,t,a,d,m,g,w){const b=u.context.gl,S=a.paint.get("fill-pattern"),k=S&&S.constantOr(1),z=a.getCrossfadeParameters();let L,O,j,U,N;w?(O=k&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=b.LINES):(O=k?"fillPattern":"fill",L=b.TRIANGLES);for(const J of d){const $=t.getTile(J);if(k&&!$.patternsLoaded())continue;const K=$.getBucket(a);if(!K)continue;u.prepareDrawTile();const q=K.programConfigurations.get(a.id),ee=u.useProgram(O,q);k&&(u.context.activeTexture.set(b.TEXTURE0),$.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),q.updatePaintBuffers(z));const Z=S.constantOr(null);if(Z&&$.imageAtlas){const oe=$.imageAtlas,Ee=oe.patternPositions[Z.to.toString()],Me=oe.patternPositions[Z.from.toString()];Ee&&Me&&q.setConstantPatternPositions(Ee,Me)}const Y=u.translatePosMatrix(J.projMatrix,$,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(w){U=K.indexBuffer2,N=K.segments2;const oe=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[b.drawingBufferWidth,b.drawingBufferHeight];j=O==="fillOutlinePattern"&&k?Ea(Y,u,z,$,oe):Ta(Y,oe)}else U=K.indexBuffer,N=K.segments,j=k?_d(Y,u,z,$):gu(Y);u.prepareDrawProgram(u.context,ee,J.toUnwrapped()),ee.draw(u.context,L,m,u.stencilModeForClipping(J),g,s.CullFaceMode.disabled,j,a.id,K.layoutVertexBuffer,U,N,a.paint,u.transform.zoom,q)}}function Ca(u,t,a,d,m,g,w){const b=u.context,S=b.gl,k=u.transform,z=a.paint.get("fill-extrusion-pattern"),L=z.constantOr(1),O=a.getCrossfadeParameters(),j=a.paint.get("fill-extrusion-opacity"),U=k.projection.name==="globe"?s.fillExtrusionHeightLift():0,N=k.projection.name==="globe",J=N?s.globeToMercatorTransition(k.zoom):0,$=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],K=[];N&&K.push("PROJECTION_GLOBE_VIEW");for(const q of d){const ee=t.getTile(q),Z=ee.getBucket(a);if(!Z||Z.projection!==k.projection.name)continue;const Y=Z.programConfigurations.get(a.id),oe=u.useProgram(L?"fillExtrusionPattern":"fillExtrusion",Y,K);if(u.terrain){const Be=u.terrain;if(u.style.terrainSetForDrapingOnly())Be.setupElevationDraw(ee,oe,{useMeterToDem:!0});else{if(!Z.enableTerrain)continue;if(Be.setupElevationDraw(ee,oe,{useMeterToDem:!0}),Ad(b,t,q,Z,a,Be),!Z.centroidVertexBuffer){const Pe=oe.attributes.a_centroid_pos;Pe!==void 0&&S.vertexAttrib2f(Pe,0,0)}}}L&&(u.context.activeTexture.set(S.TEXTURE0),ee.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Y.updatePaintBuffers(O));const Ee=z.constantOr(null);if(Ee&&ee.imageAtlas){const Be=ee.imageAtlas,Pe=Be.patternPositions[Ee.to.toString()],xe=Be.patternPositions[Ee.from.toString()];Pe&&xe&&Y.setConstantPatternPositions(Pe,xe)}const Me=u.translatePosMatrix(q.projMatrix,ee,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ke=k.projection.createInversionMatrix(k,q.canonical),$e=a.paint.get("fill-extrusion-vertical-gradient"),ye=L?md(Me,u,$e,j,q,O,ee,U,J,$,ke):Fl(Me,u,$e,j,q,U,J,$,ke);u.prepareDrawProgram(b,oe,q.toUnwrapped()),oe.draw(b,b.gl.TRIANGLES,m,g,w,s.CullFaceMode.backCCW,ye,a.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,a.paint,u.transform.zoom,Y,u.terrain?Z.centroidVertexBuffer:null,N?Z.layoutVertexExtBuffer:null)}}function Ad(u,t,a,d,m,g){const w=[$=>{let K=$.canonical.x-1,q=$.wrap;return K<0&&(K=(1<<$.canonical.z)-1,q--),new s.OverscaledTileID($.overscaledZ,q,$.canonical.z,K,$.canonical.y)},$=>{let K=$.canonical.x+1,q=$.wrap;return K===1<<$.canonical.z&&(K=0,q++),new s.OverscaledTileID($.overscaledZ,q,$.canonical.z,K,$.canonical.y)},$=>new s.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,($.canonical.y===0?1<<$.canonical.z:$.canonical.y)-1),$=>new s.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y===(1<<$.canonical.z)-1?0:$.canonical.y+1)],b=$=>{const K=t.getSource().minzoom,q=Z=>{const Y=t.getTileByID(Z);if(Y&&Y.hasData())return Y.getBucket(m)},ee=[0,-1,1];for(const Z of ee){if($.overscaledZ+Z<K)continue;const Y=q($.calculateScaledKey($.overscaledZ+Z));if(Y)return Y}},S=[0,0,0],k=($,K)=>(S[0]=Math.min($.min.y,K.min.y),S[1]=Math.max($.max.y,K.max.y),S[2]=s.EXTENT-K.min.x>$.max.x?K.min.x-s.EXTENT:$.max.x,S),z=($,K)=>(S[0]=Math.min($.min.x,K.min.x),S[1]=Math.max($.max.x,K.max.x),S[2]=s.EXTENT-K.min.y>$.max.y?K.min.y-s.EXTENT:$.max.y,S),L=[($,K)=>k($,K),($,K)=>k(K,$),($,K)=>z($,K),($,K)=>z(K,$)],O=new s.pointGeometry(0,0);let j,U,N;const J=($,K,q,ee,Z)=>{const Y=[[ee?q:$,ee?$:q,0],[ee?q:K,ee?K:q,0]],oe=Z<0?s.EXTENT+Z:Z,Ee=[ee?oe:($+K)/2,ee?($+K)/2:oe,0];return q===0&&Z<0||q!==0&&Z>0?g.getForTilePoints(N,[Ee],!0,U):Y.push(Ee),g.getForTilePoints(a,Y,!0,j),Math.max(Y[0][2],Y[1][2],Ee[2])/g.exaggeration()};for(let $=0;$<4;$++){const K=($<2?1:5)-$,q=d.borders[$];if(q.length===0)continue;const ee=N=w[$](a),Z=b(ee);if(!(Z&&Z instanceof s.FillExtrusionBucket&&Z.enableTerrain)||d.borderDoneWithNeighborZ[$]===Z.canonical.z&&Z.borderDoneWithNeighborZ[K]===d.canonical.z||(U=g.findDEMTileFor(ee),!U||!U.dem))continue;if(!j){const Me=g.findDEMTileFor(a);if(!Me||!Me.dem)return;j=Me}const Y=Z.borders[K];let oe=0;const Ee=Z.borderDoneWithNeighborZ[K]!==d.canonical.z;if(d.canonical.z===Z.canonical.z){for(let Me=0;Me<q.length;Me++){const ke=d.featuresOnBorder[q[Me]],$e=ke.borders[$];let ye;for(;oe<Y.length&&(ye=Z.featuresOnBorder[Y[oe]],!(ye.borders[K][1]>$e[0]+3));)Ee&&Z.encodeCentroid(void 0,ye,!1),oe++;if(ye&&oe<Y.length){const Be=oe;let Pe=0;for(;!(ye.borders[K][0]>$e[1]-3)&&(Pe++,++oe!==Y.length);)ye=Z.featuresOnBorder[Y[oe]];if(ye=Z.featuresOnBorder[Y[Be]],ke.intersectsCount()>1||ye.intersectsCount()>1||Pe!==1){Pe!==1&&(oe=Be),d.encodeCentroid(void 0,ke,!1),Ee&&Z.encodeCentroid(void 0,ye,!1);continue}const xe=L[$](ke,ye),ge=$%2?s.EXTENT-1:0;O.x=J(xe[0],Math.min(s.EXTENT-1,xe[1]),ge,$<2,xe[2]),O.y=0,d.encodeCentroid(O,ke,!1),Ee&&Z.encodeCentroid(O,ye,!1)}else d.encodeCentroid(void 0,ke,!1)}d.borderDoneWithNeighborZ[$]=Z.canonical.z,d.needsCentroidUpdate=!0,Ee&&(Z.borderDoneWithNeighborZ[K]=d.canonical.z,Z.needsCentroidUpdate=!0)}else{for(const Me of q)d.encodeCentroid(void 0,d.featuresOnBorder[Me],!1);if(Ee){for(const Me of Y)Z.encodeCentroid(void 0,Z.featuresOnBorder[Me],!1);Z.borderDoneWithNeighborZ[K]=d.canonical.z,Z.needsCentroidUpdate=!0}d.borderDoneWithNeighborZ[$]=Z.canonical.z,d.needsCentroidUpdate=!0}}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(u)}const Id=new s.Color(1,0,0,1),kd=new s.Color(0,1,0,1),wu=new s.Color(0,0,1,1),Ro=new s.Color(1,0,1,1),Aa=new s.Color(0,1,1,1);function bu(u,t,a,d){$r(u,0,t+a/2,u.transform.width,a,d)}function Fo(u,t,a,d){$r(u,t-a/2,0,a,u.transform.height,d)}function $r(u,t,a,d,m,g){const w=u.context,b=w.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*s.exported.devicePixelRatio,a*s.exported.devicePixelRatio,d*s.exported.devicePixelRatio,m*s.exported.devicePixelRatio),w.clear({color:g}),b.disable(b.SCISSOR_TEST)}function Md(u,t,a){const d=u.context,m=d.gl,g=u.transform.projection.name==="globe",w=a.projMatrix,b=u.useProgram("debug",null,g?["PROJECTION_GLOBE_VIEW"]:null),S=t.getTileByID(a.key);u.terrain&&u.terrain.setupElevationDraw(S,b);const k=s.DepthMode.disabled,z=s.StencilMode.disabled,L=u.colorModeForRenderPass(),O="$debug";d.activeTexture.set(m.TEXTURE0),u.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),g?S._makeGlobeTileDebugBuffers(u.context,u.transform.projection):S._makeDebugTileBoundsBuffers(u.context,u.transform.projection);const j=S._tileDebugBuffer||u.debugBuffer,U=S._tileDebugIndexBuffer||u.debugIndexBuffer,N=S._tileDebugSegments||u.debugSegments;b.draw(d,m.LINE_STRIP,k,z,L,s.CullFaceMode.disabled,Nl(w,s.Color.red),O,j,U,N,null,null,null,S._globeTileDebugBorderBuffer);const J=S.latestRawTileData,$=Math.floor((J&&J.byteLength||0)/1024),K=t.getTile(a).tileSize,q=512/Math.min(K,512)*(a.overscaledZ/u.transform.zoom)*.5;let ee=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ee+=` => ${a.overscaledZ}`),function(Ee,Me){Ee.initDebugOverlayCanvas();const ke=Ee.debugOverlayCanvas,$e=Ee.context.gl,ye=Ee.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,ke.width,ke.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(Me,5,5),ye.strokeText(Me,5,5),Ee.debugOverlayTexture.update(ke),Ee.debugOverlayTexture.bind($e.LINEAR,$e.CLAMP_TO_EDGE)}(u,`${ee} ${$}kb`);const Z=S._tileDebugTextBuffer||u.debugBuffer,Y=S._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,oe=S._tileDebugTextSegments||u.debugSegments;b.draw(d,m.TRIANGLES,k,z,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Nl(w,s.Color.transparent,q),O,Z,Y,oe,null,null,null,S._globeTileDebugTextBuffer)}const Tu=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$t}=Tu;function hr(u,t,a,d){u.emplaceBack(t,a,d)}class zd{constructor(t){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,hr(this.vertexArray,-1,-1,1),hr(this.vertexArray,1,-1,1),hr(this.vertexArray,-1,1,1),hr(this.vertexArray,1,1,1),hr(this.vertexArray,-1,-1,-1),hr(this.vertexArray,1,-1,-1),hr(this.vertexArray,-1,1,-1),hr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,$t),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function Oo(u,t,a,d,m,g){const w=u.gl,b=t.paint.get("sky-atmosphere-color"),S=t.paint.get("sky-atmosphere-halo-color"),k=t.paint.get("sky-atmosphere-sun-intensity"),z=((L,O,j,U,N)=>({u_matrix_3f:L,u_sun_direction:O,u_sun_intensity:j,u_color_tint_r:[U.r,U.g,U.b,U.a],u_color_tint_m:[N.r,N.g,N.b,N.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),d),m,k,b,S);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),a.draw(u,w.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,z,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Ia=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class xm{constructor(t){const a=new s.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new s.StructArrayLayout3ui6;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,Ia.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Pd={symbol:function(u,t,a,d,m){if(u.renderPass!=="translucent")return;const g=s.StencilMode.disabled,w=u.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(b,S,k,z,L,O,j){const U=S.transform,N=L==="map",J=O==="map";for(const $ of b){const K=z.getTile($),q=K.getBucket(k);if(!q||q.projection!==U.projection.name||!q.text||!q.text.segments.get().length)continue;const ee=s.evaluateSizeForZoom(q.textSizeData,U.zoom),Z=S.transform.calculatePixelsToTileUnitsMatrix(K),Y=kt($.projMatrix,K.tileID.canonical,J,N,S.transform,Z),oe=k.layout.get("icon-text-fit")!=="none"&&q.hasIconData();if(ee){const Ee=Math.pow(2,U.zoom-K.tileID.overscaledZ);gm(q,N,J,j,s.symbolSize,U,Y,$,Ee,ee,oe,U.projection)}}}(d,u,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),m),a.paint.get("icon-opacity").constantOr(1)!==0&&Sd(u,t,a,d,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),g,w),a.paint.get("text-opacity").constantOr(1)!==0&&Sd(u,t,a,d,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),g,w),t.map.showCollisionBoxes&&(Bo(u,t,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Bo(u,t,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,a,d){if(u.renderPass!=="translucent")return;const m=a.paint.get("circle-opacity"),g=a.paint.get("circle-stroke-width"),w=a.paint.get("circle-stroke-opacity"),b=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(g.constantOr(1)===0||w.constantOr(1)===0))return;const S=u.context,k=S.gl,z=u.transform,L=u.depthModeForSublayer(0,s.DepthMode.ReadOnly),O=s.StencilMode.disabled,j=u.colorModeForRenderPass(),U=z.projection.name==="globe",N=[s.mercatorXfromLng(z.center.lng),s.mercatorYfromLat(z.center.lat)],J=[];for(let K=0;K<d.length;K++){const q=d[K],ee=t.getTile(q),Z=ee.getBucket(a);if(!Z||Z.projection!==z.projection.name)continue;const Y=Z.programConfigurations.get(a.id),oe=yu(a);U&&oe.push("PROJECTION_GLOBE_VIEW");const Ee=u.useProgram("circle",Y,oe),Me=Z.layoutVertexBuffer,ke=Z.globeExtVertexBuffer,$e=Z.indexBuffer,ye=z.projection.createInversionMatrix(z,q.canonical),Be={programConfiguration:Y,program:Ee,layoutVertexBuffer:Me,globeExtVertexBuffer:ke,indexBuffer:$e,uniformValues:Ol(u,q,ee,ye,N,a),tile:ee};if(b){const Pe=Z.segments.get();for(const xe of Pe)J.push({segments:new s.SegmentVector([xe]),sortKey:xe.sortKey,state:Be})}else J.push({segments:Z.segments,sortKey:0,state:Be})}b&&J.sort((K,q)=>K.sortKey-q.sortKey);const $={useDepthForOcclusion:!U};for(const K of J){const{programConfiguration:q,program:ee,layoutVertexBuffer:Z,globeExtVertexBuffer:Y,indexBuffer:oe,uniformValues:Ee,tile:Me}=K.state,ke=K.segments;u.terrain&&u.terrain.setupElevationDraw(Me,ee,$),u.prepareDrawProgram(S,ee,Me.tileID.toUnwrapped()),ee.draw(S,k.TRIANGLES,L,O,j,s.CullFaceMode.disabled,Ee,a.id,Z,oe,ke,a.paint,z.zoom,q,U?Y:null)}},heatmap:function(u,t,a,d){if(a.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const m=u.context,g=m.gl,w=s.StencilMode.disabled,b=new s.ColorMode([g.ONE,g.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(j,U,N,J){const $=j.gl,K=U.width*J,q=U.height*J;j.activeTexture.set($.TEXTURE1),j.viewport.set([0,0,K,q]);let ee=N.heatmapFbo;if(!ee||ee&&(ee.width!==K||ee.height!==q)){ee&&ee.destroy();const Z=$.createTexture();$.bindTexture($.TEXTURE_2D,Z),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),ee=N.heatmapFbo=j.createFramebuffer(K,q,!1),function(Y,oe,Ee,Me,ke,$e){const ye=Y.gl;ye.texImage2D(ye.TEXTURE_2D,0,ye.RGBA,ke,$e,0,ye.RGBA,Y.extRenderToTextureHalfFloat?Y.extTextureHalfFloat.HALF_FLOAT_OES:ye.UNSIGNED_BYTE,null),Me.colorAttachment.set(Ee)}(j,0,Z,ee,K,q)}else $.bindTexture($.TEXTURE_2D,ee.colorAttachment.get()),j.bindFramebuffer.set(ee.framebuffer)})(m,u,a,u.transform.projection.name==="globe"?.5:.25),m.clear({color:s.Color.transparent});const S=u.transform,k=S.projection.name==="globe",z=k?["PROJECTION_GLOBE_VIEW"]:null,L=k?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,O=[s.mercatorXfromLng(S.center.lng),s.mercatorYfromLat(S.center.lat)];for(let j=0;j<d.length;j++){const U=d[j];if(t.hasRenderableParent(U))continue;const N=t.getTile(U),J=N.getBucket(a);if(!J||J.projection!==S.projection.name)continue;const $=J.programConfigurations.get(a.id),K=u.useProgram("heatmap",$,z),{zoom:q}=u.transform;u.terrain&&u.terrain.setupElevationDraw(N,K),u.prepareDrawProgram(m,K,U.toUnwrapped());const ee=S.projection.createInversionMatrix(S,U.canonical);K.draw(m,g.TRIANGLES,s.DepthMode.disabled,w,b,L,xu(u,U,N,ee,O,q,a.paint.get("heatmap-intensity")),a.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,a.paint,u.transform.zoom,$,k?J.globeExtVertexBuffer:null)}m.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(m,g){const w=m.context,b=w.gl,S=g.heatmapFbo;if(!S)return;w.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,S.colorAttachment.get()),w.activeTexture.set(b.TEXTURE1);let k=g.colorRampTexture;k||(k=g.colorRampTexture=new s.Texture(w,g.colorRamp,b.RGBA)),k.bind(b.LINEAR,b.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(w,b.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,m.colorModeForRenderPass(),s.CullFaceMode.disabled,((z,L,O,j)=>({u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}))(0,g),g.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,g.paint,m.transform.zoom)}(u,a))},line:function(u,t,a,d){if(u.renderPass!=="translucent")return;const m=a.paint.get("line-opacity"),g=a.paint.get("line-width");if(m.constantOr(1)===0||g.constantOr(1)===0)return;const w=u.depthModeForSublayer(0,s.DepthMode.ReadOnly),b=u.colorModeForRenderPass(),S=u.terrain&&u.terrain.renderingToTexture?1:s.exported.devicePixelRatio,k=a.paint.get("line-dasharray"),z=k.constantOr(1),L=a.layout.get("line-cap"),O=a.paint.get("line-pattern"),j=O.constantOr(1),U=a.paint.get("line-gradient"),N=a.getCrossfadeParameters(),J=j?"linePattern":"line",$=u.context,K=$.gl,q=(Z=>{const Y=[];wd(Z)&&Y.push("RENDER_LINE_DASH"),Z.paint.get("line-gradient")&&Y.push("RENDER_LINE_GRADIENT");const oe=Z.paint.get("line-pattern").constantOr(1),Ee=Z.paint.get("line-opacity").constantOr(1)!==1;return!oe&&Ee&&Y.push("RENDER_LINE_ALPHA_DISCARD"),Y})(a);let ee=q.includes("RENDER_LINE_ALPHA_DISCARD");u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(ee=!1);for(const Z of d){const Y=t.getTile(Z);if(j&&!Y.patternsLoaded())continue;const oe=Y.getBucket(a);if(!oe)continue;u.prepareDrawTile();const Ee=oe.programConfigurations.get(a.id),Me=u.useProgram(J,Ee,q),ke=O.constantOr(null);if(ke&&Y.imageAtlas){const tt=Y.imageAtlas,st=tt.patternPositions[ke.to.toString()],qe=tt.patternPositions[ke.from.toString()];st&&qe&&Ee.setConstantPatternPositions(st,qe)}const $e=k.constantOr(null),ye=L.constantOr(null);if(!j&&$e&&ye&&Y.lineAtlas){const tt=Y.lineAtlas,st=tt.getDash($e.to,ye),qe=tt.getDash($e.from,ye);st&&qe&&Ee.setConstantPatternPositions(st,qe)}const Be=a.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&Be[0]!==Be[1]&&(Be[0]===0&&(Be[0]-=1),Be[1]===1&&(Be[1]+=1));const Pe=u.terrain?Z.projMatrix:null,xe=j?vu(u,Y,a,N,Pe,S):xd(u,Y,a,N,Pe,oe.lineClipsArray.length,S,Be);if(U){const tt=oe.gradients[a.id];let st=tt.texture;if(a.gradientVersion!==tt.version){let qe=256;if(a.stepInterpolant){const rt=t.getSource().maxzoom,ot=Z.canonical.z===rt?Math.ceil(1<<u.transform.maxZoom-Z.canonical.z):1;qe=s.clamp(s.nextPowerOfTwo(oe.maxLineLength/s.EXTENT*1024*ot),256,$.maxTextureSize)}tt.gradient=s.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:qe,image:tt.gradient||void 0,clips:oe.lineClipsArray}),tt.texture?tt.texture.update(tt.gradient):tt.texture=new s.Texture($,tt.gradient,K.RGBA),tt.version=a.gradientVersion,st=tt.texture}$.activeTexture.set(K.TEXTURE1),st.bind(a.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}z&&($.activeTexture.set(K.TEXTURE0),Y.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),Ee.updatePaintBuffers(N)),j&&($.activeTexture.set(K.TEXTURE0),Y.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Ee.updatePaintBuffers(N)),u.prepareDrawProgram($,Me,Z.toUnwrapped());const ge=tt=>{Me.draw($,K.TRIANGLES,w,tt,b,s.CullFaceMode.disabled,xe,a.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,a.paint,u.transform.zoom,Ee,oe.layoutVertexBuffer2)};if(ee){const tt=u.stencilModeForClipping(Z).ref;tt===0&&u.terrain&&$.clear({stencil:0});const st={func:K.EQUAL,mask:255};xe.u_alpha_discard_threshold=.8,ge(new s.StencilMode(st,tt,255,K.KEEP,K.KEEP,K.INVERT)),xe.u_alpha_discard_threshold=0,ge(new s.StencilMode(st,tt,255,K.KEEP,K.KEEP,K.KEEP))}else ge(u.stencilModeForClipping(Z))}ee&&(u.resetStencilClippingMasks(),u.terrain&&$.clear({stencil:0}))},fill:function(u,t,a,d){const m=a.paint.get("fill-color"),g=a.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const w=u.colorModeForRenderPass(),b=a.paint.get("fill-pattern"),S=u.opaquePassEnabledForLayer()&&!b.constantOr(1)&&m.constantOr(s.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===S){const k=u.depthModeForSublayer(1,u.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);Zl(u,t,a,d,k,w,!1)}if(u.renderPass==="translucent"&&a.paint.get("fill-antialias")){const k=u.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);Zl(u,t,a,d,k,w,!0)}},"fill-extrusion":function(u,t,a,d){const m=a.paint.get("fill-extrusion-opacity");if(m!==0&&u.renderPass==="translucent"){const g=new s.DepthMode(u.context.gl.LEQUAL,s.DepthMode.ReadWrite,u.depthRangeFor3D);if(m!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Ca(u,t,a,d,g,s.StencilMode.disabled,s.ColorMode.disabled),Ca(u,t,a,d,g,u.stencilModeFor3D(),u.colorModeForRenderPass()),u.resetStencilClippingMasks();else{const w=u.colorModeForRenderPass();Ca(u,t,a,d,g,s.StencilMode.disabled,w)}}},hillshade:function(u,t,a,d){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const m=u.context,g=u.depthModeForSublayer(0,s.DepthMode.ReadOnly),w=u.colorModeForRenderPass(),b=u.terrain&&u.terrain.renderingToTexture,[S,k]=u.renderPass!=="translucent"||b?[{},d]:u.stencilConfigForOverlap(d);for(const z of k){const L=t.getTile(z);if(L.needsHillshadePrepare&&u.renderPass==="offscreen")hu(u,L,a,g,s.StencilMode.disabled,w);else if(u.renderPass==="translucent"){const O=b&&u.terrain?u.terrain.stencilModeForRTTOverlap(z):S[z.overscaledZ];cu(u,z,L,a,g,O,w)}}m.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,a,d,m,g){if(u.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!d.length)return;const w=u.context,b=w.gl,S=t.getSource(),k=u.useProgram("raster"),z=u.colorModeForRenderPass(),L=u.terrain&&u.terrain.renderingToTexture,[O,j]=S instanceof pe||L?[{},d]:u.stencilConfigForOverlap(d),U=j[j.length-1].overscaledZ,N=!u.options.moving;for(const J of j){const $=L?s.DepthMode.disabled:u.depthModeForSublayer(J.overscaledZ-U,a.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,b.LESS),K=J.toUnwrapped(),q=t.getTile(J);if(L&&(!q||!q.hasData()))continue;const ee=L?J.projMatrix:u.transform.calculateProjMatrix(K,N),Z=u.terrain&&L?u.terrain.stencilModeForRTTOverlap(J):O[J.overscaledZ],Y=g?0:a.paint.get("raster-fade-duration");q.registerFadeDuration(Y);const oe=t.findLoadedParent(J,0),Ee=pu(q,oe,t,u.transform,Y);let Me,ke;u.terrain&&u.terrain.prepareDrawTile();const $e=a.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;w.activeTexture.set(b.TEXTURE0),q.texture.bind($e,b.CLAMP_TO_EDGE),w.activeTexture.set(b.TEXTURE1),oe?(oe.texture.bind($e,b.CLAMP_TO_EDGE),Me=Math.pow(2,oe.tileID.overscaledZ-q.tileID.overscaledZ),ke=[q.tileID.canonical.x*Me%1,q.tileID.canonical.y*Me%1]):q.texture.bind($e,b.CLAMP_TO_EDGE);const ye=jl(ee,ke||[0,0],Me||1,Ee,a,S instanceof pe?S.perspectiveTransform:[0,0]);if(u.prepareDrawProgram(w,k,K),S instanceof pe)S.boundsBuffer&&S.boundsSegments&&k.draw(w,b.TRIANGLES,$,s.StencilMode.disabled,z,s.CullFaceMode.disabled,ye,a.id,S.boundsBuffer,u.quadTriangleIndexBuffer,S.boundsSegments);else{const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:Pe,tileBoundsSegments:xe}=u.getTileBoundsBuffers(q);k.draw(w,b.TRIANGLES,$,Z,z,s.CullFaceMode.disabled,ye,a.id,Be,Pe,xe)}}u.resetStencilClippingMasks()},background:function(u,t,a,d){const m=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g===0)return;const w=u.context,b=w.gl,S=u.transform,k=S.tileSize,z=a.paint.get("background-pattern");if(u.isPatternMissing(z))return;const L=!z&&m.a===1&&g===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==L)return;const O=s.StencilMode.disabled,j=u.depthModeForSublayer(0,L==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),U=u.colorModeForRenderPass(),N=u.useProgram(z?"backgroundPattern":"background");let J,$=d;$||(J=u.getBackgroundTiles(),$=Object.values(J).map(q=>q.tileID)),z&&(w.activeTexture.set(b.TEXTURE0),u.imageManager.bind(u.context));const K=a.getCrossfadeParameters();for(const q of $){const ee=q.toUnwrapped(),Z=d?q.projMatrix:u.transform.calculateProjMatrix(ee);u.prepareDrawTile();const Y=t?t.getTile(q):J?J[q.key]:new s.Tile(q,k,S.zoom,u),oe=z?mm(Z,g,u,z,{tileID:q,tileSize:k},K):$l(Z,g,m);u.prepareDrawProgram(w,N,ee);const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:Me,tileBoundsSegments:ke}=u.getTileBoundsBuffers(Y);N.draw(w,b.TRIANGLES,j,O,U,s.CullFaceMode.disabled,oe,a.id,Ee,Me,ke)}},sky:function(u,t,a){const d=u.transform,m=d.projection.name==="mercator"||d.projection.name==="globe"?1:s.smoothstep(7,8,d.zoom),g=a.paint.get("sky-opacity")*m;if(g===0)return;const w=u.context,b=a.paint.get("sky-type"),S=new s.DepthMode(w.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),k=u.frameCounter/1e3%1;b==="atmosphere"?u.renderPass==="offscreen"?a.needsSkyboxCapture(u)&&(function(z,L,O,j){const U=z.context,N=U.gl;let J=L.skyboxFbo;if(!J){J=L.skyboxFbo=U.createFramebuffer(32,32,!1),L.skyboxGeometry=new zd(U),L.skyboxTexture=U.gl.createTexture(),N.bindTexture(N.TEXTURE_CUBE_MAP,L.skyboxTexture),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MAG_FILTER,N.LINEAR);for(let ee=0;ee<6;++ee)N.texImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,N.RGBA,32,32,0,N.RGBA,N.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(J.framebuffer),U.viewport.set([0,0,32,32]);const $=L.getCenter(z,!0),K=z.useProgram("skyboxCapture"),q=new Float64Array(16);s.identity(q),s.rotateY(q,q,.5*-Math.PI),Oo(U,L,K,q,$,0),s.identity(q),s.rotateY(q,q,.5*Math.PI),Oo(U,L,K,q,$,1),s.identity(q),s.rotateX(q,q,.5*-Math.PI),Oo(U,L,K,q,$,2),s.identity(q),s.rotateX(q,q,.5*Math.PI),Oo(U,L,K,q,$,3),s.identity(q),Oo(U,L,K,q,$,4),s.identity(q),s.rotateY(q,q,Math.PI),Oo(U,L,K,q,$,5),U.viewport.set([0,0,z.width,z.height])}(u,a),a.markSkyboxValid(u)):u.renderPass==="sky"&&function(z,L,O,j,U){const N=z.context,J=N.gl,$=z.transform,K=z.useProgram("skybox");N.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,L.skyboxTexture);const q=((ee,Z,Y,oe,Ee)=>({u_matrix:ee,u_sun_direction:Z,u_cubemap:0,u_opacity:oe,u_temporal_offset:Ee}))($.skyboxMatrix,L.getCenter(z,!1),0,j,U);z.prepareDrawProgram(N,K),K.draw(N,J.TRIANGLES,O,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,q,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(u,a,S,g,k):b==="gradient"&&u.renderPass==="sky"&&function(z,L,O,j,U){const N=z.context,J=N.gl,$=z.transform,K=z.useProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new zd(N)),N.activeTexture.set(J.TEXTURE0);let q=L.colorRampTexture;q||(q=L.colorRampTexture=new s.Texture(N,L.colorRamp,J.RGBA)),q.bind(J.LINEAR,J.CLAMP_TO_EDGE);const ee=((Z,Y,oe,Ee,Me)=>({u_matrix:Z,u_color_ramp:0,u_center_direction:Y,u_radius:s.degToRad(oe),u_opacity:Ee,u_temporal_offset:Me}))($.skyboxMatrix,L.getCenter(z,!1),L.paint.get("sky-gradient-radius"),j,U);z.prepareDrawProgram(N,K),K.draw(N,J.TRIANGLES,O,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,ee,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(u,a,S,g,k)},debug:function(u,t,a){for(let d=0;d<a.length;d++)Md(u,t,a[d])},custom:function(u,t,a){const d=u.context,m=a.implementation;if(u.transform.projection.unsupportedLayers&&u.transform.projection.unsupportedLayers.includes("custom"))s.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(u.renderPass==="offscreen"){const g=m.prerender;g&&(u.setCustomLayerDefaults(),d.setColorMode(u.colorModeForRenderPass()),g.call(m,d.gl,u.transform.customLayerMatrix()),d.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),d.setColorMode(u.colorModeForRenderPass()),d.setStencilMode(s.StencilMode.disabled);const g=m.renderingMode==="3d"?new s.DepthMode(u.context.gl.LEQUAL,s.DepthMode.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,s.DepthMode.ReadOnly);d.setDepthMode(g),m.render(d.gl,u.transform.customLayerMatrix()),d.setDirty(),u.setBaseState(),d.bindFramebuffer.set(null)}}};class Dd{constructor(t,a){this.context=new X(t),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ud,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,a){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new dm(this,t));const m=this._terrain;this.transform.elevation=d?m:null,m.update(t,this.transform,a)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,m]=a.getFovAdjustedRange(this.transform._fov);if(d>m)return void(this.transform.fogCullDistSq=null);const g=d+.78*(m-d);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,a){if(this.width=t*s.exported.devicePixelRatio,this.height=a*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._layers[d].resize()}setup(){const t=this.context,a=new s.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(s.EXTENT,0),a.emplaceBack(0,s.EXTENT),a.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(a,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const d=new s.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(s.EXTENT,0),d.emplaceBack(0,s.EXTENT),d.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=t.createVertexBuffer(d,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const m=new s.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const g=new s.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(s.EXTENT,0,s.EXTENT,0),g.emplaceBack(0,s.EXTENT,0,s.EXTENT),g.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(g,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const w=new s.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const b=new s.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])b.emplaceBack(k);this.debugIndexBuffer=t.createIndexBuffer(b),this.emptyTexture=new s.Texture(t,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=s.create();const S=this.context.gl;this.stencilClearMode=new s.StencilMode({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new xm(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,a.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,Ll(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,d){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let b=!1;for(const S of d)if(this._tileClippingMaskIDs[S.key]===void 0){b=!0;break}if(!b)return}this.currentStencilSource=a.id;const m=this.context,g=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(s.ColorMode.disabled),m.setDepthMode(s.DepthMode.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of d){const S=a.getTile(b),k=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:L,tileBoundsSegments:O}=this.getTileBoundsBuffers(S);w.draw(m,g.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:g.ALWAYS,mask:0},k,255,g.KEEP,g.KEEP,g.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Ll(b.projMatrix),"$clipping",z,L,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new s.StencilMode({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new s.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,d=t.sort((w,b)=>b.overscaledZ-w.overscaledZ),m=d[d.length-1].overscaledZ,g=d[0].overscaledZ-m+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const w={};for(let b=0;b<g;b++)w[b+m]=new s.StencilMode({func:a.GEQUAL,mask:255},b+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[w,d]}return[{[m]:s.StencilMode.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([t.CONSTANT_COLOR,t.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(t,a,d){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new s.DepthMode(d||this.context.gl.LEQUAL,a,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const d=this.style.order,m=this.style._sourceCaches;for(const S in m){const k=m[S];k.used&&k.prepare(this.context)}const g={},w={},b={};for(const S in m){const k=m[S];g[S]=k.getVisibleCoordinates(),w[S]=g[S].slice().reverse(),b[S]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<d.length;S++)if(this.style._layers[d[S]].is3D()){this.opaquePassCutoff=S;break}if(this.terrain&&(this.terrain.updateTileBinding(b),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const S of d){const k=this.style._layers[S],z=t._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const L=z?w[z.id]:void 0;(k.type==="custom"||k.isSky()||L&&L.length)&&this.renderLayer(this,z,k,L)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[d[this.currentLayer]],k=t._getLayerSourceCache(S);if(S.isSky())continue;const z=k?w[k.id]:void 0;this._renderTileClippingMasks(S,k,z),this.renderLayer(this,k,S,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(S,k){const z=S.context,L=z.gl,O=S.transform,j=new s.DepthMode(L.LEQUAL,s.DepthMode.ReadOnly,[0,1]),U=S.useProgram("globeAtmosphere",null,O.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),N=s.globeToMercatorTransition(O.zoom),J=k.properties.get("color").toArray01(),$=k.properties.get("high-color").toArray01(),K=k.properties.get("space-color").toArray01PremultipliedAlpha(),q=s.identity$1([]);s.rotateY$1(q,q,-s.degToRad(O._center.lng)),s.rotateX$1(q,q,s.degToRad(O._center.lat)),s.rotateZ$1(q,q,O.angle),s.rotateX$1(q,q,-O._pitch);const ee=s.fromQuat(new Float32Array(16),q),Z=s.mapValue(k.properties.get("star-intensity"),0,1,0,.25),Y=5e-4,oe=s.mapValue(k.properties.get("horizon-blend"),0,1,Y,.25),Ee=s.globeUseCustomAntiAliasing(S,z,O)&&oe===Y?O.worldSize/(2*Math.PI*1.025)-1:O.globeRadius,Me=S.frameCounter/1e3%1,ke=s.length(O.globeCenterInViewSpace),$e=Math.sqrt(Math.pow(ke,2)-Math.pow(Ee,2)),ye=Math.acos($e/ke),Be=((xe,ge,tt,st,qe,rt,ot,bt,mt,Ye,Ke,zt,Zt,ri)=>({u_frustum_tl:xe,u_frustum_tr:ge,u_frustum_br:tt,u_frustum_bl:st,u_horizon:qe,u_transition:rt,u_fadeout_range:ot,u_color:bt,u_high_color:mt,u_space_color:Ye,u_star_intensity:Ke,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:zt,u_horizon_angle:Zt,u_rotation_matrix:ri}))(O.frustumCorners.TL,O.frustumCorners.TR,O.frustumCorners.BR,O.frustumCorners.BL,O.frustumCorners.horizon,N,oe,J,$,K,Z,Me,ye,ee);S.prepareDrawProgram(z,U);const Pe=S.atmosphereBuffer;Pe&&U.draw(z,L.TRIANGLES,j,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Be,"skybox",Pe.vertexBuffer,Pe.indexBuffer,Pe.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const S=this.style._layers[d[this.currentLayer]],k=t._getLayerSourceCache(S);S.isSky()&&this.renderLayer(this,k,S,k?w[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;){const S=this.style._layers[d[this.currentLayer]],k=t._getLayerSourceCache(S);if(S.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(S)){if(S.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=k?(S.type==="symbol"?b:w)[k.id]:void 0;this._renderTileClippingMasks(S,k,k?g[k.id]:void 0),this.renderLayer(this,k,S,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let S=null;s.values(this.style._layers).forEach(k=>{const z=t._getLayerSourceCache(k);z&&!k.isHidden(this.transform.zoom)&&(!S||S.getSource().maxzoom<z.getSource().maxzoom)&&(S=z)}),S&&this.options.showTileBoundaries&&Pd.debug(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const k=S.transform.padding;bu(S,S.transform.height-(k.top||0),3,Id),bu(S,k.bottom||0,3,kd),Fo(S,k.left||0,3,wu),Fo(S,S.transform.width-(k.right||0),3,Ro);const z=S.transform.centerPoint;(function(L,O,j,U){$r(L,O-1,j-10,2,20,U),$r(L,O-10,j-1,20,2,U)})(S,z.x,S.transform.height-z.y,Aa)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(t,a,d,m){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||m&&m.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)||Pd[d.type](t,a,d,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let d=this.gpuTimers[t.id];d||(d=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),d.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,d.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=t.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),t.beginQueryEXT(t.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const d in t){const m=t[d],g=this.context.extTimerQuery,w=g.getQueryObjectEXT(m.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(m.query),a[d]=w}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let d=0;for(const m of t)d+=a.getQueryObjectEXT(m,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(m);return d}translatePosMatrix(t,a,d,m,g){if(!d[0]&&!d[1])return t;const w=g?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){const k=Math.sin(w),z=Math.cos(w);d=[d[0]*z-d[1]*k,d[0]*k+d[1]*z]}const b=[g?d[0]:qi(a,d[0],this.transform.zoom),g?d[1]:qi(a,d[1],this.transform.zoom),0],S=new Float32Array(16);return s.translate(S,t,b),S}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),d=this.imageManager.getPattern(t.to.toString());return!a||!d}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,d=[];return this.terrain&&!this.terrain.renderingToTexture&&d.push("TERRAIN"),a&&!t&&a.getOpacity(this.transform.pitch)!==0&&d.push("FOG"),t&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}useProgram(t,a,d){this.cache=this.cache||{};const m=d||[],g=this.currentGlobalDefines().concat(m),w=Bl.cacheKey(t,g,a);return this.cache[w]||(this.cache[w]=new Bl(this.context,t,lu[t],a,Td[t],g)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,a,d){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const g=m.getOpacity(this.transform.pitch),w=((b,S,k,z,L,O,j,U,N,J,$)=>{const K=b.transform,q=S.properties.get("color").toArray01();q[3]=z;const ee=b.frameCounter/1e3%1;return{u_fog_matrix:k?K.calculateFogTileMatrix(k):b.identityMat,u_fog_range:S.getFovAdjustedRange(K._fov),u_fog_color:q,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:ee,u_frustum_tl:L,u_frustum_tr:O,u_frustum_br:j,u_frustum_bl:U,u_globe_pos:N,u_globe_radius:J,u_viewport:$,u_globe_transition:s.globeToMercatorTransition(K.zoom),u_is_globe:+(K.projection.name==="globe")}})(this,m,d,g,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);a.setFogUniformValues(t,w)}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const m of d)a[m.key]=t[m.key]||new s.Tile(m,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class Eu{constructor(t=0,a=0,d=0,m=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=d,this.right=m}interpolate(t,a,d){return a.top!=null&&t.top!=null&&(this.top=s.number(t.top,a.top,d)),a.bottom!=null&&t.bottom!=null&&(this.bottom=s.number(t.bottom,a.bottom,d)),a.left!=null&&t.left!=null&&(this.left=s.number(t.left,a.left,d)),a.right!=null&&t.right!=null&&(this.right=s.number(t.right,a.right,d)),this}getCenter(t,a){const d=s.clamp((this.left+t-this.right)/2,0,t),m=s.clamp((this.top+a-this.bottom)/2,0,a);return new s.pointGeometry(d,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Eu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ql(u,t){const a=s.getColumn(u,3);s.fromQuat(u,t),s.setColumn(u,3,a)}function vs(u,t){const a=s.identity$1([]);return s.rotateZ$1(a,a,-t),s.rotateX$1(a,a,-u),a}function No(u,t){const a=[u[0],u[1],0],d=[t[0],t[1],0];if(s.length(a)>=1e-15){const w=s.normalize([],a);s.scale$2(d,w,s.dot(d,w)),t[0]=d[0],t[1]=d[1]}const m=s.cross([],t,u);if(s.len(m)<1e-15)return null;const g=Math.atan2(-m[1],m[0]);return vs(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),g)}class Wl{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof s.MercatorCoordinate?t:new s.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=s.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;const d=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(t)):0,m=this.position,g=s.MercatorCoordinate.fromLngLat(t,d),w=[g.x-m.x,g.y-m.y,g.z-m.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=No(w,a)}setPitchBearing(t,a){this.orientation=vs(s.degToRad(t),s.degToRad(-a))}}class ka{constructor(t,a){this._transform=s.identity([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new s.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=s.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&s.setColumn(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.identity$1([]),t&&ql(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=vs(t,a),ql(this._transform,this._orientation)}forward(){const t=s.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const d=new Float64Array(16);return s.invert(d,this.getWorldToCamera(t,a)),d}getWorldToCameraPosition(t,a,d){const m=this.position;s.scale$2(m,m,-t);const g=new Float64Array(16);return s.fromScaling(g,[d,d,d]),s.translate(g,g,m),g[10]*=a,g}getWorldToCamera(t,a){const d=new Float64Array(16),m=new Float64Array(4),g=this.position;return s.conjugate(m,this._orientation),s.scale$2(g,g,-t),s.fromQuat(d,m),s.translate(d,d,g),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(t,a,d,m){const g=new Float64Array(16);return s.perspective(g,t,a,d,m),g}getDistanceToElevation(t){const a=t===0?0:s.mercatorZfromAltitude(t,this.position[1]),d=this.forward();return(a-this.position[2])/d[2]}clone(){return new ka([...this.position],[...this.orientation])}}function Su(u,t){const a=ws(u),d=function(g,w,b,S,k){const z=new s.LngLat(b.lng-180*Xe,b.lat),L=new s.LngLat(b.lng+180*Xe,b.lat),O=g.project(z.lng,z.lat),j=g.project(L.lng,L.lat),U=-Math.atan2(j.y-O.y,j.x-O.x),N=s.MercatorCoordinate.fromLngLat(b);N.y=s.clamp(N.y,-.999975,.999975);const J=N.toLngLat(),$=g.project(J.lng,J.lat),K=s.MercatorCoordinate.fromLngLat(J);K.x+=Xe;const q=K.toLngLat(),ee=g.project(q.lng,q.lat),Z=Cu(ee.x-$.x,ee.y-$.y,U),Y=s.MercatorCoordinate.fromLngLat(J);Y.y+=Xe;const oe=Y.toLngLat(),Ee=g.project(oe.lng,oe.lat),Me=Cu(Ee.x-$.x,Ee.y-$.y,U),ke=Math.abs(Z.x)/Math.abs(Me.y),$e=s.identity([]);s.rotateZ($e,$e,-U*(1-(k?0:S)));const ye=s.identity([]);return s.scale(ye,ye,[1,1-(1-ke)*S,1]),ye[4]=-Me.x/Me.y*S,s.rotateZ(ye,ye,U),s.multiply(ye,$e,ye),ye}(u.projection,0,u.center,a,t),m=Ma(u);return s.scale(d,d,[m,m,1]),d}function Ma(u){const t=u.projection,a=ws(u),d=Wn(t,u.center),m=Wn(t,s.LngLat.convert(t.center));return Math.pow(2,d*a+(1-a)*m)}function ws(u,t=1/0){const a=u.projection.range;if(!a)return 0;const d=Math.min(t,Math.max(u.width,u.height)),m=Math.log(d/1024)/Math.LN2;return s.smoothstep(a[0]+m,a[1]+m,u.zoom)}const Xe=1/4e4;function Wn(u,t){const a=s.clamp(t.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),d=new s.LngLat(t.lng-180*Xe,a),m=new s.LngLat(t.lng+180*Xe,a),g=u.project(d.lng,a),w=u.project(m.lng,a),b=s.MercatorCoordinate.fromLngLat(d),S=s.MercatorCoordinate.fromLngLat(m),k=w.x-g.x,z=w.y-g.y,L=S.x-b.x,O=S.y-b.y,j=Math.sqrt((L*L+O*O)/(k*k+z*z));return Math.log(j)/Math.LN2}function Cu(u,t,a){const d=Math.cos(a),m=Math.sin(a);return{x:u*d-t*m,y:u*m+t*d}}class Xl{constructor(t,a,d,m,g,w,b){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=d==null?0:d,this._maxPitch=m==null?60:m,this.setProjection(w),this.setMaxBounds(b),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Eu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ka,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const t=new Xl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||a)&&this._updateCameraOnTerrain(),(t||a)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(t){t==null&&(t={name:"mercator"}),this.projectionOptions=t;const a=this.projection?this.getProjection():void 0;this.projection=s.getProjection(t);const d=this.getProjection();return G(a,d)?null:(this._calcMatrices(),d)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;var d;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(d=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),function(m,g,w){var b=g[0],S=g[1],k=g[2],z=g[3],L=Math.sin(w),O=Math.cos(w);m[0]=b*O+k*L,m[1]=S*O+z*L,m[2]=b*-L+k*O,m[3]=S*-L+z*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=s.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let m=0,g=0;for(let w=0;w<a.length;w++){const b=new s.pointGeometry(a[w][0]*this.width,d+a[w][1]*(this.height-d)),S=t.pointCoordinate(b);if(!S)continue;const k=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);m+=S[3]*k,g+=k}return g===0?NaN:m/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,m=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),w=Math.max(m-d,g);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const m=s.length(s.sub([],this._camera.position,d));return s.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!s.exactEquals(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];s.exactEquals$1(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new Wl;return a.position=new s.MercatorCoordinate(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!s.length$1(t))return!1;s.normalize$1(t,t);const a=s.transformQuat([],[0,0,-1],t),d=s.transformQuat([],[0,-1,0],t);if(d[2]<0)return!1;const m=No(a,d);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=s.clamp(t[2],m/d,m/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,d){this._unmodified=!1,this._edgeInsets.interpolate(t,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new s.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new s.pointGeometry(0,0)),m=this.pointCoordinate(new s.pointGeometry(this.width,0)),g=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new s.pointGeometry(0,this.height)),b=Math.floor(Math.min(d.x,m.x,g.x,w.x)),S=Math.floor(Math.max(d.x,m.x,g.x,w.x)),k=1;for(let z=b-k;z<=S+k;z++)z!==0&&a.push(new s.UnwrappedTileID(z,t))}return a}coveringTiles(t){let a=this.coveringZoomLevel(t);const d=a,m=this.elevation&&!t.isTerrainDEM,g=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const w=this.locationCoordinate(this.center),b=this.center.lat,S=1<<a,k=[S*w.x,S*w.y,0],z=this.projection.name==="globe",L=!z,O=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,L),j=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=S*s.mercatorZfromAltitude(1,this.center.lat),N=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),J=[S*j.x,S*j.y,N*(L?1:U)],$=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,q=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ee=t.isTerrainDEM?-q:this._elevation?this._elevation.getMinElevationBelowMSL():0,Z=this.projection.isReprojectedInTileSpace?Ma(this):1,Y=ge=>{const st=new s.MercatorCoordinate(ge.x+25e-6,ge.y,ge.z),qe=new s.MercatorCoordinate(ge.x,ge.y+25e-6,ge.z),rt=ge.toLngLat(),ot=st.toLngLat(),bt=qe.toLngLat(),mt=this.locationCoordinate(rt),Ye=this.locationCoordinate(ot),Ke=this.locationCoordinate(bt),zt=Math.hypot(Ye.x-mt.x,Ye.y-mt.y),Zt=Math.hypot(Ke.x-mt.x,Ke.y-mt.y);return Math.sqrt(zt*Zt)*Z/25e-6},oe=ge=>{const tt=q,st=ee;return{aabb:s.tileAABB(this,S,0,0,0,ge,st,tt,this.projection),zoom:0,x:0,y:0,minZ:st,maxZ:tt,wrap:ge,fullyVisible:!1}},Ee=[];let Me=[];const ke=a,$e=t.reparseOverscaled?d:a,ye=ge=>ge*ge,Be=ye((N-this._centerAltitude)*U),Pe=ge=>{if(!this._elevation||!ge.tileID||!g)return;const tt=this._elevation.getMinMaxForTile(ge.tileID),st=ge.aabb;tt?(st.min[2]=tt.min,st.max[2]=tt.max,st.center[2]=(st.min[2]+st.max[2])/2):(ge.shouldSplit=xe(ge),ge.shouldSplit||(st.min[2]=st.max[2]=st.center[2]=this._centerAltitude))},xe=ge=>{if(ge.zoom<K)return!0;if(ge.zoom===ke)return!1;if(ge.shouldSplit!=null)return ge.shouldSplit;const tt=ge.aabb.distanceX(J),st=ge.aabb.distanceY(J);let qe=Be,rt=1;if(z){qe=ye(ge.aabb.distanceZ(J));const bt=Math.pow(2,ge.zoom),mt=s.latFromMercatorY((ge.y+1)/bt),Ye=s.latFromMercatorY(ge.y/bt),Ke=Math.min(Math.max(b,mt),Ye),zt=s.circumferenceAtLatitude(Ke)/s.circumferenceAtLatitude(b);if(rt=Ke===b?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&ge.zoom===ke-1&&zt>=.9)return!0}else if(m&&(qe=ye(ge.aabb.distanceZ(J)*U)),this.projection.isReprojectedInTileSpace&&d<=5){const bt=Math.pow(2,ge.zoom),mt=Y(new s.MercatorCoordinate((ge.x+.5)/bt,(ge.y+.5)/bt));rt=mt>.85?1:mt}const ot=tt*tt+st*st+qe;return ot<ye((1<<ke-ge.zoom)*$*rt*((bt,mt)=>{if(mt*ye(.707)<bt)return 1;const Ye=Math.sqrt(mt/bt);return Ye/(1.4144271570014144+(Math.pow(1.1,Ye-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(qe,Be),ot))};if(this.renderWorldCopies)for(let ge=1;ge<=3;ge++)Ee.push(oe(-ge)),Ee.push(oe(ge));for(Ee.push(oe(0));Ee.length>0;){const ge=Ee.pop(),tt=ge.x,st=ge.y;let qe=ge.fullyVisible;if(!qe){const rt=ge.aabb.intersects(O);if(rt===0)continue;qe=rt===2}if(ge.zoom!==ke&&xe(ge))for(let rt=0;rt<4;rt++){const ot=(tt<<1)+rt%2,bt=(st<<1)+(rt>>1),mt={aabb:g?ge.aabb.quadrant(rt):s.tileAABB(this,S,ge.zoom+1,ot,bt,ge.wrap,ge.minZ,ge.maxZ,this.projection),zoom:ge.zoom+1,x:ot,y:bt,wrap:ge.wrap,fullyVisible:qe,tileID:void 0,shouldSplit:void 0,minZ:ge.minZ,maxZ:ge.maxZ};m&&!z&&(mt.tileID=new s.OverscaledTileID(ge.zoom+1===ke?$e:ge.zoom+1,ge.wrap,ge.zoom+1,ot,bt),Pe(mt)),Ee.push(mt)}else{const rt=ge.zoom===ke?$e:ge.zoom;if(t.minzoom&&t.minzoom>rt)continue;const ot=k[0]-(.5+tt+(ge.wrap<<ge.zoom))*(1<<a-ge.zoom),bt=k[1]-.5-st,mt=ge.tileID?ge.tileID:new s.OverscaledTileID(rt,ge.wrap,ge.zoom,tt,st);Me.push({tileID:mt,distanceSq:ot*ot+bt*bt})}}if(this.fogCullDistSq){const ge=this.fogCullDistSq,tt=this.horizonLineFromTop();Me=Me.filter(st=>{const qe=[0,0,0,1],rt=[s.EXTENT,s.EXTENT,0,1],ot=this.calculateFogTileMatrix(st.tileID.toUnwrapped());s.transformMat4$1(qe,qe,ot),s.transformMat4$1(rt,rt,ot);const bt=s.getAABBPointSquareDist(qe,rt);if(bt===0)return!0;let mt=!1;const Ye=this._elevation;if(Ye&&bt>ge&&tt!==0){const Ke=this.calculateProjMatrix(st.tileID.toUnwrapped());let zt;t.isTerrainDEM||(zt=Ye.getMinMaxForTile(st.tileID)),zt||(zt={min:ee,max:q});const Zt=s.furthestTileCorner(this.rotation),ri=[Zt[0]*s.EXTENT,Zt[1]*s.EXTENT,zt.max];s.transformMat4(ri,ri,Ke),mt=(1-ri[1])*this.height*.5<tt}return bt<ge||mt})}return Me.sort((ge,tt)=>ge.distanceSq-tt.distanceSq).map(ge=>ge.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=s.clamp(t.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),d=this.projection.project(t.lng,a);return new s.pointGeometry(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,a){let d,m;const g=this.centerPoint;if(this.projection.name==="globe"){const b=this.worldSize;d=(a.x-g.x)/b,m=(a.y-g.y)/b}else{const b=this.pointCoordinate(a),S=this.pointCoordinate(g);d=b.x-S.x,m=b.y-S.y}const w=this.locationCoordinate(t);this.setLocation(new s.MercatorCoordinate(w.x-d,w.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,a){const d=a?s.mercatorZfromAltitude(a,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new s.MercatorCoordinate(m.x,m.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const d=a!=null?a:this._centerAltitude,m=[t.x,t.y,0,1],g=[t.x,t.y,1,1];s.transformMat4$1(m,m,this.pixelMatrixInverse),s.transformMat4$1(g,g,this.pixelMatrixInverse);const w=g[3];s.scale$1(m,m,1/m[3]),s.scale$1(g,g,1/w);const b=m[2],S=g[2];return{p0:m,p1:g,t:b===S?0:(d-b)/(S-b)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return s.transformMat4$1(a,a,this.pixelMatrixInverse),s.transformMat4$1(d,d,this.pixelMatrixInverse),s.scale$1(a,a,1/a[3]),s.scale$1(d,d,1/d[3]),a[2]=s.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,d[2]=s.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,s.scale$1(a,a,1/this.worldSize),s.scale$1(d,d,1/this.worldSize),new s.Ray([a[0],a[1],a[2]],s.normalize([],s.sub([],d,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:d,t:m}=t,g=s.mercatorZfromAltitude(a[2],this._center.lat),w=s.mercatorZfromAltitude(d[2],this._center.lat);return new s.MercatorCoordinate(s.number(a[0],d[0],m)/this.worldSize,s.number(a[1],d[1],m)/this.worldSize,s.number(g,w,m))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let a=this.projection.pointCoordinate3D(this,t.x,t.y);if(a)return new s.MercatorCoordinate(a[0],a[1],a[2]);let d=0,m=this.horizonLineFromTop();if(t.y>m)return this.pointCoordinate(t);const g=.02*m,w=t.clone();for(let b=0;b<10&&m-d>g;b++){w.y=s.number(d,m,.66);const S=this.projection.pointCoordinate3D(this,w.x,w.y);S?(m=w.y,a=S):d=w.y}return a?new s.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}_coordinatePoint(t,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return s.transformMat4$1(m,m,this.pixelMatrix),m[3]>0?new s.pointGeometry(m[0]/m[3],m[1]/m[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,a){const d=new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),g=new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),w=new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let b=this.pointCoordinate(d,t),S=this.pointCoordinate(m,t);const k=this.pointCoordinate(g,a),z=this.pointCoordinate(w,a),L=(O,j)=>(j.y-O.y)/(j.x-O.x);return b.y>1&&S.y>=0?b=new s.MercatorCoordinate((1-z.y)/L(z,b)+z.x,1):b.y<0&&S.y<=1&&(b=new s.MercatorCoordinate(-z.y/L(z,b)+z.x,0)),S.y>1&&b.y>=0?S=new s.MercatorCoordinate((1-k.y)/L(k,S)+k.x,1):S.y<0&&b.y<=1&&(S=new s.MercatorCoordinate(-k.y/L(k,S)+k.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(b)).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(k))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const a=t.visibleDemTiles.reduce((d,m)=>{if(m.dem){const g=m.dem.tree;d.min=Math.min(d.min,g.minimums[0]),d.max=Math.max(d.max,g.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,d=this._distanceTileDataCache;if(d[a])return d[a];const m=t.canonical,g=1/this.height,w=this.cameraWorldSize/this.zoomScale(m.z),b=(m.x+Math.pow(2,m.z)*t.wrap)*w,S=m.y*w,k=this.point,z=this.angle,L=Math.sin(-z),O=-Math.cos(-z);return d[a]={bearing:[L,O],center:[(k.x-b)*g,(k.y-S)*g],scale:w/s.EXTENT*g},d[a]}calculateFogTileMatrix(t){const a=t.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const m=this.projection.createTileMatrix(this,this.cameraWorldSize,t);return s.multiply(m,this.worldToFogMatrix,m),d[a]=new Float32Array(m),d[a]}calculateProjMatrix(t,a=!1){const d=t.key,m=a?this._alignedProjMatrixCache:this._projMatrixCache;if(m[d])return m[d];const g=this.calculatePosMatrix(t,this.worldSize);return s.multiply(g,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,g),m[d]=new Float32Array(g),m[d]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const m=function(g,w){const{scale:b}=g.tileTransform,S=b*s.EXTENT/(g.tileSize*Math.pow(2,w.zoom-g.tileID.overscaledZ+g.tileID.canonical.z));return k=new Float32Array(4),O=(z=w.inverseAdjustmentMatrix)[1],j=z[2],U=z[3],J=(L=[S,S])[1],k[0]=z[0]*(N=L[0]),k[1]=O*N,k[2]=j*J,k[3]=U*J,k;var k,z,L,O,j,U,N,J}(t,this);return d[a]=m,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),m=this._camera.forward(),g=s.mercatorZfromAltitude(1,this._center.lat);d[2]/=g,m[2]/=g,s.normalize(m,m);const w=t.raycast(d,m,t.exaggeration());if(w){const b=s.scaleAndAdd([],d,m,w),S=new s.MercatorCoordinate(b[0],b[1],s.mercatorZfromAltitude(b[2],s.latFromMercatorY(b[1]))),k=(S.z+s.length([S.x-d[0],S.y-d[1],S.z-d[2]*g]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),m=t.getAtPointOrZero(new s.MercatorCoordinate(...d)),g=this._minimumHeightOverTerrain()*Math.cos(s.degToRad(this._maxPitch)),w=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*m;if(w<g){const b=this.locationCoordinate(this._center,this._centerAltitude),S=[b.x-d[0],b.y-d[1],b.z-d[2]],k=s.length(S);S[2]-=(g-w)/this._projectionScaler;const z=s.length(S);if(z===0)return;s.scale$2(S,S,k/z*this._projectionScaler),this._camera.position=[b.x-S[0],b.y-S[1],b.z*this._projectionScaler-S[2]],this._camera.orientation=No(S,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const L=this.center;return L.lat=s.clamp(L.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(L.lng=s.clamp(L.lng,this.minLng,this.maxLng)),this.center=L,void(this._constraining=!1)}const t=this._unmodified,{x:a,y:d}=this.point;let m=0,g=a,w=d;const b=this.width/2,S=this.height/2,k=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(d-S<k&&(w=k+S),d+S>z&&(w=z-S),z-k<this.height&&(m=Math.max(m,this.height/(z-k)),w=(z+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const L=this.worldMinX*this.scale,O=this.worldMaxX*this.scale,j=this.worldSize/2-(L+O)/2;g=(a+j+this.worldSize)%this.worldSize-j,g-b<L&&(g=L+b),g+b>O&&(g=O-b),O-L<this.width&&(m=Math.max(m,this.width/(O-L)),g=(O+L)/2)}g===a&&w===d||(this.center=this.unproject(new s.pointGeometry(g,w))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this._fov/2,a=this.centerOffset,d=this.pixelsPerMeter;if(this.projection.name!=="globe")this._projectionScaler=d/(s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize);else{const Z=s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize,Y=s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,oe=ws(this,1024),Ee=s.number(Z,Y,oe);this._projectionScaler=d/Ee,this._mercatorScaleRatio=Y/Z}this.cameraToCenterDistance=.5/Math.tan(t)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?d:1),g=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);g[8]=2*-a.x/this.width,g[9]=2*a.y/this.height;let w=s.mul([],g,m);if(this.projection.isReprojectedInTileSpace){const Z=this.locationCoordinate(this.center),Y=s.identity([]);s.translate(Y,Y,[Z.x*this.worldSize,Z.y*this.worldSize,0]),s.multiply(Y,Y,Su(this)),s.translate(Y,Y,[-Z.x*this.worldSize,-Z.y*this.worldSize,0]),s.multiply(w,w,Y),this.inverseAdjustmentMatrix=function(oe){const Ee=Su(oe,!0);return ii([],[Ee[0],Ee[1],Ee[4],Ee[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],w,[this.worldSize,this.worldSize,this.worldSize/d,1]),this.projMatrix=w,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const b=s.invert([],g);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(b,this.horizonLineFromTop(),this.height);const S=new Float32Array(16);s.identity(S),s.scale(S,S,[1,-1,1]),s.rotateX(S,S,this._pitch),s.rotateZ(S,S,this.angle);const k=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-a.x/this.width,k[9]=2*(a.y+z)/this.height,this.skyboxMatrix=s.multiply(S,k,S);const L=this.point,O=L.x,j=L.y,U=this.width%2/2,N=this.height%2/2,J=Math.cos(this.angle),$=Math.sin(this.angle),K=O-Math.round(O)+J*U+$*N,q=j-Math.round(j)+J*N+$*U,ee=new Float64Array(w);if(s.translate(ee,ee,[K>.5?K-1:K,q>.5?q-1:q,0]),this.alignedProjMatrix=ee,w=s.create(),s.scale(w,w,[this.width/2,-this.height/2,1]),s.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=s.create(),s.scale(w,w,[1,-1,1]),s.translate(w,w,[-1,-1,0]),s.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},w=s.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=w,this.projection.name==="globe"){this.globeMatrix=s.calculateGlobeMatrix(this);const Z=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(Z,Z,m),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=w;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,a=this.cameraPixelsPerMeter,d=this._camera.position,m=1/this.height/this._projectionScaler,g=[t,t,a];s.scale$2(g,g,m),s.scale$2(d,d,-1),s.multiply$2(d,d,g);const w=s.create();s.translate(w,w,d),s.scale(w,w,g),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,m)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),m=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-d[0]*g,m.y/this.worldSize-d[1]*g,t/this.worldSize*this._centerAltitude-d[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=t[2];let m=1;d>0&&(m=Math.min((a-this._camera.position[2])/d,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,t,m),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:m}=this._camera.getPitchBearing(),g=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),b=Math.max((t[2]-g)/Math.cos(d),w),S=this._zoomFromMercatorZ(b);s.scaleAndAdd(t,t,a,b),this._pitch=s.clamp(d,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(m,-Math.PI,Math.PI),this._setZoom(s.clamp(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const d=Math.min(t.x,a.x),m=Math.max(t.x,a.x),g=Math.min(t.y,a.y),w=Math.max(t.y,a.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const b=[new s.pointGeometry(d,g),new s.pointGeometry(m,w),new s.pointGeometry(d,w),new s.pointGeometry(m,g)],S=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const z of b){const L=this.pointRayIntersection(z);if(L.t<0)return!0;const O=this.rayIntersectionCoordinate(L);if(O.x<S||O.y<0||O.x>k||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,a){const d=s.length(s.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function(a,d){const m=[a[0],a[1],a[2],1];s.transformMat4$1(m,m,d);const g=Math.max(m[3],1e-6);return[m[0]/g,m[1]/g,m[2]/g,g]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,t))}}}function Au(u,t){let a=!1,d=null;const m=()=>{d=null,a&&(u(),d=setTimeout(m,t),a=!1)};return()=>(a=!0,d||m(),d)}class bs{constructor(t){this._hashName=t&&encodeURIComponent(t),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Au(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,s.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const a=this._map;if(!a)return"";const d=a.getCenter(),m=Math.round(100*a.getZoom())/100,g=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),b=Math.round(d.lng*w)/w,S=Math.round(d.lat*w)/w,k=a.getBearing(),z=a.getPitch();let L="";if(L+=t?`/${b}/${S}/${m}`:`${m}/${S}/${b}`,(k||z)&&(L+="/"+Math.round(10*k)/10),z&&(L+=`/${Math.round(z)}`),this._hashName){const O=this._hashName;let j=!1;const U=s.window.location.hash.slice(1).split("&").map(N=>{const J=N.split("=")[0];return J===O?(j=!0,`${J}=${L}`):N}).filter(N=>N);return j||U.push(`${O}=${L}`),`#${U.join("&")}`}return`#${L}`}_getCurrentHash(){const t=s.window.location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,t)}}const za={linearity:.3,easing:s.bezier(0,0,.3,1)},Hl=s.extend({deceleration:2500,maxSpeed:1400},za),Iu=s.extend({deceleration:20,maxSpeed:1400},za),Yl=s.extend({deceleration:1e3,maxSpeed:360},za),Ld=s.extend({deceleration:1e3,maxSpeed:90},za);class Bd{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=s.exported.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(a.pan.mag()){const g=Kl(a.pan.mag(),d,s.extend({},Hl,t||{}));m.offset=a.pan.mult(g.amount/a.pan.mag()),m.center=this._map.transform.center,Zr(m,g)}if(a.zoom){const g=Kl(a.zoom,d,Iu);m.zoom=this._map.transform.zoom+g.amount,Zr(m,g)}if(a.bearing){const g=Kl(a.bearing,d,Yl);m.bearing=this._map.transform.bearing+s.clamp(g.amount,-179,179),Zr(m,g)}if(a.pitch){const g=Kl(a.pitch,d,Ld);m.pitch=this._map.transform.pitch+g.amount,Zr(m,g)}if(m.zoom||m.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;m.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Zr(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Kl(u,t,a){const{maxSpeed:d,linearity:m,deceleration:g}=a,w=s.clamp(u*m/(t/1e3),-d,d),b=Math.abs(w)/(g*m);return{easing:a.easing,duration:1e3*b,amount:w*(b/2)}}class Ln extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d,m={}){const g=Fe(a.getCanvasContainer(),d),w=a.unproject(g);super(t,s.extend({point:g,lngLat:w,originalEvent:d},m)),this._defaultPrevented=!1,this.target=a}}class Pa extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){const m=t==="touchend"?d.changedTouches:d.touches,g=ct(a.getCanvasContainer(),m),w=g.map(S=>a.unproject(S)),b=g.reduce((S,k,z,L)=>S.add(k.div(L.length)),new s.pointGeometry(0,0));super(t,{points:g,point:b,lngLats:w,lngLat:a.unproject(b),originalEvent:d}),this._defaultPrevented=!1}}class Jl extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){super(t,{originalEvent:d}),this._defaultPrevented=!1}}class ku{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Jl(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Ln(t.type,this._map,t))}mouseup(t){this._map.fire(new Ln(t.type,this._map,t))}preclick(t){const a=s.extend({},t);a.type="preclick",this._map.fire(new Ln(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Ln(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Ln(t.type,this._map,t))}mouseover(t){this._map.fire(new Ln(t.type,this._map,t))}mouseout(t){this._map.fire(new Ln(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Pa(t.type,this._map,t))}touchmove(t){this._map.fire(new Pa(t.type,this._map,t))}touchend(t){this._map.fire(new Pa(t.type,this._map,t))}touchcancel(t){this._map.fire(new Pa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rd{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Ln(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Ln(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fd{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(ve(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const d=a;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=de("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(m.x,d.x),w=Math.max(m.x,d.x),b=Math.min(m.y,d.y),S=Math.max(m.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${g}px,${b}px)`,this._box.style.width=w-g+"px",this._box.style.height=S-b+"px")})}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const d=this._startPos,m=a;if(this.reset(),Ze(),d.x!==m.x||d.y!==m.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(d,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),he(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new s.Event(t,{originalEvent:a}))}}function Ts(u,t){const a={};for(let d=0;d<u.length;d++)a[u[d].identifier]=t[d];return a}class Mu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const g=new s.pointGeometry(0,0);for(const w of m)g._add(w);return g.div(m.length)}(a),this.touches=Ts(d,a)))}touchmove(t,a,d){if(this.aborted||!this.centroid)return;const m=Ts(d,a);for(const g in this.touches){const w=this.touches[g],b=m[g];(!b||b.dist(w)>30)&&(this.aborted=!0)}}touchend(t,a,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ql{constructor(t){this.singleTap=new Mu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,d){this.singleTap.touchstart(t,a,d)}touchmove(t,a,d){this.singleTap.touchmove(t,a,d)}touchend(t,a,d){const m=this.singleTap.touchend(t,a,d);if(m){const g=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(g&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Od{constructor(){this._zoomIn=new Ql({numTouches:1,numTaps:2}),this._zoomOut=new Ql({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,d){this._zoomIn.touchstart(t,a,d),this._zoomOut.touchstart(t,a,d)}touchmove(t,a,d){this._zoomIn.touchmove(t,a,d),this._zoomOut.touchmove(t,a,d)}touchend(t,a,d){const m=this._zoomIn.touchend(t,a,d),g=this._zoomOut.touchend(t,a,d);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(m)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Nd={0:1,2:2};class ec{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const d=ut(t);this._correctButton(t,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(t,a){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(m,g){const w=Nd[g];return m.buttons===void 0||(m.buttons&w)!==w}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(t){this._lastPoint&&ut(t)===this._eventButton&&(this._moved&&Ze(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ud extends ec{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class Uo extends ec{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const d=.8*(a.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){t.preventDefault()}}class zu extends ec{_correctButton(t,a){return a===0&&t.ctrlKey||a===2}_move(t,a){const d=-.5*(a.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){t.preventDefault()}}class jd{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(t,a,d){return this._calculateTransform(t,a,d)}touchmove(t,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,a,d)}}touchend(t,a,d){this._calculateTransform(t,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,d){d.length>0&&(this._active=!0);const m=Ts(d,a),g=new s.pointGeometry(0,0),w=new s.pointGeometry(0,0);let b=0;for(const k in m){const z=m[k],L=this._touches[k];L&&(g._add(z),w._add(z.sub(L)),b++,m[k]=z)}if(this._touches=m,b<this._minTouches||!w.mag())return;const S=w.div(b);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(b),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=de("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class tc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,d){return{}}touchstart(t,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,d){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[g,w]=m,b=Da(d,a,g),S=Da(d,a,w);if(!b||!S)return;const k=this._aroundCenter?null:b.add(S).div(2);return this._move([b,S],k,t)}touchend(t,a,d){if(!this._firstTwoTouches)return;const[m,g]=this._firstTwoTouches,w=Da(d,a,m),b=Da(d,a,g);w&&b||(this._active&&Ze(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Da(u,t,a){for(let d=0;d<u.length;d++)if(u[d].identifier===a)return t[d]}function Pu(u,t){return Math.log(u/t)/Math.LN2}class Vd extends tc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Pu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pu(this._distance,d),pinchAround:a}}}function Yi(u,t){return 180*u.angleWith(t)/Math.PI}class vm extends tc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const d=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Yi(this._vector,d),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,d=Yi(t,this._startVector);return Math.abs(d)<a}}function ic(u){return Math.abs(u.y)>Math.abs(u.x)}class wm extends tc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ic(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,d){const m=this._lastPoints;if(!m)return;const g=t[0].sub(m[0]),w=t[1].sub(m[1]);return this._map._cooperativeGestures&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(g,w,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+w.y)/2*-.5})}gestureBeginsVertically(t,a,d){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,g=a.mag()>=2;if(!m&&!g)return;if(!m||!g)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const w=t.y>0==a.y>0;return ic(t)&&ic(a)&&w}}const bm={panStep:100,bearingStep:15,pitchStep:10};class qr{constructor(){const t=bm;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,d=0,m=0,g=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:b=>{const S=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:Gd,zoom:a?Math.round(S)+a*(t.shiftKey?2:1):S,bearing:b.getBearing()+d*this._bearingStep,pitch:b.getPitch()+m*this._pitchStep,offset:[-g*this._panStep,-w*this._panStep],center:b.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gd(u){return u*(2-u)}const jo=4.000244140625;class Tr{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=s.exported.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%jo==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Fe(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>jo?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&k!==0&&(k=1/k);const z=a(),L=Math.pow(2,z),O=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):L;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(O*k))),this._type==="wheel"&&(this._startZoom=a(),this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),m=this._startZoom,g=this._easing;let w,b=!1;if(this._type==="wheel"&&m&&g){const S=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),k=g(S);w=s.number(m,d,k),S<1?this._frameId||(this._frameId=!0):b=!0}else w=d,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:w-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=s.ease;if(this._prevEase){const d=this._prevEase,m=(s.exported.now()-d.start)/d.duration,g=d.easing(m+.01)-d.easing(m),w=.27/Math.sqrt(g*g+1e-4)*.01,b=Math.sqrt(.0729-w*w);a=s.bezier(w,b,.25,1)}return this._prevEase={start:s.exported.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=de("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!s.window.document.fullscreenElement||!!s.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class nc{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class it{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $d{constructor(){this._tap=new Ql({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,a,d))}touchmove(t,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=a[0],g=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,a,d)}touchend(t,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,a,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zd{constructor(t,a,d){this._el=t,this._mousePan=a,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class La{constructor(t,a,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ba{constructor(t,a,d,m){this._el=t,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ra=u=>u.zoom||u.drag||u.pitch||u.rotate;class qd extends s.Event{}class Wd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const d=s.sub([],a,t);this.radius=s.length(d[2]<0?s.div([],d,this.constants):[d[0],d[1],0])}projectRay(t){s.div(t,t,this.constants),s.normalize(t,t),s.mul$1(t,t,this.constants);const a=s.scale$2([],t,this.radius);if(a[2]>0){const d=s.scale$2([],[0,0,1],s.dot(a,[0,0,1])),m=s.scale$2([],s.normalize([],[a[0],a[1],0]),this.radius),g=s.add([],a,s.scale$2([],s.sub([],s.add([],m,d),a),2));a[0]=g[0],a[1]=g[1]}return a}}function Fa(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Xd{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Bd(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[m,g,w]of this._listeners)m.addEventListener(g,m===s.window.document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,a,d]of this._listeners)t.removeEventListener(a,t===s.window.document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(t){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new ku(a,t));const m=a.boxZoom=new Fd(a,t);this._add("boxZoom",m);const g=new Od,w=new it;a.doubleClickZoom=new nc(w,g),this._add("tapZoom",g),this._add("clickZoom",w);const b=new $d;this._add("tapDragZoom",b);const S=a.touchPitch=new wm(a);this._add("touchPitch",S);const k=new Uo(t),z=new zu(t);a.dragRotate=new La(t,k,z),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const L=new Ud(t),O=new jd(a,t);a.dragPan=new Zd(d,L,O),this._add("mousePan",L),this._add("touchPan",O,["touchZoom","touchRotate"]);const j=new vm,U=new Vd;a.touchZoomRotate=new Ba(d,U,j,b),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Rd(a));const N=a.scrollZoom=new Tr(a,this);this._add("scrollZoom",N,["mousePan"]);const J=a.keyboard=new qr;this._add("keyboard",J);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[$]&&a[$].enable(t[$])}_add(t,a,d){this._handlers.push({handlerName:t,handler:a,allowed:d}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ra(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,d){for(const m in t)if(m!==d&&(!a||a.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const d of t)this._el.contains(d.target)&&a.push(d);return a}handleEvent(t,a){this._updatingCamera=!0;const d=t.type==="renderFrame",m=d?void 0:t,g={needsRenderFrame:!1},w={},b={},S=t.touches?this._getMapTouches(t.touches):void 0,k=S?ct(this._el,S):d?void 0:Fe(this._el,t);for(const{handlerName:O,handler:j,allowed:U}of this._handlers){if(!j.isEnabled())continue;let N;this._blockedByActive(b,U,O)?j.reset():j[a||t.type]&&(N=j[a||t.type](t,k,S),this.mergeHandlerResult(g,w,N,O,m),N&&N.needsRenderFrame&&this._triggerRenderFrame()),(N||j.isActive())&&(b[O]=j)}const z={};for(const O in this._previousActiveHandlers)b[O]||(z[O]=m);this._previousActiveHandlers=b,(Object.keys(z).length||Fa(g))&&(this._changes.push([g,w,z]),this._triggerRenderFrame()),(Object.keys(b).length||Fa(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=g;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(t,a,d,m,g){if(!d)return;s.extend(t,d);const w={handlerName:m,originalEvent:d.originalEvent||g};d.zoomDelta!==void 0&&(a.zoom=w),d.panDelta!==void 0&&(a.drag=w),d.pitchDelta!==void 0&&(a.pitch=w),d.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const t={},a={},d={};for(const[m,g,w]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new s.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),s.extend(a,g),s.extend(d,w);this._updateMapTransform(t,a,d),this._changes=[]}_updateMapTransform(t,a,d){const m=this._map,g=m.transform,w=K=>[K.x,K.y,K.z];if((K=>{const q=this._eventsInProgress.drag;return q&&!this._handlersById[q.handlerName].isActive()})()&&!Fa(t)){const K=g.zoom;g.cameraElevationReference="sea",g.recenterOnTerrain(),g.cameraElevationReference="ground",K!==g.zoom&&this._map._update(!0)}if(!Fa(t))return void this._fireEvents(a,d,!0);let{panDelta:b,zoomDelta:S,bearingDelta:k,pitchDelta:z,around:L,aroundCoord:O,pinchAround:j}=t;j!==void 0&&(L=j),(K=>a.drag&&!this._eventsInProgress.drag)()&&L&&(this._dragOrigin=w(g.pointCoordinate3D(L)),this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",m._stop(!0),L=L||m.transform.centerPoint,k&&(g.bearing+=k),z&&(g.pitch+=z),g._updateCameraState();const U=[0,0,0];if(b){const K=g.pointCoordinate(L);if(g.projection.name==="globe"){const q=s.latFromMercatorY(K.y),ee=g.center.lat,Z=Math.min(s.mercatorZfromAltitude(1,q)/s.mercatorZfromAltitude(1,ee),2);b=b.rotate(-g.angle),U[0]=-b.x/g.worldSize*Z,U[1]=-b.y/g.worldSize*Z}else{const q=g.pointCoordinate(L.sub(b));K&&q&&(U[0]=q.x-K.x,U[1]=q.y-K.y)}}const N=g.zoom,J=[0,0,0];if(S){const K=w(O||g.pointCoordinate3D(L)),q={dir:s.normalize([],s.sub([],K,g._camera.position))};if(q.dir[2]<0){const ee=g.zoomDeltaToMovement(K,S);s.scale$2(J,q.dir,ee)}}const $=s.add(U,U,J);g._translateCameraConstrained($),S&&Math.abs(g.zoom-N)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,d,!0)}_fireEvents(t,a,d){const m=Ra(this._eventsInProgress),g=Ra(t),w={};for(const z in t){const{originalEvent:L}=t[z];this._eventsInProgress[z]||(w[`${z}start`]=L),this._eventsInProgress[z]=t[z]}!m&&g&&this._fireEvent("movestart",g.originalEvent);for(const z in w)this._fireEvent(z,w[z]);g&&this._fireEvent("move",g.originalEvent);for(const z in t){const{originalEvent:L}=t[z];this._fireEvent(z,L)}const b={};let S;for(const z in this._eventsInProgress){const{handlerName:L,originalEvent:O}=this._eventsInProgress[z];this._handlersById[L].isActive()||(delete this._eventsInProgress[z],S=a[L]||O,b[`${z}end`]=S)}for(const z in b)this._fireEvent(z,b[z]);const k=Ra(this._eventsInProgress);if(d&&(m||g)&&!k){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;z?(L(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:S})):(this._map.fire(new s.Event("moveend",{originalEvent:S})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new s.Event(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new qd("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Du="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Hd extends s.Evented{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,d){return t=s.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,s.extend({offset:t},a),d)}panTo(t,a,d){return this.easeTo(s.extend({center:t},a),d)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,d){return this.easeTo(s.extend({zoom:t},a),d)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,d){return this.easeTo(s.extend({bearing:t},a),d)}resetNorth(t,a){return this.rotateTo(0,s.extend({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){if(this.transform.projection.name==="globe")return void s.warnOnce("Globe projection does not support cameraForBounds API");t=s.LngLatBounds.convert(t);const d=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),d,a)}_extendCameraOptions(t){const a={top:0,bottom:0,right:0,left:0};if(typeof(t=s.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const d=t.padding;t.padding={top:d,bottom:d,right:d,left:d}}return t.padding=s.extend(a,t.padding),t}_cameraForBoxAndBearing(t,a,d,m){const g=this._extendCameraOptions(m),w=this.transform,b=w.padding,S=w.project(s.LngLat.convert(t)),k=w.project(s.LngLat.convert(a)),z=new s.pointGeometry(S.x,k.y),L=new s.pointGeometry(k.x,S.y),O=-s.degToRad(d),j=S.rotate(O),U=k.rotate(O),N=z.rotate(O),J=L.rotate(O),$=new s.pointGeometry(Math.max(j.x,U.x,N.x,J.x),Math.max(j.y,U.y,N.y,J.y)),K=new s.pointGeometry(Math.min(j.x,U.x,N.x,J.x),Math.min(j.y,U.y,N.y,J.y)),q=$.sub(K),ee=(w.width-((b.left||0)+(b.right||0)+g.padding.left+g.padding.right))/q.x,Z=(w.height-((b.top||0)+(b.bottom||0)+g.padding.top+g.padding.bottom))/q.y;if(Z<0||ee<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Y=Math.min(w.scaleZoom(w.scale*Math.min(ee,Z)),g.maxZoom),oe=typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new s.pointGeometry(g.offset.x,g.offset.y):s.pointGeometry.convert(g.offset),Ee=new s.pointGeometry((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(d*Math.PI/180),Me=oe.add(Ee).mult(w.scale/w.zoomScale(Y));return{center:w.unproject(S.add(k).div(2).sub(Me)),zoom:Y,bearing:d}}_cameraForBox(t,a,d,m,g){const w=this._extendCameraOptions(g);d=d||0,m=m||0,t=s.LngLat.convert(t),a=s.LngLat.convert(a);const b=this.transform.clone();b.padding=w.padding;const S=this.getFreeCameraOptions(),k=new s.LngLat(.5*(t.lng+a.lng),.5*(t.lat+a.lat)),z=.5*(d+m);if(b._camera.position[2]<s.mercatorZfromAltitude(z,k.lat))return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");S.lookAtPoint(k),b.setFreeCameraOptions(S);const L=s.MercatorCoordinate.fromLngLat(t),O=s.MercatorCoordinate.fromLngLat(a),j=b.pointRayIntersection(b.centerPoint,z),U=[(N=b.rayIntersectionCoordinate(j)).x,N.y,N.z];var N;const J=b.screenPointToMercatorRay(b.centerPoint),$=b.projection.name!=="globe";let K,q=0;do{const ee=Math.floor(b.zoom),Z=1<<ee,Y=Math.min(Z*L.x,Z*O.x),oe=Math.min(Z*L.y,Z*O.y),Ee=Math.max(Z*L.x,Z*O.x),Me=Math.max(Z*L.y,Z*O.y),ke=new s.Aabb([Y,oe,d],[Ee,Me,m]),$e=s.Frustum.fromInvProjectionMatrix(b.invProjMatrix,b.worldSize,ee,$);if(ke.intersects($e)!==2){K&&(b._camera.position=s.scaleAndAdd([],b._camera.position,J.dir,-K),b._updateStateFromCamera());break}const ye=s.sub([],b._camera.position,U);K=.5*s.length(ye),b._camera.position=s.scaleAndAdd([],b._camera.position,J.dir,K);try{b._updateStateFromCamera()}catch{return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++q<10);return{center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}}fitBounds(t,a,d){return this.transform.projection.name==="globe"?(s.warnOnce("Globe projection does not support fitBounds API"),this):this._fitInternal(this.cameraForBounds(t,a),a,d)}_raycastElevationBox(t,a){const d=this.transform.elevation;if(!d)return;const m=new s.pointGeometry(t.x,a.y),g=new s.pointGeometry(a.x,t.y),w=d.pointCoordinate(t);if(!w)return;const b=d.pointCoordinate(a);if(!b)return;const S=d.pointCoordinate(m);if(!S)return;const k=d.pointCoordinate(g);if(!k)return;const z=new s.MercatorCoordinate(w[0],w[1]).toLngLat(),L=new s.MercatorCoordinate(b[0],b[1]).toLngLat(),O=new s.MercatorCoordinate(S[0],S[1]).toLngLat(),j=new s.MercatorCoordinate(k[0],k[1]).toLngLat(),U=Math.min(z.lng,Math.min(L.lng,Math.min(O.lng,j.lng))),N=Math.min(z.lat,Math.min(L.lat,Math.min(O.lat,j.lat))),J=Math.max(z.lng,Math.max(L.lng,Math.max(O.lng,j.lng))),$=Math.max(z.lat,Math.max(L.lat,Math.max(O.lat,j.lat))),K=Math.min(w[3],Math.min(b[3],Math.min(S[3],k[3]))),q=Math.max(w[3],Math.max(b[3],Math.max(S[3],k[3])));return{minLngLat:new s.LngLat(U,N),maxLngLat:new s.LngLat(J,$),minAltitude:K,maxAltitude:q}}fitScreenCoordinates(t,a,d,m,g){if(this.transform.projection.name==="globe")return s.warnOnce("Globe projection does not support fitScreenCoordinates API"),this;let w,b,S,k;const z=s.pointGeometry.convert(t),L=s.pointGeometry.convert(a),O=this._raycastElevationBox(z,L);if(O)w=O.minLngLat,b=O.maxLngLat,S=O.minAltitude,k=O.maxAltitude;else{if(this.transform.anyCornerOffEdge(z,L))return this;w=this.transform.pointLocation(z),b=this.transform.pointLocation(L)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(t)),this.transform.pointLocation(s.pointGeometry.convert(a)),d,m):this._cameraForBox(w,b,S,k,m),m,g)}_fitInternal(t,a,d){return t?(delete(a=s.extend(t,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(t,a){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let m=!1,g=!1,w=!1;return"zoom"in t&&d.zoom!==+t.zoom&&(m=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=s.LngLat.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(g=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(w=!0,d.pitch=+t.pitch),t.padding==null||d.isPaddingEqual(t.padding)||(d.padding=t.padding),t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),m&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),g&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),w&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Du),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return s.warnOnce(Du),this;this.stop();const m=d.zoom,g=d.pitch,w=d.bearing;d.setFreeCameraOptions(t);const b=m!==d.zoom,S=g!==d.pitch,k=w!==d.bearing;return this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),b&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),k&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),S&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=s.extend({offset:[0,0],duration:500,easing:s.ease},t)).animate===!1||!t.essential&&s.exported.prefersReducedMotion)&&(t.duration=0);const d=this.transform,m=this.getZoom(),g=this.getBearing(),w=this.getPitch(),b=this.getPadding(),S="zoom"in t?+t.zoom:m,k="bearing"in t?this._normalizeBearing(t.bearing,g):g,z="pitch"in t?+t.pitch:w,L="padding"in t?t.padding:d.padding,O=s.pointGeometry.convert(t.offset);let j,U,N;if(d.projection.name==="globe"){const Me=s.MercatorCoordinate.fromLngLat(d.center),ke=O.rotate(-d.angle);Me.x+=ke.x/d.worldSize,Me.y+=ke.y/d.worldSize;const $e=Me.toLngLat(),ye=s.LngLat.convert(t.center||$e);this._normalizeCenter(ye),j=d.centerPoint.add(ke),U=new s.pointGeometry(Me.x,Me.y).mult(d.worldSize),N=new s.pointGeometry(s.mercatorXfromLng(ye.lng),s.mercatorYfromLat(ye.lat)).mult(d.worldSize).sub(U)}else{j=d.centerPoint.add(O);const Me=d.pointLocation(j),ke=s.LngLat.convert(t.center||Me);this._normalizeCenter(ke),U=d.project(Me),N=d.project(ke).sub(U)}const J=d.zoomScale(S-m);let $,K;t.around&&($=s.LngLat.convert(t.around),K=d.locationPoint($));const q=this._zooming||S!==m,ee=this._rotating||g!==k,Z=this._pitching||z!==w,Y=!d.isPaddingEqual(L),oe=Me=>ke=>{if(q&&(Me.zoom=s.number(m,S,ke)),ee&&(Me.bearing=s.number(g,k,ke)),Z&&(Me.pitch=s.number(w,z,ke)),Y&&(Me.interpolatePadding(b,L,ke),j=Me.centerPoint.add(O)),$)Me.setLocationAtPoint($,K);else{const $e=Me.zoomScale(Me.zoom-m),ye=S>m?Math.min(2,J):Math.max(.5,J),Be=Math.pow(ye,1-ke),Pe=Me.unproject(U.add(N.mult(ke*Be)).mult($e));Me.setLocationAtPoint(Me.renderWorldCopies?Pe.wrap():Pe,j)}return t.preloadOnly||this._fireMoveEvents(a),Me};if(t.preloadOnly){const Me=this._emulate(oe,t.duration,d);return this._preloadTiles(Me),this}const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=q,this._rotating=ee,this._pitching=Z,this._padding=Y,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Ee),this._ease(oe(d),Me=>{d.recenterOnTerrain(),this._afterEase(a,Me)},t),this}_prepareEase(t,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||d.moving||this.fire(new s.Event("movestart",t)),this._zooming&&!d.zooming&&this.fire(new s.Event("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new s.Event("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new s.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.Event("move",t)),this._zooming&&this.fire(new s.Event("zoom",t)),this._rotating&&this.fire(new s.Event("rotate",t)),this._pitching&&this.fire(new s.Event("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,m=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new s.Event("zoomend",t)),m&&this.fire(new s.Event("rotateend",t)),g&&this.fire(new s.Event("pitchend",t)),this.fire(new s.Event("moveend",t))}flyTo(t,a){if(!t.essential&&s.exported.prefersReducedMotion){const qe=s.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qe,a)}this.stop(),t=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},t);const d=this.transform,m=this.getZoom(),g=this.getBearing(),w=this.getPitch(),b=this.getPadding(),S="zoom"in t?s.clamp(+t.zoom,d.minZoom,d.maxZoom):m,k="bearing"in t?this._normalizeBearing(t.bearing,g):g,z="pitch"in t?+t.pitch:w,L="padding"in t?t.padding:d.padding,O=d.zoomScale(S-m),j=s.pointGeometry.convert(t.offset);let U=d.centerPoint.add(j);const N=d.pointLocation(U),J=s.LngLat.convert(t.center||N);this._normalizeCenter(J);const $=d.project(N),K=d.project(J).sub($);let q=t.curve;const ee=Math.max(d.width,d.height),Z=ee/O,Y=K.mag();if("minZoom"in t){const qe=s.clamp(Math.min(t.minZoom,m,S),d.minZoom,d.maxZoom),rt=ee/d.zoomScale(qe-m);q=Math.sqrt(rt/Y*2)}const oe=q*q;function Ee(qe){const rt=(Z*Z-ee*ee+(qe?-1:1)*oe*oe*Y*Y)/(2*(qe?Z:ee)*oe*Y);return Math.log(Math.sqrt(rt*rt+1)-rt)}function Me(qe){return(Math.exp(qe)-Math.exp(-qe))/2}function ke(qe){return(Math.exp(qe)+Math.exp(-qe))/2}const $e=Ee(0);let ye=function(qe){return ke($e)/ke($e+q*qe)},Be=function(qe){return ee*((ke($e)*(Me(rt=$e+q*qe)/ke(rt))-Me($e))/oe)/Y;var rt},Pe=(Ee(1)-$e)/q;if(Math.abs(Y)<1e-6||!isFinite(Pe)){if(Math.abs(ee-Z)<1e-6)return this.easeTo(t,a);const qe=Z<ee?-1:1;Pe=Math.abs(Math.log(Z/ee))/q,Be=function(){return 0},ye=function(rt){return Math.exp(qe*q*rt)}}t.duration="duration"in t?+t.duration:1e3*Pe/("screenSpeed"in t?+t.screenSpeed/q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const xe=g!==k,ge=z!==w,tt=!d.isPaddingEqual(L),st=qe=>rt=>{const ot=rt*Pe,bt=1/ye(ot);qe.zoom=rt===1?S:m+qe.scaleZoom(bt),xe&&(qe.bearing=s.number(g,k,rt)),ge&&(qe.pitch=s.number(w,z,rt)),tt&&(qe.interpolatePadding(b,L,rt),U=qe.centerPoint.add(j));const mt=rt===1?J:qe.unproject($.add(K.mult(Be(ot))).mult(bt));return qe.setLocationAtPoint(qe.renderWorldCopies?mt.wrap():mt,U),qe._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),qe};if(t.preloadOnly){const qe=this._emulate(st,t.duration,d);return this._preloadTiles(qe),this}return this._zooming=!0,this._rotating=xe,this._pitching=ge,this._padding=tt,this._prepareEase(a,!1),this._ease(st(d),()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,a,d){d.animate===!1||d.duration===0?(t(1),a()):(this._easeStart=s.exported.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=s.wrap(t,-180,180);const d=Math.abs(t-a);return Math.abs(t-360-a)<d&&(t-=360),Math.abs(t+360-a)<d&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const d=t.lng-a.center.lng;t.lng+=d>180?-360:d<-180?360:0}_emulate(t,a,d){const m=Math.ceil(15*a/1e3),g=[],w=t(d.clone());for(let b=0;b<=m;b++){const S=w(b/m);g.push(S.clone())}return g}}class Oa{constructor(t={}){this.options=t,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact;return this._map=t,this._container=de("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=de("button","mapboxgl-ctrl-attrib-button",this._container),de("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=de("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const d=this._map._getUIString(`AttributionControl.${a}`);t.setAttribute("aria-label",d),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(t){const d=a.reduce((m,g,w)=>(g.value&&(m+=`${g.key}=${g.value}${w<a.length-1?"&":""}`),m),"?");t.href=`${s.config.FEEDBACK_URL}/${d}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const a=this._map.style._sourceCaches;for(const m in a){const g=a[m];if(g.used){const w=g.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t.sort((m,g)=>m.length-g.length),t=t.filter((m,g)=>{for(let w=g+1;w<t.length;w++)if(t[w].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class rc{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=de("div","mapboxgl-ctrl");const a=de("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const d=t[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Na{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const m of d)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Lu(u,t,a){if(u=new s.LngLat(u.lng,u.lat),t){const d=new s.LngLat(u.lng-360,u.lat),m=new s.LngLat(u.lng+360,u.lat),g=360*Math.ceil(Math.abs(u.lng-a.center.lng)/360),w=a.locationPoint(u).distSqr(t),b=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint(d).distSqr(t)<w&&(b||Math.abs(d.lng-a.center.lng)<g)?u=d:a.locationPoint(m).distSqr(t)<w&&(b||Math.abs(m.lng-a.center.lng)<g)&&(u=m)}for(;Math.abs(u.lng-a.center.lng)>180;){const d=a.locationPoint(u);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;u.lng>a.center.lng?u.lng-=360:u.lng+=360}return u}const oc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sc extends s.Evented{constructor(t,a){if(super(),(t instanceof s.window.HTMLElement||a)&&(t=s.extend({element:t},a)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=s.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=de("div");const m=41,g=27,w=Ae("svg",{display:"block",height:m*this._scale+"px",width:g*this._scale+"px",viewBox:`0 0 ${g} ${m}`},this._element),b=Ae("radialGradient",{id:"shadowGradient"},Ae("defs",{},w));Ae("stop",{offset:"10%","stop-opacity":.4},b),Ae("stop",{offset:"100%","stop-opacity":.05},b),Ae("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),Ae("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),Ae("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),Ae("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=s.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const d=this._element.classList;for(const m in oc)d.remove(`mapboxgl-marker-anchor-${m}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,d=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map;if(!t)return!1;const a=t.unproject(this._pos),d=t.getFreeCameraOptions();if(!d.position)return!1;const m=d.position.toLngLat();return m.distanceTo(a)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(a);let m;t._usingGlobe()&&s.isLngLatBehindGlobe(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=.2)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._calculateXYTransform()+this._calculateZTransform(),d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px) ${oc[this._anchor]}
            ${a}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map;if(this.getPitchAlignment()!=="map"||!a||!t)return"";if(!a._usingGlobe()){const S=a.getPitch();return S?`rotateX(${S}deg)`:""}const d=s.radToDeg(s.globeTiltAtLngLat(a.transform,this._lngLat)),m=t.sub(s.globeCenterToScreenPoint(a.transform)),g=d/(Math.abs(m.x)+Math.abs(m.y)),w=m.x*g,b=-m.y*g;return b||w?`rotateX(${b}deg) rotateY(${w}deg)`:""}_calculateZTransform(){const t=this._calculateRotation();return t?`rotateZ(${t}deg)`:""}_calculateRotation(){if(this._rotationAlignment==="viewport"||this._rotationAlignment==="auto")return this._rotation;if(this._map&&this._rotationAlignment==="map"){const t=this._map;if(this._pos&&t&&t._usingGlobe()){const a=t.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),d=t.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(a);return this._rotation+s.radToDeg(Math.atan2(d.y,d.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(t){s.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Lu(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),t===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._usingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.pointGeometry.convert(t),this._update(),this}_onMove(t){const a=this._map;if(a){if(!this._isDragging){const d=this._clickTolerance||a._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map;a&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class Yd{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=s.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,d){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+d}}const Kd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Jd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ac(u){u.parentNode&&u.parentNode.removeChild(u)}const Bu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qd{constructor(t,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Uo({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new zu({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),ve()}move(t,a){const d=this.map,m=this.mouseRotate.mousemoveWindow(t,a),g=m&&m.bearingDelta;if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const w=this.mousePitch.mousemoveWindow(t,a),b=w&&w.pitchDelta;b&&d.setPitch(d.getPitch()+b)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){he(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(s.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Fe(this.element,t)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Fe(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ct(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ct(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ep={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},tp={maxWidth:100,unit:"metric"};function Es(u,t,a,d,m,g){const w=function(S){const k=Math.pow(10,`${Math.floor(S)}`.length-1);let z=S/k;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(L){const O=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*O)/O}(z),k*z}(a),b=w/a;g._requestDomTask(()=>{u.style.width=t*b+"px",u.innerHTML=m!=="nautical-mile"?new Intl.NumberFormat(d,{style:"unit",unitDisplay:"narrow",unit:m}).format(w):`${w}&nbsp;nm`})}const Ru={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ip=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lc(u=new s.pointGeometry(0,0),t="bottom"){if(typeof u=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new s.pointGeometry(0,u);case"top-left":return new s.pointGeometry(a,a);case"top-right":return new s.pointGeometry(-a,a);case"bottom":return new s.pointGeometry(0,-u);case"bottom-left":return new s.pointGeometry(a,-a);case"bottom-right":return new s.pointGeometry(-a,-a);case"left":return new s.pointGeometry(u,0);case"right":return new s.pointGeometry(-u,0)}return new s.pointGeometry(0,0)}return u instanceof s.pointGeometry||Array.isArray(u)?s.pointGeometry.convert(u):s.pointGeometry.convert(u[t]||[0,0])}const Ua={version:s.version,supported:ue,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Hd{constructor(u){if((u=s.extend({},Jd,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(u.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Xl(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._optimizeForTerrain=u.optimizeForTerrain,this._language=u.language==="auto"?s.window.navigator.language:u.language,this._worldview=u.worldview,this._renderTaskQueue=new Na,this._domRenderTaskQueue=new Na,this._controls=[],this._markers=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Kd,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Yd(0),this._explicitProjection=null,this._requestManager=new s.RequestManager(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,typeof u.container=="string"){if(this._container=s.window.document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Xd(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this._hash=u.hash&&new bs(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,s.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),u.attributionControl&&this.addControl(new Oa({customAttribution:u.customAttribution})),this._logoControl=new rc,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new s.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new s.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=u.onAdd(this);this._controls.push(u);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.Event("movestart",u)).fire(new s.Event("move",u)),this.fire(new s.Event("resize",u)),t&&this.fire(new s.Event("moveend",u)),this}getBounds(){return this.transform.projection.name==="globe"?(s.warnOnce("Globe projection does not support getBounds API"),null):this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(s.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u==null?-2:u)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u==null?22:u)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u==null?0:u)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u==null?85:u)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}getLanguage(){return this._language}setLanguage(u){if(this._language=u==="auto"?s.window.navigator.language:u,this.style)for(const t in this.style._sourceCaches){const a=this.style._sourceCaches[t]._source;a._setLanguage&&a._setLanguage(this._language)}for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){if(this._worldview=u,this.style)for(const t in this.style._sourceCaches){const a=this.style._sourceCaches[t]._source;a._setWorldview&&a._setWorldview(u)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._updateProjection(u)}_updateProjection(u){const t=this.getProjection();u===null&&(this._explicitProjection=null);const a=u||this.getProjection(),d=this.transform.setProjection(a&&a.name==="globe"?{name:this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?"mercator":"globe"}:a);if(u&&(this._explicitProjection=u.name==="globe"?{name:"globe",center:[0,0]}:this.transform.getProjection()),d){if(t.name==="globe"&&this.getProjection().name==="globe")this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const m in this.style._sourceCaches)this.style._sourceCaches[m].clearTiles()}this.style.applyProjectionUpdate(),this._update(!0)}else!this.transform.projection.requiresDraping||this.getTerrain()||this.style.stylesheet.terrain||this.style.setTerrainForDraping();return this}project(u){return this.transform.locationPoint3D(s.LngLat.convert(u))}unproject(u){return this.transform.pointLocation3D(s.pointGeometry.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(u,t,a){if(u==="mouseenter"||u==="mouseover"){let d=!1;const m=w=>{const b=t.filter(k=>this.getLayer(k)),S=b.length?this.queryRenderedFeatures(w.point,{layers:b}):[];S.length?d||(d=!0,a.call(this,new Ln(u,this,w.originalEvent,{features:S}))):d=!1},g=()=>{d=!1};return{layers:new Set(t),listener:a,delegates:{mousemove:m,mouseout:g}}}if(u==="mouseleave"||u==="mouseout"){let d=!1;const m=w=>{const b=t.filter(S=>this.getLayer(S));(b.length?this.queryRenderedFeatures(w.point,{layers:b}):[]).length?d=!0:d&&(d=!1,a.call(this,new Ln(u,this,w.originalEvent)))},g=w=>{d&&(d=!1,a.call(this,new Ln(u,this,w.originalEvent)))};return{layers:new Set(t),listener:a,delegates:{mousemove:m,mouseout:g}}}{const d=m=>{const g=t.filter(b=>this.getLayer(b)),w=g.length?this.queryRenderedFeatures(m.point,{layers:g}):[];w.length&&(m.features=w,a.call(this,m),delete m.features)};return{layers:new Set(t),listener:a,delegates:{[u]:d}}}}on(u,t,a){if(a===void 0)return super.on(u,t);Array.isArray(t)||(t=[t]);const d=this._createDelegatedListener(u,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(u,t,a){if(a===void 0)return super.once(u,t);Array.isArray(t)||(t=[t]);const d=this._createDelegatedListener(u,t,a);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(u,t,a){if(a===void 0)return super.off(u,t);t=new Set(Array.isArray(t)?t:[t]);const d=(g,w)=>{if(g.size!==w.size)return!1;for(const b of g)if(!w.has(b))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[u]:void 0;return m&&(g=>{for(let w=0;w<g.length;w++){const b=g[w];if(b.listener===a&&d(b.layers,t)){for(const S in b.delegates)this.off(S,b.delegates[S]);return g.splice(w,1),this}}})(m),this}queryRenderedFeatures(u,t){return this.style?(t!==void 0||u===void 0||u instanceof s.pointGeometry||Array.isArray(u)||(t=u,u=void 0),this.style.queryRenderedFeatures(u=u||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(u,t){return this.style.querySourceFeatures(u,t)}queryTerrainElevation(u,t){const a=this.transform.elevation;return a?(t=s.extend({},{exaggerated:!0},t),a.getAtPoint(s.MercatorCoordinate.fromLngLat(u),null,t.exaggerated)):null}setStyle(u,t){return(t=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u&&(this.style=new ur(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ur(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,t){if(typeof u=="string"){const a=this._requestManager.normalizeStyleURL(u),d=this._requestManager.transformRequest(a,s.ResourceType.Style);s.getJSON(d,(m,g)=>{m?this.fire(new s.ErrorEvent(m)):g&&this._updateDiff(g,t)})}else typeof u=="object"&&this._updateDiff(u,t)}_updateDiff(u,t){try{this.style.setState(u)&&this._update(!0)}catch(a){s.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(u,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(u,t){return this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)}isSourceLoaded(u){return!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){const u=this.style&&this.style._sourceCaches;for(const t in u){const a=u[t]._tiles;for(const d in a){const m=a[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(u,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,a)}removeSource(u){return this.style.removeSource(u),this._updateTerrain(),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,t,{pixelRatio:a=1,sdf:d=!1,stretchX:m,stretchY:g,content:w}={}){if(this._lazyInitEmptyStyle(),t instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&t instanceof s.window.ImageBitmap){const{width:b,height:S,data:k}=s.exported.getImageData(t);this.style.addImage(u,{data:new s.RGBAImage({width:b,height:S},k),pixelRatio:a,stretchX:m,stretchY:g,content:w,sdf:d,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:b,height:S}=t,k=t;this.style.addImage(u,{data:new s.RGBAImage({width:b,height:S},new Uint8Array(k.data)),pixelRatio:a,stretchX:m,stretchY:g,content:w,sdf:d,version:0,userImage:k}),k.onAdd&&k.onAdd(this,u)}}updateImage(u,t){const a=this.style.getImage(u);if(!a)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&t instanceof s.window.ImageBitmap?s.exported.getImageData(t):t,{width:m,height:g}=d;m!==void 0&&g!==void 0?m===a.data.width&&g===a.data.height?(a.data.replace(d.data,!(t instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&t instanceof s.window.ImageBitmap)),this.style.updateImage(u,a)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${m}, ${g})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){s.getImage(this._requestManager.transformRequest(u,s.ResourceType.Image),(a,d)=>{t(a,d instanceof s.window.HTMLImageElement?s.exported.getImageData(d):d)})}listImages(){return this.style.listImages()}addLayer(u,t){return this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)}moveLayer(u,t){return this.style.moveLayer(u,t),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,t,a){return this.style.setLayerZoomRange(u,t,a),this._update(!0)}setFilter(u,t,a={}){return this.style.setFilter(u,t,a),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,t,a,d={}){return this.style.setPaintProperty(u,t,a,d),this._update(!0)}getPaintProperty(u,t){return this.style.getPaintProperty(u,t)}setLayoutProperty(u,t,a,d={}){return this.style.setLayoutProperty(u,t,a,d),this._update(!0)}getLayoutProperty(u,t){return this.style.getLayoutProperty(u,t)}setLight(u,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(u),this.transform):0}setFeatureState(u,t){return this.style.setFeatureState(u,t),this._update()}removeFeatureState(u,t){return this.style.removeFeatureState(u,t),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,d,m,g=this._container;for(;g&&(!d||!m);){const w=s.window.getComputedStyle(g).transform;w&&w!=="none"&&(a=w.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(m=a[3])),g=g.parentElement}this._containerWidth=d?Math.abs(u/d):u,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=de("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=de("div","mapboxgl-canvas-container",u);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=de("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=de("div","mapboxgl-control-container",u),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{d[m]=de("div",`mapboxgl-ctrl-${m}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const a=s.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(u),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const u=s.extend({},ue.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);t?(s.storeAuthState(t,!0),this.painter=new Dd(t,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(t)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;const a=this.painter.context.extTimerQuery,d=s.exported.now();if(this.listens("gpu-timing-frame")&&(t=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this.getProjection().name==="globe"&&(this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.projection.name==="globe"&&this._updateProjection():this.transform.projection.name==="mercator"&&this._updateProjection());let m=!1;const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,k=this.transform.pitch,z=s.exported.now();this.style.zoomHistory.update(S,z);const L=new s.EvaluationParameters(S,{now:z,fadeDuration:g,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),O=L.crossFadingFactor();O===1&&O===this._crossFadingFactor||(m=!0,this._crossFadingFactor=O),this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(d),this.style._updateSources(this.transform),this._forceMarkerUpdate()):w=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const S=s.exported.now()-d;a.endQueryEXT(a.TIME_ELAPSED_EXT,t),setTimeout(()=>{const k=a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(t),this.fire(new s.Event("gpu-timing-frame",{cpuTime:S,gpuTime:k})),s.window.performance.mark("frame-gpu",{startTime:d,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(S);this.fire(new s.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(S);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(b||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(w=this._updateAverageElevation(d,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const u of this._markers)u._update()}_updateAverageElevation(u,t=!1){const a=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const d=this.transform.averageElevation;let m=this.transform.sampleAverageElevation(),g=!1;this.transform.elevation&&(g=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=u;const w=Math.abs(d-m);if(w>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(m),a(m);this._averageElevation.easeTo(m,u,300)}else if(w>1e-4)return this._averageElevation.jumpTo(m),a(m)}return!!this._averageElevation.isEasing(u)&&a(this._averageElevation.getValue(u))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===s.AUTH_ERR_MSG||u.status===401)){const t=this.painter.context.gl;s.storeAuthState(t,!1),this._logoControl instanceof rc&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function m(g){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,g,0);const w=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,w),w}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(m(u),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(u,t,a){let d=a[1]-a[0];const m=u.length/4;for(let g=0;g<t.length;g++){const w=t[g];let b=0;for(let S=0;S<w.length;S+=4)w[S]===u[S]&&w[S+1]===u[S+1]&&w[S+2]===u[S+2]&&w[S+3]===u[S+3]&&(b+=1);d+=(a[g+2]-a[g+1])*(1-b/m)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),ac(this._canvasContainer),ac(this._controlContainer),ac(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=s.exported.frame(t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_preloadTiles(u){const t=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(t,(a,d)=>a._preloadTiles(u,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}_setCacheLimits(u,t){s.setCacheLimits(u,t)}get version(){return s.version}},NavigationControl:class{constructor(u){this.options=s.extend({},Bu,u),this._container=de("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),de("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),de("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))}),this._compassIcon=de("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),a=t===u.getMaxZoom(),d=t===u.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qd(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const a=de("button",u,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(u,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",a),u.firstElementChild&&u.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.Evented{constructor(u){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},ep,u),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Au(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=de("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){this._supportsGeolocation!==void 0?u(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(t=>{this._supportsGeolocation=t.state!=="denied",u(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.geolocation,u(this._supportsGeolocation))}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),a=u.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",u)),this._finish()}}_updateCamera(u){const t=new s.LngLat(u.coords.longitude,u.coords.latitude),a=u.coords.accuracy,d=this._map.getBearing(),m=s.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),m,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new s.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map._containerHeight/2,t=this._map.unproject([0,u]),a=this._map.unproject([100,u]),d=t.distanceTo(a)/100,m=Math.ceil(2*this._accuracy/d);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=de("button","mapboxgl-ctrl-geolocate",this._container),de("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=de("div","mapboxgl-user-location"),this._dotElement.appendChild(de("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(de("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=de("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Oa,ScaleControl:class{constructor(u){this.options=s.extend({},tp,u),s.bindAll(["_update","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){(function(u,t,a,d){const m=d&&d.maxWidth||100,g=u._containerHeight/2,w=u._containerWidth/2-m/2,b=u.unproject([w,g]),S=u.unproject([w+m,g]),k=b.distanceTo(S);if(d&&d.unit==="imperial"){const z=3.2808*k;z>5280?Es(t,m,z/5280,a,"mile",u):Es(t,m,z,a,"foot",u)}else d&&d.unit==="nautical"?Es(t,m,k/1852,a,"nautical-mile",u):k>=1e3?Es(t,m,k/1e3,a,"kilometer",u):Es(t,m,k,a,"meter",u)})(this._map,this._container,this._language,this.options)}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=de("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof s.window.HTMLElement?this._container=u.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=de("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=de("button","mapboxgl-ctrl-fullscreen",this._controlContainer);de("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(u){super(),this.options=s.extend(Object.create(Ru),u),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=s.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(s.window.document.createTextNode(u))}setHTML(u){const t=s.window.document.createDocumentFragment(),a=s.window.document.createElement("body");let d;for(a.innerHTML=u;d=a.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=de("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const a=this._closeButton=de("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,d=this._pos;if(!t||!a||!d)return"bottom";const m=a.offsetWidth,g=a.offsetHeight,w=d.x<m/2,b=d.x>t.transform.width-m/2;if(d.y+u<g)return w?"top-left":b?"top-right":"top";if(d.y>t.transform.height-g){if(w)return"bottom-left";if(b)return"bottom-right"}return w?"left":b?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=de("div","mapboxgl-popup",t.getContainer()),this._tip=de("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lu(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const m=this._pos=this._trackPointer&&u?u:t.project(this._lngLat),g=lc(this.options.offset),w=this._anchor=this._getAnchor(g.y),b=lc(this.options.offset,w),S=m.add(b).round();t._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${oc[w]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&t._usingGlobe()){const m=s.isLngLatBehindGlobe(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(ip);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:sc,Style:ur,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Wl,Evented:s.Evented,config:s.config,prewarm:function(){Gt().acquire(ft)},clearPrewarmedResources:function(){const u=It;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(ft),It=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(u){s.config.ACCESS_TOKEN=u},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(u){s.config.API_URL=u},get workerCount(){return xt.workerCount},set workerCount(u){xt.workerCount=u},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){s.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){s.clearTileCache(u)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Ua});var F=E;return F})})($g);const SC="pk.eyJ1Ijoic2hhbm02MzA1IiwiYSI6ImNsNDZxaGZ3YjA1MHczanJ5cmp1Z3ZpbnMifQ.euWyMWB3DATTx-7AS8ycSA",CC="mapbox://styles/shanm6305/cl46r5bhr000114tfcnc5f93m";var Oy={exports:{}},am={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AC=Ko.exports,IC=Symbol.for("react.element"),kC=Symbol.for("react.fragment"),MC=Object.prototype.hasOwnProperty,zC=AC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,PC={key:!0,ref:!0,__self:!0,__source:!0};function Pb(r,l,f){var x,E={},I=null,F=null;f!==void 0&&(I=""+f),l.key!==void 0&&(I=""+l.key),l.ref!==void 0&&(F=l.ref);for(x in l)MC.call(l,x)&&!PC.hasOwnProperty(x)&&(E[x]=l[x]);if(r&&r.defaultProps)for(x in l=r.defaultProps,l)E[x]===void 0&&(E[x]=l[x]);return{$$typeof:IC,type:r,key:I,ref:F,props:E,_owner:zC.current}}am.Fragment=kC;am.jsx=Pb;am.jsxs=Pb;Oy.exports=am;const we=Oy.exports.jsx,hi=Oy.exports.jsxs;function _i(r){return hi("div",{className:"image-artifact-container",children:[we("span",{children:r.caption}),we("img",{src:r.source})]})}function bi(r){return[r.longitude,r.latitude]}const DC="globe",$i=4.25,LC=30,BC=.45,Li=.2,RC=4.75,cf=4.25,FC="hsl(350, 80%, 50%)",bh="hsl(350, 80%, 50%)",Th="yellow",K_="green",OC="orange",v1="gray";function Gs(r,l){return{id:r+"-line",type:"line",source:r,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":l,"line-width":3,"line-opacity":.7}}}function Eh(r,l){return{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:null,geometry:{type:"LineString",coordinates:[[r.longitude,r.latitude],[l.longitude,l.latitude]]}}]}}}function J_(r){return{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:null,geometry:{type:"MultiLineString",coordinates:r.map(l=>[[l[0].longitude,l[0].latitude],[l[1].longitude,l[1].latitude]])}}]}}}function NC(){const r=Ko.exports.useRef(null),l=Ko.exports.useRef(null),[f,x]=Ko.exports.useState("canton"),[E,I]=Ko.exports.useState(null),[F,s]=Ko.exports.useState(!0);function G(Ae,je){var Ge;(Ge=l.current)==null||Ge.dragPan.disable(),l.current.flyTo({center:[Ae.longitude+RC,Ae.latitude],pitch:LC,zoom:$i,speed:BC}),I(je)}class ue{constructor(je,Ge,Tt){dh(this,"title");dh(this,"marker");dh(this,"coordinates");dh(this,"stage");const ve=new $g.exports.Marker({color:FC}).setLngLat(bi(Ge));ve.getElement().addEventListener("click",()=>G(Ge,Tt)),this.title=je,this.marker=ve,this.coordinates=Ge,this.stage=Tt}}const ae={chinese:{canton:new ue("Canton City",{longitude:113.25325,latitude:23.128994},"canton"),sanFrancisco:new ue("San Francisco",{longitude:-122.41942+.15,latitude:37.77493-.33},"chinese-san-francisco"),chinatown:new ue("Chinatown, San Francisco",{longitude:-122.404331716,latitude:37.790163506},"chinatown"),washingtonDC:new ue("Washington, D.C | 1882-1965",{longitude:-77.03637,latitude:38.89511},"chinese-washington-dc"),beijing:new ue("Beijing | 1972",{longitude:116.39723,latitude:39.9075},"beijing"),countrywide:new ue("Countrywide | Present Day",{longitude:-99,latitude:40},"chinese-countrywide"),chopSueyToishan:new ue("Countrywide | Present Day",{longitude:112.7833302,latitude:22.249999},"chop-suey-toishan"),chopSueyNewYork:new ue("Countrywide | Present Day",{longitude:-74.00597,latitude:40.71427},"chop-suey-new-york"),chopSueySanFrancisco:new ue("Countrywide | Present Day",{longitude:-122.41942+.11,latitude:37.77493-.25},"chop-suey-san-francisco"),chopSueyCaliforniaRailroad:new ue("Countrywide | Present Day",{longitude:-121.4944,latitude:38.58157},"chop-suey-california"),orangeChicken:new ue("Countrywide | Present Day",{longitude:-157.85833,latitude:21.30694},"orange-chicken"),fortuneCookie:new ue("Countrywide | Present Day",{longitude:-122.4298,latitude:37.7851},"fortune-cookie"),oysterPail:new ue("Countrywide | Present Day",{longitude:-87.65005,latitude:41.85003},"oyster-pail"),funFact:new ue("Countrywide | Present Day",{longitude:-118.24368,latitude:34.05223},"chinese-fun-fact")},italian:{southItaly:new ue("South Italy",{longitude:14.24641,latitude:40.85631},"south-italy"),ellisIsland:new ue("Ellis Island",{longitude:-74.039559,latitude:40.699475},"ellis-island"),paris:new ue("Paris | End of WWII",{longitude:2.3488,latitude:48.85341},"paris"),washingtonDC:new ue("Washington, D.C | Prohibition",{longitude:-77.03637+.2,latitude:38.89511+.2},"italian-washington-dc"),chefBoyardeeA:new ue("Chef Boyardee",{longitude:-81.69541,latitude:41.4995},"chef-boyardee part a"),chefBoyardeeB:new ue("South Italy",{longitude:-76.84774,latitude:41.01203},"chef boyardee part b")},mexican:{texas:new ue("Annexation of Texas",{longitude:-99,latitude:32},"texas"),chili:new ue("Chile Con Carne - San Antonio",{longitude:-98.49363,latitude:29.42412},"chili"),tamales:new ue("Tamales",{longitude:-122.41942+.15,latitude:37.77493-.21},"tamales"),tacoBell:new ue("Taco Bell",{longitude:-118.13257,latitude:33.94001},"taco-bell")}};Ko.exports.useEffect(()=>{l.current||(l.current=new $g.exports.Map({container:r.current,style:CC,center:bi(ae.chinese.canton.coordinates),zoom:3,projection:{name:DC},dragRotate:!1,dragPan:!0,accessToken:SC}),ae.chinese.canton.marker.addTo(l.current))});function me(Ae){var je;I(null),(je=l.current)==null||je.dragPan.enable(),l.current.flyTo({center:bi(Ae),zoom:$i,pitch:0,speed:Li})}function de(Ae,je,Ge,Tt){l.current.addSource(Ae,Eh(Ge,Tt)),l.current.addLayer(Gs(Ae,je))}return hi("div",{children:[we("div",{ref:r,className:"map-container"}),we("div",{id:"opening-panel-toggle",className:"button",onClick:()=>s(!0),children:"Open Introduction Page"}),hi("div",{id:"opening-panel",style:{display:F?"flex":"none"},children:[we("div",{id:"close-opening-panel",className:"button",onClick:()=>s(!1),children:"Close"}),we("span",{id:"opening-panel-title",children:"Exploration of Foreign Cuisine in America"}),we("span",{id:"opening-panel-text",children:"This museum will explore a psuedo-chronological history of the three most popular foreign cuisines in America: Chinese, Italian, and Mexican, as well as various interesting facts about these cuisines."}),we("span",{id:"opening-panel-text",children:"Along the way, we will learn how various cultural conditions contributed to prejudice against the people who brought their food to America. But we will also see how these ethnic groups succeeded in becoming widely recognizable and respected in America today."}),we("span",{id:"opening-panel-text",children:"The point of this exhibit is to show off America as an amazing land of cultural diversity and opportunity. People and events and cultures from all over the world had an effect on these cuisines. And despite the challenges (including some that still exist today) these ethnic groups have come to dominate the culinary mind of the American public. America accepts and incorporates many different cultures into its own; today, Chinese-American, Italian-American, Mexican-American, and other ethnic food is as American as apple pie."}),we("span",{className:"open-subtitle",children:"Physical Museum Layout"}),we("img",{src:"/museum-layout.png"}),we("span",{className:"text",children:"The museum would be arranged as three chambers, connected by one room. The purpose of this circular layout is to help visitors understand that, in America, culture, especially food, is always linked to one another, through the shared culture of America as a whole."}),we("span",{className:"text",children:"The 3 sections in each chamber would be display cases with artifacts and info pertaining to them."}),we("span",{className:"text",children:"All three chambers start with immigration (and the special case of annexation of Texas for Mexican-American). This helps visitors understand that the first thing that causes a culture to form in a foreign country is a large presence of foreigners in that country."}),we("span",{className:"text",children:"Then, the next section for each chamber has more info about a place that had a particularly large impact on the development of that ethnic group and their cuisine in America. This helps visitors understand the process by which foreigners become integrated into American culture."}),we("span",{className:"text",children:"The last display chamber ends with info on common dishes and their creation/evolution, just because that topic would be interesting."}),we("span",{className:"open-subtitle",children:"Works Cited"}),we("span",{className:"text",children:"\u201CAbout Us | Chef Boyardee.\u201D Chef Boyardee, ConAgra, www.chefboyardee.com/about-us."}),we("span",{className:"text",children:"Arellano, Gustavo. \u201CAs American as Fajita Pie.\u201D Wall Street Journal, 23 Mar. 2012, www.wsj.com/articles/SB10001424052702304724404577297981260189946. Accessed 11 June 2022."}),we("span",{className:"text",children:"---. Taco USA : How Mexican Food Conquered America. New York, Scribner, 2013."}),we("span",{className:"text",children:"\u201CBehind the Scenes at Chef Boyardee.\u201D The United Food & Commercial Workers International Union, UFCWU, 25 July 2019, www.ufcw.org/chefboyardee/. Accessed 11 June 2022."}),we("span",{className:"text",children:"Carter, Susan B. \u201CAmerica\u2019s First Culinary Revolution, or How a Girl from Gopher Prairie Came to Dine on Eggs Fooyung.\u201D ECONOMIC EVOLUTION and REVOLUTIONS in HISTORICAL TIME, 10 Apr. 2011, papers.ssrn.com/sol3/papers.cfm?abstract_id=1805158."}),we("span",{className:"text",children:"Chen, Yong. \u201CThe Rise of Chinese Food in the United States.\u201D Oxford Research Encyclopedias, 28 June 2017, oxfordre.com/americanhistory/view/10.1093/acrefore/9780199329175.001.0001/acrefore-9780199329175-e-273#acrefore-9780199329175-e-273-div1-2."}),we("span",{className:"text",children:"\u201CChinese Exclusion Act (1882).\u201D National Archives, 8 Sept. 2021, www.archives.gov/milestone-documents/chinese-exclusion-act."}),we("span",{className:"text",children:"Coe, Andrew. Chop Suey : A Cultural History of Chinese Food in the United States. New York, Oxford University Press, 2009."}),we("span",{className:"text",children:"\u201CCulture a La Carte: Would You like Some Han Dynasty with Your Meal?\u201D National Museum of American History, 1 July 2011, americanhistory.si.edu/blog/2011/07/would-you-like-some-han-dynasty-with-your-meal.html. Accessed 11 June 2022."}),we("span",{className:"text",children:"Del Barco, Mandalit. \u201COrange Chicken, Panda Express\u2019 Gift to American Chinese Food, Turns 30.\u201D NPR.org, 30 Oct. 2017, www.npr.org/sections/thesalt/2017/10/30/560822270/orange-chicken-panda-express-gift-to-american-chinese-food-turns-30."}),we("span",{className:"text",children:"Godoy, Maria. \u201CNPR Choice Page.\u201D Npr.org, 2019, www.npr.org/sections/thesalt/2016/02/22/467113401/lo-mein-loophole-how-u-s-immigration-law-fueled-a-chinese-restaurant-boom."}),we("span",{className:"text",children:"Gong-fu, Zhong. \u201CGuangzhou | Geography, People, & History.\u201D Encyclop\xE6dia Britannica, 2019, www.britannica.com/place/Guangzhou."}),we("span",{className:"text",children:"Greenbaum, Hilary, and Dana Rubinstein. \u201CThe Chinese-Takeout Container Is Uniquely American.\u201D The New York Times, 13 Jan. 2012, www.nytimes.com/2012/01/15/magazine/the-chinese-takeout-container-is-uniquely-american.html."}),we("span",{className:"text",children:"Haiming Liu. From Canton Restaurant to Panda Express : A History of Chinese Food in the United States. New Brunswick, New Jersey, Rutgers University Press, 2015."}),we("span",{className:"text",children:"Horowitz, Gemma. \u201CThe Illustrated History of Italian-American Food.\u201D First We Feast, First We Feast, 7 Dec. 2016, firstwefeast.com/features/illustrated-history-of-italian-american-food."}),we("span",{className:"text",children:"Kelly, Debra. \u201CThe Untold Truth of Chef Boyardee.\u201D Mashed.com, 15 Aug. 2017, www.mashed.com/80512/untold-truth-chef-boyardee/. Accessed 11 June 2022."}),we("span",{className:"text",children:"LBJ Presidential Library. \u201CText - Signing of the Immigration and Nationality Act, October 3, 1965 - LBJ Library.\u201D Www.lbjlibrary.org, www.lbjlibrary.org/object/text/signing-immigration-and-nationality-act-10-03-1965."}),we("span",{className:"text",children:"Lee, Jennifer 8. The Fortune Cookie Chronicles : Adventures in the World of Chinese Food. New York, Twelve, 2009."}),we("span",{className:"text",children:"Long, Trish. \u201CGeorge Ashley Revolutionized Mexican Food, Ran Ashley\u2019s Gardens Restaurant: Trish Long.\u201D El Paso Times, 23 July 2021, www.elpasotimes.com/story/news/history/2021/07/23/george-ashley-revolutionized-mexican-food-trish-long/8028865002/. Accessed 11 June 2022."}),we("span",{className:"text",children:"Magazine, Smithsonian, and Franz Lidz. \u201CThe Uniquely Texan Origins of the Frozen Margarita.\u201D Smithsonian Magazine, July 2018, www.smithsonianmag.com/smithsonian-institution/uniquely-texas-origins-frozen-margarita-180969339/. Accessed 11 June 2022."}),we("span",{className:"text",children:"\u201CNatural History of the Kitchen: Chef Boyardee \u2013 Eat Me Daily.\u201D Web.archive.org, 3 Feb. 2020, web.archive.org/web/20200203165907/www.eatmedaily.com/2010/06/natural-history-of-the-kitchen-chef-boyardee/. Accessed 11 June 2022."}),we("span",{className:"text",children:"Panda Restaurant Group. \u201CTimeline | Panda Restaurant Group.\u201D Pandarg.com, 2011, www.pandarg.com/about-us/timeline."}),we("span",{className:"text",children:"PBS. \u201CDestination America . When Did They Come? | PBS.\u201D Pbs.org, 2019, www.pbs.org/destinationamerica/usim_wn_noflash_5.html."}),we("span",{className:"text",children:"Rawlinson, John Lang. \u201CLi Hongzhang | Chinese Statesman.\u201D Encyclopedia Britannica, www.britannica.com/biography/Li-Hongzhang."}),we("span",{className:"text",children:"Ray, Krishnendu. The Ethnic Restaurateur. London ; New York, Ny, Bloomsbury Academic, An Imprint Of Bloomsbury Publishing, Plc, Cop, 2016."}),we("span",{className:"text",children:"Richard Nixon Presidential Library and Museum. \u201CNixon\u2019s Trip to China | Richard Nixon Museum and Library.\u201D Nixonlibrary.gov, 2019, www.nixonlibrary.gov/index.php/nixons-trip-china."}),we("span",{className:"text",children:"Sakovich, Maria. \u201CWhen the \u201CEnemy\u201D Landed at Angel Island.\u201D National Archives, 15 Aug. 2016, www.archives.gov/publications/prologue/2009/summer/angel.html."}),we("span",{className:"text",children:"Smith, Crawford. \u201CThe Truth about Tex-Mex.\u201D Mashed.com, 11 Oct. 2021, www.mashed.com/629483/the-truth-about-tex-mex/. Accessed 11 June 2022."}),we("span",{className:"text",children:"SouthFloridaReporter.com. \u201CIn 1977, the Texas State Legislature Proclaimed Chili the Official \u201CState Food\u201D of Texas.\u201D South Florida Reporter, 25 Feb. 2021, southfloridareporter.com/in-1977-the-texas-state-legislature-proclaimed-chili-the-official-state-food-of-texas/. Accessed 11 June 2022."}),we("span",{className:"text",children:"Steerling, Justine. \u201CThe Many Origin Stories of Chop Suey.\u201D Food & Wine, 23 Apr. 2017, www.foodandwine.com/news/many-origin-stories-chop-suey."}),we("span",{className:"text",children:"\u201CThe Great Arrival | Italian | Immigration and Relocation in U.S. History | Classroom Materials at the Library of Congress | Library of Congress.\u201D Library of Congress, Washington, D.C. 20540 USA, Library of Congress, www.loc.gov/classroom-materials/immigration/italian/the-great-arrival/."}),we("span",{className:"text",children:"\u201CThe Man, the Can: Recipes of the Real Chef Boyardee.\u201D NPR.org, 17 May 201AD, www.npr.org/2011/05/17/136398042/the-man-the-can-recipes-of-the-real-chef-boyardee."}),we("span",{className:"text",children:"\u201CThe Volstead Act | US House of Representatives: History, Art & Archives.\u201D History, Art, & Archives, United States House of Representatives, 2019, history.house.gov/Historical-Highlights/1901-1950/The-Volstead-Act/."}),we("span",{className:"text",children:"\u201CUnification of Italian States - Countries - Office of the Historian.\u201D State.gov, Department of State: Office of the Historian, 2019, history.state.gov/countries/issues/italian-unification."}),we("span",{className:"text",children:"United State House of Representatives. \u201CImmigration and Nationality Act of 1965 | US House of Representatives: History, Art & Archives.\u201D History, Arts, & Archives, 2019, history.house.gov/Historical-Highlights/1951-2000/Immigration-and-Nationality-Act-of-1965/."}),we("span",{className:"text",children:"Vawter, Eve. \u201CWhat Really Makes Panda Express\u2019 Orange Chicken so Delicious.\u201D Mashed.com, 29 Aug. 2019, www.mashed.com/164245/what-really-makes-panda-express-orange-chicken-so-delicious/."}),we("span",{className:"text",children:"Yeh, Cedric S., and Noriko Sanefuji. \u201COrigins of a Fortune Cookie.\u201D National Museum of American History, 8 July 2010, americanhistory.si.edu/blog/2010/07/origins-of-a-fortune-cookie.html."}),we("span",{className:"text",children:"Yeung, Yue-man, and Chen-tung Chang. \u201CGuangdong | Province, China.\u201D Encyclop\xE6dia Britannica, 1 Nov. 2016, www.britannica.com/place/Guangdong."}),we("span",{className:"text",children:"Zeldes, Leah A. \u201CDining Chicago\xBB the Unique Chicago Tamale, a Tuneful Mystery.\u201D Dining Chicago, 21 Dec. 2009, web.archive.org/web/20091221190811/blog.diningchicago.com:80/2009/12/18/the-unique-chicago-tamale-a-tuneful-mystery/. Accessed 11 June 2022."})]}),hi("div",{className:"info",style:{display:E=="canton"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.canton.coordinates),zoom:$i,pitch:0,speed:Li}),f=="canton"&&(x("chinese-san-francisco"),ae.chinese.sanFrancisco.marker.addTo(l.current),l.current.addSource("gz-sf",J_([[ae.chinese.canton.coordinates,{longitude:180,latitude:ae.chinese.canton.coordinates.latitude+9}],[{longitude:-180,latitude:ae.chinese.canton.coordinates.latitude+9},ae.chinese.sanFrancisco.coordinates]])),l.current.addLayer(Gs("gz-sf",bh)))},children:"Close"}),we("span",{className:"title",children:"Canton City"}),we("span",{className:"text",children:"The story of Chinese American cuisine starts here, in Canton province (although it is now known as Guangdong province). The rich port of Canton City (now known as Guangzhou) served as the primary hub for travel from China to America's West Coast. Two companies, the Pacific Mail Steamship Company, and the Occidental and Oriental Steamship Company, were the 2 main companies that ferried Chinese immigrants to America."}),we(_i,{source:"https://farm3.staticflickr.com/2898/14747474921_b93fcf8e13_o.jpg",caption:'An advertisement from the Pacific Mail Steamship Company promoting travel between San Francisco and the "Orient" (outdated term for the continent of Asia).'}),we(_i,{source:"https://upload.wikimedia.org/wikipedia/commons/5/51/Lai_Afong%2C_stranded_paddleship_Alaska%2C_September_1874.jpg",caption:"The S.S. Alaska was one of the ships belonging to the Pacific Mail Steamship Company. It traveled the San Francisco-China route. Here, in this picture by Chinese photographer Lai Afong, it is shown stranded on the shore."}),we(_i,{source:"https://upload.wikimedia.org/wikipedia/commons/7/7b/Chinese_Emigration_to_America.jpg",caption:`A sketch of Chinese immigrants aboard the steamship Alaska. It was published in the magazine, "Harper's Weekly", but the creator is unknown.`})]}),hi("div",{className:"info",style:{display:E=="chinese-san-francisco"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.sanFrancisco.coordinates),zoom:cf,pitch:0,speed:Li}),f=="chinese-san-francisco"&&(x("chinatown"),ae.chinese.chinatown.marker.addTo(l.current),l.current.addSource("sf-ct",Eh(ae.chinese.sanFrancisco.coordinates,ae.chinese.chinatown.coordinates)),l.current.addLayer(Gs("sf-ct",bh)))},children:"Close"}),we("span",{className:"title",children:"San Francisco"}),we("span",{className:"text",children:"Most Chinese immigrants during this time settled here in San Francisco. Their reasons for coming are multifaceted and complex. Traditionally, Chinese immigrants were understood to be poor, looking for an easy way to make money off the Gold Rush, or off the people mining gold as so many others had done. New reexaminations of historical sources indicates that many immigrants were actually already established merchants and traders looking for new opportunities to grow their wealth, and Chinese people of all economic backgrounds came to America."}),we("span",{className:"text",children:"Chinese people worked as laborers and businessmen alike. Enterprising Chinese quickly set up businesses: laundry shops, general stores, restaurants, warehouses, and more. Laundry's used to be the most popular businesses for Chinese immigrants to open up."}),we(_i,{source:"https://www.archives.gov/files/publications/prologue/2009/summer/images/angel-island-l.jpg",caption:"A picture of Angel Island Immigration Station in San Francisco, where Chinese immigrants were delivered before being allowed into the country."}),we(_i,{source:"https://upload.wikimedia.org/wikipedia/en/3/3a/ChineseLaundry1881.jpg",caption:"Drawing of a Chinese laundry."}),we(_i,{source:"https://s3.amazonaws.com/s3.timetoast.com/public/uploads/photos/7712722/canton_restaurant.jpg",caption:"Chinese restaurant in San Francisco."})]}),hi("div",{className:"info",style:{display:E=="chinatown"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.chinatown.coordinates),zoom:cf,pitch:0,speed:Li}),f=="chinatown"&&(x("chinese-washington-dc"),ae.chinese.washingtonDC.marker.addTo(l.current),l.current.addSource("ct-dc",Eh(ae.chinese.chinatown.coordinates,ae.chinese.washingtonDC.coordinates)),l.current.addLayer(Gs("ct-dc",bh)))},children:"Close"}),we("span",{className:"title",children:"Chinatown, San Francisco"}),we("span",{className:"text",children:"Due to racism, Chinese immigrants formed pockets within the city where they mainly lived and supported each other, similar to many other immigrant communities. This Chinatown in San Francisco is the oldest and largest. The established community and infrastructure made it easier for further waves of Chinese to come to America. The first Chinese restaurants were built in places like these, meant to serve and support other Chinese immigrants. They were not made to serve foreigners to Chinese culture and cuisine, and in fact, non-Chinese people specifically stayed away from these establishments, due to racist rumors and stories that Chinese restaurants were unclean and contained unpalatable exotic foods."}),we("span",{className:"text",children:"Despite this, Chinese establishments became a popular spot for miners once they realized that such restaurants were a great place to find food for cheap. Additionally, while many Western restaurants only served whatever the cook was making that day, the Chinese tradition differed from that of the West by allowing customers to choose what meal they wanted from a menu. Indeed, the average Chinese establishment was generally of a higher caliber than the average Western restaurant at this time. And with this influx of Westerners, Chinese cooks began to make small adjustments to their dishes to fit Western tastes."}),we(_i,{source:"https://media.npr.org/assets/img/2016/02/17/chinesecooks_custom-8ce5b3cc75d190173269d137068a14cbad996224-s1600-c85.webp",caption:"Chefs working at a Chinese restaurant in Chinatown."})]}),hi("div",{className:"info",style:{display:E=="chinese-washington-dc"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae,je,Ge;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.washingtonDC.coordinates),zoom:$i,pitch:0,speed:Li}),f=="chinese-washington-dc"&&(x("beijing"),ae.chinese.beijing.marker.addTo(l.current),(je=l.current)==null||je.addSource("dc-be",Eh(ae.chinese.washingtonDC.coordinates,ae.chinese.beijing.coordinates)),(Ge=l.current)==null||Ge.addLayer(Gs("dc-be",bh)))},children:"Close"}),we("span",{className:"title",children:"Immigration Law | 1882-1965"}),we("span",{className:"text",children:"Anti Chinese sentiment was all too common, and is well represented by the Chinese Exclusion Act. Passed by Congress in 1882, this act banned immigration of all Chinese laborers for 10 years. In practice, it was a ban on Chinese people overall, not just laborers."}),we(_i,{source:"https://catalog.archives.gov/OpaAPI/media/5752153/content/dc-metro/rg-011/299811/07608-2015-001-ac.jpg",caption:"A scan of the first page of the Chinese Exclusion Act."}),we("span",{className:"text",children:"But, however surprisingly, this act was actually a major contributive development to the growth of Chinese American cuisine. The act allowed Chinese business owners to obtain a special visa that would allow them to travel to China and bring over workers. Only a few kinds of businesses were allowed this freedom, however, and restaurants were added to the list in 1915. This meant a huge number of restaurants popped up that had to keep their doors open for a certain amount of time before they could apply for a visa. Once the visa was obtained, Chinese immigrants would bring over their family to America. Many laborers were counted as owners so they could bring their families over."}),we("span",{className:"text",children:'The prejudice towards Chinese also pushed Chinese people away from wage work and professional jobs, forcing them to start their own businesses. Knowing that they would not be able to easily travel to and from China, immigrants realized they had to be self sufficient in all aspects. Chinese restaurant owners started adjusting, or "Americanizing" their dishes to appeal to a broader range of Americans to attract more business.'}),we("span",{className:"text",children:"The next major development for the success of Chinese American cuisine was the Immigration and Nationality Act of 1965, commonly known as the Hart-Celler Act. This act cleared the strict race and ethnicity based quota system, creating a new system where immigrants were admitted based on skill and potential. This new system allowed for a influx of Chinese immigrants, who soon found readily available jobs in the Chinese restaurant industry."}),we(_i,{source:"https://www.migrationpolicy.org/sites/default/files/feature_images/LBJ-65Act.jpg",caption:"President Lyndon B. Johnson signs the Hart-Celler Act on October 3, 1965."})]}),hi("div",{className:"info",style:{display:E=="beijing"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.beijing.coordinates),zoom:$i,pitch:0,speed:Li}),f=="beijing"&&(x("chinese-countrywide"),ae.chinese.countrywide.marker.addTo(l.current),l.current.addSource("be-co",J_([[ae.chinese.beijing.coordinates,{longitude:180,latitude:ae.chinese.beijing.coordinates.latitude+0}],[{longitude:-180,latitude:ae.chinese.beijing.coordinates.latitude+0},ae.chinese.countrywide.coordinates]])),l.current.addLayer(Gs("be-co",bh)))},children:"Close"}),we("span",{className:"title",children:"Beijing | 1972"}),we("span",{className:"text",children:`In 1972, Richard Nixon famously visited China, ending 25 years of isolation between the countries. The event was called "the week that changed the world." Nixon's visit had some more overseen effects. Millions of Americans watched Nixon dine on Chinese cuisine over the television on February 21, 1972. This generated intense interest in Chinese culture and Chinese cuisine, encouraging Americans to seek out Chinese restaurants.`}),we(_i,{source:"https://upload.wikimedia.org/wikipedia/commons/4/43/President_Richard_Nixon_and_Premier_Chou_En-Lai_Shake_Hands_at_the_Nixons%27_Arrival_in_Peking%2C_China.jpg",caption:"President Nixon shakes hands with Chinese Premier Zhou Enlai."}),we(_i,{source:"https://specials-images.forbesimg.com/imageserve/5dc4a14fb4d5050007a51e33/960x0.jpg?cropX1=16&cropX2=1499&cropY1=0&cropY2=990",caption:"President Nixon dines with Chinese Premier Zhou Enlai and other Chinese leaders."})]}),hi("div",{className:"info",style:{display:E=="chinese-countrywide"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae,je,Ge;if(I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.countrywide.coordinates),zoom:$i,pitch:0,speed:Li}),f=="chinese-countrywide"){x("south-italy");for(const Tt of[ae.chinese.chopSueyToishan.marker,ae.chinese.chopSueyNewYork.marker,ae.chinese.chopSueySanFrancisco.marker,ae.chinese.chopSueyCaliforniaRailroad.marker,ae.chinese.orangeChicken.marker,ae.chinese.fortuneCookie.marker,ae.chinese.oysterPail.marker,ae.chinese.funFact.marker])Tt.addTo(l.current);ae.italian.southItaly.marker.addTo(l.current),(je=l.current)==null||je.addSource("chinese-additional-info",J_([[ae.chinese.countrywide.coordinates,{longitude:-180,latitude:ae.chinese.countrywide.coordinates.latitude-10}],[{longitude:180,latitude:ae.chinese.countrywide.coordinates.latitude-10},ae.chinese.chopSueyToishan.coordinates],...[ae.chinese.chopSueyNewYork.coordinates,ae.chinese.sanFrancisco.coordinates,ae.chinese.chopSueyCaliforniaRailroad.coordinates,ae.chinese.orangeChicken.coordinates,ae.chinese.fortuneCookie.coordinates,ae.chinese.oysterPail.coordinates,ae.chinese.funFact.coordinates].map(Tt=>[ae.chinese.countrywide.coordinates,Tt])])),(Ge=l.current)==null||Ge.addLayer(Gs("chinese-additional-info",OC)),l.current.addSource("italian-start",Eh(ae.chinese.countrywide.coordinates,ae.italian.southItaly.coordinates)),l.current.addLayer(Gs("italian-start",v1))}},children:"Close"}),we("span",{className:"title",children:"Countrywide | Present Day"}),we("span",{className:"text",children:"Chinese-American cuisine continued to grow gradually, until it reached the point where it is today. Chinese-American cuisine remains the most popular ethnic cuisine in America, and Chinese restaurants can be found in almost every city and town in America, with over 40,000 restaurants in business. While certain large chains have popped up and enjoyed great success, a unique aspect is that many Chinese restaurants remain mom and pop establishments."})]}),hi("div",{className:"info",style:{display:E=="chop-suey-toishan"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>me(ae.chinese.chopSueyToishan.coordinates),children:"Close"}),we("span",{className:"title",children:"Chop Suey | Toishan, Guangdong"}),we("span",{className:"text",children:"Chop suey is a simple dish composed of fried meat and vegetables over rice, with sauce. One of Chinese American cuisine's most famous products, the true origins of chop suey has been transcended by it's various mythical origin stories. No single origin story presents a firm case over any other."}),we("span",{className:"text",children:"One origin story states that chop suey already existed as a popular dish in China. Many immigrants came from this area in China, known as Toishan. Supposedly, chop suey already existed here in some form, and was simply exported to America when immigrants from Toishan came to America."})]}),hi("div",{className:"info",style:{display:E=="chop-suey-new-york"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>me(ae.chinese.chopSueyNewYork.coordinates),children:"Close"}),we("span",{className:"title",children:"Chop Suey | New York"}),we("span",{className:"text",children:"Chop suey is a simple dish composed of fried meat and vegetables over rice with sauce. One of Chinese American cuisine's most famous products, the true origins of chop suey have been transcended by it's various mythical origin stories. No single origin story presents a firm case over any other."}),we("span",{className:"text",children:"Perhaps the most famous origin story states that chop suey resulted from a visit by Li Hongzhang, an influential Chinese politician. Li was largely known in the West for his diplomatic negotiations, and as a great statesman. His visit to America created interest in China and its culture, and his visit was largely reported on by journalists. Reporters claimed Li did not like to touch American food, and instead preferred his personal chefs to cook his meals."}),we("span",{className:"text",children:"The story goes that Li's chef created chop suey for him out of the ingredients available to him one day, while Li was on tour in New York. This story is almost certainly not true. But what is true is that Li was a kind of celebrity to the eyes of the American public, and his visit resulted in an explosion of people wanting to try chop suey and Chinese cuisine."}),we(_i,{source:"https://upload.wikimedia.org/wikipedia/commons/d/d7/Li_Hung_Chang_in_1896.jpg",caption:"A picture of Li Hongzhang taken in 1896."}),we(_i,{source:"https://live.staticflickr.com/3152/2759164827_ae5fb6ff55_b.jpg",caption:"A photo by Charles Cushman showing a street in New York's Chinatown, including a chow mein restaurant and chop suey restaurant."})]}),hi("div",{className:"info",style:{display:E=="chop-suey-san-francisco"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.chopSueySanFrancisco.coordinates),zoom:cf,pitch:0,speed:Li})},children:"Close"}),we("span",{className:"title",children:"Chop Suey | San Francisco"}),we("span",{className:"text",children:"Chop suey is a simple dish composed of fried meat and vegetables over rice, with sauce. One of Chinese American cuisine's most famous products, the true origins of chop suey has been transcended by it's various mythical origin stories. No single origin story presents a firm case over any other."}),we("span",{className:"text",children:`One origin story states that chop suey was created by a Chinese chef. Supposedly, a group of drunk miners wandered into the chef's restaurant near closing hours. Even though the chef was out of fresh food, in order to avoid conflict with the miners, the cook threw together a quick dish made of whatever scraps he had left. When asked the name of the dish, the chef responded, "chop suey."`})]}),hi("div",{className:"info",style:{display:E=="chop-suey-california"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.chopSueyCaliforniaRailroad.coordinates),zoom:$i,pitch:0,speed:Li})},children:"Close"}),we("span",{className:"title",children:"Chop Suey | California Railroad"}),we("span",{className:"text",children:"Chop suey is a simple dish composed of fried meat and vegetables over rice, with sauce. One of Chinese American cuisine's most famous products, the true origins of chop suey has been transcended by it's various mythical origin stories. No single origin story presents a firm case over any other."}),we("span",{className:"text",children:"One origin story states that chop suey was created by a Chinese laborer working on the transcontinental railroad. The laborer was hired to work as a cook, feeding other railroad laborers. However, he did not have much experience with cooking, and threw together a simple dish of rice and stir fried meat and vegetables and called it chop suey."}),we(_i,{source:"http://reappropriate.co/wp-content/uploads/2014/04/tc-railroad.jpg",caption:"Chinese workers on the Transcontinental Railroad, which aimed to link East and West America to facilitate faster trade and travel."})]}),hi("div",{className:"info",style:{display:E=="orange-chicken"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.orangeChicken.coordinates),zoom:$i,pitch:0,speed:Li})},children:"Close"}),we("span",{className:"title",children:"Orange Chicken"}),we("span",{className:"text",children:"Orange chicken, a dish of thick sweet and sour orange flavored sauce coated on top of battered and fried chicken chunks, has become the most famous Chinese American dish. Almost synonymous with the popular Chinese chain restaurant Panda Express, the dish was invented by chef Andy Kao, who was working at a Panda Express location in Hawaii. Panda Express alone sells over 100 million pounds of orange chicken each year. The dish has inspired copycats in thousands of independent Chinese restaurants across America."}),we(_i,{source:"https://www.pandarg.com/sites/default/files/styles/timeline/public/timeline-images/pi-historical.jpg?itok=-Cqi5KUk",caption:"A picture of Panda Express founder Andrew Cherng (left), along with his wife Peggy (right), and his father Ming-Tsai Cherng, who created many of Panda Express' original recipes."})]}),hi("div",{className:"info",style:{display:E=="fortune-cookie"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.fortuneCookie.coordinates),zoom:cf,pitch:0,speed:Li})},children:"Close"}),we("span",{className:"title",children:"Fortune Cookies"}),hi("span",{className:"text",children:["Fortune cookies are signature creations of Chinese American restaurants, right? Well, some suggest they are actually Japanese in origin. Like many other foods, fortune cookies have an unclear past, although the case for the Japanese origin presents a strong one. This origin story belongs to a Japanese immigrant named Makoto Hagiwara. Supposedly, Makoto had adapted his cookie based on a treat in Japan referred to as ",we("i",{children:"omikuji senbei"}),", ",we("i",{children:"tsujiura suzu"}),", or",we("i",{children:"tsujiura senbei"}),", which was a crunchy cookie wrapped around a paper fortune."]}),we("span",{className:"text",children:"Makoto's restaurant, Japanese Tea Garden, and the bakery that made the cookies, Benkyodo, are both located right here in Japantown in San Francisco."}),we("span",{className:"text",children:"So, how did fortune cookies come to be known as Chinese treats? It appears to have been a simple case of Chinese restaurant owners buying the cookies as treats for their guests, and the association was made."}),we(_i,{source:"https://americanhistory.si.edu/sites/default/files/blog_files/a/6a00e553a80e1088340133f1ff8691970b-500wi.jpg",caption:"Senbei irons owned by Makoto Hagiwara, which were used to cook the fortune cookies."})]}),hi("div",{className:"info",style:{display:E=="oyster-pail"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.oysterPail.coordinates),zoom:$i,pitch:0,speed:Li})},children:"Close"}),we("span",{className:"title",children:"Chinese Takeout Box"}),we("span",{className:"text",children:`The grand Chinese takeout container started its life as a humble oyster pail. This container was actually created as a cheap replacement for wooden oyster pails, and was created by Frederick Weeks Wilcox, and patented in 1890. Chinese restaurants started to use it to hold food, since it was cheap and able to contain sauces without leaking. In the 1970's, a designer at the manufacturer Fold-Pak had the idea to put a pagoda and the words "Thank You", printed in red (an important Chinese color) to honor the Chinese restaurants using the pail, and the design stuck.`}),we(_i,{source:"https://patentimages.storage.googleapis.com/5d/c7/10/5173fd86634ffb/US426698-drawings-page-1.png",caption:"The patent for Frederick Weeks Wilcox's oyster pail."})]}),hi("div",{className:"info",style:{display:E=="chinese-fun-fact"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.chinese.chopSueyCaliforniaRailroad.coordinates),zoom:$i,pitch:0,speed:Li})},children:"Close"}),we("span",{className:"title",children:"1960 DNC Fortune Cookies"}),we("span",{className:"text",children:"At the 1960 Democratic National Convention in Los Angeles, Democratic primary candidates Stuart Symington and Adlai Stevenson handed out fortune cookies, showing the influence and awareness of Chinese cuisine in America."}),we(_i,{source:"https://upload.wikimedia.org/wikipedia/commons/b/bf/AdlaiEStevenson1900-1965.jpg",caption:"Picture of Adlai Stevenson"}),we(_i,{source:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Portrait_of_W._Stuart_Symington_97-1844.jpg",caption:"Picture of Stuart Symington"})]}),hi("div",{className:"info",style:{display:E=="south-italy"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.italian.southItaly.coordinates),zoom:$i,pitch:0,speed:Li}),f=="south-italy"&&(x("ellis-island"),ae.italian.ellisIsland.marker.addTo(l.current),de("it_south",Th,ae.italian.southItaly.coordinates,ae.italian.ellisIsland.coordinates))},children:"Close"}),we("span",{className:"title",children:"Southern Italy Immigration"}),we("span",{className:"text",children:"The story of Italian-American cuiine started when Italian immigrants initially moved from Italy due to poverty and hardship. Little opportunity lay for them, and started a massive emigration to countries all over the world. As always, the precise factors leading to this are complex, but Southern Italians faced disease and disaster, and the recent Unification of Italy, which combined many fragmented Italian states into a single nation brought social and political strife. The new and inexperienced government that arose from this revolution was incapable of addressing their needs."})]}),hi("div",{className:"info",style:{display:E=="ellis-island"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.italian.ellisIsland.coordinates),zoom:$i,pitch:0,speed:Li}),f=="ellis-island"&&(x("paris"),ae.italian.paris.marker.addTo(l.current),de("it_ellis",Th,ae.italian.ellisIsland.coordinates,ae.italian.paris.coordinates))},children:"Close"}),we("div",{className:"title",children:"Italian Immigration"}),we("span",{className:"text",children:"From the 1870s to 1920, over 4 million Italian immigrants arrived to America. There first step was here, at the infamous Ellis Island, where immigrants were checked and processed. Like so many other immigrants, many Italian immigrants worked to send money back home."}),we(_i,{source:"https://totalitalian.com/wp-content/uploads/2020/05/italian-ellis-island.jpg",caption:"Italian immigrants at Ellis Island."}),we("span",{className:"text",children:"At first, Italian food was seen as deeply unappealing due to racism. While Italian cuisine may be regarded as fine dining today, that was mostly associated with French cuisine back then. Garlic became a particular point of contention, with Americans claiming that they could not stand Italian immigrants and the smell of garlic in their food or on their persons. Indeed, Italians were not even regarded as white, and Americans reduced them to the level of colored peoples. Americans complained of the garlic and spice, and some even claimed Italian food made people crave alcohol."})]}),hi("div",{className:"info",style:{display:E=="paris"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.italian.paris.coordinates),zoom:$i,pitch:0,speed:Li}),f=="paris"&&(x("italian-washington-dc"),ae.italian.washingtonDC.marker.addTo(l.current),de("it_paris",Th,ae.italian.paris.coordinates,ae.italian.washingtonDC.coordinates))},children:"Close"}),we("span",{className:"title",children:"End of WWI"}),we("span",{className:"text",children:"The Treay of Versailles, which was signed here at the Palace of Versailles, ended WWI."}),we(_i,{source:"https://i1.wp.com/militaryhistorynow.com/wp-content/uploads/2019/06/672px-Treaty_of_Versailles_English_version.jpg?resize=560%2C864&ssl=1",caption:"The Treaty of Versailles"}),we("span",{className:"text",children:"The end of WWI meant a huge influx of Italians into America. This meant not only more people starting businesses in the restaurant industry, but also more people to serve. During this time, anti-Italian racism was still common, and so Italian restaurants mostly served Italian immigrants. However, the opening of many family restaurants was still an important step towards canonicalizing Italian cuisine in the halls of American culture."})]}),hi("div",{className:"info",style:{display:E=="italian-washington-dc"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.italian.washingtonDC.coordinates),zoom:$i,pitch:0,speed:Li}),f=="italian-washington-dc"&&(x("chef-boyardee part a"),ae.italian.chefBoyardeeA.marker.addTo(l.current),de("it_wash",Th,ae.italian.washingtonDC.coordinates,ae.italian.chefBoyardeeA.coordinates))},children:"Close"}),we("span",{className:"title",children:"Prohibition"}),we("span",{className:"text",children:"On October 28, 1919, Congress passed the Volstead Act, which instituted Prohibition, banning the sale of alcohol for consumption. Of course, as everyone knows, the Prohibition accomplished very little. Most turned to creating, selling, and consuming bootleg alcohol. A prohibition law clause allowed families to make their own small amount of alcohol each year. During the Prohibition, Italian growers shipped grapes to the East, where they would make the alcohol and illegally sell it to Italian restaurants. Wine grown and served by Italian-Americans caused Italian American cuisine to start to gain more mindshare in Americans. Additionally, the wine helped change the perception of Italians into something exotic and elegant, typical of Europe, rather than foreign and dirty."}),we(_i,{source:"https://americanhistory.si.edu/sites/default/files/Bocce%20Grapes.jpg",caption:'Grape crate label from a wine grape grower in California. The "Mondavi" name on the label shows Italian heritage.'})]}),hi("div",{className:"info",style:{display:E=="chef-boyardee part a"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.italian.chefBoyardeeA.coordinates),zoom:$i,pitch:0,speed:Li}),f=="chef-boyardee part a"&&(x("chef boyardee part b"),ae.italian.chefBoyardeeB.marker.addTo(l.current),de("it_chefa",Th,ae.italian.chefBoyardeeA.coordinates,ae.italian.chefBoyardeeB.coordinates))},children:"Close"}),we("span",{className:"title",children:"Chef Boyardee"}),we("span",{className:"text",children:"You may be surprised to know that the smiling man behind the can of Chef Boyardee was a real person. Born as Ettore Boiardi, he marketed under the Anglicized name Hector Boyardee to help consumers pronounce it."}),we("span",{className:"text",children:"Boiardi started his career young; he was hired as a cook at New York's Plaza Hotel when he was only 17. In 1924, Boiardi opened his restaurant Il Giardino d'Italia (Garden of Italy) in Cleveland with his wife Helen. His restaurant became very popular. Some of his consumers started asking for his recipes to make the dishes at home. He responded to this by filling bottles with his pasta sauce so that people could make the dishes at home. At first he filled up glass milk bottles, but the sauce became so popular he decided to work with a local canner instead. After this hit success, he got an idea to open up his own business selling home meals."}),we(_i,{source:"https://www.chefboyardee.com/sites/g/files/qyyrlu321/files/images/articles/af9ae38e9688fa3fd96b6cb44e8685d3-main.jpg",caption:"Picture of Chef Boyardee"})]}),hi("div",{className:"info",style:{display:E=="chef boyardee part b"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.italian.chefBoyardeeB.coordinates),zoom:$i,pitch:0,speed:Li}),f=="chef boyardee part b"&&(x("texas"),ae.mexican.texas.marker.addTo(l.current),de("boy-b",v1,ae.italian.chefBoyardeeB.coordinates,ae.mexican.texas.coordinates))},children:"Close"}),we("span",{className:"title",children:"Chef Boyardee"}),we("span",{className:"text",children:"Boiardi opened up his first manufacturing facility in Milton, Pennsylvania with the help of his brothers Mario and Paul. The company was a success, with the company becoming the largest importer of Italian Parmesan cheese. Boiardi's foods hit the store shelves. The delicious, cheap, and easy to prepare meals went a long way in popularizing Italian food for consumers, and opening them up to what was then considered foreign cuisine."}),we("span",{className:"text",children:"During WWII, Boiardi's factory in Milton ran 24/7 to create food for the war effort. After the war was over, Boiardi was awarded the Gold Star, a high ranking civilian honor award."}),we(_i,{source:"https://www.chefboyardee.com/sites/g/files/qyyrlu321/files/images/articles/cD02ODdhNTA4NDRjOTYzZDE4ZDBhYjM5ZjU2ZmM2OTA1MyZnPWVkOTU0NDY4MTAyYjE1YmIyNThjZGNjNzAxNTM0Nzcx.jpeg",caption:"Boiardi being awarded the Gold Star."})]}),hi("div",{className:"info",style:{display:E=="texas"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.mexican.texas.coordinates),zoom:$i,pitch:0,speed:Li}),f=="texas"&&(x("chili"),ae.mexican.chili.marker.addTo(l.current),de("me-tx",K_,ae.mexican.texas.coordinates,ae.mexican.chili.coordinates))},children:"Close"}),we("span",{className:"title",children:"Annexation of Texas"}),we("span",{className:"text",children:"One of the first times Mexican cuisine crossed into America was the annexation of Texas. After Americans had taken control of Texas from the Mexican government, America decided to annex it. However, there were still thousands of Mexicans living in Texas, called Tejanos. With a massive amount of foreigners and their cuisine suddenly in America (not to mention Mexico sharing a border with America), the cultural exchange started to happen."})]}),hi("div",{className:"info",style:{display:E=="chili"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.mexican.chili.coordinates),zoom:$i,pitch:0,speed:Li}),f=="chili"&&(x("tamales"),ae.mexican.tamales.marker.addTo(l.current),de("me-ch",K_,ae.mexican.chili.coordinates,ae.mexican.tamales.coordinates))},children:"Close"}),we("span",{className:"title",children:"Chili"}),we("span",{className:"text",children:"The first major presence of Mexican food in America was in San Antonio. In San Antonio, the dish chili con carne became extremely popular. One could go to many parts of the city, and see chili stands set up. Newspapers reported on the various Mexican establishments one could find in San Antonio, boasting of tamales, enchiladas, and chili con carne. Although some cooks may have slightly adjusted the recipes to American tastes, the food was very similar to what was in Mexico, complete with extremely spicy chilies."}),we("span",{className:"text",children:`While some claim that a chili stand at the 1893 World's Fair in Chicago popularized chili, there is little evidence to support this. The dish came much earlier. The dish became popular in San Antonio, and the flavorful but cheap and easy to make dish spread across America, dropping the "con carne" along the way.`}),we(_i,{source:"https://digital.utsa.edu/digital/api/singleitem/image/p9020coll2/1909/default.jpg",caption:"A chili stand in Haymarket Plaza in San Antonio."})]}),hi("div",{className:"info",style:{display:E=="tamales"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.mexican.tamales.coordinates),zoom:$i,pitch:0,speed:Li}),f=="tamales"&&(x("taco-bell"),ae.mexican.tacoBell.marker.addTo(l.current),de("me-ta",K_,ae.mexican.tamales.coordinates,ae.mexican.tacoBell.coordinates))},children:"Close"}),we("span",{className:"title",children:"Tamales | 1890s-1910s"}),we("span",{className:"text",children:"The next dish to continue pushing Mexican cuisine into the mainstream was the tamale. Unlike chili con carne, this one was actually present at the 1893 World's Fair. In San Francisco, travelling tamale salesmen sold tamales on the street. Although tamales are Mexican, many other ethnic groups sold tamales on the streets as well."}),we("span",{className:"text",children:"And the dish wasn't just popular in San Francisco. Tamale salesmen were common in Chicago, San Antonio, and many other cities. Eventually, the tamale salesman died out in favor of canned tamales coming off the factory line. The Workman Packing Company made 1800 tamales a day. in 1912, the company sold 140,000 cans of tamales."}),we(_i,{source:"https://digitallibrary.californiahistoricalsociety.org/islandora/object/islandora%3A2531/datastream/JPG/view",caption:"Label of canned tamales produced by Workman Packing Company, under the IXL brand."})]}),hi("div",{className:"info",style:{display:E=="taco-bell"?"flex":"none"},children:[we("div",{className:"close-button button",onClick:()=>{var Ae;I(null),(Ae=l.current)==null||Ae.dragPan.enable(),l.current.flyTo({center:bi(ae.mexican.tacoBell.coordinates),zoom:$i,pitch:0,speed:Li}),f=="taco-bell"&&x("mexican-additional")},children:"Close"}),we("span",{className:"title",children:"Taco Bell"}),we("span",{className:"text",children:"One of the most recognizable foods of Mexican American cuisine is the venerable taco. While tacos had been known to America for some time, especially thanks to George Ashley's homemade taco kit, tacos could not be found at many Mexican restaurants, and very few consumers had ever tried one. That all changed with the creation of Taco Bell."}),we("span",{className:"text",children:"Glen Bell, the founder of Taco Bell, had already experimented with tacos, opening various restaurants across California. However, the previous attempts were only mildly successful at best. Unlike them, Taco Bell was a hit. Indeed, tacos were not easily available until Taco Bell started selling them, no matter how inauthentic they may be. Consumers viewed the taco as an exotic, authentic Mexican food. By 1967, there were a hundred Taco Bells in California. From there, the chain only became more and more popular. Today, there are thousands worldwide. Despite Taco Bell being very different from authentic Mexican cuisine, it cannot be understated the effect of Taco Bell on popularizing Mexican American cuisine in the American conscious."}),we(_i,{source:"https://a.abcnews.com/images/Lifestyle/ht_first_taco_bell_original_jc_150319_16x9_992.jpg",caption:"The very first Taco Bell."})]})]})}Mb(document.querySelector("#app")).render(we(NC,{}));
